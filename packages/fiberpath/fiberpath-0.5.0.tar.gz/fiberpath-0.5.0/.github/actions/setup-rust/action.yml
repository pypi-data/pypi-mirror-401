name: Setup Rust Environment
description: Sets up Rust toolchain with caching and Linux dependencies

inputs:
  install-linux-deps:
    description: Whether to install Linux dependencies for Tauri
    required: false
    default: "false"
  working-directory:
    description: Working directory for cargo operations
    required: false
    default: "./fiberpath_gui/src-tauri"

runs:
  using: composite
  steps:
    - name: Set up Rust toolchain
      uses: dtolnay/rust-toolchain@stable

    - name: Cache cargo artifacts
      uses: actions/cache@v4
      with:
        path: |
          ~/.cargo/bin
          ~/.cargo/registry
          ~/.cargo/git
          ${{ inputs.working-directory }}/target
        key: ${{ runner.os }}-cargo-${{ hashFiles(format('{0}/Cargo.lock', inputs.working-directory)) }}
        restore-keys: |
          ${{ runner.os }}-cargo-

    - name: Install Linux dependencies
      if: runner.os == 'Linux' && inputs.install-linux-deps == 'true'
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          pkg-config \
          libgtk-3-dev \
          libwebkit2gtk-4.1-dev \
          libjavascriptcoregtk-4.1-dev \
          libayatana-appindicator3-dev \
          librsvg2-dev \
          patchelf
