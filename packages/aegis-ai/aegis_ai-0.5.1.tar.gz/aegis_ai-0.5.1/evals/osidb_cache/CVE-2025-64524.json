{
    "status": "success",
    "error_message": null,
    "cve_id": "CVE-2025-64524",
    "cwe_id": "CWE-120",
    "impact": "MODERATE",
    "title": "cups-filters: Heap buffer overflow in rastertopclx filter may lead arbitrary code execution",
    "statement": "Red Hat rates this Moderate. While the `rastertopclx` filter runs under the `lp` user, limiting direct root compromise, the vulnerability can be exploited remotely via the CUPS web interface by an attacker with low privileges to install a printer with a crafted PPD file. This could lead to a denial of service or potentially arbitrary code execution, impacting system availability.",
    "mitigation": "",
    "comment_zero": "Hi all,\n\nwe have embargoed CVE-2025-64524 in cups-filters project regarding heap\nbuffer overflow in rastertopclx reported by frostb1ten.\n\nSince the issue requires user to have additional permissions to install\nprinter with PPD file calling rastertopclx filter and the filter is run\nunder lp user which does not have root permissions, the vulnerability is\nLow with CVSS score 3.3 CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:L .\n\nMore details from the advisory:\n\nDetails\nThe vulnerability exists in the CompressData function of the\nrastertopclx filter, specifically at line 1474 in rastertopclx.c, where\nan unvalidated length parameter is used, leading to a write beyond\nallocated memory.\nThe code in question:\n```\n1474  *comp_ptr++ = (offset << 3) | (count - 1);\n```\nThis occurs in the following context, where comp_ptr is the pointer used\nfor compressed data and can cause the write beyond the allocated buffer:\n```\nvoid CompressData(unsigned char *line, int length, int plane, int pend,\nint type) {\n  unsigned char *comp_ptr = CompBuffer;\n  // ... compression logic ...\n  *comp_ptr++ = (offset << 3) | (count - 1);  // Vulnerable write\n}\n```\nThe malloc call in StartPage at line 828 allocates insufficient memory\nfor the subsequent operations:\n```\n828  CompBuffer = malloc(DotBufferSize * 4);\n```\nAs the buffer overflows, the AddressSanitizer output confirms the issue\nat this location:\n```\n==479967==ERROR: AddressSanitizer: heap-buffer-overflow on address\n0x5140000001ec at pc 0x55cd75225cec bp 0x7ffe1bb7bba0 sp 0x7ffe1bb7bb90\nWRITE of size 1 at 0x5140000001ec thread T0\n    #0 0x55cd75225ceb in CompressData filter/rastertopclx.c:1474\n```\n\nStack trace of the crash:\n```\n#0  CompressData (line=0x43d780 '\\377' <repeats 107 times>, length=0x23,\nplane=0x0, pend=0x56, type=0xa) at filter/rastertopclx.c:1474\n#1  0x0000000000407039 in OutputLine (ppd=0x0, header=0x7fffffffdc10) at\nfilter/rastertopclx.c:1644\n#2  0x0000000000407945 in main (argc=0x7, argv=0x7fffffffe498) at\nfilter/rastertopclx.c:1959\n```\n\nPoC\nTo reproduce the issue:\n1. Compile and run the CUPS filter (With or without ASAN)\n2. Unzip the provided crash.zip and execute the following command with\nthe crafted job:\n```\n/usr/lib/cups/filter/rastertopclx 1234 user \"Test Print Job\" 1\n\"option=value\" ./crash\n```\n3. The program will crash with a segmentation fault due to the\nheap-buffer overflow.\nThe crafted input manipulates the length and other parameters to trigger\nthe overflow in the CompressData function.\n\nImpact\nThis is a heap-buffer-overflow vulnerability. An attacker with control\nover the input data sent to the CUPS server (e.g., through print job\nparameters) could exploit this flaw to corrupt memory, potentially\nleading to arbitrary code execution on the system running the vulnerable\nCUPS instance.\nExploitation via CUPS Web Interface\nThis vulnerability can be exploited remotely through CUPS on port 631 by\nadding a printer with a PPD file configured to use the vulnerable\nrastertopclx filter. Below are the steps to replicate the attack:\n1. Add the Printer with a Custom PPD File: This step configures a\nprinter named frost to use the specified PPD file( from exploit.zip),\nwhich points to the vulnerable rastertopclx filter. The command used:\n```\nlpadmin -p frost -E -v ipp://localhost/ -P ./exploit.ppd\n```\nThis sets up the printer and enables it, using the PPD file that\nconfigures it to process jobs with rastertopclx.\n\n2. Send the Malicious Print Job: After setting up the printer, you can\nsend the crafted crash.zip as a print job to exploit the vulnerability:\n```\nlp -d frost -h localhost:631 ./crash\n```\n\nThis command sends the crash file to the printer, causing rastertopclx\nto process the file and subsequently trigger the buffer overflow.\n\n==================================================================================================\n\nProposed public date: November 20th 15:00 UTC\n\nProposed patches attached.",
    "comments": "",
    "description": "A flaw was found in cups-filters. This vulnerability allows a heap buffer overflow and memory corruption, potentially leading to arbitrary code execution or a Denial of Service, via an unvalidated length parameter in the CompressData function of the rastertopclx filter. This can be exploited by an attacker with permissions to install a printer with a PPD (PostScript Printer Description) file or remotely via the CUPS (Common Unix Printing System) web interface.",
    "components": [
        "cups-filters"
    ],
    "references": [
        {
            "url": "https://github.com/OpenPrinting/cups-filters/commit/956283c74a34ae924266a2a63f8e5f529a1abd06"
        }
    ],
    "affects": [
        {
            "affected": "AFFECTED",
            "ps_module": "fedora-42",
            "ps_product": "Community Projects",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "fedora-43",
            "ps_product": "Community Projects",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-10",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-10",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-10",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-7",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-8",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-8",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-8",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-8",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-8",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-9",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-9",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-9",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-9",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-9",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhel-9",
            "ps_product": "Red Hat Enterprise Linux",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        },
        {
            "affected": "AFFECTED",
            "ps_module": "rhivos-1",
            "ps_product": "Red Hat In-Vehicle OS",
            "ps_component": "cups-filters",
            "impact": "",
            "not_affected_justification": "",
            "delegated_not_affected_justification": ""
        }
    ],
    "cvss_scores": [
        {
            "issuer": "CVEORG",
            "vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:L"
        },
        {
            "issuer": "RH",
            "vector": "CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:L/A:H"
        }
    ]
}
