"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[3053],{65434(e,t,n){n.r(t),n.d(t,{ITableOfContentsRegistry:()=>c,ITableOfContentsTracker:()=>d,TableOfContents:()=>u,TableOfContentsFactory:()=>r,TableOfContentsItem:()=>v,TableOfContentsModel:()=>g,TableOfContentsPanel:()=>w,TableOfContentsRegistry:()=>x,TableOfContentsTracker:()=>H,TableOfContentsTree:()=>C,TableOfContentsUtils:()=>i,TableOfContentsWidget:()=>T});var s={};n.r(s),n.d(s,{getHeadingId:()=>R,getHeadings:()=>I,isMarkdown:()=>$,parseHeadings:()=>D});var i={};n.r(i),n.d(i,{Markdown:()=>s,NUMBERING_CLASS:()=>y,addPrefix:()=>O,clearNumbering:()=>P,filterHeadings:()=>A,getHTMLHeadings:()=>E,getPrefix:()=>M,isHTML:()=>k});var a=n(73475);class r{constructor(e){this.tracker=e}isApplicable(e){return!!this.tracker.has(e)}createNew(e,t){const n=this._createNew(e,t),s=e.context,i=()=>{n.refresh().catch(e=>{console.error("Failed to update the table of contents.",e)})},r=new a.ActivityMonitor({signal:s.model.contentChanged,timeout:200});r.activityStopped.connect(i);const l=()=>{n.title=a.PathExt.basename(s.localPath)};return s.pathChanged.connect(l),s.ready.then(()=>{l(),i()}).catch(e=>{console.error(`Failed to initiate headings for ${s.localPath}.`)}),e.disposed.connect(()=>{r.activityStopped.disconnect(i),s.pathChanged.disconnect(l)}),n}}var l=n(92410),o=n(25884),h=n(12756);const c=new o.Token("@jupyterlab/toc:ITableOfContentsRegistry","A service to register table of content factory."),d=new o.Token("@jupyterlab/toc:ITableOfContentsTracker","A widget tracker for table of contents.");var u;!function(e){e.defaultConfig={baseNumbering:1,maximalDepth:4,numberingH1:!0,numberHeaders:!1,includeOutput:!0,syncCollapseState:!1}}(u||(u={}));class g extends l.VDomModel{constructor(e,t){super(),this.widget=e,this._activeHeading=null,this._activeHeadingChanged=new h.Signal(this),this._collapseChanged=new h.Signal(this),this._configuration=null!=t?t:{...u.defaultConfig},this._headings=new Array,this._headingsChanged=new h.Signal(this),this._isActive=!1,this._isRefreshing=!1,this._needsRefreshing=!1}get activeHeading(){return this._activeHeading}get activeHeadingChanged(){return this._activeHeadingChanged}get collapseChanged(){return this._collapseChanged}get configuration(){return this._configuration}get headings(){return this._headings}get headingsChanged(){return this._headingsChanged}get isActive(){return this._isActive}set isActive(e){this._isActive=e,this._isActive&&!this.isAlwaysActive&&this.refresh().catch(e=>{console.error("Failed to refresh ToC model.",e)})}get isAlwaysActive(){return!1}get supportedOptions(){return["maximalDepth"]}get title(){return this._title}set title(e){e!==this._title&&(this._title=e,this.stateChanged.emit())}async refresh(){if(this._isRefreshing)return this._needsRefreshing=!0,Promise.resolve();this._isRefreshing=!0;try{const e=await this.getHeadings();if(this._needsRefreshing)return this._needsRefreshing=!1,this._isRefreshing=!1,this.refresh();e&&!this._areHeadingsEqual(e,this._headings)&&(this._headings=e,this.stateChanged.emit(),this._headingsChanged.emit())}finally{this._isRefreshing=!1}}setActiveHeading(e,t=!0){this._activeHeading!==e&&(this._activeHeading=e,this.stateChanged.emit()),t&&this._activeHeadingChanged.emit(this._activeHeading)}setConfiguration(e){const t={...this._configuration,...e};o.JSONExt.deepEqual(this._configuration,t)||(this._configuration=t,this.refresh().catch(e=>{console.error("Failed to update the table of contents.",e)}))}toggleCollapse(e){var t,n;if(e.heading)e.heading.collapsed=null!==(t=e.collapsed)&&void 0!==t?t:!e.heading.collapsed,this.stateChanged.emit(),this._collapseChanged.emit(e.heading);else{const t=null!==(n=e.collapsed)&&void 0!==n?n:!this.headings.some(e=>{var t;return!(null!==(t=e.collapsed)&&void 0!==t&&t)});this.headings.forEach(e=>e.collapsed=t),this.stateChanged.emit(),this._collapseChanged.emit(null)}}isHeadingEqual(e,t){return e.level===t.level&&e.text===t.text&&e.prefix===t.prefix}_areHeadingsEqual(e,t){if(e.length===t.length){for(let n=0;n<e.length;n++)if(!this.isHeadingEqual(e[n],t[n]))return!1;return!0}return!1}}var p,f=n(9521),m=n(73232),_=n(41468);class v extends m.PureComponent{render(){const{children:e,isActive:t,heading:n,onCollapse:s,onMouseDown:i}=this.props;return m.createElement(_.TreeItem,{className:"jp-tocItem jp-TreeItem nested",selected:t,expanded:!n.collapsed,onExpand:e=>{e.defaultPrevented||e.target.expanded===!n.collapsed||(e.preventDefault(),s(n))},onMouseDown:e=>{e.defaultPrevented||(e.preventDefault(),i(n))},onKeyUp:e=>{e.defaultPrevented||"Enter"!==e.key||t||(e.preventDefault(),i(n))}},m.createElement("div",{className:"jp-tocItem-heading"},m.createElement("span",{className:"jp-tocItem-content",title:n.text,...n.dataset},n.prefix,n.text)),e)}}class C extends m.PureComponent{render(){const{documentType:e}=this.props;return m.createElement(_.TreeView,{className:"jp-TableOfContents-content jp-TreeView","data-document-type":e},this.buildTree())}buildTree(){if(0===this.props.headings.length)return[];const e=t=>{const n=this.props.headings,s=new Array,i=n[t];let a=t+1;for(;a<n.length&&!(n[a].level<=i.level);){const[t,n]=e(a);s.push(t),a=n}return[m.createElement(v,{key:`${i.level}-${t}-${i.text}`,isActive:!!this.props.activeHeading&&i===this.props.activeHeading,heading:i,onMouseDown:this.props.setActiveHeading,onCollapse:this.props.onCollapseChange},s.length?s:null),a]},t=new Array;let n=0;for(;n<this.props.headings.length;){const[s,i]=e(n);t.push(s),n=i}return t}}class T extends l.VDomRenderer{constructor(e){super(e.model),this._placeholderHeadline=e.placeholderHeadline,this._placeholderText=e.placeholderText}render(){return this.model&&0!==this.model.headings.length?m.createElement(C,{activeHeading:this.model.activeHeading,documentType:this.model.documentType,headings:this.model.headings,onCollapseChange:e=>{this.model.toggleCollapse({heading:e})},setActiveHeading:e=>{this.model.setActiveHeading(e)}}):m.createElement("div",{className:"jp-TableOfContents-placeholder"},m.createElement("div",{className:"jp-TableOfContents-placeholderContent"},m.createElement("h3",null,this._placeholderHeadline),m.createElement("p",null,this._placeholderText)))}}class w extends l.SidePanel{constructor(e){super({content:new f.Panel,translator:e}),this._model=null,this.addClass("jp-TableOfContents"),this._title=new p.Header(this._trans.__("Table of Contents")),this.header.addWidget(this._title),this._treeview=new T({placeholderHeadline:this._trans.__("No Headings"),placeholderText:this._trans.__("The table of contents shows headings in notebooks and supported files.")}),this._treeview.addClass("jp-TableOfContents-tree"),this.content.addWidget(this._treeview)}get model(){return this._model}set model(e){var t,n;this._model!==e&&(null===(t=this._model)||void 0===t||t.stateChanged.disconnect(this._onTitleChanged,this),this._model=e,this._model&&(this._model.isActive=this.isVisible),null===(n=this._model)||void 0===n||n.stateChanged.connect(this._onTitleChanged,this),this._onTitleChanged(),this._treeview.model=this._model)}onAfterHide(e){super.onAfterHide(e),this._model&&(this._model.isActive=!1)}onBeforeShow(e){super.onBeforeShow(e),this._model&&(this._model.isActive=!0)}_onTitleChanged(){var e,t;this._title.setTitle(null!==(t=null===(e=this._model)||void 0===e?void 0:e.title)&&void 0!==t?t:this._trans.__("Table of Contents"))}}!function(e){class t extends f.Widget{constructor(e){const t=document.createElement("h2");t.textContent=e,t.classList.add("jp-text-truncated"),super({node:t}),this._title=t}setTitle(e){this._title.textContent=e}}e.Header=t}(p||(p={}));var b=n(82336);class x{constructor(){this._generators=new Map,this._idCounter=0}getModel(e,t){for(const n of this._generators.values())if(n.isApplicable(e))return n.createNew(e,t)}add(e){const t=this._idCounter++;return this._generators.set(t,e),new b.DisposableDelegate(()=>{this._generators.delete(t)})}}class H{constructor(){this.modelMapping=new WeakMap}add(e,t){this.modelMapping.set(e,t)}get(e){const t=this.modelMapping.get(e);return!t||t.isDisposed?null:t}}const y="numbering-entry";function A(e,t,n=[]){const s={...u.defaultConfig,...t},i=n;let a=i.length;const r=new Array;for(const t of e){if(t.skip)continue;const e=t.level;if(e>0&&e<=s.maximalDepth){const n=M(e,a,i,s);a=e,r.push({...t,prefix:n})}}return r}function k(e){return"text/html"===e}function E(e,t=!0){var n;const s=document.createElement("div");s.innerHTML=e;const i=new Array,a=s.querySelectorAll("h1, h2, h3, h4, h5, h6");for(const e of a){const t=parseInt(e.tagName[1],10);i.push({text:null!==(n=e.textContent)&&void 0!==n?n:"",level:t,id:null==e?void 0:e.getAttribute("id"),skip:e.classList.contains("jp-toc-ignore")||e.classList.contains("tocSkip")})}return i}function O(e,t,n){let s=e.querySelector(t);if(!s)return null;if(s.querySelector(`span.${y}`)){const i=e.querySelectorAll(t);for(const e of i)if(!e.querySelector(`span.${y}`)){s=e,S(e,n);break}}else S(s,n);return s}function M(e,t,n,s){const{baseNumbering:i,numberingH1:a,numberHeaders:r}=s;let l="";if(r){const s=a?1:2;if(e>t){for(let s=t;s<e-1;s++)n[s]=0;n[e-1]=e===s?i:1}else n[e-1]+=1,e<t&&n.splice(e);a?l=n.map(e=>null!=e?e:0).join(".")+". ":n.length>1&&(l=n.slice(1).map(e=>null!=e?e:0).join(".")+". ")}return l}function S(e,t){e.insertAdjacentHTML("afterbegin",`<span class="${y}">${t}</span>`)}function P(e){null==e||e.querySelectorAll(`span.${y}`).forEach(e=>{e.remove()})}var j=n(61960),N=n(7101);async function R(e,t,n,s){try{const i=document.createElement("div");await(0,N.renderMarkdown)({markdownParser:e,host:i,source:t,trusted:!1,sanitizer:null!=s?s:new j.Sanitizer,shouldTypeset:!1,resolver:null,linkHandler:null,latexTypesetter:null});const a=i.querySelector(`h${n}`);return a?(null==s?void 0:s.allowNamedProperties)?a.id:a.getAttribute("data-jupyter-id"):null}catch(e){console.error("Failed to parse a heading.",e)}return null}async function D(e,t){if(!t)return console.warn("Couldn't parse headings; Markdown parser is null"),[];const n=await t.render(e),s=new Array;return(new DOMParser).parseFromString(n,"text/html").querySelectorAll("h1, h2, h3, h4, h5, h6").forEach((e,t)=>{var n;const i=parseInt(e.tagName.substring(1),10),a=(null===(n=e.textContent)||void 0===n?void 0:n.trim())||"";s.push({text:a,line:t,level:i,raw:e.outerHTML,skip:F.test(e.outerHTML)})}),s}function I(e){const t=e.split("\n"),n=new Array;let s,i,a=0,r=0;if("---"===t[r])for(let e=r+1;e<t.length;e++)if("---"===t[e]){r=e+1;break}for(;r<t.length;r++){const e=t[r];if(""===e)continue;if(e.startsWith("```")||e.startsWith("~~~")){const t=q(e);if(0===t)continue;if(0===a){i=e.charAt(0),s=!s,a=t;continue}i===e.charAt(0)&&t>=a&&(s=!s,a=0,i="")}if(s)continue;const l=U(e,t[r+1]);l&&n.push({...l,line:r})}return n}function q(e){let t;return t=e.startsWith("`")?e.match(/^(`{3,})/):e.match(/^(~{3,})/),t?t[0].length:0}const L=["text/x-ipythongfm","text/x-markdown","text/x-gfm","text/markdown"];function $(e){return L.includes(e)}function U(e,t){let n=e.match(/^([#]{1,6}) (.*)/);return n?{text:W(n[2]),level:n[1].length,raw:e,skip:F.test(n[0])}:t&&(n=t.match(/^ {0,3}([=]{2,}|[-]{2,})\s*$/),n)?{text:W(e),level:"="===n[1][0]?1:2,raw:[e,t].join("\n"),skip:F.test(e)}:(n=e.match(/<h([1-6]).*>(.*)<\/h\1>/i),n?{text:n[2],level:parseInt(n[1],10),skip:F.test(n[0]),raw:e}:null)}function W(e){return e.replace(/\[(.+)\]\(.+\)/g,"$1")}const F=/<\w+\s(.*?\s)?class="(.*?\s)?(jp-toc-ignore|tocSkip)(\s.*?)?"(\s.*?)?>/}}]);