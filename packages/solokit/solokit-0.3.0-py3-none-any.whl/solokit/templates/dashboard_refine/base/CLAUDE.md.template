# CLAUDE.md - Project Guidelines for {project_name}

## Project Configuration

- **Stack**: {template_name}
- **Quality Tier**: {tier_name}
- **Test Coverage Target**: {coverage_target}%
- **Package Manager**: {package_manager}
- **Additional Options**: {additional_options}
- **Initialized With**: Solokit v{solokit_version}

This project was initialized with Solokit Session-Driven Development.

For detailed architecture patterns and code examples, see **ARCHITECTURE.md**.

---

## Building From Scratch

This project uses minimal scaffolding. You'll create files from scratch following the patterns in ARCHITECTURE.md:

1. **Read the PRD** at `docs/PRD.md` (if it exists)
2. **Understand the requirements** from the work item spec
3. **Create necessary files** following ARCHITECTURE.md patterns
4. **Write tests** alongside implementation
5. **Run quality gates** before completing with `/validate`

### Quick Pattern Reference

**Adding a New Resource:**

1. Configure data provider in `lib/refine.tsx`
2. Add resource definition to `lib/refine.tsx`
3. Create list page at `app/(dashboard)/[resource]/page.tsx`
4. Create forms at `app/(dashboard)/[resource]/create/page.tsx`
5. Add validation schema to `lib/validations.ts`
6. Add navigation link to `components/layout/sidebar.tsx`
7. Add tests alongside each file

**Data Provider Setup:**

```typescript
// lib/refine.tsx - Choose your backend:

// REST API
import dataProvider from "@refinedev/simple-rest";
export const refineDataProvider = dataProvider("https://api.example.com");

// Supabase
import { dataProvider } from "@refinedev/supabase";
export const refineDataProvider = dataProvider(supabaseClient);

// GraphQL
import dataProvider, { GraphQLClient } from "@refinedev/graphql";
export const refineDataProvider = dataProvider(client);
```

**Resource Definition:**

```typescript
// lib/refine.tsx
export const refineResources = [
  {
    name: "users",
    list: "/users",
    create: "/users/create",
    edit: "/users/edit/:id",
    show: "/users/show/:id",
  },
];
```

See ARCHITECTURE.md for complete code patterns and examples.

---

## Stack Architecture Rules

### Critical Rules

1. **Use Refine hooks for ALL CRUD operations**
   - `useTable()` for list pages
   - `useForm()` for create/edit pages
   - `useShow()` for detail pages
   - `useList()`, `useOne()`, `useCreate()`, `useUpdate()`, `useDelete()` for data fetching
   - NEVER implement custom CRUD logic

2. **Data Provider Pattern**
   - All API communication goes through the data provider
   - Configure data provider in `lib/refine.tsx`
   - **IMPORTANT**: The template includes a placeholder data provider that throws helpful errors
   - You MUST configure a real data provider before building features

3. **UI Components**
   - Use shadcn/ui components from `components/ui/`
   - Follow the existing theming system (CSS variables)
   - Use Tailwind CSS for styling

### File Organization

| New Code Type           | Location               |
| ----------------------- | ---------------------- |
| Resource pages          | `app/(dashboard)/`     |
| Shared components       | `components/`          |
| UI primitives           | `components/ui/`       |
| Form components         | `components/forms/`    |
| Refine config           | `lib/refine.tsx`       |
| Validation schemas      | `lib/validations.ts`   |

### Code Patterns

**List Page with useTable:**

```typescript
"use client";
import { useTable } from "@refinedev/core";
import { DataTable } from "@/components/ui/data-table";

export default function ProductList() {
  const { tableQueryResult } = useTable({
    resource: "products",
  });

  return <DataTable data={tableQueryResult.data?.data ?? []} />;
}
```

**Form Page with useForm:**

```typescript
"use client";
import { useForm } from "@refinedev/react-hook-form";

export default function ProductCreate() {
  const { refineCore: { onFinish }, register, handleSubmit } = useForm({
    resource: "products",
  });

  return (
    <form onSubmit={handleSubmit(onFinish)}>
      <input {...register("name")} />
      <button type="submit">Create</button>
    </form>
  );
}
```

### Common Mistakes to Avoid

- Writing custom fetch/axios calls for CRUD operations
- Not configuring a real data provider before building features
- Creating custom table components instead of using Refine's integration
- Not defining resources in the Refine configuration
- Bypassing the data provider for API calls

---

## Solokit Usage Guide

This project uses Solokit for Session-Driven Development. Follow these guidelines for consistent and effective usage.

### Understanding Solokit Commands

Solokit commands are available as **slash commands** in Claude Code (e.g., `/start`, `/end`, `/work-new`) or via the `sk` CLI in terminal. **Slash commands are preferred** as they provide interactive prompts.

For CLI usage with specific arguments, use `--help` to discover options:

```bash
sk <command> --help
```

### Work Item Management

#### Creating Work Items

**When asked to create a work item, ALWAYS use the CLI:**

```bash
# First, check available options
sk work-new --help

# Create with required fields
sk work-new --type feature --title "Add user authentication" --priority high

# With dependencies
sk work-new --type feature --title "Add OAuth" --priority high --dependencies feat_user_auth

# Mark as urgent
sk work-new --type bug --title "Fix critical login error" --priority critical --urgent
```

**NEVER create work items by directly editing `work_items.json`.**

**Valid Types**: feature, bug, refactor, security, integration_test, deployment
**Valid Priorities**: critical, high, medium, low

#### Listing Work Items

```bash
# List all work items
sk work-list

# Filter by status
sk work-list --status not_started
sk work-list --status in_progress

# Filter by type
sk work-list --type bug

# Filter by milestone
sk work-list --milestone "v1.0"
```

#### Viewing Work Item Details

```bash
sk work-show <work_item_id>
```

#### Updating Work Items

```bash
# Check available update options
sk work-update --help

# Update status
sk work-update feat_001 --status in_progress

# Update priority
sk work-update feat_001 --priority critical

# Add dependency
sk work-update feat_001 --add-dependency feat_002

# Mark as urgent
sk work-update feat_001 --set-urgent
```

#### Deleting Work Items

```bash
sk work-delete <work_item_id>
```

### Spec File Guidelines

**CRITICAL: When creating work items, spec files are automatically created from templates.**

#### Spec File Location

- Spec files are stored in `.session/specs/`
- Each work item gets a spec file: `.session/specs/{work_item_id}.md`

#### When to Update Spec Files

1. **After creating a work item** - Fill in the template placeholders
2. **Before starting work** - Ensure spec is complete
3. **During implementation** - Update with any changes or discoveries

#### Spec File Best Practices

1. **Always use the template structure**
   - Don't create spec files from scratch
   - Use the existing template in `.session/specs/`
   - Fill in ALL sections, don't leave placeholders

2. **Be thorough and consistent**
   - If creating multiple work items, give EQUAL attention to each spec file
   - Don't write detailed specs for the first few and brief specs for the rest
   - Each spec file should have the same level of detail

3. **Include acceptance criteria**
   - Every spec must have clear, testable acceptance criteria
   - These will be used during `/validate` and `/end`

4. **Link related work items**
   - Reference dependencies in the spec
   - Note any blocking or blocked-by relationships

#### Spec File Template Structure

```markdown
# Work Item: {title}

## Overview

[Clear description of what this work item accomplishes]

## Acceptance Criteria

- [ ] Criterion 1
- [ ] Criterion 2
- [ ] Criterion 3

## Technical Approach

[How will this be implemented?]

## Dependencies

[List any work items this depends on]

## Testing Requirements

[What tests need to be written?]

## Notes

[Any additional context]
```

### Session Workflow

#### Starting a Session

Use `/start` to begin a session:

```bash
/start                    # Interactive - select from available work items
/start <work_item_id>     # Start specific work item
```

The start command:

- Updates work item status to `in_progress`
- Generates a session briefing in `.session/briefings/`
- Provides context about the work item and dependencies

#### Checking Session Status

Use `/status` to check current session:

```bash
/status
```

Shows:

- Current work item
- Session duration
- Quality gate status
- Pending tasks

#### Validating Without Ending

Use `/validate` to check quality gates:

```bash
/validate
```

Runs quality gates without ending the session:

- Test coverage check
- Linting
- Type checking
- Spec completion status

Use this frequently during development to catch issues early.

#### Ending a Session

Use `/end` to complete a session:

```bash
/end
```

The end command:

- Runs all quality gate validations
- Prompts for session summary
- Updates work item status if complete
- Generates session history in `.session/history/`
- Prompts for learning capture

**IMPORTANT**: Always end sessions properly. Don't abandon sessions.

### Learning Capture

#### When to Capture Learnings

Capture learnings when you:

- Solve a tricky problem
- Discover a better pattern
- Find an important gotcha
- Learn something about the codebase

#### How to Capture Learnings

**Method 1: During Session End (Preferred)**
When running `/end`, you'll be prompted to capture learnings. This is the preferred method as it links learnings to the session context.

**Method 2: Explicit Command**

```bash
/learn
```

This will prompt for:

- Learning title
- Description
- Category
- Tags

#### Learning Storage

- Learnings are stored in `.session/tracking/learnings.json`
- They are indexed and searchable
- They persist across sessions

#### Searching Learnings

```bash
/learn-search "authentication"
```

#### Viewing Learnings

```bash
/learn-show                           # Show all learnings
/learn-show --category debugging      # Filter by category
/learn-show --tag authentication      # Filter by tag
```

**IMPORTANT**:

- Always capture learnings through Solokit commands, not by editing JSON directly
- Don't put learnings in commit messages - use the learning system
- Learnings should be reusable knowledge, not task-specific notes

### Dependency Graph

Visualize work item dependencies:

```bash
/work-graph                       # Generate dependency graph
/work-graph --focus feat_001      # Focus on specific work item
/work-graph --critical-path       # Show critical path
/work-graph --bottlenecks         # Show bottlenecks
```

---

## Claude Behavior Guidelines

### Be Thorough

1. **Complete all tasks fully**
   - Don't rush through multiple items
   - Give equal attention to each task
   - If creating 5 work items, each spec file should be equally detailed

2. **Don't make assumptions**
   - Ask clarifying questions when requirements are ambiguous
   - Confirm understanding before making significant changes
   - When in doubt, ask rather than guess

3. **Follow established patterns**
   - Check existing code for patterns before writing new code
   - Maintain consistency with the codebase style
   - Reference ARCHITECTURE.md for stack-specific patterns

4. **Validate your work**
   - Run `/validate` after making changes
   - Ensure tests pass before considering work complete
   - Check that linting and type checking pass

### Ask Clarifying Questions When

- Requirements are vague or could be interpreted multiple ways
- You're unsure which of several approaches to take
- The task might affect other parts of the codebase
- You need to make architectural decisions
- The user's request conflicts with existing patterns

### Writing PRDs

When asked to create or write a PRD:

1. **Always read `.session/guides/PRD_WRITING_GUIDE.md` first** - This guide is mandatory
2. Follow the structure and best practices defined there
3. Use vertical slices, not horizontal layers (see guide for details)
4. Include all required sections: technical constraints, acceptance criteria, error cases
5. Reference `.session/guides/STACK_GUIDE.md` for stack-specific considerations
6. Save the PRD at `docs/PRD.md`

**IMPORTANT**: Do NOT write PRDs from memory or general knowledge. The PRD_WRITING_GUIDE.md contains Solokit-specific patterns that ensure PRDs translate correctly into work items.

### Reference Documentation

- **ARCHITECTURE.md** - For stack-specific patterns, conventions, and code examples
- **README.md** - For project-specific configuration and getting started
- **.session/specs/** - For work item requirements and acceptance criteria
- **.session/guides/PRD_WRITING_GUIDE.md** - **MUST follow when writing PRDs**
- **.session/guides/STACK_GUIDE.md** - For understanding stack choice and capabilities
- **sk <command> --help** - For Solokit command options

---

## What NOT to Do

### Never Do These

1. **Don't edit tracking files directly**
   - NEVER edit `.session/tracking/work_items.json` manually
   - NEVER edit `.session/tracking/learnings.json` manually
   - Always use `sk` commands to modify these files

2. **Don't skip the spec file template**
   - NEVER create spec files from scratch
   - ALWAYS use the template structure in `.session/specs/`
   - ALWAYS fill in all sections of the template

3. **Don't be inconsistent with multiple items**
   - If creating multiple work items, don't write detailed specs for the first few and brief specs for the rest
   - Each item deserves equal attention and thoroughness

4. **Don't put learnings in wrong places**
   - NEVER add learnings to commit messages
   - NEVER create random learning files outside the system
   - ALWAYS use `/learn` or capture during `/end`

5. **Don't ignore the architecture**
   - NEVER violate stack-specific rules (see Stack Architecture Rules above)
   - NEVER use patterns that contradict ARCHITECTURE.md
   - NEVER skip validation steps

6. **Don't guess command options**
   - NEVER assume you know all options for an `sk` command
   - ALWAYS run `sk <command> --help` first if unsure
   - NEVER pass invalid arguments to commands

7. **Don't abandon sessions**
   - NEVER leave a session without running `/end`
   - NEVER start a new session without ending the current one
   - ALWAYS complete the session workflow properly

8. **Don't skip quality gates**
   - NEVER commit code that fails linting
   - NEVER commit code that fails type checking
   - NEVER commit code without running tests
   - NEVER bypass pre-commit hooks with `--no-verify`

### Stack-Specific Anti-Patterns

#### dashboard_refine

- DON'T write custom CRUD logic - use Refine hooks
- DON'T deploy without configuring a real data provider
- DON'T bypass the data provider for API calls

---

## Quality Requirements

**Quality Tier**: {tier_name}
**Test Coverage Target**: {coverage_target}%

### Required Quality Gates

All code changes must pass these quality gates before completion:

#### All Tiers

- [ ] All tests pass
- [ ] Code is formatted (run formatter before commit)
- [ ] No linting errors
- [ ] Type checking passes
- [ ] Test coverage meets {coverage_target}% target

#### Additional Requirements by Tier

{tier_specific_requirements}

### Running Quality Checks

```bash
# Run all quality validations
/validate

# Manual checks for {template_id}:
npm test                 # Run tests
npm run test:coverage    # Check coverage
npm run lint             # Run linting
npm run type-check       # Run type checking
```

### Pre-Commit Hooks

This project has pre-commit hooks installed. They run automatically on `git commit`.

If hooks fail:

1. Fix the issues reported
2. Stage the fixes: `git add .`
3. Commit again

To bypass hooks (NOT RECOMMENDED):

```bash
git commit --no-verify
```

---

## Quick Reference

### Solokit Commands (Slash Commands)

| Command                     | Description                    |
| --------------------------- | ------------------------------ |
| `/work-list`                | List all work items            |
| `/work-show <id>`           | Show work item details         |
| `/work-new`                 | Create new work item           |
| `/work-update <id>`         | Update work item               |
| `/work-delete <id>`         | Delete work item               |
| `/work-graph`               | Visualize dependencies         |
| `/work-next`                | Get next recommended work item |
| `/start [id]`               | Start a session                |
| `/status`                   | Check session status           |
| `/validate`                 | Validate quality gates         |
| `/end`                      | End session                    |
| `/learn`                    | Capture a learning             |
| `/learn-show`               | View learnings                 |
| `/learn-search <query>`     | Search learnings               |

### Key Files

| File                                     | Purpose                                       |
| ---------------------------------------- | --------------------------------------------- |
| `CLAUDE.md`                              | AI guidance (this file)                       |
| `ARCHITECTURE.md`                        | Stack architecture guide (detailed patterns)  |
| `README.md`                              | Project quick start                           |
| `.session/guides/PRD_WRITING_GUIDE.md`   | PRD authoring guide (MUST follow for PRDs)    |
| `.session/guides/STACK_GUIDE.md`         | Stack selection and capabilities guide        |
| `.session/tracking/work_items.json`      | Work item data (use `sk` commands)            |
| `.session/tracking/learnings.json`       | Captured learnings (use `sk` commands)        |
| `.session/specs/`                        | Work item specifications                      |
| `.session/briefings/`                    | Session briefings                             |
| `.session/history/`                      | Session summaries                             |

### Development Commands

```bash
# Install dependencies
npm install

# Run development server
npm run dev

# Build for production
npm run build

# Start production server
npm start
```

### Testing Commands

```bash
# Run all tests
npm test

# Run tests with coverage
npm run test:coverage

# Run linting
npm run lint

# Run type checking
npm run type-check

# Run E2E tests (tier-3+)
npm run test:e2e

# Run accessibility tests (tier-4)
npm run test:a11y

# Run Lighthouse CI (tier-4)
npm run lighthouse
```
