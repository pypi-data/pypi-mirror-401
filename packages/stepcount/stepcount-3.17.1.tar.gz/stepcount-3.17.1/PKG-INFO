Metadata-Version: 2.4
Name: stepcount
Version: 3.17.1
Summary: Step counter for wrist-worn accelerometers compatible with the UK Biobank Accelerometer Dataset
Home-page: https://github.com/OxWearables/stepcount
Download-URL: https://github.com/OxWearables/stepcount
Author: Shing Chan, Scott Small, Gert Mertes, Aiden Doherty
Maintainer: Shing Chan
Maintainer-email: shing.chan@ndph.ox.ac.uk
License: See LICENSE file.
Classifier: Programming Language :: Python :: 3
Classifier: Topic :: Scientific/Engineering
Classifier: Topic :: Scientific/Engineering :: Bio-Informatics
Classifier: Topic :: Scientific/Engineering :: Information Analysis
Classifier: Topic :: Scientific/Engineering :: Medical Science Apps.
Requires-Python: >=3.8, <3.11
Description-Content-Type: text/markdown
License-File: LICENSE.md
Requires-Dist: actipy>=3.8.0
Requires-Dist: numpy==1.24.*
Requires-Dist: scipy==1.10.*
Requires-Dist: pandas==2.0.*
Requires-Dist: tqdm==4.64.*
Requires-Dist: joblib==1.2.*
Requires-Dist: scikit-learn==1.1.1
Requires-Dist: imbalanced-learn==0.9.1
Requires-Dist: hmmlearn==0.3.*
Requires-Dist: torch==1.13.*
Requires-Dist: torchvision==0.14.*
Requires-Dist: transforms3d==0.4.*
Requires-Dist: numba==0.58.*
Requires-Dist: matplotlib==3.7.*
Provides-Extra: dev
Requires-Dist: flake8; extra == "dev"
Requires-Dist: autopep8; extra == "dev"
Requires-Dist: ipython; extra == "dev"
Requires-Dist: ipdb; extra == "dev"
Requires-Dist: twine; extra == "dev"
Requires-Dist: tomli; extra == "dev"
Requires-Dist: jupyter; extra == "dev"
Requires-Dist: matplotlib; extra == "dev"
Requires-Dist: pytest>=7.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0; extra == "dev"
Provides-Extra: docs
Requires-Dist: sphinx>=4.2; extra == "docs"
Requires-Dist: sphinx_rtd_theme>=1.0; extra == "docs"
Requires-Dist: readthedocs-sphinx-search>=0.1; extra == "docs"
Requires-Dist: sphinxcontrib-programoutput>=0.17; extra == "docs"
Requires-Dist: docutils<0.18; extra == "docs"
Dynamic: author
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: download-url
Dynamic: home-page
Dynamic: license
Dynamic: license-file
Dynamic: maintainer
Dynamic: maintainer-email
Dynamic: provides-extra
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# stepcount

[![Github all releases](https://img.shields.io/github/release/OxWearables/stepcount.svg)](https://github.com/OxWearables/stepcount/releases/)
[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.14535974.svg)](https://doi.org/10.5281/zenodo.14535974)

Improved step counting based on a foundation model for wrist-worn accelerometers.

The foundation model was trained using self-supervised learning on the large-scale [UK Biobank Accelerometer Dataset](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0169649), and fine-tuned on the [OxWalk Dataset](https://ora.ox.ac.uk/objects/uuid:19d3cb34-e2b3-4177-91b6-1bad0e0163e7).

The command-line tool can process Axivity AX3 files (UK Biobank, China Kadoorie Biobank) directly. For consumer devices like Fitbit and Apple Watch, convert them to raw CSV first.

Available models:
- Self-supervised learning model of Hang et al. (default): https://www.nature.com/articles/s41746-024-01062-3
- Random forest (enable with the flag `-t rf`)

## ðŸ“¦ Install

**Minimum requirements**: ðŸ Python >=3.8 and <3.11, â˜• Java 8 (1.8)

The following instructions make use of Anaconda to meet the minimum requirements:

1. Download & install [Miniconda](https://docs.conda.io/en/latest/miniconda.html) (light-weight version of Anaconda).
1. (Windows) Once installed, launch the **Anaconda Prompt**.
1. Create a virtual environment:
    ```console
    $ conda create -n stepcount python=3.9 openjdk pip
    ```
    This creates a virtual environment called `stepcount` with Python version 3.9, OpenJDK, and Pip.
1. Activate the environment:
    ```console
    $ conda activate stepcount
    ```
    You should now see `(stepcount)` written in front of your prompt.
1. Install `stepcount`:
    ```console
    $ pip install stepcount
    ```

You are all set! The next time that you want to use `stepcount`, open the Anaconda Prompt and activate the environment (step 4). If you see `(stepcount)` in front of your prompt, you are ready to go!

Check out the 5-minute video tutorial to get started: [https://www.youtube.com/watch?v=FPb7H-jyRVQ](https://www.youtube.com/watch?v=FPb7H-jyRVQ).

## ðŸ’» Usage

```bash
# Process an AX3 file
$ stepcount sample.cwa

# Or an ActiGraph file
$ stepcount sample.gt3x

# Or a GENEActiv file
$ stepcount sample.bin

# Or a CSV file (see data format below)
$ stepcount sample.csv
```

Output:
```console
Summary
-------
{
    "Filename": "sample.cwa",
    "Filesize(MB)": 65.1,
    "Device": "Axivity",
    "DeviceID": 2278,
    "ReadErrors": 0,
    "SampleRate": 100.0,
    "ReadOK": 1,
    "StartTime": "2013-10-21 10:00:07",
    "EndTime": "2013-10-28 10:00:01",
    "TotalWalking(min)": 655.75,
    "TotalSteps": 43132,
    ...
}

Estimated Daily Steps
---------------------
              steps
time
2013-10-21     5368
2013-10-22     7634
2013-10-23    10009
...

Output: outputs/sample/
```
Refer to the [GLOSSARY.md](https://github.com/OxWearables/stepcount/blob/main/GLOSSARY.md) for a comprehensive list of outputs.

### ðŸ”§ Troubleshooting 
Some systems may face issues with Java when running the script. If this is your case, try fixing OpenJDK to version 8:
```console
$ conda install -n stepcount openjdk=8
```

### ðŸ“ Output files
By default, output files will be stored in a folder named after the input file, `outputs/{filename}/`, created in the current working directory. You can change the output path with the `-o` flag:

```console
$ stepcount sample.cwa -o /path/to/some/folder/
```

The following output files will be generated (CSV files are gzipped):

- `Info.json` Summary info and high-level metrics.
- `Steps.csv.gz` Per-window step counts (10 s windows for SSL).
- `StepTimes.csv.gz` Timestamps of each detected step (one per row).
- `Minutely.csv.gz` Minute-level steps and ENMO; `MinutelyAdjusted.csv.gz` with time-of-day imputation.
- `Hourly.csv.gz` Hourly steps and ENMO; `HourlyAdjusted.csv.gz` with time-of-day imputation.
- `Daily.csv.gz` Daily metrics (steps, walking mins, step percentile times, cadence peaks, ENMO);
  `DailyAdjusted.csv.gz` after time-of-day imputation.
- `Bouts.csv.gz` Detected walking bouts with duration, steps, cadence stats, ENMO.
- `Steps.png` Per-day plot of steps/min with missing periods shaded.

Notes
- All CSVs are gzipped (`.csv.gz`).
- `Steps.csv.gz` is window-level. SSL uses 10 s windows).
- â€œAdjustedâ€ CSVs apply time-of-day imputation, accounting for wear-time thresholds. Short recordings may show many NaNs.

### ðŸ¤– Machine learning model type
By default, the `stepcount` tool employs a self-supervised Resnet18 model to detect walking periods.
However, it is possible to switch to a random forest model, by using the `-t` flag:

```console
$ stepcount sample.cwa -t rf
```

When using the random forest model, a set of signal features is extracted from the accelerometer data. 
These features are subsequently used as inputs for the model's classification process. 
For a comprehensive list of the extracted features, see [the glossary](https://github.com/OxWearables/stepcount/blob/main/GLOSSARY.md#random-forest-feature-list).


### ðŸ“ˆ Crude vs. Adjusted Estimates
Adjusted estimates are provided that account for missing data.
Missing values in the time-series are imputed with the mean of the same timepoint of other available days.
For adjusted totals and daily statistics, 24h multiples are needed and will be imputed if necessary.
Estimates will be NaN where data is still missing after imputation.


### ðŸ“„ Processing CSV files
If a CSV file is provided, the following header is expected: `time`, `x`, `y`, `z`. 

Example:
```console
time,x,y,z
2013-10-21 10:00:08.000,-0.078923,0.396706,0.917759
2013-10-21 10:00:08.010,-0.094370,0.381479,0.933580
2013-10-21 10:00:08.020,-0.094370,0.366252,0.901938
2013-10-21 10:00:08.030,-0.078923,0.411933,0.901938
...
```

If the CSV file has a different header, use the option `--txyz` to specify the time and x-y-z columns, in that order. For example:

```console
HEADER_TIMESTAMP,X,Y,Z
2013-10-21 10:00:08.000,-0.078923,0.396706,0.917759
2013-10-21 10:00:08.010,-0.094370,0.381479,0.933580
2013-10-21 10:00:08.020,-0.094370,0.366252,0.901938
2013-10-21 10:00:08.030,-0.078923,0.411933,0.901938
...
```

then use:
```console
$ stepcount my-file.csv --txyz HEADER_TIMESTAMP,X,Y,Z
```


### âš™ï¸ Processing multiple files
#### Windows
To process multiple files you can create a text file in Notepad which includes one line for each file you wish to process, as shown below for *file1.cwa*, *file2.cwa*, and *file2.cwa*.

Example text file *commands.txt*: 
```console
stepcount file1.cwa &
stepcount file2.cwa &
stepcount file3.cwa 
:END
````
Once this file is created, run `cmd < commands.txt` from the terminal.

#### Linux
Create a file *command.sh* with:
```console
stepcount file1.cwa
stepcount file2.cwa
stepcount file3.cwa
```
Then, run `bash command.sh` from the terminal.

#### ðŸ“Š Collating outputs

A utility script is provided to collate outputs from multiple runs:

```console
$ stepcount-collate-outputs outputs/
```
This collates summaries into `collated-outputs/` by default:
- `Info.csv.gz` from all `*-Info.json`
- `Daily.csv.gz`, `Hourly.csv.gz`, `Minutely.csv.gz`, and `Bouts.csv.gz` from matching CSVs


## ðŸ¤ Contributing
If you would like to contribute to this repository, please check out [CONTRIBUTING.md](https://github.com/OxWearables/stepcount/blob/main/CONTRIBUTING.md).
We welcome contributions in the form of bug reports, feature requests, and pull requests. 


## ðŸ“š Citing our work

When using this tool, please consider citing the works listed in [CITATION.md](https://github.com/OxWearables/stepcount/blob/main/CITATION.md).


## ðŸ“œ Licence
See [LICENSE.md](https://github.com/OxWearables/stepcount/blob/main/LICENSE.md).


## ðŸ™ Acknowledgements
We would like to thank all our code contributors, manuscript co-authors, and research participants for their help in making this work possible.
