# Nekhebet Core
**Cryptographically Verifiable Events ‚Äî Signing & Verification Core**

![MIT License](https://img.shields.io/badge/license-MIT-blue.svg)
![Python](https://img.shields.io/badge/python-3.11+-blue)
![msgspec](https://img.shields.io/badge/serialization-msgspec-orange)
![Ed25519](https://img.shields.io/badge/signature-Ed25519-9cf)

## üî∫ –û–±–∑–æ—Ä

**Nekhebet Core** ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è, –ø–æ–¥–ø–∏—Å–∏ –∏ —Å—Ç—Ä–æ–≥–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –≤ zero-trust –º–æ–¥–µ–ª–∏.

–≠—Ç–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

- –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ RFC 8785 (JCS)
- –ø–æ–¥–ø–∏—Å—å –∏ –ø—Ä–æ–≤–µ—Ä–∫—É Ed25519
- –∑–∞—â–∏—Ç—É –æ—Ç replay-–∞—Ç–∞–∫
- –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫ –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π
- –∂—ë—Å—Ç–∫—É—é –∑–∞—â–∏—Ç—É –æ—Ç DoS –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

Core –∑–∞–¥–∞—ë—Ç **–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏** –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã Nekhebet: –µ—Å–ª–∏ —Å–æ–±—ã—Ç–∏–µ –ø—Ä–æ—à–ª–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é ‚Äî –æ–Ω–æ –ø–æ–¥–ª–∏–Ω–Ω–æ–µ, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—Ä–µ–¥—ã.

## üî∫ –ö–ª—é—á–µ–≤–æ–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç

> –°–æ–±—ã—Ç–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞,  
> –∫–æ–≥–¥–∞ –µ–≥–æ –ø–æ–¥–ø–∏—Å—å –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—à–ª–∏ –ø–æ–ª–Ω—É—é –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é.

## üî∫ –û—Å–Ω–æ–≤–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏

- –¢–æ–ª—å–∫–æ **Ed25519** + **SHA-256**
- –ö–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–≥–æ –ø–æ **RFC 8785** (JCS)
- Replay-–∑–∞—â–∏—Ç–∞ –ø–æ —Ç—Ä–æ–π–∫–µ `(key_id, nonce, issued_at)`
- Zero-trust: –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç –Ω–∏—á–µ–º—É –∏–∑ —ç—Ç–∞–ø–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- –ñ—ë—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã: 1 MiB –Ω–∞ –∫–∞–Ω–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π payload, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –≥–ª—É–±–∏–Ω–∞, —Ñ–æ—Ä–º–∞—Ç nonce –∏ —Ç.–¥.
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞—É–¥–∏—Ç–∞
- –ú–µ—Ç—Ä–∏–∫–∏ signing/verification –ø–æ —Ç–∏–ø–∞–º —Å–æ–±—ã—Ç–∏–π

## üî∫ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±
pip install nekhebet-core
```

```bash
# –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
pip install git+https://github.com/nekhebet/nekhebet-core.git@main
```

```bash
# –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–æ–≤ (—Å–∞–º—ã–π —É–¥–æ–±–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
git clone https://github.com/nekhebet/nekhebet-core.git
cd nekhebet-core
pip install -e ".[dev]"          # —Å mypy, pytest, ruff –∏ —Ç.–¥.
```

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
- `msgspec>=0.18` ‚Äî –±—ã—Å—Ç—Ä–∞—è –∏ —Å—Ç—Ä–æ–≥–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è
- `cryptography>=42.0.0` ‚Äî Ed25519

–¢—Ä–µ–±—É–µ—Ç—Å—è **Python 3.10+**.

–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```python
import nekhebet_core
print(nekhebet_core.__version__)                    # ‚Üí 4.0.0 (–∏–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è)
print(nekhebet_core.MAX_ABSOLUTE_PAYLOAD_SIZE)      # ‚Üí 1048576
```

## üî∫ –§–æ—Ä–º–∞—Ç —Å–æ–±—ã—Ç–∏—è (SignedEnvelope)

```json
{
  "header": {
    "id":               "550e8400-e29b-41d4-a716-446655440000",
    "type":             "omen.observed",
    "version":          "4.0.0",
    "source":           "collector-01",
    "issued_at":        "2026-01-13T09:45:12.345Z",
    "expires_at":       "2026-01-13T10:45:12.345Z",   // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    "nonce":            "a1b2c3d4e5f67890... (32‚Äì100 hex chars)",
    "key_id":           "ed25519:reg-001",
    "algorithm":        "ed25519",
    "canonicalization": "rfc8785",
    "payload_hash":     "64 —Å–∏–º–≤–æ–ª–∞ sha256 lowercase",
    "context":          { ... },                      // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    "extensions":       { ... }                       // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  },
  "payload": {
    // –ª—é–±—ã–µ JSON-–∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –¥–æ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  },
  "signature": {
    "signature":  "base64(64 –±–∞–π—Ç–∞ Ed25519 signature)",
    "public_key": "base64(32 –±–∞–π—Ç–∞ Ed25519 public key)"
  }
}
```

## üî∫ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from nekhebet_core import (
    create_envelope,
    sign_envelope,
    verify_envelope,
    DefaultSigningContext,
    InMemoryReplayGuard,
)
from cryptography.hazmat.primitives.asymmetric.ed25519 import Ed25519PrivateKey

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞)
private_key = Ed25519PrivateKey.generate()
public_key = private_key.public_key()

signing_ctx = DefaultSigningContext(
    private_key=private_key,
    public_key=public_key,
    key_id="ed25519:reg-001"
)

replay_guard = InMemoryReplayGuard()

# 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
unsigned = create_envelope(
    event_type="omen.observed",
    payload={"temperature": 23.7, "sensor_id": "ext-42"},
    source="collector-pi-07",
    key_id="ed25519:reg-001"
)

# 2. –ü–æ–¥–ø–∏—Å—å
signed = sign_envelope(unsigned, signing_ctx)

# 3. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (—Å–∞–º—ã–π –∫—Ä–∏—Ç–∏—á–Ω—ã–π –≤—ã–∑–æ–≤)
result = verify_envelope(signed, replay_guard=replay_guard)

print(result.valid)          # True
print(result.reason)         # "Envelope verified successfully"
```

## üî∫ –í–∞–∂–Ω—ã–µ –º–æ–¥—É–ª–∏

- `canonical.py` ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è** —Ç–æ—á–∫–∞ –∫–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏–∏ (JCS)
- `verification.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π zero-trust –∫–æ–Ω–≤–µ–π–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏
- `envelope.py` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ + –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫
- `signing.py` ‚Äî –ø–æ–¥–ø–∏—Å—å –∑–∞–≥–æ–ª–æ–≤–∫–∞
- `replay_guard.py` ‚Äî —ç—Ç–∞–ª–æ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–æ–≤ (in-memory)
- `types.py` ‚Äî –≤—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–∏–∑–º–µ–Ω–µ–Ω–∏–µ ‚Üí –ª–æ–º–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∏!)
- `registry.py` ‚Äî –ø–æ–ª–∏—Ç–∏–∫–∏ —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π

## üî∫ –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è –Ω–∞—Ä—É—à–∞—Ç—å

1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã `EnvelopeHeader` ‚Üí –≤—Å–µ –ø–æ–¥–ø–∏—Å–∏ –∏–Ω–≤–∞–ª–∏–¥–Ω—ã
2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ `canonicalize()` ‚Üí –≤—Å–µ –ø–æ–¥–ø–∏—Å–∏ –∏–Ω–≤–∞–ª–∏–¥–Ω—ã
3. –û—Å–ª–∞–±–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ `verify_envelope()` ‚Üí –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
4. –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ (`MAX_ABSOLUTE_PAYLOAD_SIZE`, –≥–ª—É–±–∏–Ω—ã –∏ —Ç.–¥.)
5. –î–æ–≤–µ—Ä–∏–µ –ª—é–±—ã–º –¥–∞–Ω–Ω—ã–º –≤–Ω–µ `verify_envelope()`

## üî∫ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üî∫ –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**Nekhebet Core** ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ, —Å—Ç—Ä–æ–≥–æ–µ –∏ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª—é–±–æ–π —Å–∏—Å—Ç–µ–º–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å:

> –ö–∞–∂–¥–æ–µ –ø—Ä–∏–Ω—è—Ç–æ–µ —Å–æ–±—ã—Ç–∏–µ –∏–º–µ–µ—Ç **–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–∫–∞–∑—É–µ–º—É—é** –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∏ —Å–≤–µ–∂–µ—Å—Ç—å.

–ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å –ø—Ä–æ—à–ª–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é ‚Äî —Å–æ–±—ã—Ç–∏–µ –Ω–∞—Å—Ç–æ—è—â–µ–µ.  
–¢–æ—á–∫–∞.
