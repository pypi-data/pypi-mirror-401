# HoloDeck Customer Support Agent Configuration
# Generated by: holodeck init {{ project_name }}
# Template: customer-support

name: "{{ project_name }}"
description: {{ description | tojson }}
{% if author %}author: {{ author | tojson }}
{% endif %}

# Model Configuration - Balanced for friendly support
model:
  provider: {{ llm_provider }}
  name: {{ llm_model }}
{% if llm_provider == "openai" %}
  api_key: ${OPENAI_API_KEY}
{% elif llm_provider == "azure_openai" %}
  endpoint: {{ llm_endpoint }}
  api_key: ${AZURE_OPENAI_API_KEY}
{% elif llm_provider == "anthropic" %}
  api_key: ${ANTHROPIC_API_KEY}
{% endif %}
  temperature: 0.5
  max_tokens: 4096

# Response Format - Structured output for support responses
response_format:
  type: object
  properties:
    response:
      type: string
      description: Support response to customer
    ticket_category:
      type: string
      enum:
        - billing
        - technical
        - general
        - escalation
      description: Category of the support ticket
    requires_escalation:
      type: boolean
      description: Whether the issue requires human escalation
    suggested_actions:
      type: array
      items:
        type: string
      description: List of suggested next steps
  required:
    - response
    - ticket_category

# Agent Instructions - Customer Support Focus
instructions:
  file: instructions/system-prompt.md

# Tools Configuration - For customer issue management
tools:
  # Vectorstore for knowledge base search
  - type: vectorstore
    name: search_kb
    description: Search knowledge base for solutions
    source: data/knowledge_base
    embedding_model: nomic-embed-text:latest
    top_k: 5
    chunk_size: 512
    chunk_overlap: 64
    min_similarity_score: 0.7
    database: {{ vector_store }}
{% if mcp_servers %}

  # MCP Servers (from wizard selection)
{% for server in mcp_servers %}
  # {{ server.display_name }} - {{ server.description }}
  - type: mcp
    name: {{ server.name }}
    description: {{ server.description }}
    command: {{ server.command }}
    args:
      - "-y"
      - "{{ server.package }}"
    request_timeout: 30
{% endfor %}
{% endif %}

# Note: Vector store '{{ vector_store }}' selected for vectorstore tools above.
# See docs: https://useholodeck.ai/docs/tools/vectorstore

# Evaluation Configuration
evaluations:
  model:
    provider: {{ llm_provider }}
    name: {{ llm_model }}
{% if llm_provider == "openai" %}
    api_key: ${OPENAI_API_KEY}
{% elif llm_provider == "azure_openai" %}
    endpoint: {{ llm_endpoint }}
    api_key: ${AZURE_OPENAI_API_KEY}
{% elif llm_provider == "anthropic" %}
    api_key: ${ANTHROPIC_API_KEY}
{% endif %}
    temperature: 0.0
  metrics:
    - type: geval
      name: Coherence
      criteria: "Evaluate whether the response is clear, well-structured, and easy to understand."
      evaluation_steps:
        - "Evaluate whether the response uses clear and direct language."
        - "Check if the explanation avoids jargon or explains it when used."
        - "Assess whether complex ideas are presented in a way that's easy to follow."
        - "Identify any vague or confusing parts that reduce understanding."
      evaluation_params:
        - actual_output
      threshold: 0.7
{% for eval in evals %}
{% if eval == "rag-faithfulness" %}
    - type: rag
      metric_type: faithfulness
      threshold: 0.7
{% elif eval == "rag-answer_relevancy" %}
    - type: rag
      metric_type: answer_relevancy
      threshold: 0.7
{% elif eval == "rag-context_precision" %}
    - type: rag
      metric_type: context_precision
      threshold: 0.7
{% elif eval == "rag-context_recall" %}
    - type: rag
      metric_type: context_recall
      threshold: 0.7
{% endif %}
{% endfor %}
    - type: standard
      metric: groundedness
      threshold: 0.85
    - type: standard
      metric: f1_score
      threshold: 0.7

# Test Cases
test_cases:
  - name: "Simple issue resolution"
    input: "I forgot my password, can you help?"
    expected_tools:
      - search_kb
    ground_truth: "Should provide password reset instructions"

  - name: "Account issue acknowledgment"
    input: "I was charged twice for my order"
    expected_tools:
      - search_kb
    ground_truth: "Should acknowledge issue and offer to escalate"

  - name: "Knowledge base search"
    input: "How do I update my billing information?"
    expected_tools:
      - search_kb
    ground_truth: "Should find and provide billing update instructions"

  - name: "Issue requiring escalation"
    input: "I need to dispute a charge from last month"
    expected_tools:
      - search_kb
    ground_truth: "Should search KB and offer human escalation"

  - name: "Troubleshooting flow"
    input: "I can't log into my account"
    expected_tools:
      - search_kb
    ground_truth: "Should provide troubleshooting steps and offer escalation if needed"
