import{j as e}from"./@radix-Da0HZyg8.js";import{i as D,j as A,e as x,A as k,h as b,a6 as u,B as j,r as o,ci as P,k as T,s as E,aj as z,L as O,Q as F,U as I,G as L,H as _,J as B,x as M,y as q,V as Q,W as R,X as U,Y as H,Z as g,bF as $,O as G,am as J,al as K,a9 as V,ax as W,aa as X}from"./index-5vBAbha7.js";import{P as Y}from"./Pagination-CpPW8mrD.js";import{S as Z}from"./SearchField-f4ysuxbY.js";import{s as h}from"./index-BVxm-FGD.js";import{b as f,c as ee,e as se}from"./@tanstack-BRZ8pkCt.js";import{f as te,L as d,c as ae}from"./@react-router-BEwS6i40.js";import{z as m}from"./@zod-yP6IINRw.js";import{C as y}from"./CodeSnippet-D7U8IeXv.js";import{C as re}from"./CollapsibleCard-BT3TLIT1.js";import{R as ne,S as ie}from"./resizable-sheet-wba1Mius.js";import{e as N}from"./components-Br2ezRib.js";import{a as l}from"./@monaco-editor-xs6rrDBC.js";import{N as v}from"./NumberBox-BGg7fGjx.js";import{C as ce}from"./ComponentBadge-UiOcG6B4.js";import{A as le}from"./action-cell-BLwhFOdG.js";const p=1,oe=m.object({page:m.coerce.number().min(p).optional().default(p).catch(p),name:m.string().optional(),operator:m.enum(["and","or"]).optional()});function de(){const[s]=te(),{page:t,name:a,operator:r}=oe.parse({page:s.get("page")||void 0,name:s.get("name")||void 0});return{page:t,name:a,logical_operator:r}}const S=l.createContext(null);function me({children:s}){const[t,a]=l.useState([]);return e.jsx(S.Provider,{value:{integrations:t,setIntegrations:a},children:s})}function w(){const s=l.useContext(S);if(s===null)throw new Error("useIntegrationsContext must be used within an AuthProvider");return s}function xe({children:s,stackId:t,stackName:a}){const[r,n]=l.useState(!1);return e.jsxs(D,{open:r,onOpenChange:n,children:[e.jsx(A,{children:s}),e.jsx(ne,{className:"overflow-y-auto",children:e.jsxs(me,{children:[e.jsx(ie,{}),e.jsx(ue,{stackId:t}),e.jsx(je,{name:a}),e.jsx(he,{stackId:t})]})})]})}function ue({stackId:s}){const t=f({...h.stackDetail(s)});return t.isError?null:t.isPending?e.jsx("div",{className:"p-5",children:e.jsx(x,{className:"h-6 w-full"})}):e.jsxs("div",{className:"flex min-w-[10rem] items-center justify-between border-b border-theme-border-moderate bg-theme-surface-primary p-5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{type:"square",size:"lg",className:"shrink-0",children:e.jsx(b,{size:"lg",children:t.data.name[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"group/copybutton grid grid-cols-1 items-center gap-0.5",children:[e.jsx("p",{className:"mb-0.5 truncate text-text-sm text-theme-text-secondary",children:t.data.id}),e.jsx(u,{copyText:t.data.id})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("h2",{className:"text-display-xs font-semibold",children:t.data.name})})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(j,{asChild:!0,type:"button",size:"sm",intent:"primary",emphasis:"subtle",children:e.jsx(d,{to:o.stacks.edit(s),children:e.jsx(P,{})})})})]})}function he({stackId:s}){const{setIntegrations:t}=w(),a=f({...h.stackDetail(s)});if(l.useEffect(()=>{if(!a.data)return;const i=N(a.data.metadata?.components).map(c=>c.body?.integration).filter(c=>!!c&&c!=="built-in"&&c!=="custom");i.length>=1&&t(c=>Array.from(new Set([...c,...i])))},[a.data,t]),a.isError)return null;if(a.isPending)return e.jsx("div",{className:"p-5",children:e.jsx(x,{className:"h-[300px] w-full"})});const r=N(a.data.metadata?.components);return e.jsx("ul",{className:"space-y-5 p-5",children:r.map(n=>e.jsx("li",{children:e.jsx(pe,{component:n})},n.id))})}function pe({component:s}){return e.jsxs(T,{className:"flex items-center justify-between p-5",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{width:32,height:32,alt:`${s.resources?.flavor?.body?.display_name} logo`,src:E(s.body?.logo_url||"")}),e.jsxs("div",{children:[e.jsx(d,{to:o.components.detail(s.id),className:"text-text-xl",children:s.name}),e.jsxs("div",{className:"group/copybutton flex items-center gap-0.5",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:s.id.split("-")[0]}),e.jsx(u,{copyText:s.id})]})]})]}),e.jsx(d,{to:o.components.overview,children:e.jsx(ce,{type:s.body?.type||"orchestrator",children:z(s.body?.type||"")})})]})}function je({name:s}){const{integrations:t}=w();return e.jsx("section",{className:"px-5 pt-5",children:e.jsx(re,{title:e.jsx("span",{className:"text-text-lg",children:"Set this stack"}),initialOpen:!0,children:e.jsxs("ul",{className:"space-y-5",children:[e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{children:"1"}),e.jsx("p",{className:"font-semibold",children:"Set your stack"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Set the stack as active on your client"}),e.jsx(y,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml stack set ${s}`})]})]}),t.length>=1&&e.jsxs("li",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{children:"2"}),e.jsx("p",{className:"font-semibold",children:"Install the integrations"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:"Install the required integrations to run pipelines in your stack"}),e.jsx(y,{codeClasses:"whitespace-pre-wrap",wrap:!0,code:`zenml integration install ${t.join(" ")}`})]})]})]})})})}function fe({deleteHandler:s,open:t,setOpen:a}){return e.jsx(O,{open:t,onOpenChange:a,children:e.jsx(F,{title:"Delete Stack",handleDelete:s,children:e.jsxs(I,{children:[e.jsx("p",{children:"Are you sure?"}),e.jsx("p",{children:"This action cannot be undone."})]})})})}async function ge({stackId:s},t){const a=L(B.stacks.detail(s)),r=await fetch(a,{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"}});if(!r.ok){const n=await r.json().then(i=>Array.isArray(i.detail)?i.detail[1]:i.detail).catch(()=>`Error while deleting stack ${s}`);throw new _({status:r.status,statusText:r.statusText,message:n})}return r.json()}function ye(s){return ee({...s,mutationFn:async({stackId:t})=>ge({stackId:t})})}function Ne(s,t){const{toast:a}=M(),r=se(),n=ae(),i=ye({onSuccess:async()=>{r.invalidateQueries({queryKey:h.all}),n(o.stacks.overview),t?.()},onError:C=>{a({status:"error",emphasis:"subtle",icon:e.jsx(q,{className:"h-5 w-5 shrink-0 fill-error-700"}),description:C.message,rounded:!0})}});function c(){i.mutate({stackId:s})}return{handleDelete:c,deleteStack:i}}function ve({id:s}){const[t,a]=l.useState(!1),{handleDelete:r,deleteStack:n}=Ne(s,()=>a(!1));return e.jsxs(e.Fragment,{children:[e.jsx(fe,{deleteHandler:r,open:t,setOpen:a}),e.jsxs(Q,{children:[e.jsx(R,{asChild:!0,children:e.jsx(U,{children:e.jsx("span",{className:"sr-only",children:"Open stack actions"})})}),e.jsxs(H,{className:"z-10",align:"end",sideOffset:1,children:[e.jsx(g,{asChild:!0,className:"cursor-pointer space-x-2",children:e.jsxs(d,{to:o.stacks.edit(s),children:[e.jsx($,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Edit"})]})}),e.jsxs(g,{disabled:n.isPending,onClick:()=>a(!0),className:"cursor-pointer space-x-2",children:[e.jsx(G,{className:"h-3 w-3 fill-neutral-400"}),e.jsx("p",{children:"Delete"})]})]})]})]})}function ke(){return l.useMemo(()=>[{id:"name",header:"Stack",accessorFn:s=>({name:s.name,id:s.id}),cell:({getValue:s})=>{const{name:t,id:a}=s();return e.jsxs("div",{className:"group/copybutton flex min-w-[10rem] items-center gap-2",children:[e.jsx(k,{type:"square",size:"md",className:"shrink-0",children:e.jsx(b,{size:"md",children:t[0]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{stackName:t,stackId:a,children:e.jsx("h2",{className:"grid grid-cols-1 text-text-md font-semibold",children:e.jsx("span",{className:"truncate",children:t})})}),e.jsx(u,{copyText:t})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:a.split("-")[0]}),e.jsx(u,{copyText:a})]})]})]})}},{id:"created",header:"Created at",accessorFn:s=>s.body?.created,cell:({getValue:s})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(J,{dateString:s()})})},{id:"author",header:"Author",accessorFn:s=>s.resources?.user?.name,cell:({row:s})=>{const t=s.original.resources?.user;return t?e.jsx(K,{avatarUrl:t.body?.avatar_url??void 0,username:t.name,isServiceAccount:!!t.body?.is_service_account}):null}},{id:"actions",header:"",accessorFn:s=>({id:s.id}),cell:({getValue:s})=>{const{id:t}=s();return e.jsx(le,{children:e.jsx(ve,{id:t})})}}],[])}function Me({fixedQueryParams:s={}}){const t=de(),a=ke(),{refetch:r,data:n}=f({...h.stackList({...t,sort_by:"desc:updated",...s}),throwOnError:!0});return e.jsx("section",{children:e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-y-4",children:[e.jsx(Z,{searchParams:t}),e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs(j,{intent:"primary",emphasis:"subtle",size:"md",onClick:()=>r(),children:[e.jsx(V,{className:"h-5 w-5 fill-theme-text-brand"}),"Refresh"]}),e.jsx(j,{size:"md",asChild:!0,children:e.jsxs(d,{to:o.stacks.create.index,children:[e.jsx(W,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Stack"})]})})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:n?e.jsx(X,{columns:a,data:n.items}):e.jsx(x,{className:"h-[500px] w-full"})}),n?n.total_pages>1&&e.jsx(Y,{searchParams:t,paginate:n}):e.jsx(x,{className:"h-[36px] w-[300px]"})]})]})})}export{Me as S};
