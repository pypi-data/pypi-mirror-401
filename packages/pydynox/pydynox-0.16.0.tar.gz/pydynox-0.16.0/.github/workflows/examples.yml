name: Test examples

on:
    pull_request:
        branches: [main]
        paths:
            - "docs/examples/**"
            - "tests/examples/**"
            - ".github/workflows/examples.yml"
    workflow_dispatch:

jobs:
    test-examples:
        name: Test documentation examples
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

            - name: Set up Python
              uses: actions/setup-python@83679a892e2d95755f2dac6acb0bfd1e9ac5d548 # v6.1.0
              with:
                  python-version: "3.12"

            - name: Build wheel
              uses: PyO3/maturin-action@86b9d133d34bc1b40018696f782949dac11bd380 # v1.49.4
              with:
                  command: build
                  args: --release --out dist
                  sccache: true

            - name: Create venv and install
              run: |
                  python -m venv .venv
                  source .venv/bin/activate
                  pip install dist/*.whl
                  pip install testcontainers boto3 pydantic[email] aws-lambda-powertools opentelemetry-api opentelemetry-sdk

            - name: Run examples
              run: |
                  source .venv/bin/activate
                  python tests/examples/run_all_examples.py
