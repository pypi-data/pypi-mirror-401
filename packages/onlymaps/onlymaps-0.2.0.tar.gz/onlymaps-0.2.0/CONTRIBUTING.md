
## Raising an issue

There are two main ways to contribute to Onlymaps:

1. **Bug Hunting**: It is very likely that there currently exist
   a number of bugs silently waiting to be discovered! If you happen to stumble
   upon one of them, please raise an issue labeled as **bug**,
   in which you report your findings as well as explain how one can reproduce
   the bug.

2. **Propose an addition/modification**: Everything good can always be made even better! If you have an idea that you think might improve Onlymaps, you can raise an issue labeled as **enhancement**, in which you discuss your idea.

An issue can be raised at the [Issues][issues-page] page.

## Contributing code
---------------------------------------
If you wish to work on a bug or a feature yourself, you should know the following:

* Onlymaps uses `pytest` for testing, `mypy` for type checking, `pylint` for linting, `black` along with `isort` for formatting, and finally `invoke` for task management. All these dependencies and more are declared within the `dev` optional dependency group of `pyproject.toml`.

* Before opening a PR, please make sure that your code is properly formatted, which you can easily do by running `invoke format`, and that it passes all the required standards, which you can determine by running `invoke check`. Finally, tests can be executed by simply running the command `invoke test`.

* PRs must target the `develop` branch.


## Generating the async API

After installing `onlymaps`, you can do `from onlymaps.asyncio import connect` so as to access the async API. However, if you check within the Github repo, there does not seem to exist any directory called `asyncio` under `onlymaps`. That is so because the async API  is entirely autogenerated!

Looking at the project's top level, you'll see a Python script called `gen_async.py`. Furthermore, if you've gone through the source code, you might have noticed some weird markers like `# <async>` or `# <await>` scattered around. These are not just random comments. In fact, they're very important as it is through them that the async API can be autogenerated.

When `gen_async.py` is executed it reads through a bunch of modules and, using those special markers, it builds their async version. The way it works is basically this:

- `gen_async.py` reads a Python module line by line.

- If a line contains any string included in `SPECIAL`, then it is replaced with its async version. To learn what the async version of each special string is you can look at the function `sub_special`.

- If a line contains the marker `# <async>` at the end, then any strings defined in `ASYNC` are replaced with their async version, which mostly comes to adding the `async` marker, i.e. `def` becomes `async def`, `with` becomes `async with`, etc...

- If a line contains the marker `# <await>` at the end, then any function call is automatically awaited, i.e. `x = fn()` becomes `x = await fn()`.

- If a line contains the marker `# <include:[CODE]>`, then any code in `[CODE]` is injected into the async version of the module.

- If a line contains the marker `# <replace:[CODE]>`, then any source code in this line is replaced by the source code in `[CODE]`.

- If a line contains the marker `# <ignore>`, then any source code is ignored until another `# <ignore>` marker is encountered.

By combining all these rules together, the script generates the entire `onlymaps.asyncio` and `tests.asyncio` subpackages.

You can easily generate the async API yourself by running `invoke asyncio`. Following this, it's a good idea to run `invoke check` so as to ensure that nothing went wrong during the code generation.

## Code of Conduct

Please be nice to each other and abide by the principles of the [Python Software Foundation][psf-coc].

<!-- MARKDOWN LINKS & IMAGES -->
[issues-page]: https://github.com/manoss96/onlymaps/issues
[psf-coc]: https://www.python.org/psf/codeofconduct/