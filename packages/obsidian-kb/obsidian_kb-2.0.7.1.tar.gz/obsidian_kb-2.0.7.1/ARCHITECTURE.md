# ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° obsidian-kb

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 0.6.0 (Quality Release)
**Ğ”Ğ°Ñ‚Ğ° Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ:** 2026-01-05
**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:** ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğ¹ Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ v0.6.0 â€” structured logging, TTL cache, MCP exceptions hierarchy, MCP auto-registration Ñ discover pattern, Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ğ°Ñ CLI ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°, ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ğ°Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ, 98.9% Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‚.

---

## Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹](#Ğ¾Ğ±Ğ·Ğ¾Ñ€-ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
2. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° v5: Ğ¢Ñ€Ñ‘Ñ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°-v5-Ñ‚Ñ€Ñ‘Ñ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ°Ñ-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
3. [Extended Query Layer (v6, Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)](#extended-query-layer-v6-Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)
4. [ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ğ¸Ñ… Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ](#ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹-Ğ¸-Ğ¸Ñ…-Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ)
5. [ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¸-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
6. [ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ](#Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)
7. [Ğ¡Ñ…ĞµĞ¼Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#ÑÑ…ĞµĞ¼Ğ°-Ğ±Ğ°Ğ·Ñ‹-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
8. [ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ ÑÑ…ĞµĞ¼Ñ‹](#Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸-ÑÑ…ĞµĞ¼Ñ‹)

---

## ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

obsidian-kb â€” ÑÑ‚Ğ¾ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ğ¾ Obsidian vault'Ğ°Ğ¼, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‰Ğ°Ñ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ embeddings Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾Ğ³Ğ¾ Ğ¸ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ² Ğ·Ğ°Ğ¼ĞµÑ‚ĞºĞ°Ñ….

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸

- **Ğ¡ĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº** â€” Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ embeddings (Multi-provider: Ollama, Yandex Cloud)
- **ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº** â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‚ĞµĞºÑÑ‚Ñƒ Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ FTS Ğ¸Ğ½Ğ´ĞµĞºÑĞ¾Ğ²
- **Ğ“Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº** â€” ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ re-ranking
- **Adaptive Search v5** â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ intent Ğ¸ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
- **Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹** â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ², Ñ‚ĞµĞ³Ğ°Ğ¼, Ğ´Ğ°Ñ‚Ğ°Ğ¼, ÑÑÑ‹Ğ»ĞºĞ°Ğ¼
- **Hybrid Indexing Pipeline** â€” markdown-aware chunking Ğ¸ LLM-Ğ¾Ğ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ
- **Ğ˜Ğ½ĞºÑ€ĞµĞ¼ĞµĞ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** â€” Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- **ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹** â€” ChangeMonitorService Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
- **Ğ¤Ğ¾Ğ½Ğ¾Ğ²Ğ°Ñ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ** â€” BackgroundJobQueue Ğ´Ğ»Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ±ĞµĞ· Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸
- **Cost Tracking** â€” Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚ Ğ½Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ LLM
- **ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ embeddings** â€” ÑƒÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- **MCP Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ** â€” Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Claude Desktop, Cursor Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

- **Python 3.12+** â€” Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ÑĞ·Ñ‹Ğº
- **LanceDB** â€” Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ°Ñ Ğ±Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- **Multi-Provider LLM** â€” Ollama (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹), Yandex Cloud
- **aiohttp** â€” Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
- **Pydantic** â€” Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
- **Click** â€” CLI Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ
- **FastMCP** â€” MCP ÑĞµÑ€Ğ²ĞµÑ€ Ğ´Ğ»Ñ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸

---

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° v5: Ğ¢Ñ€Ñ‘Ñ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

Ğ’ Ğ²ĞµÑ€ÑĞ¸Ğ¸ v5 ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ±Ñ‹Ğ»Ğ° Ğ¿ĞµÑ€ĞµÑ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ° Ñ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼ Ñ‚Ñ€Ñ‘Ñ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ Ğ´Ğ»Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¸Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ.

### ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ»Ğ¾Ñ‘Ğ²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENTATION LAYER                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   MCP Server    â”‚  â”‚ IResultFormatter â”‚                     â”‚
â”‚  â”‚  (mcp_server.py)â”‚  â”‚  (formatter.py)  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚           â”‚                    â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ SearchRequest / SearchResponse
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SEARCH LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ISearchService  â”‚â”€â”€â”‚ IIntentDetector â”‚  â”‚ ISearchStrategy â”‚  â”‚
â”‚  â”‚  (service.py)   â”‚  â”‚ (intent_        â”‚  â”‚  (strategies/)  â”‚  â”‚
â”‚  â”‚                 â”‚  â”‚  detector.py)   â”‚  â”‚                 â”‚  â”‚
â”‚  â”‚  - search()     â”‚  â”‚  - detect()     â”‚  â”‚  - search()     â”‚  â”‚
â”‚  â”‚  - multi_vault()â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚                                                     â”‚
â”‚           â”‚ Orchestration: parse â†’ detect â†’ select â†’ execute    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       STORAGE LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  IChunkRepository   â”‚  â”‚ IDocumentRepository â”‚              â”‚
â”‚  â”‚  (chunk_repository) â”‚  â”‚ (document_repository)â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚  - vector_search()  â”‚  â”‚  - get()            â”‚              â”‚
â”‚  â”‚  - fts_search()     â”‚  â”‚  - get_many()       â”‚              â”‚
â”‚  â”‚  - get_by_document()â”‚  â”‚  - find_by_tags()   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚             â”‚                        â”‚                          â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                        â”‚                                         â”‚
â”‚                        â–¼                                         â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚            â”‚   LanceDBManager     â”‚                              â”‚
â”‚            â”‚   (lance_db.py)      â”‚                              â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ¡Ğ»Ğ¾Ğ¹ 1: Storage Layer (Ğ ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞĞ±ÑÑ‚Ñ€Ğ°ĞºÑ†Ğ¸Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼, Ğ½Ğ¸Ğ·ĞºĞ¾ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ²Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Ğ‘Ğ”.

#### ChunkRepository (`storage/chunk_repository.py`)

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚:** `IChunkRepository`

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `upsert()` â€” ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²
- `delete_by_document()` â€” ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
- `get_by_document()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
- `vector_search()` â€” Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‡Ğ°Ğ½ĞºĞ°Ğ¼
- `fts_search()` â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‡Ğ°Ğ½ĞºĞ°Ğ¼

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Ğ”ĞµĞ»ĞµĞ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ² `LanceDBManager`
- ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ `SearchResult` â†’ `ChunkSearchResult`
- ĞĞµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞµ Ğ¿Ğ¾Ğ¸ÑĞºĞ°

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:**
```python
from obsidian_kb.service_container import get_service_container

services = get_service_container()
chunk_repo = services.chunk_repository

# Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº
results = await chunk_repo.vector_search(
    vault_name="my_vault",
    query_vector=[0.1] * 768,
    limit=10,
)
```

#### DocumentRepository (`storage/document_repository.py`)

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚:** `IDocumentRepository`

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `get()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° Ğ¿Ğ¾ ID
- `get_many()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
- `find_by_property()` â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ñƒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
- `find_by_tags()` â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼
- `find_by_date_range()` â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½Ñƒ Ğ´Ğ°Ñ‚
- `get_content()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
- `get_properties()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ² Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ´Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
- ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚: Ñ„Ğ°Ğ¹Ğ» Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ > ÑĞ±Ğ¾Ñ€ĞºĞ° Ğ¸Ğ· Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² Ğ´Ğ»Ñ `get_content()`
- ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ `DocumentInfo` â†’ `Document`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ:**
```python
doc_repo = services.document_repository

# ĞŸĞ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼
doc_ids = await doc_repo.find_by_tags(
    vault_name="my_vault",
    tags=["python", "tutorial"],
    match_all=True,
)

# ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
docs = await doc_repo.get_many("my_vault", doc_ids)
```

### Ğ¡Ğ»Ğ¾Ğ¹ 2: Search Layer (Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¸ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ğ¾Ğ¸ÑĞºĞ°, Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ intent, Ğ²Ñ‹Ğ±Ğ¾Ñ€ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸.

#### IntentDetector (`search/intent_detector.py`)

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚:** `IIntentDetector`

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ° Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ².

**Ğ¢Ğ¸Ğ¿Ñ‹ intent:**
- `METADATA_FILTER` â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹, Ğ±ĞµĞ· Ñ‚ĞµĞºÑÑ‚Ğ°
- `KNOWN_ITEM` â€” ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» (README.md, CHANGELOG)
- `PROCEDURAL` â€” how-to Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ (how to, ĞºĞ°Ğº, Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ)
- `EXPLORATORY` â€” Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ (Ñ‡Ñ‚Ğ¾, ĞºĞ°Ğº, Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ)
- `SEMANTIC` â€” ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ)

**ĞœĞµÑ‚Ğ¾Ğ´:**
- `detect(query, parsed_filters) -> IntentDetectionResult`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
detector = IntentDetector()
result = detector.detect("tags:python", {"tags": ["python"]})
# result.intent = SearchIntent.METADATA_FILTER
# result.recommended_granularity = RetrievalGranularity.DOCUMENT
```

#### SearchService (`search/service.py`)

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚:** `ISearchService`

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞÑ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ¿Ğ¾Ğ¸ÑĞºĞ°.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `search(request) -> SearchResponse` â€” Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
- `search_multi_vault(vault_names, request) -> SearchResponse` â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ğ¼ vault'Ğ°Ğ¼
- `get_available_strategies() -> list[str]` â€” ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¹

**ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¿Ğ¾Ğ¸ÑĞºĞ°:**
1. ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ñ‡ĞµÑ€ĞµĞ· `QueryParser`
2. Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²
3. ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ intent Ñ‡ĞµÑ€ĞµĞ· `IntentDetector`
4. Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ granularity
5. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ‡ĞµÑ€ĞµĞ· ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ñ
6. Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ `SearchResponse`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
search_service = services.search_service

request = SearchRequest(
    vault_name="my_vault",
    query="Python async programming",
    limit=10,
    granularity=RetrievalGranularity.AUTO,
)

response = await search_service.search(request)
# response.detected_intent = SearchIntent.SEMANTIC
# response.strategy_used = "chunk_level"
# response.results = [DocumentSearchResult, ...]
```

#### Search Strategies (`search/strategies/`)

**Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ:** `BaseSearchStrategy` (`strategies/base.py`)

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:**
- `DocumentLevelStrategy` (`strategies/document_level.py`)
- `ChunkLevelStrategy` (`strategies/chunk_level.py`)

**DocumentLevelStrategy:**
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ: metadata-only Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ², known-item, procedural
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹
- Score Ğ²ÑĞµĞ³Ğ´Ğ° `EXACT_METADATA` Ñ value=1.0

**ChunkLevelStrategy:**
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ: semantic, exploratory Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ñ‡Ğ°Ğ½ĞºĞ¸ Ğ¿Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼
- ĞĞ³Ñ€ĞµĞ³Ğ¸Ñ€ÑƒĞµÑ‚ scores (max, mean, rrf)
- Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ¿-3 Ñ‡Ğ°Ğ½ĞºĞ° Ğ² `matched_chunks`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸:**
```python
from obsidian_kb.search.strategies.base import BaseSearchStrategy

class CustomStrategy(BaseSearchStrategy):
    @property
    def name(self) -> str:
        return "custom"
    
    async def search(self, vault_name, query, parsed_filters, limit, options):
        # Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
        pass
```

### Ğ¡Ğ»Ğ¾Ğ¹ 3: Presentation Layer (Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Ğ² MCP.

#### MCPResultFormatter (`presentation/formatter.py`)

**Ğ ĞµĞ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚:** `IResultFormatter`

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `format_markdown(response) -> str` â€” Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Markdown
- `format_json(response) -> dict` â€” Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² JSON

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¼ĞµÑ‚Ğ¾Ğº intent (ğŸ“‹ Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼, ğŸ” Ğ¡ĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº, etc.)
- ĞœĞµÑ‚ĞºĞ¸ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸ (ğŸŸ¢ Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ, ğŸŸ¡ Ğ¡Ñ€ĞµĞ´Ğ½ÑÑ, etc.)
- Obsidian URLs Ğ´Ğ»Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸
- Snippet Ğ¸Ğ· Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² (Ğ´Ğ¾ 500 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
formatter = services.formatter

# Markdown Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
markdown = formatter.format_markdown(response)

# JSON Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
json_data = formatter.format_json(response)
```

### Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ ÑĞ»Ğ¾Ñ‘Ğ²

Ğ’ÑĞµ ÑĞ»Ğ¾Ğ¸ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ñ‡ĞµÑ€ĞµĞ· `ServiceContainer`:

```python
services = get_service_container()

# Storage Layer
chunk_repo = services.chunk_repository
doc_repo = services.document_repository

# Search Layer
intent_detector = services.intent_detector
search_service = services.search_service

# Presentation Layer
formatter = services.formatter
```

### ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ° Ñ‚Ñ€Ñ‘Ñ…ÑĞ»Ğ¾Ğ¹Ğ½Ğ¾Ğ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

1. **Ğ Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:** ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ¹ Ñ€ĞµÑˆĞ°ĞµÑ‚ ÑĞ²Ğ¾Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ
2. **Ğ¢ĞµÑÑ‚Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ:** Ğ›ĞµĞ³ĞºĞ¾ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞ»Ğ¾Ñ
3. **Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚ÑŒ:** ĞĞ¾Ğ²Ñ‹Ğµ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ĞµÑ€Ñ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾ ĞºĞ¾Ğ´Ğ°
4. **Ğ§Ğ¸ÑÑ‚Ğ¾Ñ‚Ğ° ĞºĞ¾Ğ´Ğ°:** MCP server ÑƒĞ¿Ñ€Ğ¾Ñ‰Ñ‘Ğ½ Ğ´Ğ¾ ~20 ÑÑ‚Ñ€Ğ¾Ğº Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ÑĞ¾Ñ‚ĞµĞ½

---

## Extended Query Layer (v6, Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ)

**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** ğŸ“‹ ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (ÑĞ¼. [tests/Prop.md](tests/Prop.md) Ğ¸ [IMPROVEMENT_PLAN.md](IMPROVEMENT_PLAN.md#Ñ„Ğ°Ğ·Ğ°-v6-extended-query-api))

Extended Query Layer â€” ÑÑ‚Ğ¾ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ¹ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹ v5, Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‰Ğ¸Ğ¹ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ², Ğ¿Ñ€ÑĞ¼Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ°, Ğ³Ñ€Ğ°Ñ„-Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¸ Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ğ¹.

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Extended Query Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           MCP Server                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Extended Query Tools                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚dataview_ â”‚ â”‚search_   â”‚ â”‚get_vault_â”‚ â”‚find_     â”‚  ...      â”‚   â”‚
â”‚  â”‚  â”‚query     â”‚ â”‚text      â”‚ â”‚schema    â”‚ â”‚connected â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â”‚            â”‚            â”‚            â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚            â”‚            â”‚            â”‚
           â–¼            â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Extended Query Layer (NEW)                            â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ DataviewServiceâ”‚  â”‚ RipgrepService â”‚  â”‚ GraphQuery     â”‚             â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚ Service        â”‚             â”‚
â”‚  â”‚ - query()      â”‚  â”‚ - search_text()â”‚  â”‚ - find_        â”‚             â”‚
â”‚  â”‚ - aggregate()  â”‚  â”‚ - search_regex â”‚  â”‚   connected()  â”‚             â”‚
â”‚  â”‚ - parse_where()â”‚  â”‚ - find_files() â”‚  â”‚ - find_orphansâ”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚          â”‚                   â”‚                   â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ FrontmatterAPI â”‚  â”‚ TimelineServiceâ”‚  â”‚ BatchOperationsâ”‚             â”‚
â”‚  â”‚                â”‚  â”‚                â”‚  â”‚                â”‚             â”‚
â”‚  â”‚ - get_schema() â”‚  â”‚ - timeline()   â”‚  â”‚ - export_csv() â”‚             â”‚
â”‚  â”‚ - list_by_prop â”‚  â”‚ - recent_      â”‚  â”‚ - compare_     â”‚             â”‚
â”‚  â”‚ - aggregate()  â”‚  â”‚   changes()    â”‚  â”‚   schemas()    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚          â”‚                   â”‚                   â”‚                       â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                              â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Existing v5 Architecture                              â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Search Layer                                â”‚   â”‚
â”‚  â”‚  SearchService â”‚ IntentDetector â”‚ Strategies                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      Storage Layer                               â”‚   â”‚
â”‚  â”‚  ChunkRepository â”‚ DocumentRepository â”‚ LanceDBManager           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    LanceDB Tables (v4 Schema)                    â”‚   â”‚
â”‚  â”‚  documents â”‚ chunks â”‚ document_properties â”‚ metadata             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Extended Query Layer

#### 1. FrontmatterAPI (`services/frontmatter_api.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº frontmatter Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ².

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `get_frontmatter()` â€” Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ frontmatter ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°
- `get_schema()` â€” ÑÑ…ĞµĞ¼Ğ° frontmatter vault'Ğ° (Ğ²ÑĞµ Ğ¿Ğ¾Ğ»Ñ, Ñ‚Ğ¸Ğ¿Ñ‹, Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹)
- `list_by_property()` â€” Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°
- `aggregate_by_property()` â€” Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ñƒ (Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹)
- `get_property_values()` â€” ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ñ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾Ğ¼

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚:**
- `LanceDBManager` â†’ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `document_properties`, `metadata`, `documents`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
api = services.frontmatter_api

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ…ĞµĞ¼Ñƒ vault'Ğ°
schema = await api.get_schema("my_vault", doc_type="person")

# ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑÑ‚Ğ°Ñ‚ÑƒÑÑƒ
aggregation = await api.aggregate_by_property("my_vault", "status")
# â†’ {"done": 80, "in-progress": 15, "pending": 5}
```

#### 2. DataviewService (`services/dataview_service.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** SQL-Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ¾ frontmatter (Ğ²Ğ´Ğ¾Ñ…Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½ Ğ¿Ğ»Ğ°Ğ³Ğ¸Ğ½Ğ¾Ğ¼ Dataview Ğ´Ğ»Ñ Obsidian).

**Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ:**
```sql
SELECT title, status, date
FROM type:1-1
WHERE status != "done" AND links CONTAINS "Ğ˜Ğ²Ğ°Ğ½ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²"
SORT BY date DESC
LIMIT 10
```

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `query()` â€” Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
- `query_string()` â€” Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¸Ğ· SQL-like ÑÑ‚Ñ€Ğ¾ĞºĞ¸
- `parse_query()` â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ SQL-like ÑĞ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸ÑĞ°

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚:**
- `WhereParser` (`query/where_parser.py`) â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ WHERE ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹
- `DocumentRepository` â€” Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
- `LanceDBManager` â†’ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ `documents`, `document_properties`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
service = services.dataview_service

result = await service.query_string(
    "my_vault",
    "SELECT title, status FROM type:task WHERE status != done SORT BY priority DESC"
)
```

#### 3. RipgrepService (`services/ripgrep_service.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼ vault'Ğ° Ğ±ĞµĞ· Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `search_text()` â€” Ğ¿Ğ¾Ğ¸ÑĞº Ñ‚ĞµĞºÑÑ‚Ğ° (ripgrep â†’ grep â†’ python fallback)
- `search_regex()` â€” Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ğ¾ regex Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñƒ
- `find_files()` â€” Ğ¿Ğ¾Ğ¸ÑĞº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸ Ğ¸/Ğ¸Ğ»Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ¼Ñƒ
- `is_ripgrep_available()` â€” Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ ripgrep

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Graceful degradation: ripgrep â†’ grep â†’ pure Python
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° (ÑÑ‚Ñ€Ğ¾ĞºĞ¸ Ğ´Ğ¾/Ğ¿Ğ¾ÑĞ»Ğµ ÑĞ¾Ğ²Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ñ)
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° case_sensitive, whole_word, file_pattern

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
service = services.ripgrep_service

# ĞŸĞ¾Ğ¸ÑĞº Ğ²ÑĞµÑ… TODO ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ĞµĞ²
result = await service.search_text(
    vault_path="/path/to/vault",
    query="TODO:",
    case_sensitive=True,
    context_lines=2
)
```

#### 4. GraphQueryService (`services/graph_query_service.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ—Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ¾ ÑĞ²ÑĞ·ÑĞ¼ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ (wikilinks).

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `find_connected()` â€” Ğ½Ğ°Ğ¹Ñ‚Ğ¸ ÑĞ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ (incoming/outgoing/both)
- `find_orphans()` â€” Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ±ĞµĞ· Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… ÑÑÑ‹Ğ»Ğ¾Ğº
- `find_broken_links()` â€” Ğ±Ğ¸Ñ‚Ñ‹Ğµ wikilinks
- `get_backlinks()` â€” Ğ²ÑĞµ backlinks Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚:**
- `ChunkRepository` â†’ Ğ¿Ğ¾Ğ»Ğµ `links` Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ `chunks`
- `DocumentRepository` â€” Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ…

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
service = services.graph_query_service

# ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ²ÑĞµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹, ÑÑÑ‹Ğ»Ğ°ÑÑ‰Ğ¸ĞµÑÑ Ğ½Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°
result = await service.find_connected(
    "my_vault",
    "People/Ğ˜Ğ²Ğ°Ğ½ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ².md",
    direction="incoming"
)
```

#### 5. TimelineService (`services/timeline_service.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ¥Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¿Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `timeline()` â€” Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ»ĞµĞ½Ñ‚Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
- `recent_changes()` â€” Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ (ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğµ)

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚:**
- `DocumentRepository` â†’ Ğ¿Ğ¾Ğ»Ñ `created_at`, `modified_at`
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ñ… date fields Ğ¸Ğ· frontmatter

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
service = services.timeline_service

# Ğ¥Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ²ÑÑ‚Ñ€ĞµÑ‡ Ğ·Ğ° Ğ´ĞµĞºĞ°Ğ±Ñ€ÑŒ
timeline = await service.timeline(
    "my_vault",
    doc_type="meeting",
    date_field="date",
    after="2024-12-01",
    before="2024-12-31"
)
```

#### 6. BatchOperations (`services/batch_operations.py`) âœ… Phase 5

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞœĞ°ÑÑĞ¾Ğ²Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ½Ğ°Ğ´ vault'Ğ°Ğ¼Ğ¸.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `export_to_csv()` â€” ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… vault'Ğ° Ğ² CSV Ñ„Ğ°Ğ¹Ğ»
  - ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ² (doc_type, fields, where)
  - ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ° ĞµÑĞ»Ğ¸ Ğ¿ÑƒÑ‚ÑŒ Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½
- `compare_schemas()` â€” ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ ÑÑ…ĞµĞ¼ frontmatter Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… vault'Ğ¾Ğ²
  - ĞĞ±Ñ‰Ğ¸Ğµ Ğ¿Ğ¾Ğ»Ñ
  - Ğ£Ğ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ
  - Ğ Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ¸Ñ Ğ² Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸ÑÑ…

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚:**
- `FrontmatterAPI` â€” Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑÑ…ĞµĞ¼
- `LanceDBManager` â€” Ğ´Ğ»Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ğ¼ Ğ‘Ğ”
- `WhereParser` â€” Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° WHERE ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
batch = services.batch_operations

# Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ²ÑĞµÑ… Ğ»ÑĞ´ĞµĞ¹ Ğ² CSV
csv_path = await batch.export_to_csv(
    "my_vault",
    doc_type="person",
    fields="title,role,team,hire_date"
)

# Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ¼ WHERE
csv_path = await batch.export_to_csv(
    "my_vault",
    where="status = active",
    fields="title,status,priority"
)

# Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ ÑÑ…ĞµĞ¼ Ğ´Ğ²ÑƒÑ… vault'Ğ¾Ğ²
comparison = await batch.compare_schemas(["vault1", "vault2"])
# â†’ {
#     "common_fields": ["type", "status"],
#     "unique_fields": {"vault1": ["role"], "vault2": ["priority"]},
#     "field_differences": {...},
#     "vault_stats": {"vault1": 100, "vault2": 50}
# }
```

### Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ¹ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ¾Ğ¹

Extended Query Layer Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ v5:

1. **Storage Layer:** Ğ’ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ `DocumentRepository` Ğ¸ `ChunkRepository`
2. **LanceDBManager:** ĞŸÑ€ÑĞ¼Ğ¾Ğ¹ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ğ¼ Ğ‘Ğ” Ñ‡ĞµÑ€ĞµĞ· ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹
3. **ServiceContainer:** ĞĞ¾Ğ²Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· lazy initialization
4. **MCP Server:** ĞĞ¾Ğ²Ñ‹Ğµ MCP tools Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ…

### ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

1. **ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ:** ĞĞ¾Ğ²Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸
2. **Read-only:** ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ² Ñ„Ğ°Ğ¹Ğ»Ñ‹ vault'Ğ°
3. **Graceful degradation:** Fallback Ğ½Ğ° Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ (ripgrep â†’ grep â†’ python)
4. **Consistent API:** Ğ•Ğ´Ğ¸Ğ½Ğ¾Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‹ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
5. **Lazy loading:** Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· ServiceContainer Ğ¿Ğ¾ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### ĞĞ¾Ğ²Ñ‹Ğµ MCP Tools

Extended Query API Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµÑ‚ 14 Ğ½Ğ¾Ğ²Ñ‹Ñ… MCP tools:

| Tool | ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|-----------|----------|
| `get_frontmatter` | FrontmatterAPI | ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ frontmatter Ñ„Ğ°Ğ¹Ğ»Ğ° |
| `get_vault_schema` | FrontmatterAPI | Ğ¡Ñ…ĞµĞ¼Ğ° frontmatter vault'Ğ° |
| `list_by_property` | FrontmatterAPI | Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ñƒ |
| `aggregate_by_property` | FrontmatterAPI | ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ñƒ |
| `dataview_query` | DataviewService | SQL-Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ |
| `search_text` | RipgrepService | Ğ¢ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº (ripgrep) |
| `search_regex` | RipgrepService | Regex Ğ¿Ğ¾Ğ¸ÑĞº |
| `find_files` | RipgrepService | ĞŸĞ¾Ğ¸ÑĞº Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² |
| `find_connected` | GraphQueryService | Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ |
| `find_orphans` | GraphQueryService | Orphan Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ |
| `find_broken_links` | GraphQueryService | Ğ‘Ğ¸Ñ‚Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸ |
| `get_backlinks` | GraphQueryService | Backlinks Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° |
| `timeline` | TimelineService | Ğ¥Ñ€Ğ¾Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² |
| `recent_changes` | TimelineService | ĞĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ |
| `export_to_csv` | BatchOperations | Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ² CSV |
| `compare_schemas` | BatchOperations | Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ vault'Ğ¾Ğ² |

### ĞŸĞ»Ğ°Ğ½ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

Ğ¡Ğ¼. [IMPROVEMENT_PLAN.md](IMPROVEMENT_PLAN.md#Ñ„Ğ°Ğ·Ğ°-v6-extended-query-api) Ğ´Ğ»Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ»Ğ°Ğ½Ğ° Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (8 Ğ½ĞµĞ´ĞµĞ»ÑŒ, 5 Ñ„Ğ°Ğ·).

---

## ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ğ¸Ñ… Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ

### Multi-Provider Support (Phase 1-2)

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 0.5.0  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾

#### ProviderFactory (`providers/factory.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ² LLM Ğ¿Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ¸.

**ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹:**
- **Ollama** (Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹) â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½
- **Yandex Cloud** â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `get_embedding_provider(provider_name, model, **kwargs) -> IEmbeddingProvider`
- `get_chat_provider(provider_name, model, **kwargs) -> IChatCompletionProvider`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
from obsidian_kb.providers.factory import ProviderFactory

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ embedding Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
embedding_provider = ProviderFactory.get_embedding_provider(
    provider_name="yandex",
    folder_id="b1g...",
    api_key="AQV...",
    model="text-search-doc/latest"
)

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ chat Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°
chat_provider = ProviderFactory.get_chat_provider(
    provider_name="ollama",
    model="qwen2.5:7b-instruct"
)
```

#### Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ²

**IEmbeddingProvider** (`providers/interfaces.py`):
- `get_embedding(text) -> list[float]`
- `get_embeddings_batch(texts) -> list[list[float]]`
- `health_check() -> ProviderHealth`

**IChatCompletionProvider** (`providers/interfaces.py`):
- `complete(messages, **kwargs) -> str`
- `health_check() -> ProviderHealth`

### Hybrid Indexing Pipeline (Phase 3)

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 0.5.0  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾

#### IndexingOrchestrator (`indexing/orchestrator.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞšĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ²ÑĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ğ¸.

**5 Ñ„Ğ°Ğ· Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ğ¸:**
1. **Change Detection** â€” Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ñ‡ĞµÑ€ĞµĞ· `ChangeDetector`
2. **Document Processing** â€” Ñ€Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ‡Ğ°Ğ½ĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· `ChunkingService`
3. **Enrichment** â€” Ğ¾Ğ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· `ContextualRetrievalService` Ğ¸ `SummarizationService`
4. **Vectorization** â€” Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ embeddings Ñ‡ĞµÑ€ĞµĞ· `IEmbeddingProvider`
5. **Storage** â€” ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ² LanceDB Ñ‡ĞµÑ€ĞµĞ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸

**Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ¾Ğ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ñ:**
- `NONE` â€” Ğ±ĞµĞ· Ğ¾Ğ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ñ (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ chunking + embedding)
- `CONTEXTUAL` â€” context prefix Ğ´Ğ»Ñ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)
- `FULL` â€” context prefix + document summary

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
from obsidian_kb.indexing.orchestrator import IndexingOrchestrator, EnrichmentStrategy

orchestrator = IndexingOrchestrator(
    embedding_provider=embedding_provider,
    chat_provider=chat_provider,
    chunk_repository=chunk_repo,
    document_repository=doc_repo,
    config_manager=config_manager,
)

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ğ¸
job = await orchestrator.create_job(
    vault_name="my-vault",
    vault_path=Path("/path/to/vault"),
    enrichment=EnrichmentStrategy.CONTEXTUAL,
)

# Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
result = await orchestrator.run_job(job.id)
```

#### ChunkingService (`indexing/chunking.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Markdown-aware Ñ€Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ½Ğ° Ñ‡Ğ°Ğ½ĞºĞ¸.

**Ğ¡Ñ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ chunking:**
- `AUTO` â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)
- `HEADERS` â€” Ñ€Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°Ğ¼
- `SEMANTIC` â€” ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ÑƒÑ‚Ğ¾Ñ‡Ğ½ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· LLM
- `FIXED` â€” Ñ„Ğ¸ĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Ğ ĞµĞºÑƒÑ€ÑĞ¸Ğ²Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… ÑĞµĞºÑ†Ğ¸Ğ¹
- ĞĞ½Ğ°Ğ»Ğ¸Ğ· ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ° Ñ‡Ğ°Ğ½ĞºĞ° (header_section, paragraph, code_block, list)

### Background Jobs & Monitoring (Phase 6)

**Ğ’ĞµÑ€ÑĞ¸Ñ:** 0.5.0  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ:** âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¾

#### BackgroundJobQueue (`indexing/job_queue.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°Ğ¼Ğ¸ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ğ¸ Ğ² Ñ„Ğ¾Ğ½Ğµ.

**Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**
- ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ñ‹ Ğ·Ğ°Ğ´Ğ°Ñ‡ (high, normal, low)
- ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ (Ğ´Ğ¾ 2 Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ¾Ğ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾)
- ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸
- Retry Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° (Ğ´Ğ¾ 3 Ñ€Ğ°Ğ· Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…)
- Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑÑ‹ Ğ·Ğ°Ğ´Ğ°Ñ‡ (pending, running, completed, failed, cancelled)

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
from obsidian_kb.indexing.job_queue import BackgroundJobQueue, JobPriority

job_queue = BackgroundJobQueue(max_workers=2)

# ĞŸĞ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ² Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ
job = await job_queue.enqueue(
    vault_name="my-vault",
    vault_path=Path("/path/to/vault"),
    operation="index_documents",
    params={"enrichment": "contextual"},
    priority=JobPriority.NORMAL,
)

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
status = job.status  # pending | running | completed | failed
progress = job.progress  # 0.0 - 1.0
```

#### ChangeMonitorService (`indexing/change_monitor.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ Ğ² vault'Ğ°Ñ….

**Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**
- ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ² Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ñ‡ĞµÑ€ĞµĞ· `watchdog`
- ĞŸĞµÑ€Ğ¸Ğ¾Ğ´Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 60 ÑĞµĞºÑƒĞ½Ğ´)
- Debouncing Ğ´Ğ»Ñ Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ½Ğ¾Ğ¶ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ñ… Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ğ¹ (2 ÑĞµĞºÑƒĞ½Ğ´Ñ‹)
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¿Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ² `BackgroundJobQueue`

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
from obsidian_kb.indexing.change_monitor import ChangeMonitorService

monitor = ChangeMonitorService(
    job_queue=job_queue,
    config_manager=config_manager,
    enabled=True,
    polling_interval=60,
    debounce_seconds=2.0,
)

# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°
await monitor.start()
```

#### CostTracker (`quality/cost_tracker.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚ Ğ½Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ LLM.

**Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸:**
- ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚ Ğ½Ğ° embedding Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚ Ğ½Ğ° chat completion Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- Ğ Ğ°Ğ·Ğ±Ğ¸Ğ²ĞºĞ° Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ°Ğ¼ Ğ¸ vault'Ğ°Ğ¼
- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ·Ğ° Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```python
from obsidian_kb.quality.cost_tracker import CostTracker

cost_tracker = CostTracker()

# Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ·Ğ°Ñ‚Ñ€Ğ°Ñ‚
await cost_tracker.record_embedding_cost(
    provider="yandex",
    tokens=1000,
    vault_name="my-vault",
)

# ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ°
report = await cost_tracker.get_report(days=7)
```

## ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸ Ğ¸Ñ… Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLI / MCP Server                      â”‚
â”‚                    (cli.py, mcp_server.py)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     ServiceContainer                                  â”‚  â”‚
â”‚  â”‚     (service_container.py)                           â”‚  â”‚
â”‚  â”‚     - Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸                       â”‚  â”‚
â”‚  â”‚     - Dependency Injection                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                              â”‚
               â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   QueryParser        â”‚      â”‚   VaultIndexer       â”‚
    â”‚   (query_parser.py)  â”‚      â”‚   (vault_indexer.py)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                              â”‚
               â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   FilterBuilder      â”‚      â”‚   FrontmatterParser  â”‚
    â”‚   (filters.py)       â”‚      â”‚   (frontmatter_      â”‚
    â”‚                      â”‚      â”‚    parser.py)        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                              â”‚
               â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   FileParsers         â”‚      â”‚   DataNormalizer     â”‚
    â”‚   (file_parsers.py)   â”‚      â”‚   (normalization.py) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                              â”‚
               â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚              LanceDBManager                          â”‚
    â”‚              (lance_db.py)                           â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
    â”‚  â”‚     DBConnectionManager                      â”‚   â”‚
    â”‚  â”‚     (db_connection_manager.py)               â”‚   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                              â”‚
               â–¼                              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   EmbeddingService   â”‚      â”‚   EmbeddingCache     â”‚
    â”‚   (embedding_        â”‚      â”‚   (embedding_cache.py)â”‚
    â”‚    service.py)       â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ HTTP Pool      â”‚ â”‚
    â”‚  â”‚ (aiohttp)      â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Ollama  â”‚
         â”‚  Server  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

#### 1. ServiceContainer (`service_container.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² (Dependency Injection).

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°:**
- `db_manager` â€” Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IDatabaseManager`)
- `embedding_service` â€” ÑĞµÑ€Ğ²Ğ¸Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ embeddings (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IEmbeddingService`)
- `embedding_cache` â€” ĞºÑÑˆ embeddings (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IEmbeddingCache`)
- `diagnostics_service` â€” ÑĞµÑ€Ğ²Ğ¸Ñ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ¸ (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IDiagnosticsService`)
- `metrics_collector` â€” ÑĞ±Ğ¾Ñ€Ñ‰Ğ¸Ğº Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IMetricsCollector`)
- `recovery_service` â€” ÑĞµÑ€Ğ²Ğ¸Ñ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IRecoveryService`)
- `search_logger` â€” Ğ»Ğ¾Ğ³Ğ³ĞµÑ€ Ğ¿Ğ¾Ğ¸ÑĞºĞ° (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `ISearchLogger`)
- `performance_monitor` â€” Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IPerformanceMonitor`)

**V5: ĞĞ¾Ğ²Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (Storage/Search/Presentation layers):**
- `chunk_repository` â€” Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IChunkRepository`)
- `document_repository` â€” Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¹ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IDocumentRepository`)
- `intent_detector` â€” Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¾Ñ€ intent (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IIntentDetector`)
- `search_service` â€” ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `ISearchService`)
- `formatter` â€” Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ñ‚ĞµÑ€ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IResultFormatter`)

**Phase 1-2: Multi-Provider Support:**
- `embedding_provider` â€” Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ embeddings (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IEmbeddingProvider`)
- `chat_provider` â€” Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€ chat completion (ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ `IChatCompletionProvider`)

**Phase 3: Hybrid Indexing Pipeline:**
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· `IndexingOrchestrator` (ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ÑÑ Ğ¿Ğ¾ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)

**Phase 6: Background Jobs & Monitoring:**
- Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· `BackgroundJobQueue` Ğ¸ `ChangeMonitorService` (ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Lazy loading ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² (ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğ¸)
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- ĞœĞµÑ‚Ğ¾Ğ´ `cleanup()` Ğ´Ğ»Ñ Ğ¾ÑĞ²Ğ¾Ğ±Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ²
- Singleton Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ñ‡ĞµÑ€ĞµĞ· `get_service_container()`
- Ğ’ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°Ğ¼ Protocol Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¸Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸ (Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ ServiceContainer Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ğ¾Ğ²)
- Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ: Ğ²ÑĞµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ `Any`

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
```python
from obsidian_kb.service_container import get_service_container
from obsidian_kb.types import SearchRequest, RetrievalGranularity

services = get_service_container()

# Legacy API (v4)
results = await services.db_manager.search(...)
embedding = await services.embedding_service.get_embedding(text)

# V5 API (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)
search_service = services.search_service
request = SearchRequest(
    vault_name="my_vault",
    query="Python async programming",
    limit=10,
    granularity=RetrievalGranularity.AUTO,
)
response = await search_service.search(request)

# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
formatter = services.formatter
markdown = formatter.format_markdown(response)
```

**Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ Ğ¼Ğ¾ĞºĞ°Ğ¼Ğ¸:**
```python
from obsidian_kb.interfaces import IDatabaseManager, IEmbeddingService

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾ĞºĞ¾Ğ², ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°Ğ¼
class MockDatabaseManager:
    async def search(self, ...): ...

class MockEmbeddingService:
    async def get_embedding(self, text: str) -> list[float]: ...

# ĞœĞ¾ĞºĞ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°Ğ¼ Protocol
```

#### 2. VaultIndexer (`vault_indexer.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ markdown Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¸Ğ· Obsidian vault'Ğ¾Ğ².

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `scan_all()` â€” ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ² vault'Ğµ
- `_scan_markdown_file()` â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ markdown Ñ„Ğ°Ğ¹Ğ»Ğ°
- `_extract_wikilinks()` â€” Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ wikilinks `[[note-name]]`

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¼ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»Ğ¸Ğ·Ğ¼Ğ¾Ğ¼
- ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ğ¾Ğµ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- Ğ Ğ°Ğ·Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ frontmatter Ğ¸ inline Ñ‚ĞµĞ³Ğ¾Ğ²
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `FrontmatterParser` Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³Ğ° frontmatter
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `DataNormalizer` Ğ´Ğ»Ñ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

#### 3. FrontmatterParser (`frontmatter_parser.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ frontmatter Ğ¸Ğ· markdown Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ².

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `parse()` â€” Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ frontmatter Ğ¸Ğ· ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ³Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°
- `extract_frontmatter()` â€” Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ° frontmatter
- `parse_frontmatter_text()` â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ¸Ğ· Ñ‚ĞµĞºÑÑ‚Ğ°
- `parse_frontmatter_dict()` â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ¸Ğ· ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ (Ğ¿Ğ¾ÑĞ»Ğµ YAML)
- `sanitize_frontmatter()` â€” Ğ¿Ñ€ĞµĞ´Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° frontmatter
- `_parse_date()` â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ´Ğ°Ñ‚ Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¾Ğ²

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ¾Ğ² Obsidian `{{...}}`
- Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ½Ñ‹Ñ… ĞºĞ°Ğ²Ñ‹Ñ‡ĞµĞº Ğ² YAML
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¾Ğ² Ğ´Ğ°Ñ‚ (ISO 8601, timestamp, Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ)
- ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸ Ñ‚ĞµĞ³Ğ¾Ğ²

#### 2. EmbeddingService (`embedding_service.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ñ… Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹ Ñ‚ĞµĞºÑÑ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· Ollama.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `get_embedding()` â€” Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ embedding Ğ´Ğ»Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°
- `get_embeddings_batch()` â€” Ğ±Ğ°Ñ‚Ñ‡ĞµĞ²Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ embeddings

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- HTTP connection pool Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹
- Semaphore Ğ´Ğ»Ñ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»Ğ¸Ğ·Ğ¼Ğ° (max 10 Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
- Timeout Ğ´Ğ»Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (10 ÑĞµĞºÑƒĞ½Ğ´)
- Retry Ñ exponential backoff Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…

#### 3. LanceDBManager (`lance_db.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ğ¾Ğ¹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… LanceDB.

**ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹:**
- `upsert_chunks()` â€” ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² Ğ² Ğ‘Ğ”
- `vector_search()` â€” Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº
- `fts_search()` â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº
- `hybrid_search()` â€” Ğ³Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ñ re-ranking

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ DBConnectionManager Ğ´Ğ»Ñ connection pooling
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ÑÑ…ĞµĞ¼Ñ‹ Ğ‘Ğ”
- Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ¿Ğ¾Ğ¸ÑĞºĞ°
- Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼

#### 4. QueryParser (`query_parser.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼Ğ¸.

**ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹:**
- `type:` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°
- `tags:` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ frontmatter Ñ‚ĞµĞ³Ğ°Ğ¼
- `#tags:` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ inline Ñ‚ĞµĞ³Ğ°Ğ¼
- `links:` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ wikilinks
- `created:`, `modified:` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğ°Ğ¼
- `file:` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ¿ÑƒÑ‚Ğ¸ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²:**
```
"Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ type:person"
"tags:meeting #tags:important"
"links:amuratov created:>2024-12-01"
```

#### 5. FilterBuilder (`filters.py`) (v4)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞŸĞ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ SQL ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ² Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ¾Ğ¹ Ğ´Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ².

**Ğ¢Ğ¸Ğ¿Ñ‹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²:**
- `DocTypeFilter` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ´Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ² v4)
- `TagFilter` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼ (frontmatter/inline)
- `LinkFilter` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ ÑÑÑ‹Ğ»ĞºĞ°Ğ¼
- `DateFilter` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğ°Ğ¼
- `FileFilter` â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ¿ÑƒÑ‚Ğ¸ Ğº Ñ„Ğ°Ğ¹Ğ»Ñƒ

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸ v4:**
- **ĞÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹** â€” `build_where_clause()` Ñ‚ĞµĞ¿ĞµÑ€ÑŒ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹
- **Ğ”Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹** â€” Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ² Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼ (type, author, status, etc.)
- **Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ¾Ñ€Ñ‚ĞµĞ¶** â€” `(where_clause, document_ids)` Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²: `=`, `!=`, `>`, `<`, `>=`, `<=`
- ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· `AND`, `OR`, `NOT`
- ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²

**Ğ”Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹:**
```python
# Ğ­Ñ‚Ğ°Ğ¿ 1: Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼
doc_ids = await db_manager.get_documents_by_property(
    vault_name="vault",
    property_key="type",
    property_value="Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»"
)

# Ğ­Ñ‚Ğ°Ğ¿ 2: ĞŸĞ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ WHERE ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ¸ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ° document_ids
where_clause, document_ids = await FilterBuilder.build_where_clause(
    doc_type="Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»",
    db_manager=db_manager,
    vault_name="vault"
)
```

#### 6. SearchOptimizer (`search_optimizer.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ².

**ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:**
- `AgentQueryNormalizer` â€” Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¾Ñ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²
- `QueryExpander` â€” Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² ÑĞ¸Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ¼Ğ¸
- `ReRanker` â€” Ğ¿ĞµÑ€ĞµÑ€Ğ°Ğ½Ğ¶Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
- `AdaptiveAlphaCalculator` â€” Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ²ĞµÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ³Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ°

#### 7. DBConnectionManager (`db_connection_manager.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿ÑƒĞ»Ğ¾Ğ¼ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹ Ğº LanceDB.

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Singleton Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½ Ğ´Ğ»Ñ ĞµĞ´Ğ¸Ğ½Ğ¾Ğ³Ğ¾ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ğ°
- Thread-safe Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº Ğ¿ÑƒĞ»Ñƒ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹
- Context manager Ğ´Ğ»Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾Ğ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹ Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸

#### 8. EmbeddingCache (`embedding_cache.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ embeddings Ğ´Ğ»Ñ ÑƒÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ.

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸:**
- Ğ¥Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ embeddings Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ LanceDB
- ĞšĞ»ÑÑ‡ ĞºÑÑˆĞ°: Ñ…ÑÑˆ Ñ‚ĞµĞºÑÑ‚Ğ° + Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ embedding
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¾Ñ‡Ğ¸ÑÑ‚ĞºĞ° ÑƒÑÑ‚Ğ°Ñ€ĞµĞ²ÑˆĞ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹
- Ğ£ÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° 50-70%

#### 9. MetricsCollector (`metrics.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** Ğ¡Ğ±Ğ¾Ñ€ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ².

**Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸:**
- ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- Ğ’Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¿Ğ¾Ğ¸ÑĞºĞ° (vector, fts, hybrid)
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²

#### 10. PerformanceMonitor (`performance_monitor.py`)

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:** ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹.

**ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸:**
- P50, P95, P99 Ğ¿ĞµÑ€Ñ†ĞµĞ½Ñ‚Ğ¸Ğ»Ğ¸ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
- ĞĞ»ĞµÑ€Ñ‚Ñ‹ Ğ½Ğ° Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ (>5 ÑĞµĞºÑƒĞ½Ğ´)
- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹

---

## ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```
1. VaultIndexer.scan_all()
   â”‚
   â”œâ”€â–º Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ² vault'Ğµ
   â”‚   â”œâ”€â–º Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ignore_patterns
   â”‚   â””â”€â–º ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² (max_workers)
   â”‚
   â”œâ”€â–º VaultIndexer._scan_markdown_file()
   â”‚   â”œâ”€â–º Ğ§Ñ‚ĞµĞ½Ğ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° (Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ğ¾Ğµ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²)
   â”‚   â”œâ”€â–º FrontmatterParser.parse() â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ frontmatter
   â”‚   â”‚   â”œâ”€â–º FrontmatterParser.extract_frontmatter() â€” Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞºÑÑ‚Ğ° frontmatter
   â”‚   â”‚   â”œâ”€â–º FrontmatterParser.sanitize_frontmatter() â€” Ğ¿Ñ€ĞµĞ´Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°
   â”‚   â”‚   â”œâ”€â–º YAML Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³
   â”‚   â”‚   â””â”€â–º FrontmatterParser.parse_frontmatter_dict() â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ¸Ğ· ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ
   â”‚   â”œâ”€â–º Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞ³Ğ¾Ğ² (frontmatter + inline)
   â”‚   â”œâ”€â–º Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ wikilinks
   â”‚   â”œâ”€â–º FrontmatterParser._parse_date() â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ´Ğ°Ñ‚ (frontmatter â†’ filesystem)
   â”‚   â””â”€â–º Ğ Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ‡Ğ°Ğ½ĞºĞ¸ (Ğ¿Ğ¾ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°Ğ¼, max 600 ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ²)
   â”‚
   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ÑĞ¿Ğ¸ÑĞºĞ° DocumentChunk

2. EmbeddingCache.get_cached_embeddings()
   â”‚
   â”œâ”€â–º ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºÑÑˆĞ° Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ‡Ğ°Ğ½ĞºĞ°
   â”‚   â””â”€â–º ĞšĞ»ÑÑ‡: hash(content) + model_name
   â”‚
   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… embeddings

3. EmbeddingService.get_embeddings_batch()
   â”‚
   â”œâ”€â–º Ğ”Ğ»Ñ Ğ½Ğµ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²:
   â”‚   â”œâ”€â–º HTTP Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº Ollama (Ñ‡ĞµÑ€ĞµĞ· connection pool)
   â”‚   â”œâ”€â–º ĞĞ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»Ğ¸Ğ·Ğ¼Ğ° (Semaphore)
   â”‚   â””â”€â–º Retry Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ…
   â”‚
   â””â”€â–º Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… embeddings Ğ² ĞºÑÑˆ

4. LanceDBManager.upsert_chunks() (v4)
   â”‚
   â”œâ”€â–º ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ· DBConnectionManager
   â”‚
   â”œâ”€â–º ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ/ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ 4 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† v4:
   â”‚   â”œâ”€â–º vault_{vault_name}_documents
   â”‚   â”œâ”€â–º vault_{vault_name}_chunks
   â”‚   â”œâ”€â–º vault_{vault_name}_document_properties
   â”‚   â””â”€â–º vault_{vault_name}_metadata
   â”‚
   â”œâ”€â–º Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² Ğ¿Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼
   â”‚
   â”œâ”€â–º ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:
   â”‚   â”œâ”€â–º documents: Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° (title, file_path, dates, etc.)
   â”‚   â”œâ”€â–º chunks: Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ Ñ‚ĞµĞºÑÑ‚ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²
   â”‚   â”œâ”€â–º document_properties: ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ¸Ğ· frontmatter (key-value)
   â”‚   â””â”€â–º metadata: Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ frontmatter Ğ² JSON
   â”‚
   â”œâ”€â–º Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° Ğ¸Ğ· Ğ²ÑĞµÑ… 4 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†
   â”‚
   â”œâ”€â–º Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ²Ğ¾ Ğ²ÑĞµ 4 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
   â”‚
   â””â”€â–º Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ğ± Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…
```

### ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ¿Ğ¾Ğ¸ÑĞºĞ° (v5)

```
1. MCP Server / CLI Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
   â”‚
   â””â”€â–º Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ SearchRequest

2. SearchService.search(request)
   â”‚
   â”œâ”€â–º QueryParser.parse() â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
   â”‚   â”œâ”€â–º Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²: type:, tags:, #tags:, links:, created:, modified:
   â”‚   â””â”€â–º ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²
   â”‚
   â”œâ”€â–º IntentDetector.detect() â€” Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ intent
   â”‚   â”œâ”€â–º ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ğ¾Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
   â”‚   â”œâ”€â–º ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²
   â”‚   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ IntentDetectionResult Ñ recommended_granularity
   â”‚
   â”œâ”€â–º Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑÑ‚Ñ€Ğ°Ñ‚ĞµĞ³Ğ¸Ğ¸ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ granularity
   â”‚   â”œâ”€â–º DOCUMENT â†’ DocumentLevelStrategy
   â”‚   â””â”€â–º CHUNK â†’ ChunkLevelStrategy
   â”‚
   â””â”€â–º Strategy.search() â€” Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ¸ÑĞºĞ°

3a. DocumentLevelStrategy.search() (Ğ´Ğ»Ñ metadata-only Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
   â”‚
   â”œâ”€â–º ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· DocumentRepository
   â”‚   â”œâ”€â–º find_by_property() â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ñƒ
   â”‚   â”œâ”€â–º find_by_tags() â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ñ‚ĞµĞ³Ğ°Ğ¼
   â”‚   â””â”€â–º find_by_date_range() â€” Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ´Ğ°Ñ‚Ğ°Ğ¼
   â”‚
   â”œâ”€â–º ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· DocumentRepository.get_many()
   â”‚
   â”œâ”€â–º ĞĞ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ¾Ğ¼ (ĞµÑĞ»Ğ¸ include_content=True)
   â”‚
   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ DocumentSearchResult Ñ score=EXACT_METADATA

3b. ChunkLevelStrategy.search() (Ğ´Ğ»Ñ semantic Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
   â”‚
   â”œâ”€â–º Pre-filtering Ñ‡ĞµÑ€ĞµĞ· DocumentRepository (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹)
   â”‚
   â”œâ”€â–º Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ chunk-level Ğ¿Ğ¾Ğ¸ÑĞºĞ°:
   â”‚   â”œâ”€â–º vector â†’ ChunkRepository.vector_search()
   â”‚   â”œâ”€â–º fts â†’ ChunkRepository.fts_search()
   â”‚   â””â”€â–º hybrid â†’ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· RRF
   â”‚
   â”œâ”€â–º Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² Ğ¿Ğ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼
   â”‚
   â”œâ”€â–º ĞĞ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ scores (max, mean, rrf)
   â”‚
   â”œâ”€â–º ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· DocumentRepository.get()
   â”‚
   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ DocumentSearchResult Ñ Ñ‚Ğ¾Ğ¿-3 Ñ‡Ğ°Ğ½ĞºĞ°Ğ¼Ğ¸

4. Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
   â”‚
   â”œâ”€â–º MCPResultFormatter.format_markdown() â€” Ğ´Ğ»Ñ MCP
   â””â”€â–º MCPResultFormatter.format_json() â€” Ğ´Ğ»Ñ structured content
```

### ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ¿Ğ¾Ğ¸ÑĞºĞ° (legacy v4, deprecated)

```
1. QueryParser.parse()
   â”‚
   â”œâ”€â–º ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ½Ğ° Ñ‚ĞµĞºÑÑ‚ Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
   â”‚   â”œâ”€â–º Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²: type:, tags:, #tags:, links:, created:, modified:
   â”‚   â””â”€â–º ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²
   â”‚
   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ParsedQuery

2. FilterBuilder.build_where_clause() (v4 - Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹)
   â”‚
   â”œâ”€â–º Ğ”Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ² Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼
   â”‚   â”œâ”€â–º DocTypeFilter â†’ get_documents_by_property() â†’ document_ids
   â”‚   â”‚   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¿ÑƒÑÑ‚Ğ¾Ğµ WHERE, document_ids Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸
   â”‚   â”œâ”€â–º TagFilter â†’ array_contains(frontmatter_tags, 'value')
   â”‚   â”œâ”€â–º LinkFilter â†’ array_contains(links, 'value')
   â”‚   â””â”€â–º DateFilter â†’ created_at > '2024-12-01'
   â”‚
   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ĞºĞ¾Ñ€Ñ‚ĞµĞ¶Ğ° (where_clause, document_ids)

3. SearchOptimizer.optimize_query()
   â”‚
   â”œâ”€â–º AgentQueryNormalizer.normalize()
   â”‚   â””â”€â–º ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğ¾Ñ‚ Ğ°Ğ³ĞµĞ½Ñ‚Ğ°
   â”‚
   â”œâ”€â–º QueryExpander.expand()
   â”‚   â””â”€â–º Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° ÑĞ¸Ğ½Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ¼Ğ¸ (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
   â”‚
   â””â”€â–º AdaptiveAlphaCalculator.calculate()
       â””â”€â–º Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ğ²ĞµÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ³Ğ¸Ğ±Ñ€Ğ¸Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ°

4. LanceDBManager.hybrid_search() (v4)
   â”‚
   â”œâ”€â–º Ğ’ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº (vector_search)
   â”‚   â”œâ”€â–º Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ embedding Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
   â”‚   â”œâ”€â–º Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ document_ids (ĞµÑĞ»Ğ¸ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹)
   â”‚   â”œâ”€â–º ĞŸĞ¾Ğ¸ÑĞº Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ chunks Ñ WHERE Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼Ğ¸
   â”‚   â”œâ”€â–º ĞĞ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ documents
   â”‚   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ top-k Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
   â”‚
   â”œâ”€â–º ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº (fts_search)
   â”‚   â”œâ”€â–º ĞŸĞ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ FTS Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
   â”‚   â”œâ”€â–º Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ document_ids (ĞµÑĞ»Ğ¸ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ñ‹)
   â”‚   â”œâ”€â–º ĞŸĞ¾Ğ¸ÑĞº Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğµ chunks Ñ WHERE Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ğ¼Ğ¸
   â”‚   â”œâ”€â–º ĞĞ±Ğ¾Ğ³Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¸Ğ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ documents
   â”‚   â””â”€â–º Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ top-k Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
   â”‚
   â”œâ”€â–º ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²
   â”‚   â””â”€â–º Ğ”ĞµĞ´ÑƒĞ¿Ğ»Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ chunk_id
   â”‚
   â”œâ”€â–º ReRanker.rerank()
   â”‚   â”œâ”€â–º Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ features Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
   â”‚   â”œâ”€â–º Ğ’Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸ (RankingModel)
   â”‚   â””â”€â–º Ğ¡Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ğ¿Ğ¾ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸
   â”‚
   â””â”€â–º Ğ“Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ğ°Ğ¼

5. MetricsCollector.record_search()
   â”‚
   â”œâ”€â–º Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ² Ğ‘Ğ” Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
   â”‚   â”œâ”€â–º Ğ¢Ğ¸Ğ¿ Ğ¿Ğ¾Ğ¸ÑĞºĞ°, Ğ²Ñ€ĞµĞ¼Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ
   â”‚   â””â”€â–º Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹
   â”‚
   â””â”€â–º PerformanceMonitor.record()
       â””â”€â–º ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸
```

---

## ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### 1. Connection Pooling

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ» ÑĞ²Ğ¾Ñ‘ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ”, Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¸Ğ²Ğ¾Ğ´Ğ¸Ğ»Ğ¾ Ğº ÑƒÑ‚ĞµÑ‡ĞºĞ°Ğ¼ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ğ¸ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ¸Ñ.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ•Ğ´Ğ¸Ğ½Ñ‹Ğ¹ `DBConnectionManager` Ñ Ğ¿ÑƒĞ»Ğ¾Ğ¼ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹.

```python
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
with db_connection_manager.get_connection() as db:
    table = db.open_table("vault_my_vault")
    # Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ° Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†ĞµĞ¹
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹
- Ğ£ÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ½Ğ° 20-30%
- ĞœĞµĞ½ÑŒÑˆĞµ Ğ½Ğ°ĞºĞ»Ğ°Ğ´Ğ½Ñ‹Ñ… Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ğ¾Ğ²

### 2. HTTP Connection Pool

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ HTTP ÑĞµÑÑĞ¸Ğ¸ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ğº Ollama Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑĞ»Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ `TCPConnector` Ñ connection pool Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»Ğ¸Ğ·Ğ¼Ğ° Ñ‡ĞµÑ€ĞµĞ· `Semaphore`.

```python
# Ğ’ EmbeddingService
self._connector = TCPConnector(limit=20, limit_per_host=10)
self._semaphore = asyncio.Semaphore(10)  # ĞœĞ°ĞºÑ 10 Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- ĞšĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»ÑŒ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° Ollama
- ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğ¹
- Ğ£ÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ½Ğ° 10-20%

### 3. Batch Processing

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ˜Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… vault'Ğ¾Ğ² Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ñ‹Ğ¼ Ğ±ĞµĞ· Ğ²Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** `BatchProcessor` Ñ callback'Ğ°Ğ¼Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ° Ğ¸ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹.

```python
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
async def process_with_progress(items):
    async for batch in BatchProcessor.process(items, batch_size=100):
        # ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ±Ğ°Ñ‚Ñ‡Ğ°
        await process_batch(batch)
        # Callback Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
        on_progress(len(batch))
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ’Ğ¸Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑĞ°
- Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹ Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹
- Ğ›ÑƒÑ‡ÑˆĞ°Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

### 4. Graceful Degradation

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸÑ€Ğ¸ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ Ollama ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ²Ğ°Ğ»Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Fallback Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ñ‹Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ¿Ñ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ñ… embedding ÑĞµÑ€Ğ²Ğ¸ÑĞ°.

```python
# Ğ’ SearchService
try:
    embedding = await embedding_service.get_embedding(query)
    results = await vector_search(embedding)
except OllamaConnectionError:
    # Fallback Ğ½Ğ° FTS
    results = await fts_search(query)
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸ Ñ‡Ğ°ÑÑ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… ÑĞ±Ğ¾ÑÑ…
- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ´Ğ°Ğ¶Ğµ Ğ¿Ñ€Ğ¸ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°Ñ… Ñ Ollama

### 5. Dependency Injection

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ñ‹ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ² Ğ·Ğ°Ñ‚Ñ€ÑƒĞ´Ğ½ÑĞ»Ğ¸ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** `ServiceContainer` Ğ´Ğ»Ñ Ñ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸.

```python
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
from obsidian_kb.service_container import get_service_container

services = get_service_container()
results = await services.db_manager.search(...)
embedding = await services.embedding_service.get_embedding(text)
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ¼ĞµĞ½ÑÑ‚ÑŒ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)
- Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¶Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼ Ñ†Ğ¸ĞºĞ»Ğ¾Ğ¼ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
- Lazy loading (ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ Ğ¿Ñ€Ğ¸ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¼ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğ¸)
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° ĞºĞ°ÑÑ‚Ğ¾Ğ¼Ğ½Ñ‹Ñ… Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ´Ğ»Ñ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### 6. Separation of Concerns

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ‘Ğ¾Ğ»ÑŒÑˆĞ¸Ğµ ĞºĞ»Ğ°ÑÑÑ‹ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, `VaultIndexer`) ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ»Ğ¸ ÑĞ»Ğ¸ÑˆĞºĞ¾Ğ¼ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ’Ñ‹Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑĞ¿ĞµÑ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… ĞºĞ»Ğ°ÑÑĞ¾Ğ² Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:**
- `FrontmatterParser` â€” Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ frontmatter (Ğ²Ñ‹Ğ´ĞµĞ»ĞµĞ½ Ğ¸Ğ· `VaultIndexer`)
- `DataNormalizer` â€” Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ)
- `FilterBuilder` â€” Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ğµ SQL ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹ (Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ)

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ñ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
- ĞŸĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ°
- Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸

### 6.1 Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹ (Protocol)

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸Ğ·-Ğ·Ğ° Ğ¶ĞµÑÑ‚ĞºĞ¾Ğ¹ ÑĞ²ÑĞ·Ğ¸ Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¼Ğ¸ ĞºĞ»Ğ°ÑÑĞ°Ğ¼Ğ¸.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Protocol Ğ´Ğ»Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ¾Ğ² ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².

**Ğ˜Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑÑ‹:**
- `IEmbeddingService` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ embeddings
- `IDatabaseManager` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
- `IVaultIndexer` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ‚Ğ¾Ñ€Ğ° vault'Ğ¾Ğ²
- `IEmbeddingCache` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ ĞºÑÑˆĞ° embeddings
- `IDiagnosticsService` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ¸
- `IMetricsCollector` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ ÑĞ±Ğ¾Ñ€Ñ‰Ğ¸ĞºĞ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
- `IRecoveryService` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ
- `ISearchLogger` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ³ĞµÑ€Ğ° Ğ¿Ğ¾Ğ¸ÑĞºĞ°
- `IPerformanceMonitor` â€” Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**
```python
# Ğ’ Ñ‚ĞµÑÑ‚Ğ°Ñ… Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼Ğ¾ĞºĞ¸, ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°Ğ¼
from obsidian_kb.interfaces import IEmbeddingService

class MockEmbeddingService:
    async def get_embedding(self, text: str) -> list[float]:
        return [0.1] * 768
    
    async def get_embeddings_batch(self, texts: list[str], batch_size: int = 10) -> list[list[float]]:
        return [[0.1] * 768] * len(texts)

# MockEmbeddingService Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ IEmbeddingService
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ£Ğ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ¸Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Ğ¼Ğ¾ĞºĞ¸
- Ğ¯Ğ²Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ² ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
- Ğ’Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ°Ğ¼ĞµĞ½Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¹ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ°
- Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğµ Ñ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ğ¾ÑÑ‚Ğ¸ Ğ¸ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ñ API
- Ğ¡Ñ‚Ñ€Ğ¾Ğ³Ğ°Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ: Ğ²ÑĞµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ¸Ğ¼ĞµÑÑ‚ ÑĞ²Ğ½Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼Ñ‹Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ (`MetricsSummary`, `CircuitBreaker`, `IDatabaseManager` Ğ²Ğ¼ĞµÑÑ‚Ğ¾ `Any`)
- Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸ Ñ‡ĞµÑ€ĞµĞ· ServiceContainer (ÑƒÑÑ‚Ñ€Ğ°Ğ½ĞµĞ½Ñ‹ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞºĞ·ĞµĞ¼Ğ¿Ğ»ÑÑ€Ñ‹ `get_recovery_service()`, `get_search_logger()`)

### 7. Circuit Breaker

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ Ğº Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾Ğ¼Ñƒ ÑĞµÑ€Ğ²Ğ¸ÑÑƒ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»ÑĞ»Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** Circuit breaker Ğ´Ğ»Ñ Ollama Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ².

```python
# Ğ’ EmbeddingService
if self._circuit_breaker.is_open():
    raise OllamaConnectionError("Circuit breaker is open")
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ‘Ñ‹ÑÑ‚Ñ€Ğ¾Ğµ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑĞ°
- Ğ¡Ğ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ½Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ

### 8. Caching Strategy

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¾ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğµ embeddings.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** `EmbeddingCache` Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ĞµĞ¼ Ğ² LanceDB.

```python
# ĞšĞ»ÑÑ‡ ĞºÑÑˆĞ°: hash(content) + model_name
cache_key = f"{hash(content)}_{model_name}"
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ£ÑĞºĞ¾Ñ€ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ½Ğ° 50-70%
- Ğ­ĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² Ollama

### 9. Schema Migrations

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑÑ…ĞµĞ¼Ñ‹ Ğ‘Ğ” Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ»Ğ¸ Ñ€ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ÑÑ…ĞµĞ¼Ñ‹ Ñ‡ĞµÑ€ĞµĞ· `SchemaMigrations`.

```python
# Ğ’ LanceDBManager
if current_version < target_version:
    await SchemaMigrations.migrate(db, current_version, target_version)
```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ…ĞµĞ¼Ñ‹
- Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

---

## Ğ¡Ñ…ĞµĞ¼Ğ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑÑ…ĞµĞ¼Ñ‹ Ğ‘Ğ” ÑĞ¼. Ğ² [DATABASE_SCHEMA.md](DATABASE_SCHEMA.md).

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ (v4)

Ğ”Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ vault'Ğ° ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ÑÑ **4 Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹**:

1. **`vault_{vault_name}_documents`** â€” Ğ¼ĞµÑ‚Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²)
   - `document_id`, `file_path`, `title`, `created_at`, `modified_at`, `file_size`, `chunk_count`
   
2. **`vault_{vault_name}_chunks`** â€” Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ½Ñ‹Ğµ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ Ñ‚ĞµĞºÑÑ‚ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ²
   - `chunk_id`, `document_id`, `content`, `vector`, `frontmatter_tags`, `inline_tags`, `links`
   
3. **`vault_{vault_name}_document_properties`** â€” ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² (key-value)
   - `document_id`, `property_key`, `property_value`, `property_value_raw`
   - Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ´Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼)
   
4. **`vault_{vault_name}_metadata`** â€” Ğ¿Ğ¾Ğ»Ğ½Ñ‹Ğ¹ frontmatter Ğ² JSON
   - `document_id`, `metadata_json`, `metadata_hash`

**Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:**
- **`embedding_cache`** â€” ĞºÑÑˆ embeddings (Ğ¾Ğ±Ñ‰Ğ°Ñ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… vault'Ğ¾Ğ²)
- **`metrics`** â€” Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ¸ÑĞºĞ¾Ğ²Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² (Ğ¾Ğ±Ñ‰Ğ°Ñ)
- **`indexed_files`** â€” Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ± Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ… (Ğ¾Ğ±Ñ‰Ğ°Ñ)

### Ğ’ĞµÑ€ÑĞ¸Ğ¸ ÑÑ…ĞµĞ¼Ñ‹

- **v1** â€” Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ñ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸: id, vault_name, file_path, content, vector
- **v2** â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ¿Ğ¾Ğ»Ñ: frontmatter_tags, inline_tags, doc_type, links, created_at, modified_at
- **v3** â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ Ğ´ĞµĞ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ: author, status, priority, project (ÑƒÑÑ‚Ğ°Ñ€ĞµĞ»Ğ°)
- **v4** (Ñ‚ĞµĞºÑƒÑ‰Ğ°Ñ) â€” Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° Ñ 4 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ğ¼Ğ¸, Ğ´Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹

### Ğ”Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ (v4)

Ğ’ v4 Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ Ğ´Ğ»Ñ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸:

1. **Ğ­Ñ‚Ğ°Ğ¿ 1:** Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼ Ñ‡ĞµÑ€ĞµĞ· Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `document_properties`
   ```python
   doc_ids = await db_manager.get_documents_by_property(
       vault_name="vault",
       property_key="type",
       property_value="Ğ¿Ñ€Ğ¾Ñ‚Ğ¾ĞºĞ¾Ğ»"
   )
   ```

2. **Ğ­Ñ‚Ğ°Ğ¿ 2:** ĞŸĞ¾Ğ¸ÑĞº ÑÑ€ĞµĞ´Ğ¸ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
   ```python
   results = await db_manager.vector_search(
       vault_name="vault",
       query_vector=query_embedding,
       document_ids=doc_ids  # Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ document_ids
   )
   ```

**ĞŸÑ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²Ğ°:**
- Ğ­Ñ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼
- ĞœĞ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… vault'Ğ¾Ğ²
- Ğ“Ğ¸Ğ±ĞºĞ¾ÑÑ‚ÑŒ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑÑ…ĞµĞ¼Ñ‹ Ğ‘Ğ”

---

## ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ ÑÑ…ĞµĞ¼Ñ‹

**Ğ’Ğ°Ğ¶Ğ½Ğ¾:** Ğ’ v4 Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½Ğµ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑÑÑ‚ÑÑ. Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ v3 ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ, Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ.

### ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ½Ğ° v4

1. ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ€Ğ¾Ğ¹ ÑÑ…ĞµĞ¼Ñ‹ v3 (Ğ¾Ğ´Ğ½Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° `vault_{vault_name}`)
2. Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ€Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† v4 (4 Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹)
4. Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ vault'Ğ° ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ¾Ğ¹ `obsidian-kb reindex --vault <name>`

### ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ñ‹ Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

- ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° v4 Ğ½ĞµÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ° Ñ Ğ´ĞµĞ½Ğ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ v3
- ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹ ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾Ğ¹ Ğ¸ Ğ¼ĞµĞ´Ğ»ĞµĞ½Ğ½Ğ¾Ğ¹
- ĞŸĞµÑ€ĞµĞ¸Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ‰Ğµ Ğ¸ Ğ½Ğ°Ğ´Ñ‘Ğ¶Ğ½ĞµĞµ
- Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğµ Ñ‚ĞµÑ€ÑÑÑ‚ÑÑ (Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¾ÑÑ‚Ğ°ÑÑ‚ÑÑ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ)

ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ ÑĞ¼. [DATABASE_SCHEMA.md](DATABASE_SCHEMA.md#Ğ²ĞµÑ€ÑĞ¸Ğ¸-ÑÑ…ĞµĞ¼Ñ‹).

---

## Ğ Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ° (v4)

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ ĞºĞ»Ğ°ÑÑ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ° Ğ² `filters.py`:
```python
class NewFilter:
    @staticmethod
    async def build_condition(
        value: str,
        db_manager: IDatabaseManager | None = None,
        vault_name: str | None = None,
    ) -> tuple[set[str], FilterCondition]:
        # Ğ”Ğ»Ñ ÑĞ²Ğ¾Ğ¹ÑÑ‚Ğ² Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ´Ğ²ÑƒÑ…ÑÑ‚Ğ°Ğ¿Ğ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
        if db_manager and vault_name:
            doc_ids = await db_manager.get_documents_by_property(
                vault_name=vault_name,
                property_key="new_property",
                property_value=value,
            )
            return doc_ids, FilterCondition("")
        # Fallback Ğ½Ğ° WHERE Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€
        return set(), FilterCondition(sql="field = 'value'")
```

2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ² `QueryParser`:
```python
# Ğ’ QueryParser.parse()
if query.startswith("newfilter:"):
    parsed_query.new_filter = extract_value(query)
```

3. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² `FilterBuilder` (Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´):
```python
# Ğ’ FilterBuilder.build_where_clause() (async)
if new_filter:
    doc_ids, condition = await NewFilter.build_condition(
        new_filter, db_manager, vault_name
    )
    if doc_ids:
        if document_ids is None:
            document_ids = doc_ids
        else:
            document_ids &= doc_ids  # ĞŸĞµÑ€ĞµÑĞµÑ‡ĞµĞ½Ğ¸Ğµ
    elif condition.sql:
        conditions.append(condition.sql)
```

4. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ñ‹ Ğ² `tests/test_filters.py` (Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹)

### Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ‚Ğ¸Ğ¿Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ°

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€ÑĞµÑ€ Ğ² `file_parsers.py`:
```python
class NewFileParser:
    @staticmethod
    async def parse(file_path: Path) -> list[DocumentChunk]:
        # ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ñ„Ğ°Ğ¹Ğ»Ğ°
        return chunks
```

2. Ğ—Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² `VaultIndexer`:
```python
# Ğ’ VaultIndexer._scan_file()
if file_path.suffix == ".new":
    return await NewFileParser.parse(file_path)
```

---

## Ğ¡ÑÑ‹Ğ»ĞºĞ¸

- [DATABASE_SCHEMA.md](DATABASE_SCHEMA.md) â€” Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ ÑÑ…ĞµĞ¼Ñ‹ Ğ‘Ğ”
- [IMPROVEMENT_PLAN.md](IMPROVEMENT_PLAN.md) â€” Ğ¿Ğ»Ğ°Ğ½ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
- [API_DOCUMENTATION.md](API_DOCUMENTATION.md) â€” Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ API
- [DEVELOPER_GUIDE.md](DEVELOPER_GUIDE.md) â€” Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ²

