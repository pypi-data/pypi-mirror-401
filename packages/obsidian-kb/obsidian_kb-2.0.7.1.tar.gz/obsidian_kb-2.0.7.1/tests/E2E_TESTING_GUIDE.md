# Руководство по End-to-End тестированию

**Версия:** 1.0  
**Дата:** 2025-01-21  
**Цель:** Проверить полный flow работы системы от индексации до поиска

---

## Цели тестирования

1. Проверить индексацию vault'а
2. Проверить различные типы поисковых запросов
3. Проверить multi-vault поиск
4. Проверить форматирование результатов
5. Убедиться, что система работает в production-like окружении

---

## Автоматизированное тестирование

### Запуск скрипта

#### Вариант 1: С временным vault (для быстрого тестирования)

```bash
cd /Users/mdemyanov/CursorProjects/obsidian-kb
python tests/test_e2e_v5.py
```

Скрипт автоматически:
- Создаст временный vault с тестовыми файлами
- Создаст временную БД
- Выполнит все тесты
- Очистит ресурсы

#### Вариант 2: С существующим vault (для тестирования на реальных данных)

```bash
python tests/test_e2e_v5.py <путь_к_vault> [имя_vault]
```

**Пример:**
```bash
python tests/test_e2e_v5.py /path/to/my-vault my_vault
```

---

## Что тестирует скрипт

### Тест 1: Индексация vault'а

- Создание индексатора
- Сканирование файлов
- Генерация embeddings
- Сохранение в БД
- Проверка статистики

**Ожидаемый результат:**
- ✅ Все файлы проиндексированы
- ✅ Чанки созданы
- ✅ Статистика корректна

### Тест 2: Metadata-only поиск (document-level)

- Поиск по тегам: `tags:person`
- Поиск по типу: `type:meeting`
- Комбинированные фильтры: `tags:meeting tags:important`

**Ожидаемый результат:**
- ✅ Intent определяется как METADATA_FILTER
- ✅ Используется document-level стратегия
- ✅ Возвращаются полные документы

### Тест 3: Семантический поиск (chunk-level)

- Поиск: `Python async programming`
- Поиск: `meeting participants`
- Поиск: `project development`

**Ожидаемый результат:**
- ✅ Intent определяется как SEMANTIC
- ✅ Используется chunk-level стратегия
- ✅ Результаты группируются по документам
- ✅ Scores агрегируются корректно

### Тест 4: Гибридный поиск (chunk-level hybrid)

- Поиск: `Python async`
- Поиск: `meeting team`

**Ожидаемый результат:**
- ✅ Используется hybrid поиск (vector + FTS)
- ✅ Результаты объединяются через RRF
- ✅ Производительность приемлема

### Тест 5: Multi-vault поиск

- Поиск по нескольким vault'ам одновременно

**Ожидаемый результат:**
- ✅ Результаты объединяются из всех vault'ов
- ✅ Сортировка работает корректно
- ✅ Лимит применяется к объединённым результатам

### Тест 6: Форматирование результатов

- Markdown форматирование
- JSON форматирование

**Ожидаемый результат:**
- ✅ Markdown содержит все необходимые элементы
- ✅ JSON структурирован корректно
- ✅ Размер ответа приемлем

---

## Интерпретация результатов

### Успешный тест

✅ **Успешно**, если:
- Все операции выполнены без ошибок
- Результаты соответствуют ожиданиям
- Производительность приемлема

### Проблемы

❌ **Проблема**, если:
- Ошибки при выполнении операций
- Неправильные результаты поиска
- Производительность не соответствует требованиям

---

## Ручное тестирование

Если вы хотите протестировать систему вручную:

### Шаг 1: Индексация

```bash
obsidian-kb index --vault test_vault --path /path/to/vault
```

Проверьте:
- ✅ Файлы проиндексированы
- ✅ Статистика корректна

### Шаг 2: Поиск через CLI

```bash
# Metadata поиск
obsidian-kb search --vault test_vault --query "tags:person"

# Semantic поиск
obsidian-kb search --vault test_vault --query "Python async programming"
```

### Шаг 3: Поиск через MCP

В Claude Desktop:
```
Выполни поиск в vault test_vault с запросом: tags:person
```

---

## Устранение проблем

### Если индексация не работает

1. Проверьте путь к vault'у
2. Проверьте доступ к Ollama
3. Проверьте логи на ошибки

### Если поиск не работает

1. Убедитесь, что vault проиндексирован
2. Проверьте, что запрос корректен
3. Проверьте логи на ошибки

### Если форматирование не работает

1. Проверьте, что formatter инициализирован
2. Проверьте структуру SearchResponse
3. Проверьте логи на ошибки

---

## Метрики успеха

| Тест | Статус | Комментарий |
|------|--------|-------------|
| Индексация | ⏳ | Все файлы проиндексированы |
| Metadata поиск | ⏳ | Intent определяется правильно |
| Semantic поиск | ⏳ | Результаты релевантны |
| Hybrid поиск | ⏳ | Объединение работает |
| Multi-vault поиск | ⏳ | Результаты объединяются |
| Форматирование | ⏳ | Форматы корректны |

---

## Отчёт о проблемах

Если обнаружены проблемы:

1. Задокументируйте шаги для воспроизведения
2. Укажите ожидаемое и фактическое поведение
3. Приложите логи ошибок
4. Создайте issue в репозитории

---

## Контакты

При возникновении вопросов обращайтесь к разработчикам проекта.

