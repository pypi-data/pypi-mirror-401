# Руководство по использованию тестовых данных

## Обзор

В проекте создан набор тестовых данных для автоматического тестирования системы поиска obsidian-kb. Тестовые данные имитируют структуру реальной базы знаний руководителя ИТ-компании (CTO), но не содержат реальных фамилий и названий технологий.

## Расположение

Тестовые данные находятся в директории `tests/test_data/cto_vault/`.

## Структура

Тестовый vault повторяет структуру из SYSTEM_PROMPT.md:

```
tests/test_data/cto_vault/
├── 01_CONTEXT/          # Организационная информация
├── 02_TECHNOLOGY/       # Технологические решения
├── 03_METHODOLOGY/      # Методология (ITIL, DDD)
├── 04_TEMPLATES/        # Шаблоны документов
├── 05_DECISIONS/        # Архитектурные решения (ADR)
├── 06_CURRENT/projects/ # Текущие проекты
├── 07_PEOPLE/           # Профили людей и встречи 1-1
└── 08_COMMITTEES/       # Комитеты и протоколы
```

## Типы документов

Тестовые данные включают следующие типы документов:

- **person** — профили людей (ivanov, petrov, sidorov, kozlov)
- **1-1** — встречи один-на-один
- **project** — проекты (platform-modernization, integration-framework)
- **adr** — архитектурные решения (ADR-001, ADR-002)
- **meeting** — встречи по проектам и комитетам
- **committee** — комитеты
- **context** — контекстная информация
- **technology** — технологические решения
- **methodology** — методология
- **template** — шаблоны документов

## Использование

### Автоматическое тестирование

Запуск тестов на тестовых данных:

```bash
python tests/test_cto_vault_scenarios.py
```

Скрипт автоматически:
1. Индексирует тестовый vault
2. Запускает набор тестовых сценариев
3. Проверяет корректность работы поиска
4. Сохраняет результаты в `tests/cto_vault_test_results.json`

### Ручное тестирование

Для ручного тестирования можно использовать CLI:

```bash
# Индексация тестового vault
obsidian-kb index cto_test_vault tests/test_data/cto_vault

# Поиск по типу
obsidian-kb search cto_test_vault "type:person"

# Поиск по тегам
obsidian-kb search cto_test_vault "tags:project"

# Поиск по ссылкам
obsidian-kb search cto_test_vault "links:ivanov"

# Семантический поиск
obsidian-kb search cto_test_vault "архитектурные решения микросервисы"
```

### Интеграция в CI/CD

Тестовые данные автоматически проверяются при запуске финальной проверки качества:

```bash
python tests/final_check.py
```

Проверка включает:
- Существование структуры директорий
- Наличие ключевых файлов
- Подсчёт количества документов

## Тестовые сценарии

Скрипт `test_cto_vault_scenarios.py` проверяет следующие группы сценариев:

### 1. Поиск по метаданным (METADATA_FILTER)
- `type:person` — все профили людей
- `type:1-1` — все встречи 1-1
- `tags:person` — документы с тегом person
- `tags:project` — все проекты
- `tags:architecture` — архитектурные документы

### 2. Поиск по ссылкам (METADATA_FILTER)
- `links:ivanov` — документы, ссылающиеся на ivanov
- `links:petrov` — документы, ссылающиеся на petrov
- `links:platform-modernization` — документы о проекте

### 3. Поиск по датам (METADATA_FILTER)
- `created:>=2024-12-01 created:<=2024-12-31` — документы за декабрь
- `created:>2024-11-30` — документы после ноября

### 4. Комбинированные фильтры (METADATA_FILTER)
- `type:1-1 links:ivanov` — встречи 1-1 с ivanov
- `type:project tags:active` — активные проекты

### 5. Поиск известных документов (KNOWN_ITEM)
- `README.md` — файл README
- `ADR-001` — архитектурное решение
- `ivanov` — профиль по ID

### 6. Семантический поиск (SEMANTIC)
- `архитектурные решения микросервисы` — поиск по концепциям
- `проблемы производительности оптимизация` — поиск по темам
- `выбор базы данных PostgreSQL` — поиск по содержанию

### 7. Исследовательские вопросы (EXPLORATORY)
- `что такое микросервисная архитектура` — объяснение концепции
- `как работает интеграционный фреймворк` — описание работы

### 8. How-to запросы (PROCEDURAL)
- `как создать ADR` — инструкция или шаблон
- `инструкция по управлению проектом` — руководство

### 9. Комплексные запросы
- `архитектура tags:architecture created:>2024-05-01` — фильтры + текст
- `platform-modernization ivanov` — поиск по нескольким сущностям

## Ожидаемые результаты

После индексации тестового vault'а ожидается:

- **Файлов:** ~15-20 документов
- **Чанков:** ~30-50 чанков
- **Тегов:** ~20-30 уникальных тегов
- **Ссылок:** ~10-15 уникальных ссылок

## Расширение тестовых данных

Для добавления новых тестовых данных:

1. Создайте документы в соответствующей папке
2. Используйте правильный frontmatter с типом и тегами:
   ```yaml
   ---
   type: [тип документа]
   tags: [список тегов]
   created: YYYY-MM-DD
   ---
   ```
3. Добавьте ссылки на другие документы через `[[link]]`
4. При необходимости обновите тестовые сценарии в `test_cto_vault_scenarios.py`

## Принципы создания тестовых данных

1. **Реалистичность** — структура соответствует реальной базе знаний CTO
2. **Анонимность** — нет реальных фамилий и названий технологий
3. **Покрытие** — представлены все основные типы документов
4. **Связность** — документы связаны через ссылки и теги
5. **Разнообразие** — различные типы запросов могут быть протестированы

## Отладка

Если тесты не проходят:

1. Проверьте, что vault проиндексирован:
   ```bash
   obsidian-kb stats cto_test_vault
   ```

2. Проверьте логи индексации на наличие ошибок

3. Убедитесь, что все файлы имеют правильный frontmatter

4. Проверьте, что ссылки между документами корректны

5. Запустите тесты с подробным выводом:
   ```bash
   python tests/test_cto_vault_scenarios.py
   ```

## Связанные документы

- `tests/test_data/README.md` — подробная документация по тестовым данным
- `tests/test_cto_vault_scenarios.py` — скрипт тестирования
- `tests/final_check.py` — финальная проверка качества

