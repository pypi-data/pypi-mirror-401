"use strict";(self.webpackChunkjupyterlab_marimo=self.webpackChunkjupyterlab_marimo||[]).push([[132],{132(e,t,r){r.r(t),r.d(t,{default:()=>f});var i=r(19),o=r(581),s=r(830),n=r(247),a=r(840);const m="text/x-python",c=".mo.py";function l(){return"false"===document.body.getAttribute("data-jp-theme-light")}const h=new a.LabIcon({name:"marimo:icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" width="32" height="32">\n  <image width="32" height="32" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAABtlJREFUWEetV21QlNcVfs67y67KV/EjJIRdBIxJrB9BotFqAtERTIKkk8SxNiGt7Ipa46DsxvjR0rVTKuKKJFYTE1SIxmhFbR0Kwc4YNSraqmNswhSFIrBUBD8QVGTZfU/nvrDLroqQ4Pm179nnnvvc5557zr2EXlj05hSfhgvO10AUB/A4AOHEFMCADOJrBFQx0zki+ajkkA9eyslr6kVYBUIPA8ZaLOr/ttQtYJKXgRHSy6B2EBVKwMZqa+6hnsZ0S2DY8jlD2uxSIYDxPQVx/S+CSZIEpyx3rI5wXIZsslm3neouxoMJMEhvNv6JwcvcwYkw8kk9xoZFYOjgYAT2HwBZlnH99i1UNtbj9KVKVDZcho9KhX4+GtgdDrQ52sVwGYQcbduAFRUbNrTdS+R+AhaLpL9Vu4kZ8wTYV6vFrydNxTsTY/Bk0KCHinHxymVsP/E1vjz1jRvXSQIEOqGxO39esWFbo2cQbwIzZ6r0QwPSWUa6APlp++GgyYLgwCB8dqQEs8a/iEF+/j3uSPW1RqTt2orTVRfBHmgCyjQaObZidRcJLwJPL032b3XSEQaixMqTJr6s7GlDcxNOVpZj13wz9IOG9EhAABxOJ5buyUfB6RNeeCKU+vnpYsssFrvXKYhImzvcQfJXDISH/GQg5kyeiqzifYh5eiSss+ZgoK9fryb2BMnMeG/HZhR+e/peEmtqrFuU/OpQwGKRdC21pSLjJZKwMuEtZBbtw6ujx+LDXxohfD/WWu12JH6UgfL6OncIAtpVKh5VlbW1XCGgMxlnA7xT/H4zeiLO26oVCUtMv1cyuq/2na0aMz7KcB/PzjO6rdaam6wQ0JuNx5h5EhFhybQZyD54AJuS5iNhzPN9nds9fsXeHdhRetgz3m2nv+ox6ig4qnqAped04UqWn6utwr/SrVBLKmWAkPHClS4Jw4c8jsbmmzheUYaA/r6YPjJKUcp24yqOlH8PiQgvDv8pQj2Obf3NG5i8erlSH9wmcTyFmQ2vyQxR8ZASE48vTh7BlGdGYWOSUgYU+76uBtPXW9zfyZOnYnvpYbQ7nYovSh+BJXGvY27en13FB1ofH+Qlp2LyUyPc4xZ/uQX7zohUcxmvJJ05OQ1M64TrMf9ANLTcxOK4RKTFJXZLQKxQZLin9ffRoLVdOVluGxsWib8tWun+/uZCGd7+NNsTkk+hJkMOAanCK2S8225HeuIsGF+a1i2B0KDBGB4cgkP/Oe/GaNRqxI14DkcvlqG59Y7iF/Eurv7EjRGKjU5Pxe22uy7fYdKZjflgfteT1gevvIGFU1/tlsCnv1qIV0ZFY8If30dd0zUFN2PMOGxKWoDMogJsPFSk+IRS1Wu3eKky6+O1KK0sV3xEKBdNZzszv+OJSvpZLDLe6HLdmwP5hsWY8uxoxK5ZoTQiYTOfn4TsXxiw/h8HkF3y124JLCv4HDtPHu2YjtBIOpNhI4DfeBKIDovE/kXLu1WgLwQy/74Xm74udsVuIr3JsJSBNZ4EREs9tyoH/v36K+5HqUBG4R5sPlzSqQDZSG8yTmPwQReBwX7+uHqrBetnG5Sq+KgJpO7Mxf6zJztzgI5TsDnJV8PaRoCV5Y4bOkyp2888EYqChR8owLob15TG5LJ5sdMxIkSHjMK/oKH5puIeHzEcb0+IwVffnUXx+TOuCZAz2+iVhFOyfoeKhsudKUAbOkuxoYAZbwqvODqvR43H7n8ew/73liN6aKRXgL58VDbU4+Ws37pDSISEDgL3bIOQvvjfZ/FsSCj2LlymHKdHYaZdW7Gn835AwBU//2a9KzLpTMYTAE8QE4kJxfWr9vpVrEyYiXmx8X2ev+j8GSzY/gm4s4ISsaXGunWVe2mh5pQXiJ3i+uLV/EVD+vjd+YgfGfWjSYjtFN2w3dnZiAg2lZ9z1CVLXpOXtnqzIZMZHZnnYYLEkvhEpMTEQav26TWR/zVdxx8O7IZYvYexxJRQnZ2rlEsvAuIhUtliKwK4qxF4jBStetqIMYgKi0TEkGA8ERiEwf4BGKDRulFCYtHOd586hr1nSt3d0QUgolU11lx3a70vu8TF9I5MxWBM8qT9eEAQ1CoJthsdtd9LIfEWUPsouWN3OnC3XXkP3G+E7FrrFjPQdVl+YHqHWFIGqG/J+cz8lmcUX41WSU5R/12vn17uRxskMtWuzRVl38sedr5It3TuPJI5k5kDe5yIqAqACoyBAHtcoamE4EyrWbet7MGi9BA5PNUY7FDjfYCTAQT1SKQDcAmMQiLKq1mX65WBP0QBL+ywRYu0dk3rSwx+AUAkCEFg8eLCHWJcYeYaSVKXOyT527qsXFsvieL/FjzLIPLjeMUAAAAASUVORK5CYII="/>\n</svg>\n'});class d extends n.Widget{constructor(e){super(),this._marimoUrl=null,this._themeObserver=null,this._currentThemeIsDark=!1,this._context=e,this.addClass("marimo-editor-widget"),this.title.label=e.localPath,this.title.closable=!0,this.title.icon=h,this._errorDiv=document.createElement("div"),this._errorDiv.className="marimo-error-message",this._errorDiv.style.display="none",this.node.appendChild(this._errorDiv),this._iframe=document.createElement("iframe"),this._iframe.className="marimo-iframe",this._iframe.style.width="100%",this._iframe.style.height="100%",this._iframe.style.border="none",this.node.appendChild(this._iframe),this._currentThemeIsDark=l(),this._initializeMarimoUrl(),this._setupThemeObserver()}_setupThemeObserver(){this._themeObserver=new MutationObserver(()=>{const e=l();e!==this._currentThemeIsDark&&(this._currentThemeIsDark=e,this._syncThemeToIframe())}),this._themeObserver.observe(document.body,{attributes:!0,attributeFilter:["data-jp-theme-light","data-jp-theme-name","class","style"]})}_syncThemeToIframe(){(function(e,t){var r;try{const i=e.contentDocument||(null===(r=e.contentWindow)||void 0===r?void 0:r.document);return!(!i||!i.body||(i.body.dataset.vscodeThemeKind=t?"vscode-dark":"vscode-light",0))}catch(e){return console.warn("Cannot access iframe document for theme sync:",e),!1}})(this._iframe,this._currentThemeIsDark)&&console.log("Synced theme to marimo iframe: "+(this._currentThemeIsDark?"dark":"light"))}async _initializeMarimoUrl(){try{const e=this._context.path,t=s.ServerConnection.makeSettings().baseUrl;if(!await this._checkMarimoAvailability(t))return void this._showError("Marimo proxy is not available. Please ensure:\n1. marimo>=0.6.21 is installed (pip install marimo>=0.6.21)\n2. jupyter-marimo-proxy is installed (pip install jupyter-marimo-proxy)\n3. JupyterLab has been restarted after installation");const r=encodeURIComponent(e);this._marimoUrl=`${t}marimo/?file=${r}`,console.log(`Loading Marimo editor for file: ${e}`),console.log(`Marimo URL: ${this._marimoUrl}`),this._iframe.src=this._marimoUrl,this._iframe.addEventListener("load",()=>{console.log("Marimo iframe loaded successfully"),setTimeout(()=>{this._syncThemeToIframe()},500)}),this._iframe.addEventListener("error",e=>{console.error("Error loading Marimo iframe:",e),this._showError("Failed to load Marimo editor. Please check:\n1. The file path is correct\n2. Marimo proxy is running\n3. Browser console for detailed errors")})}catch(e){console.error("Error initializing Marimo URL:",e),this._showError(`Error initializing Marimo editor: ${e instanceof Error?e.message:String(e)}`)}}async _checkMarimoAvailability(e){try{const t=await fetch(`${e}marimo/`,{method:"HEAD",cache:"no-cache"});return t.ok||404===t.status}catch(e){return console.warn("Marimo proxy check failed:",e),!0}}_showError(e){this._errorDiv.textContent=e,this._errorDiv.style.display="block",this._iframe.style.display="none"}onAfterAttach(e){super.onAfterAttach(e)}onBeforeDetach(e){super.onBeforeDetach(e)}onResize(){}dispose(){this.isDisposed||(this._themeObserver&&(this._themeObserver.disconnect(),this._themeObserver=null),this._iframe.src="",super.dispose())}get context(){return this._context}}class u extends i.ABCWidgetFactory{createNewWidget(e){const t=new d(e),r=new i.DocumentWidget({content:t,context:e});return r.addClass("marimo-document-widget"),r.title.icon=h,r}}const p={name:"marimo",displayName:"Marimo Notebook",mimeTypes:[m],extensions:[c],fileFormat:"text",contentType:"file",icon:h},y={name:"python-marimo",displayName:"Python (Marimo)",mimeTypes:[m],extensions:[".py"],fileFormat:"text",contentType:"file",icon:a.pythonIcon},f={id:"jupyterlab-marimo:plugin",description:"A JupyterLab extension to open Marimo files in an embbeded Marimo editor",autoStart:!0,requires:[o.IFileBrowserFactory],activate:(e,t)=>{console.log("JupyterLab extension jupyterlab-marimo is activated!");const{docRegistry:r}=e;r.addFileType(p),r.addFileType(y);const i=new u({name:"Marimo Editor",fileTypes:["marimo","python-marimo"],defaultFor:["marimo"],readOnly:!1});r.addWidgetFactory(i),console.log("Marimo editor factory registered for .mo.py and .py files"),e.commands.addCommand("marimo:open",{label:"Open in Marimo",caption:"Open the current file in Marimo editor",icon:h,execute:r=>{let i=r.path;if(!i){const e=t.tracker.currentWidget;if(e){const t=Array.from(e.selectedItems());t.length>0&&(i=t[0].path)}}i&&(i.endsWith(c)||i.endsWith(".py"))?(console.log(`Opening ${i} in Marimo editor`),e.commands.execute("docmanager:open",{path:i,factory:"Marimo Editor"})):console.warn(`Cannot open file in Marimo: ${i}`)}}),e.contextMenu.addItem({command:"marimo:open",selector:'.jp-DirListing-item[data-file-type="marimo"]',rank:0}),e.contextMenu.addItem({command:"marimo:open",selector:'.jp-DirListing-item[data-file-type="python-marimo"]',rank:0}),console.log("Marimo context menu items added")}}}}]);