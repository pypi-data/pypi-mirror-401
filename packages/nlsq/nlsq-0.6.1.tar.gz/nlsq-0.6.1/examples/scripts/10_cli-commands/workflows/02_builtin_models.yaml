# ==============================================================================
# 02_builtin_models.yaml - Using Builtin Models
# ==============================================================================
# Demonstrates fitting with NLSQ's builtin model library.
#
# Usage:
#   nlsq fit workflows/02_builtin_models.yaml
#
# Available builtin models (nlsq.functions):
#   - linear: a*x + b
#   - exponential_decay: a*exp(-b*x) + c
#   - exponential_growth: a*exp(b*x) + c
#   - gaussian: amp*exp(-(x-mu)^2/(2*sigma^2))
#   - sigmoid: L/(1+exp(-k*(x-x0))) + b
#   - power_law: a*x^b
#   - polynomial: a0 + a1*x + a2*x^2 + ...
#
# Run `nlsq info` to see all available builtin models.
# ==============================================================================

metadata:
  workflow_name: "builtin_gaussian_fit"
  description: "Fit Gaussian peak using builtin model"
  version: "1.0"

# ==============================================================================
# DATA CONFIGURATION
# ==============================================================================
data:
  dataset_id: "gaussian_peak_001"
  input_file: "data/gaussian_peak.txt"
  format: "ascii"

  # Column mapping for ASCII text file
  columns:
    x: 0              # First column
    y: 1              # Second column
    sigma: null       # No uncertainties in this file

  # ASCII format options
  ascii:
    delimiter: null   # Any whitespace
    comment_char: "#"
    skip_header: 3    # Skip 3 header lines

# ==============================================================================
# MODEL CONFIGURATION
# ==============================================================================
model:
  type: "builtin"
  name: "gaussian"

  # Auto p0 uses data characteristics to estimate initial parameters:
  # - amplitude: max(y) - min(y)
  # - mu: x at max(y)
  # - sigma: estimated from peak width
  auto_p0: true

  # Manual override for initial parameters (uncomment to use):
  # parameters:
  #   - name: "amplitude"
  #     initial: 10.0
  #   - name: "mu"
  #     initial: 0.0
  #   - name: "sigma"
  #     initial: 1.0

# ==============================================================================
# FITTING CONFIGURATION
# ==============================================================================
fitting:
  termination:
    ftol: 1.0e-10
    xtol: 1.0e-10
    gtol: 1.0e-10
    max_iterations: 200

# ==============================================================================
# EXPORT CONFIGURATION
# ==============================================================================
export:
  results_file: "output/02_builtin_models_results.json"

  include:
    parameters: true
    covariance: true
    uncertainties: true
    statistics: true

# ==============================================================================
# VISUALIZATION CONFIGURATION
# ==============================================================================
# Style: "nature" - Nature journal specifications (3.5" width, Arial font).
# Demonstrates colorblind-safe palette for accessibility.

visualization:
  enabled: true
  output_dir: "output/figures"
  filename_prefix: "02_gaussian_fit"
  formats: ["png", "pdf"]
  dpi: 300
  figure_size: [3.5, 2.625]       # Nature single-column width
  style: "nature"
  layout: "combined"

  font:
    family: "sans-serif"          # Arial for Nature
    size: 8                       # Smaller font for compact figure
    math_fontset: "stix"

  main_plot:
    title: null
    x_label: "Position (mm)"
    y_label: "Intensity (counts)"
    show_grid: true
    grid_alpha: 0.3

    data:
      marker: "o"
      size: 15
      alpha: 0.7
      label: "Data"
      show_errorbars: false       # No sigma in this dataset

    fit:
      linewidth: 1.2
      linestyle: "-"
      label: "Gaussian Fit"
      n_points: 500

    confidence_band:
      enabled: true
      level: 0.95
      alpha: 0.2

    legend:
      enabled: true
      location: "upper right"
      frameon: false              # No frame for Nature style

    annotation:
      enabled: true
      show_r_squared: true
      show_rmse: true
      show_chi_squared: false
      location: "upper left"
      fontsize: 7
      box_alpha: 0.7

  residuals_plot:
    enabled: true
    type: "scatter"
    x_label: "Position (mm)"
    y_label: "Residual"
    show_zero_line: true
    marker: "o"
    size: 10
    alpha: 0.7

    std_bands:
      enabled: true
      levels: [1, 2]
      colors: ["#e8f4e8", "#d4e9d4"]
      alpha: 0.5

  histogram:
    enabled: true
    bins: "auto"
    show_normal_fit: true
    alpha: 0.7
    edgecolor: "white"
    title: "Residual Distribution"

  # Colorblind-safe palette (Okabe-Ito)
  active_scheme: "colorblind"
