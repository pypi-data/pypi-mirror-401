# ==============================================================================
# 08_hdf5_data.yaml - Loading HDF5 Data Files
# ==============================================================================
# Demonstrates fitting data from HDF5 format (common for large datasets).
#
# Usage:
#   nlsq fit workflows/08_hdf5_data.yaml
#
# HDF5 is ideal for:
#   - Large datasets (millions of points)
#   - Hierarchical data organization
#   - Scientific data with metadata
#   - Portable binary format
# ==============================================================================

metadata:
  workflow_name: "hdf5_data_fit"
  description: "Exponential decay fitting from HDF5 data file"
  version: "1.0"

# ==============================================================================
# DATA CONFIGURATION - HDF5 FORMAT
# ==============================================================================
data:
  dataset_id: "large_dataset_001"
  input_file: "data/large_dataset.h5"
  format: "hdf5"

  # HDF5 format: specify dataset paths within the file
  hdf5:
    x_path: "/data/x"         # Path to x data array
    y_path: "/data/y"         # Path to y data array
    sigma_path: "/data/sigma"  # Path to sigma array (optional)
    # For 2D surface fitting, add z_path to enable 2D mode:
    # z_path: "/data/z"

# ==============================================================================
# MODEL CONFIGURATION
# ==============================================================================
model:
  type: "builtin"
  name: "exponential_decay"

  auto_p0: true
  auto_bounds: false

  model_id: "exp_decay_hdf5"

# ==============================================================================
# FITTING CONFIGURATION
# ==============================================================================
fitting:
  termination:
    ftol: 1.0e-8
    xtol: 1.0e-8
    gtol: 1.0e-8
    max_iterations: 200

# ==============================================================================
# EXPORT CONFIGURATION
# ==============================================================================
export:
  results_file: "output/08_hdf5_data_results.json"

  include:
    parameters: true
    covariance: true
    uncertainties: true
    statistics: true
    convergence_info: true

# ==============================================================================
# VISUALIZATION CONFIGURATION
# ==============================================================================
# Style: "publication" - Standard journal format for large HDF5 dataset.
# Uses default color scheme with all visualization features enabled.

visualization:
  enabled: true
  output_dir: "output/figures"
  filename_prefix: "08_hdf5_fit"
  formats: ["png", "pdf"]
  dpi: 300
  figure_size: [6.0, 4.5]
  style: "publication"
  layout: "combined"

  font:
    family: "serif"
    size: 10
    math_fontset: "cm"

  main_plot:
    title: null
    x_label: "Time (s)"
    y_label: "Signal (V)"
    show_grid: true
    grid_alpha: 0.3

    data:
      marker: "."                 # Small dots for large dataset
      size: 3
      alpha: 0.4                  # Low alpha for dense data
      label: "HDF5 Data (10K points)"
      show_errorbars: false       # Disable for large datasets

    fit:
      linewidth: 2.0
      linestyle: "-"
      label: "Exponential Decay Fit"
      n_points: 500

    confidence_band:
      enabled: true
      level: 0.95
      alpha: 0.25

    legend:
      enabled: true
      location: "upper right"
      frameon: true

    annotation:
      enabled: true
      show_r_squared: true
      show_rmse: true
      show_chi_squared: true
      location: "lower right"
      fontsize: 9
      box_alpha: 0.8

  residuals_plot:
    enabled: true
    type: "scatter"
    x_label: "Time (s)"
    y_label: "Residual (V)"
    show_zero_line: true
    marker: "."
    size: 2
    alpha: 0.3

    std_bands:
      enabled: true
      levels: [1, 2]
      colors: ["#e8f4e8", "#d4e9d4"]
      alpha: 0.5

  histogram:
    enabled: true
    bins: 50                      # More bins for large dataset
    show_normal_fit: true
    alpha: 0.7
    edgecolor: "white"
    title: "Residual Distribution (N=10000)"

  active_scheme: "default"
