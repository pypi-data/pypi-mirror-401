@echo off
:: Pre-commit hook that prevents commits to main and develop branches and runs wl lint

:: Check current branch
echo Checking current branch...
for /f "tokens=*" %%i in ('git branch --show-current') do (
    set "current_branch=%%i"
)

:: Prevent commits to main and develop branches
if "%current_branch%"=="main" (
    echo ❌ ERROR: Direct commits to %current_branch% branch are not allowed.
    echo Please create a feature/fix branch and submit a Pull Request instead.
    exit /b 1
)

if "%current_branch%"=="develop" (
    echo ❌ ERROR: Direct commits to %current_branch% branch are not allowed.
    echo Please create a feature/fix branch and submit a Pull Request instead.
    exit /b 1
)

echo Running pre-commit checks...
echo 执行预提交检查...

:: Run wl lint command with custom pre-commit config
uv run wl lint --pre-commit-config config\.pre-commit-config.yaml

:: Check exit code
if %errorlevel% neq 0 (
    echo ❌ Pre-commit checks failed. Please fix the issues and try again.
    echo ❌ 预提交检查失败。请修复问题后重试。
    exit /b 1
)

echo ✅ Pre-commit checks passed.
echo ✅ 预提交检查通过。
exit /b 0
