@echo off
:: An example hook script to check the commit log message for Windows
:: Called by "git commit" with one argument, the name of the file
:: that has the commit message.  The hook should exit with non-zero
:: status after issuing an appropriate message if it wants to stop the
:: commit.  The hook is allowed to edit the commit message file.
::
:: To enable this hook, rename this file to "commit-msg".

:: This example catches duplicate Signed-off-by lines.

setlocal enabledelayedexpansion

:: Count occurrences of Signed-off-by lines
set "prev_line="
set "duplicate_found=false"

for /f "tokens=*" %%l in ('type "%1" ^| findstr /i "^Signed-off-by: "') do (
    if "%%l"=="!prev_line!" (
        set "duplicate_found=true"
        goto :duplicate
    )
    set "prev_line=%%l"
)

:duplicate
if "%duplicate_found%"=="true" (
    echo Duplicate Signed-off-by lines. 1>&2
    exit /b 1
)

exit /b 0
