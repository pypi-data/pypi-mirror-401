<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ansible-doctor-enhanced v{{ generator_version }}">
    <title>{{ role_name | html_escape }} - Ansible Role Documentation</title>
    {% if embed_css is not defined %}{% set embed_css = true %}{% endif %}
    {% if generate_toc is not defined %}{% set generate_toc = true %}{% endif %}
    {% if embed_css %}
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; padding: 2rem; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 0.5rem; margin-bottom: 1rem; }
        h2 { color: #34495e; border-bottom: 2px solid #ecf0f1; padding-bottom: 0.3rem; margin-top: 2rem; margin-bottom: 1rem; }
        h3 { color: #7f8c8d; margin-top: 1.5rem; margin-bottom: 0.5rem; }
        .meta { background: #ecf0f1; padding: 1rem; border-radius: 4px; margin: 1rem 0; }
        .meta p { margin: 0.25rem 0; }
        code { background: #f8f9fa; padding: 0.2rem 0.4rem; border-radius: 3px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.9em; }
        pre { background: #282c34; color: #abb2bf; padding: 1rem; border-radius: 4px; overflow-x: auto; margin: 1rem 0; }
        pre code { background: none; padding: 0; color: inherit; }
        ul, ol { margin-left: 2rem; margin-bottom: 1rem; }
        li { margin: 0.25rem 0; }
        .variable, .tag, .todo, .example { background: #f8f9fa; padding: 1rem; margin: 1rem 0; border-left: 4px solid #3498db; border-radius: 4px; }
        .todo { border-left-color: #e74c3c; }
        .priority { font-weight: bold; margin-right: 0.5rem; }
        .badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.85em; font-weight: 600; }
        .badge-required { background: #e74c3c; color: white; }
        .badge-optional { background: #95a5a6; color: white; }
        .footer { margin-top: 3rem; padding-top: 1rem; border-top: 1px solid #ecf0f1; text-align: center; color: #95a5a6; font-size: 0.9em; }
        a { color: #3498db; text-decoration: none; }
        a:hover { text-decoration: underline; }
        /* TOC styles */
        nav#toc { background: #ecf0f1; padding: 1.5rem; border-radius: 4px; margin-bottom: 2rem; }
        nav#toc h2 { margin-top: 0; }
        nav#toc ul { list-style: none; padding-left: 0; }
        nav#toc li { margin: 0.5rem 0; }
    </style>
    {% else %}
    <link rel="stylesheet" href="styles.css">
    {% endif %}
</head>
<body>
    <div class="container">
        {# Breadcrumb navigation -#}
        {% include '_breadcrumb.j2' ignore missing %}
        
        {% if generate_toc %}
        <nav id="toc">
            <h2>Table of Contents</h2>
            <ul>
                <li><a href="#overview">Overview</a></li>
                {% if has_variables %}<li><a href="#variables">Variables</a></li>{% endif %}
                {% if has_tags %}<li><a href="#tags">Tags</a></li>{% endif %}
                {% if role.handlers %}<li><a href="#handlers">Handlers</a></li>{% endif %}
                {% if has_todos %}<li><a href="#todos">TODOs</a></li>{% endif %}
                {% if has_examples %}<li><a href="#examples">Examples</a></li>{% endif %}
                {% if role.existing_docs %}<li><a href="#documentation">Documentation</a></li>{% endif %}
            </ul>
        </nav>
        {% endif %}
        
        <h1>{{ role_name | html_escape }}</h1>
        
        {% if role_description %}
        <p>{{ role_description | html_escape }}</p>
        {% endif %}
        
        <div class="meta">
            <p><strong>Generated:</strong> {{ generation_date.strftime('%Y-%m-%d %H:%M') }}</p>
            <p><strong>Version:</strong> {{ generator_version }}</p>
        </div>

        <h2 id="overview">Overview</h2>
        
        <p><strong>Role Name:</strong> <code>{{ role_name | html_escape }}</code></p>
        
        {% if role.metadata.author %}
        <p><strong>Author:</strong> {{ role.metadata.author | html_escape }}</p>
        {% endif %}
        
        {% if role.metadata.license %}
        <p><strong>License:</strong> {{ role.metadata.license }}</p>
        {% endif %}
        
        {% if role.metadata.platforms %}
        <h3>Platforms</h3>
        <ul>
        {% for platform in role.metadata.platforms %}
            <li>{{ platform.name }}{% if platform.versions %} ({{ platform.versions | join(', ') }}){% endif %}</li>
        {% endfor %}
        </ul>
        {% endif %}
        
        {% if role.metadata.dependencies %}
        <h3>Dependencies</h3>
        <ul>
        {% for dep in role.metadata.dependencies %}
            <li><code>{{ dep }}</code></li>
        {% endfor %}
        </ul>
        {% endif %}

        {% if has_variables %}
        <h2 id="variables">Variables</h2>
        
        {% if variable_count == 0 %}
        <p>No variables defined.</p>
        {% else %}
        <p>{{ variable_count }} variable(s) defined:</p>
        
        {% for var in role.variables %}
        <div class="variable">
            <h3><code>{{ var.name | html_escape }}</code></h3>
            
            {% if var.description %}
            <p>{{ var.description | html_escape }}</p>
            {% endif %}
            
            <ul>
                <li><strong>Type:</strong> <code>{{ var.type if var.type else 'any' }}</code></li>
                <li><strong>Required:</strong> 
                    {% if var.required %}
                    <span class="badge badge-required">Required</span>
                    {% else %}
                    <span class="badge badge-optional">Optional</span>
                    {% endif %}
                </li>
                <li><strong>Value:</strong> <code>{{ var.value | string | html_escape }}</code></li>
                {% if var.file_path %}
                <li><strong>Source:</strong> <code>{{ var.file_path }}:{{ var.line_number }}</code></li>
                {% endif %}
            </ul>
        </div>
        {% endfor %}
        {% endif %}
        {% endif %}

        {% if has_tags %}
        <h2 id="tags">Tags</h2>
        
        {% if tag_count == 0 %}
        <p>No tags defined.</p>
        {% else %}
        <p>{{ tag_count }} tag(s) available:</p>
        
        {% for tag in role.tags %}
        <div class="tag">
            <h3><code>{{ tag.name | html_escape }}</code></h3>
            
            {% if tag.description %}
            <p>{{ tag.description | html_escape }}</p>
            {% endif %}
            
            <ul>
                <li><strong>Usage Count:</strong> {{ tag.usage_count }}</li>
                <li><strong>Locations:</strong>
                    <ul>
                    {% for location in tag.file_locations %}
                        <li><code>{{ location }}</code></li>
                    {% endfor %}
                    </ul>
                </li>
            </ul>
        </div>
        {% endfor %}
        {% endif %}
        {% endif %}

        {% if role.handlers %}
        <h2 id="handlers">Handlers</h2>
        
        {% set handler_count = role.handlers | length %}
        {% if handler_count == 0 %}
        <p>No handlers defined.</p>
        {% else %}
        <p>{{ handler_count }} handler(s) available:</p>
        
        {% for handler in role.handlers %}
        <div class="variable">
            <h3><code>{{ handler.name | html_escape }}</code></h3>
            {% if handler.tags %}
            <p><strong>Tags:</strong> {% for tag in handler.tags %}<code>{{ tag }}</code>{% if not loop.last %}, {% endif %}{% endfor %}</p>
            {% endif %}
            {% if handler.listen %}
            <p><strong>Listen:</strong> {% for listen_name in handler.listen %}<code>{{ listen_name | html_escape }}</code>{% if not loop.last %}, {% endif %}{% endfor %}</p>
            {% endif %}
            <p><strong>Source:</strong> <code>{{ handler.file_path }}:{{ handler.line_number }}</code></p>
        </div>
        {% endfor %}
        {% endif %}
        {% endif %}

        {% if has_todos %}
        <h2 id="todos">TODOs</h2>
        
        {% if todo_count == 0 %}
        <p>No TODOs found.</p>
        {% else %}
        <p>{{ todo_count }} TODO(s):</p>
        
        <ul>
        {% for todo in role.todos %}
            <li class="todo">
                <span class="priority">{{ todo.priority | format_priority }}</span>
                <strong>{{ todo.description | html_escape }}</strong>
                (<code>{{ todo.file_path }}:{{ todo.line_number }}</code>)
            </li>
        {% endfor %}
        </ul>
        {% endif %}
        {% endif %}

        {% if has_examples %}
        <h2 id="examples">Examples</h2>
        
        {% if example_count == 0 %}
        <p>No examples provided.</p>
        {% else %}
        <p>{{ example_count }} example(s):</p>
        
        {% for example in role.examples %}
        <div class="example">
            {% if example.description %}
            <h3>{{ example.description | html_escape }}</h3>
            {% endif %}
            
            <pre><code class="language-{{ example.language }}">{{ example.code | html_escape }}</code></pre>
        </div>
        {% endfor %}
        {% endif %}
        {% endif %}

        {% if role.existing_docs %}
        <h2 id="documentation">Documentation</h2>
        
        {% if role.existing_docs.readme_content %}
        <h3>README</h3>
        {% if role.existing_docs.readme_format %}
        <p><em>Format: {{ role.existing_docs.readme_format | upper }}</em></p>
        {% endif %}
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
            <pre style="background: transparent; color: #333; white-space: pre-wrap;">{{ role.existing_docs.readme_content | html_escape }}</pre>
        </div>
        {% endif %}
        
        {% if role.existing_docs.license_content %}
        <h3>License</h3>
        {% if role.existing_docs.license_type %}
        <p><strong>License Type:</strong> {{ role.existing_docs.license_type }}</p>
        {% endif %}
        <pre><code>{{ role.existing_docs.license_content | html_escape }}</code></pre>
        {% endif %}
        
        {% if role.existing_docs.templates_list %}
        <h3>Templates</h3>
        <p>Available Jinja2 templates:</p>
        <ul>
        {% for template in role.existing_docs.templates_list %}
            <li><code>{{ template }}</code></li>
        {% endfor %}
        </ul>
        {% endif %}
        
        {% if role.existing_docs.files_list %}
        <h3>Static Files</h3>
        <p>Available static files:</p>
        <ul>
        {% for file in role.existing_docs.files_list %}
            <li><code>{{ file }}</code></li>
        {% endfor %}
        </ul>
        {% endif %}
        {% endif %}

        {# Sibling navigation #}
        {% include '_siblings.j2' ignore missing %}

        <div class="footer">
            <p>Documentation generated by <strong>ansible-doctor-enhanced</strong> v{{ generator_version }}</p>
        </div>
    </div>
</body>
</html>
