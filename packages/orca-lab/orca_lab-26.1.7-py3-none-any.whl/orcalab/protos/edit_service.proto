syntax = "proto3";

package SceneEdit;

enum StatusCode {
    Success = 0;
    Error = 1;
}

enum Space {
    Local = 0;
    World = 1;
}

message Transform {
    repeated double pos = 1;        // 位置 (3 elements)
    repeated double quat = 2;       // 旋转四元数 (4 elements)
    double scale = 3;               // 等比缩放 (1 elements)
}


message AlohaRequest {
    int32 value = 1;
}

message AlohaResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    int32 value = 3;
}


message AddActorRequest {
    string spawnable_name = 1;      // Actor 使用的 spawnable 名字
    string actor_name = 2;          // Actor Entity 的名字
    string parent_actor_path = 3;   // Parent Actor 的路径
    Transform transform = 4;
    Space space = 5;
}
message AddActorResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message AddGroupRequest {
    string actor_name = 2;          // Actor Entity 的名字
    string parent_actor_path = 3;   // Parent Actor 的路径
    Transform transform = 4;
    Space space = 5;
}
message AddGroupResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}


message SetActorTransformRequest {
    string actor_path = 1;
    Transform transform = 2;
    Space space = 3;
}
message SetActorTransformResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message GetPendingOperationsRequest {
}
message GetPendingOperationsResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    repeated string operations = 3;
}

message GetPendingActorTransformRequest {
    StatusCode status_code = 1;
    string error_message = 2;
    string actor_path = 3;
    Space space = 4;
}
message GetPendingActorTransformResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    Transform transform = 3;
}


message GetSyncFromMujocoToSceneRequest {
}
message GetSyncFromMujocoToSceneResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    bool value = 3;
}


message SetSyncFromMujocoToSceneRequest {
    bool value = 1;
}
message SetSyncFromMujocoToSceneResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    bool value = 3;
}

message ClearSceneRequest {
}
message ClearSceneResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message GetActorAssetsRequest {
}
message GetActorAssetsResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    repeated string actor_asset_names = 3;
}

message GetPendingSelectionChangeRequest {
}
message GetPendingSelectionChangeResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    repeated string actor_paths = 3;
}

message GetPendingAddItemRequest {
}
message GetPendingAddItemResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    Transform transform = 3;
    string actor_name = 4;
}

message SetSelectionRequest {
    repeated string actor_paths = 1;
}
message SetSelectionResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}


message SaveBodyTransformRequest {
}
message SaveBodyTransformResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message RestoreBodyTransformRequest {
}
message RestoreBodyTransformResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message DeleteActorRequest {
    string actor_path = 1;
}
message DeleteActorResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message RenameActorRequest {
    string actor_path = 1;
    string new_name = 2;
}
message RenameActorResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}


message ReParentActorRequest {
    string actor_path = 1;
    string new_parent_path = 2;
}
message ReParentActorResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message GetWindowIdRequest {
    
}
message GetWindowIdResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    uint64 window_id = 3;
}

message GetGeneratePosRequest {
    float posX = 1;
    float posY = 2;
}
message GetGeneratePosResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    Transform transform = 3;
}


message GetCacheFolderRequest {
}
message GetCacheFolderResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    string cache_folder = 3;
}


message LoadPackageRequest {
    string file_path = 1;
}
message LoadPackageResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message ChangeSimStateRequest {
    bool sim_process_running = 1;
}
message ChangeSimStateResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message ChangeManipulatorTypeRequest {
    int32 manipulator_type = 1;
}
message ChangeManipulatorTypeResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message GetCameraPNGRequest {
    string camera_name = 1;
    string png_path = 2;
    string png_name = 3;
}

message GetCameraPNGResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message GetActorAssetAabbRequest {
    string actor_path = 1;
}

message GetActorAssetAabbResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    repeated float min = 3;
    repeated float max = 4;
}

message QueueMouseEventRequest {
    uint32 button = 1;
    uint32 action = 2;
    float x = 3;
    float y = 4;
}
message QueueMouseEventResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message QueueMouseWheelEventRequest {
    int32 delta = 1;
}
message QueueMouseWheelEventResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

message QueueKeyEventRequest {
    uint32 key = 1;
    uint32 action = 2;
}
message QueueKeyEventResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}


message CameraBrief {
    string name = 1;
    int32 index = 2;
    string source = 3;
}
message GetCamerasRequest {
}
message GetCamerasResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    repeated CameraBrief cameras = 3;
}

message GetActiveCameraRequest {
}
message GetActiveCameraResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    int32 index = 3;
}

message SetActiveCameraRequest {
    int32 index = 1;
}
message SetActiveCameraResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}

// Actor Property related messages.

enum PropertyType {
    Unknown = 0;
    Bool = 1;
    Int = 2;
    Float = 3;
    String = 4;
}

message PropertyValue {
    oneof value_oneof {
        bool value_bool = 3;
        int32 value_int = 4;
        float value_float = 5;
        string value_string = 6;
    }
}

message PropertyValueList {
    repeated PropertyValue items = 1;
}

message Property {
    PropertyType type = 1;
    string name = 2;
    string display_name = 3;
}

message PropertyGroup {
    string prefix = 1;
    string name = 2;
    string hint = 3;
    repeated Property properties = 4;
}

message PropertyKey {
    string actor_path = 1;
    string group_prefix = 2;
    string property_name = 3;
    PropertyType property_type = 4;
}

message PropertyKeyList {
    repeated PropertyKey items = 1;
}

message GetPropertyGroupsRequest {
    string actor_path = 1;
}
message GetPropertyGroupsResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    repeated PropertyGroup property_groups = 3;
}

message GetPropertiesRequest {
    PropertyKeyList keys = 1;
}
message GetPropertiesResponse {
    StatusCode status_code = 1;
    string error_message = 2;
    PropertyValueList values = 3;
}

message SetPropertiesRequest {
    PropertyKeyList keys = 1;
    PropertyValueList values = 2;
}
message SetPropertiesResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}


message PublishSceneRequest {
}
message PublishSceneResponse {
    StatusCode status_code = 1;
    string error_message = 2;
}


service GrpcService {
    rpc Aloha(AlohaRequest) returns (AlohaResponse);
    
    rpc AddActor(AddActorRequest) returns (AddActorResponse);
    rpc AddGroup(AddGroupRequest) returns (AddGroupResponse);
    rpc SetActorTransform(SetActorTransformRequest) returns (SetActorTransformResponse);

    rpc GetPendingOperations(GetPendingOperationsRequest) returns (GetPendingOperationsResponse);
    rpc GetPendingActorTransform(GetPendingActorTransformRequest) returns (GetPendingActorTransformResponse);

    rpc GetSyncFromMujocoToScene(GetSyncFromMujocoToSceneRequest) returns (GetSyncFromMujocoToSceneResponse);
    rpc SetSyncFromMujocoToScene(SetSyncFromMujocoToSceneRequest) returns (SetSyncFromMujocoToSceneResponse);

    rpc ClearScene(ClearSceneRequest) returns (ClearSceneResponse);
    rpc GetActorAssets(GetActorAssetsRequest) returns (GetActorAssetsResponse);

    rpc GetPendingSelectionChange(GetPendingSelectionChangeRequest) returns (GetPendingSelectionChangeResponse);
    rpc GetPendingAddItem(GetPendingAddItemRequest) returns (GetPendingAddItemResponse);
    rpc SetSelection(SetSelectionRequest) returns (SetSelectionResponse);

    rpc SaveBodyTransform(SaveBodyTransformRequest) returns (SaveBodyTransformResponse);
    rpc RestoreBodyTransform(RestoreBodyTransformRequest) returns (RestoreBodyTransformResponse);

    rpc DeleteActor(DeleteActorRequest) returns (DeleteActorResponse);
    rpc RenameActor(RenameActorRequest) returns (RenameActorResponse);
    rpc ReParentActor(ReParentActorRequest) returns (ReParentActorResponse);

    rpc GetWindowId(GetWindowIdRequest) returns (GetWindowIdResponse);
    rpc GetGeneratePos(GetGeneratePosRequest) returns (GetGeneratePosResponse);

    rpc GetCacheFolder(GetCacheFolderRequest) returns (GetCacheFolderResponse);
    rpc LoadPackage(LoadPackageRequest) returns (LoadPackageResponse);
    rpc ChangeSimState(ChangeSimStateRequest) returns (ChangeSimStateResponse);
    rpc ChangeManipulatorType(ChangeManipulatorTypeRequest) returns (ChangeManipulatorTypeResponse);

    rpc GetCameraPNG(GetCameraPNGRequest) returns (GetCameraPNGResponse);
    rpc GetActorAssetAabb(GetActorAssetAabbRequest) returns (GetActorAssetAabbResponse);

    rpc QueueMouseEvent(QueueMouseEventRequest) returns (QueueMouseEventResponse);
    rpc QueueMouseWheelEvent(QueueMouseWheelEventRequest) returns (QueueMouseWheelEventResponse);
    rpc QueueKeyEvent(QueueKeyEventRequest) returns (QueueKeyEventResponse);

    rpc GetCameras(GetCamerasRequest) returns (GetCamerasResponse);
    rpc GetActiveCamera(GetActiveCameraRequest) returns (GetActiveCameraResponse);
    rpc SetActiveCamera(SetActiveCameraRequest) returns (SetActiveCameraResponse);

    rpc GetPropertyGroups(GetPropertyGroupsRequest) returns (GetPropertyGroupsResponse);
    rpc GetProperties(GetPropertiesRequest) returns (GetPropertiesResponse);
    rpc SetProperties(SetPropertiesRequest) returns (SetPropertiesResponse);

    rpc PublishScene(PublishSceneRequest) returns (PublishSceneResponse);
}
