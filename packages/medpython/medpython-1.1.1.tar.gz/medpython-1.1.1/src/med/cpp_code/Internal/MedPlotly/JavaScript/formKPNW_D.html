<!DOCTYPE html>
<html lang="en" xml:lang="en">
  <head>
    <!-- <meta charset="utf-8" /> -->
    <!-- <title>Getting started with JSON Form</title> -->
    <!-- <link rel="stylesheet" style="text/css" href="w3/w3.css" /> -->
    <link rel="stylesheet" style="text/css" href="../jsonform/css/bootstrap3.css" />

    <script type="text/javascript" src="jsonform/js/jquery.min.js"></script>
    <script type="text/javascript" src="jsonform/js/underscore.js"></script>
    <script type="text/javascript" src="jsonform/js/jsv.js"></script>
    <script type="text/javascript" src="jsonform/js/jsonform.js"></script> 
	
    <script type="text/javascript" src="plotly/plotly-latest.min.js"></script> 
	<style> body { margin: 40px;} </style>
  </head>
 
  <body>
    <h1>Patient Viewer</h1>
    <form></form>
    <div id="res" class="alert"></div>

	<script type="text/javascript">
	  var panel_list = [ "drugs_heatmap", "P_Diabetes", "DIAGNOSIS", "ADMISSION", "Drug"];
	  <!-- "Drugs", "Diabetes", "Cholesterol", "BP", "Renal", "Liver", "Ions", "Red_Count", "White_Count", "RC" ]; -->
      $('form').jsonForm({
        schema: {
			"pid": { type: 'number' , title: 'Pid' },
			"date": { type: 'number' , title: 'Date' },
			"desc": { type: 'string' , title: 'Description' },
			"panels": { type: 'array', title: "Panels", items: { type: 'string', enum: panel_list, default: panel_list}},
			"signals": { type: 'string', title: "signal charts"}
        },
		<!-- "customFormItems": {"panels2": {"type": "checkboxes", inline: true}}, -->
		form: [
			{"key":"pid"}, {"key":"date"}, {"key":"desc"},
			<!-- {"title": "Submit",  "type": "submit"}], -->
			{"key": "panels", "type": "checkboxes", inline: true, default: panel_list}, {key: "signals", type: "textarea"}, {"title": "Submit",  "type": "submit"}],
			<!-- {"key": "panels2", "type": "checkboxes", "activeClass": "btn-success"}], -->
        onSubmit: function (errors, values) {
          if (errors) {
            $('#res').html('<p>I beg your pardon?</p>');
          }
          else {
			<!-- var jstr = $.param(values); -->
			var jstr = JSON.stringify(values);
			var request = new XMLHttpRequest();
			request.onreadystatechange = function() {
				if (request.readyState == XMLHttpRequest.DONE) {
					<!-- document.getElementById("reshtml").innerHTML = this.responseText; -->
					$('#reshtml').html(request.responseText);
				}
			}
			request.open("POST","", true);
			<!-- request.responseType = 'document'; -->
			request.send(jstr);
          }
        }
      });
	  
	  $.getJSON( "/config", function( data ) {
		var text = '<table id="server_sett" class="table table-bordered"><thead><tr><th>Param Name</th><th>Value</th></tr></thead><tbody>';
		$.each( data, function( key, val ) {
			text += "<tr>";
			text += "<td>" + key + "</td>" + "<td>" + val + "</td>";
			text += "</tr>";
			if (key == "rep_fname") {
				var max_el=3;
				var split_tit=val.split('/');
				var last_elm = '.';
				for (i=split_tit.length - max_el; i < split_tit.length; i++) {
					if (i < 0) {
						continue;
					}
					last_elm = last_elm + "/" + split_tit[i];
				}
				document.title=last_elm;
			}
		});
		text += "</tbody></table>";
		text += '<a href="/config">Server Settings</a>';
	
		document.getElementById("cfg").innerHTML = text;
		
		});
		
		function toggle_table() {
			var x = document.getElementById("cfg");
			if (x.style.display === "none") {
				x.style.display = "block";
				document.getElementById("toggle_tbl").innerHTML = "Hide Setup Info";
			} else {
				x.style.display = "none";
				document.getElementById("toggle_tbl").innerHTML = "Show Setup Info";
			}
		}
		
    </script>
	<div id="reshtml" class="alert"></div>
	
	<div id="full_cfg">
		<button type="button" class="btn btn-primary" id="toggle_tbl" onclick="toggle_table()">Show Setup Info</button>
		<div id="cfg" style="display:none"></div>
	</div>
  </body>
</html>