defaults:
  - segment_pets_00_small
  - wandb_keys
  # - segment_pets_00_large
  - _self_
  # comment: change the parent to segment_pets_01_large / segment_pets_00_small depending on what you want to test.

globals:
  project: Segment OXPET
  author: Marc

mode:
  run_train: true
  run_test_interactive: false
  run_test_auto: true
  dump_model: false
  run_inference: false
  print_model_summary: false
  resume_chpt_path: null

transforms:
  resize_and_pad_bilinear:
    - ResizeMaxDimPad:
        max_dim: 256
        interpol_mode: bilinear
  resize_and_pad_nearest:
    - ResizeMaxDimPad:
        max_dim: 256
        interpol_mode: nearest

data:
  OXPET:
    processor: ~/dev/fonduecaquelon/experiment_templates/segment_pets/oxfordpet_preparator.py
    args:
      base_path: ~/data_ML/oxford_pets/
      subset_train: 1.0
      subset_val: 1.0
      subset_test: 1.0
      pin_memory: true
      num_workers: 4
      prefetch_factor: 2
      train_batch_size: 16
      val_batch_size: 16
      test_batch_size: 1
      shuffle_train: true
      shuffle_val: false
      shuffle_test: false

train:
  path: ~/dev/fonduecaquelon/experiment_templates/segment_pets/train_oxpets.py
  args:
    epochs: 3
    use_GPU: true
    use_AMP: true
    accumulate_grad_batches: 1
    early_stop_val_loss: 500
    early_stop_train_loss: 500
    early_stop_nan: 5

losses:
  cross_ent:
    class_name: torch.nn.CrossEntropyLoss
    args:
      reduction: mean

store:
  results_path: ~/data_ML/results
  img_exp_nb: 4
  save_last_model: true
  save_best_val_model: true
  save_best_train_model: true
  checkpoint_frequency: 4
  use_tensorboard: false
  use_wandb: true
  wandb_project: oxford_pets
  wandb_entity: stmd

test:
  processor: ~/dev/fonduecaquelon/experiment_templates/segment_pets/oxpets_test.py
  test_model: best
  args:
    metrics:
      nb_test_samples: "10"

slurm_cluster:
  fdq_test_repo: false
  fdq_version: 0.0.75
  python_env_module: python/3.12.4
  uv_env_module: uv/0.6.12
  cuda_env_module: cuda/12.8.0
  scratch_results_path: /scratch/fdq_results/
  scratch_data_path: /scratch/fdq_data/
  log_path: ~/dev/fonduecaquelon/slurm_log
  job_time: 8
  stop_grace_time: 3
  cpus_per_task: 8
  cpus_per_task_test: 8
  gres: gpu:1
  gres_test: gpu:1
  mem: 120G
  mem_test: 120G
  partition: gpu
  account: cai_ivs
  auto_resubmit: true
  world_size: 1
  additional_pip_packages:
    - chuchichaestli==0.2.14
