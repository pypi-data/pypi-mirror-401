name: 'GitHub Space Shooter'
description: 'Transform your GitHub contribution graph into an space shooter game GIF'
author: 'zane'

branding:
  icon: 'navigation-2'
  color: 'black'

inputs:
  github-token:
    description: 'GitHub token for fetching contribution data (usually secrets.GITHUB_TOKEN)'
    required: true
  username:
    description: 'GitHub username to generate game for (defaults to repository owner)'
    required: false
    default: ${{ github.repository_owner }}
  output-path:
    description: 'Path where the GIF should be saved'
    required: false
    default: 'gh-space-shooter.gif'
  strategy:
    description: 'Enemy attack strategy (column, row, or random)'
    required: false
    default: 'random'
  fps:
    description: 'Frames per second for the animation (default: 40)'
    required: false
    default: '40'
  commit-message:
    description: 'Commit message for the GIF update'
    required: false
    default: 'Update space shooter game GIF'

outputs:
  gif-path:
    description: 'Path to the generated GIF file'
    value: ${{ steps.generate.outputs.gif-path }}

runs:
  using: 'composite'
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.13'

    - name: Install gh-space-shooter
      shell: bash
      run: |
        python -m pip install --upgrade pip
        pip install gh-space-shooter

    - name: Generate game GIF
      id: generate
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github-token }}
      run: |
        gh-space-shooter ${{ inputs.username }} \
          --output ${{ inputs.output-path }} \
          --strategy ${{ inputs.strategy }} \
          --fps ${{ inputs.fps }}

    - name: Commit and push GIF
      shell: bash
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add ${{ inputs.output-path }}
        git diff --staged --quiet || git commit -m "${{ inputs.commit-message }}"
        git push
