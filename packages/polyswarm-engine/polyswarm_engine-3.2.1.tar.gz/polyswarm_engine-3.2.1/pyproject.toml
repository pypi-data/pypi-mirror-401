[build-system]
requires = ["setuptools>=70"]
build-backend = "setuptools.build_meta"

[project]
name = "polyswarm_engine"
version = "3.2.1"
description = "Polyswarm engine libarary"
readme = "README.md"
authors = [
    {name = "Polyswarm Developers", email = "developers@polyswarm.io"},
]
requires-python = ">=3.8,<4"
dependencies = [
    "celery",
    "click",
    "click-log",
    "python-json-logger",
    "requests",
]

[project.urls]
Homepage = "https://github.com/polyswarm/polyswarm_engine"

[project.optional-dependencies]
tests = [
    "pathlib3x; python_version < '3.10'",
    "flake8",
    "isort",
    "mypy",
    "pytest>=7.0",
    "types-requests",
    "yapf",
]
web = [
    "flask",
    "gunicorn",
]

[tool.distutils.bdist_wheel]
universal = 1

[tool.pytest.ini_options]
testpaths = ["tests"]
norecursedirs = [
    "env",
    ".env",
    "venv",
    ".venv",
]
collect_ignore = "['setup.py']"
log_cli = true
log_cli_level = "DEBUG"
addopts = """
-W ignore::DeprecationWarning
-v -s -rfExXs
--continue-on-collection-errors"""

[tool.isort]
atomic = true
balanced_wrapping = true
force_sort_within_sections = true
from_first = false
include_trailing_comma = true
known_first_party = ["polyswarm_engine", "polyunite"]
multi_line_output = 3

[tool.pycodestyle]
max-line-length = "119"

[tool.flake8]
max-line-length = "119"
exclude = "medallion/test"
ignore = """
E402,  # module imports not at top of file
E226   # missing whitespace around arithemtic, handled by yapf
E251,  # unexpected spaces around keyword / parameter equals
E261,  # at least two spaces before inline comment
E262,  # inline comment should start with a #
E266,  # Too many leading '#' in comment
E266,  # missing whitespace around arithmetic operators
E402,  # module imports not at top of file
E704,  # Multiple statements on one line
E722,  # Allow bare 'except' statements
W503,  # line break before binary operator
W504,  # line break after binary operator"""

[tool.yapf]
column_limit = "119"
based_on_style = "pep8"
align_closing_bracket_with_visual_indent = "true"
allow_multiline_dictionary_keys = "false"
arithmetic_precedence_indication = "true"
coalesce_brackets = "true"
dedent_closing_brackets = "true"
indent_dictionary_value = "true"
split_all_top_level_comma_separated_values = "false"
split_before_dot = "true"

[tool.setuptools]
include-package-data = false

[tool.bumpversion]
current_version = "3.2.1"
commit = true
tag = false
sign_tags = true
tag_name = "{new_version}"
parse = '^(?P<major>\d+)\.(?P<minor>\d+)\.(?P<patch>\d+)(?:\.dev(?P<dev>\d+))?(?:\+(?P<local>[a-z0-9]+(?:\.[a-z0-9]+)*))?$'
serialize = [
  "{major}.{minor}.{patch}.dev{dev}+{short_commit_sha}",
  "{major}.{minor}.{patch}"
]

[tool.bumpversion.parts.dev]
first_value = "0"
optional_value = "0"

[[tool.bumpversion.files]]
filename = "polyswarm_engine/__init__.py"
search = "__VERSION__ = '{current_version}'"
replace = "__VERSION__ = '{new_version}'"
