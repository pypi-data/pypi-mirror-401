<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarkDeck Presentation</title>

    <!-- Theme CSS (loaded dynamically based on user preference) -->
    <script>
        // Load theme preference from localStorage, default to 'dark'
        const theme = localStorage.getItem('markdeck-theme') || 'dark';
        document.write('<link id="theme-css" rel="stylesheet" href="/static/' + theme + '.css">');
    </script>

    <link rel="stylesheet" href="/static/style.css">

    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.0.0/marked.min.js"></script>

    <!-- Highlight.js for syntax highlighting -->
    <script>
        // Load highlight.js theme based on current theme
        const hlTheme = (localStorage.getItem('markdeck-theme') || 'dark') === 'dark' ? 'github-dark' : 'github';
        document.write('<link id="highlight-css" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/' + hlTheme + '.min.css">');
    </script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>

    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Mermaid.js for diagrams -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
        const mermaidTheme = (localStorage.getItem('markdeck-theme') || 'dark') === 'dark' ? 'dark' : 'default';
        mermaid.initialize({
            startOnLoad: false,
            theme: mermaidTheme
        });
        window.mermaid = mermaid;
    </script>
</head>
<body>
    <div id="app">
        <!-- Loading state -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Loading presentation...</p>
        </div>

        <!-- Main presentation container -->
        <div id="presentation" class="presentation hidden">
            <!-- Slide container -->
            <div id="slide-container" class="slide-container">
                <div id="slide-content" class="slide-content"></div>
            </div>

            <!-- Progress indicator -->
            <div id="progress" class="progress">
                <span id="current-slide">1</span> / <span id="total-slides">1</span>
            </div>

            <!-- Progress bar -->
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
        </div>

        <!-- Grid overview -->
        <div id="grid-overlay" class="grid-overlay hidden">
            <div class="grid-header">
                <h2>Slide Overview</h2>
                <button id="close-grid" class="close-grid-button">✕</button>
            </div>
            <div id="grid-container" class="grid-container"></div>
        </div>

        <!-- Help overlay -->
        <div id="help-overlay" class="help-overlay hidden">
            <div class="help-content">
                <h2>Keyboard Shortcuts</h2>
                <table>
                    <tr><td><kbd>→</kbd> <kbd>Space</kbd></td><td>Next slide</td></tr>
                    <tr><td><kbd>←</kbd></td><td>Previous slide</td></tr>
                    <tr><td><kbd>Home</kbd></td><td>First slide</td></tr>
                    <tr><td><kbd>End</kbd></td><td>Last slide</td></tr>
                    <tr><td><kbd>O</kbd></td><td>Toggle slide overview</td></tr>
                    <tr><td><kbd>F</kbd></td><td>Toggle fullscreen</td></tr>
                    <tr><td><kbd>T</kbd></td><td>Cycle theme (dark/light/beige)</td></tr>
                    <tr><td><kbd>?</kbd></td><td>Show/hide help</td></tr>
                    <tr><td><kbd>Esc</kbd></td><td>Exit fullscreen/help/overview</td></tr>
                </table>
                <button id="close-help" class="close-button">Close (Esc)</button>
            </div>
        </div>

        <!-- Error message -->
        <div id="error" class="error hidden">
            <h2>Error Loading Presentation</h2>
            <p id="error-message"></p>
        </div>
    </div>

    <script src="/static/slides.js"></script>
</body>
</html>
