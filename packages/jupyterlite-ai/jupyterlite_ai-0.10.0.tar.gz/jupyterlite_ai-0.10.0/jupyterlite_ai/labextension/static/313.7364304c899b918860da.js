"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[313,694],{3313:(e,t,s)=>{s.r(t),s.d(t,{ISecretsManager:()=>l,InMemoryConnector:()=>d,LocalStorageConnector:()=>u,SecretsManager:()=>c,default:()=>p});var i,n=s(8490),r=s(6469),a=s(7262),o=s(4602);class c{constructor(e){var t;this._onInput=async e=>{var t;await this.storing,this._storing=new a.PromiseDelegate;const s=e.target,{namespace:n,id:r}=null!==(t=i.secretPath.get(s))&&void 0!==t?t:{};if(n&&r){const e=i.buildConnectorId(n,r);await this.ready,await i.set(e,{namespace:n,id:r,value:s.value})}this._storing.resolve()},this._ready=new a.PromiseDelegate,this._fieldsVisibilityChanged=new o.Signal(this),this._storing=new a.PromiseDelegate,this._storing.resolve(),i.setSecretFieldsVisibility(null!==(t=e.showSecretFields)&&void 0!==t&&t),!1===e.showSecretFields&&i.lockFieldsVisibility()}setConnector(e){i.setConnector(e),this._ready.resolve()}get ready(){return this._ready.promise}get storing(){return this._storing.promise}get fieldVisibilityChanged(){return this._fieldsVisibilityChanged}get secretFieldsVisibility(){return i.getSecretFieldsVisibility()}set secretFieldsVisibility(e){i.setSecretFieldsVisibility(e)&&this._fieldsVisibilityChanged.emit(i.getSecretFieldsVisibility())}async get(e,t,s){return i.checkNamespace(e,t),await Promise.all([this.ready,this.storing]),i.get(i.buildConnectorId(t,s))}async set(e,t,s,n){return i.checkNamespace(e,t),await this.ready,i.set(i.buildConnectorId(t,s),n)}async list(e,t){return i.checkNamespace(e,t),await Promise.all([this.ready,this.storing]),i.list(t)}async remove(e,t,s){return i.checkNamespace(e,t),await this.ready,i.remove(i.buildConnectorId(t,s))}async attach(e,t,s,n,r){i.checkNamespace(e,t);const a=i.buildConnectorId(t,s);i.inputs.get(a)&&this.detach(e,t,s),i.inputs.set(a,n),i.secretPath.set(n,{namespace:t,id:s});const o=await i.get(a);!n.value&&o?(n.value=o.value,n.dispatchEvent(new Event("input")),r&&r(o.value)):n.value&&n.value!==(null==o?void 0:o.value)&&(await this.ready,i.set(a,{namespace:t,id:s,value:n.value})),n.addEventListener("input",this._onInput)}async detach(e,t,s){i.checkNamespace(e,t),this._detach(i.buildConnectorId(t,s))}async detachAll(e,t){i.checkNamespace(e,t);for(const e of i.secretPath.values())e.namespace===t&&this._detach(i.buildConnectorId(e.namespace,e.id))}_detach(e){const t=i.inputs.get(e);t&&(t.removeEventListener("input",this._onInput),i.secretPath.delete(t),i.inputs.delete(e))}}Object.freeze(c.prototype),function(e){e.sign=function(e,t){const{lock:s,isLocked:n,namespaces:a,symbols:o}=i,{isDisabled:c}=r.PageConfig.Extension;if(n())throw new Error("Secrets manager is locked, check errors.");c("jupyter-secrets-manager:manager")&&(console.warn("Secrets manager is disabled."),s()),c(e)&&s(`Sign error: plugin ${e} is disabled.`),o.has(e)&&s(`Sign error: another plugin signed as "${e}".`);const l=Symbol(e),d=t(l);return e!==d.id&&s(`Sign error: plugin ID mismatch "${d.id}"â‰ "${e}".`),a.set(l,e),o.set(e,l),d}}(c||(c={})),function(e){let t=!1;function s(e){if(t=!0,e)throw new Error(e)}function i(){return t}e.namespaces=new Map,e.symbols=new Map,e.lock=s,e.isLocked=i,e.checkNamespace=function(t,s){if(i()||e.namespaces.get(t)!==s)throw new Error(`The secrets namespace ${s} is not available with the provided token`)};let n=null;e.setConnector=function(e){null!==n&&s("A secrets manager connector already exists."),n=e},e.get=async function(e){if(null==n?void 0:n.fetch)return n.fetch(e)},e.list=async function(e){if(null==n?void 0:n.list)return n.list(e)},e.set=async function(e,t){if(null==n?void 0:n.save)return n.save(e,t)},e.remove=async function(e){if(null==n?void 0:n.remove)return n.remove(e)};let r=!1;e.lockFieldsVisibility=function(){r=!0};let a=!1;e.getSecretFieldsVisibility=function(){return a},e.setSecretFieldsVisibility=function(e){return!r&&e!==a&&(a=e,!0)},e.inputs=new Map,e.secretPath=new Map,e.buildConnectorId=function(e,t){return`${e}:${t}`}}(i||(i={}));const l=new a.Token("jupyter-secret-manager:manager","The secrets manager");class d{constructor(){this._secrets=new Map}async fetch(e){return this._secrets.get(e)}async save(e,t){this._secrets.set(e,t)}async remove(e){this._secrets.delete(e)}async list(e){const t=[],s=[];return this._secrets.forEach((i,n)=>{i.namespace===e&&(t.push(n),s.push(i))}),{ids:t,values:s}}}class u{constructor(){this.storage="jupyter-secrets:secrets",console.warn("\nThe secret connector used currently should not be used in production, since the\npasswords are stored as plain text in the local storage of the browser'\n    ")}async fetch(e){var t;const s=JSON.parse(null!==(t=localStorage.getItem(this.storage))&&void 0!==t?t:"{}");if(s&&s[e])return s[e]}async save(e,t){var s;const i=JSON.parse(null!==(s=localStorage.getItem(this.storage))&&void 0!==s?s:"{}");i[e]=t,localStorage.setItem(this.storage,JSON.stringify(i))}async remove(e){var t;const s=JSON.parse(null!==(t=localStorage.getItem(this.storage))&&void 0!==t?t:"{}");delete s[e],localStorage.setItem(this.storage,JSON.stringify(s))}async list(e){var t;const s=JSON.parse(null!==(t=localStorage.getItem(this.storage))&&void 0!==t?t:"{}");return Object.keys(s).filter(t=>s[t].namespace===e).reduce((e,t)=>(e.ids.push(t),e.values.push(s[t]),e),{ids:[],values:[]})}}const h={id:"jupyter-secrets-manager:connector",description:"A JupyterLab extension to manage secrets.",autoStart:!0,requires:[l],activate:(e,t)=>{t.setConnector(new d)}},g={id:"jupyter-secrets-manager:manager",description:"A JupyterLab extension to manage secrets.",autoStart:!0,provides:l,optional:[n.ISettingRegistry],activate:(e,t)=>{let s=!0;"false"===r.PageConfig.getOption("secretsManager-showFields")&&(s=!1);const i=new c({showSecretFields:s});return t.load(g.id).then(e=>{var t;if(!s)return void(null===(t=e.schema.properties)||void 0===t||delete t.ShowSecretFields);const n=()=>{var t;const s=null!==(t=e.get("ShowSecretFields").composite)&&void 0!==t&&t;i.secretFieldsVisibility=s};e.changed.connect(()=>n()),n()}).catch(e=>{console.error(`Failed to load settings for ${g.id}`,e)}),console.debug("JupyterLab extension jupyter-secrets-manager is activated!"),i}},p=[h,g]}}]);