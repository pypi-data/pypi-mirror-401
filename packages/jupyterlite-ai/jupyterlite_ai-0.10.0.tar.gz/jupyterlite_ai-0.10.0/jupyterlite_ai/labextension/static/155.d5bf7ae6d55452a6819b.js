"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[155],{2155:(e,t,n)=>{n.r(t),n.d(t,{VERSION:()=>x,createMistral:()=>j,mistral:()=>k});var o=n(2100),s=n(116),a=n(337);function r(e){if(null==e)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const t=e.prompt_tokens,n=e.completion_tokens;return{inputTokens:{total:t,noCache:t,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:n,text:n,reasoning:void 0},raw:e}}function i({data:e,mediaType:t}){return e instanceof URL?e.toString():`data:${t};base64,${(0,s.convertToBase64)(e)}`}function l(e){var t;const n=[];for(let s=0;s<e.length;s++){const{role:a,content:r}=e[s],l=s===e.length-1;switch(a){case"system":n.push({role:"system",content:r});break;case"user":n.push({role:"user",content:r.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){const t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:i({data:e.data,mediaType:t})}}if("application/pdf"===e.mediaType)return{type:"document_url",document_url:i({data:e.data,mediaType:"application/pdf"})};throw new o.b8({functionality:"Only images and PDF file parts are supported"})}})});break;case"assistant":{let e="";const t=[];for(const n of r)switch(n.type){case"text":case"reasoning":e+=n.text;break;case"tool-call":t.push({id:n.toolCallId,type:"function",function:{name:n.toolName,arguments:JSON.stringify(n.input)}});break;default:throw new Error(`Unsupported content type in assistant message: ${n.type}`)}n.push({role:"assistant",content:e,prefix:!!l||void 0,tool_calls:t.length>0?t:void 0});break}case"tool":for(const e of r){if("tool-approval-response"===e.type)continue;const o=e.output;let s;switch(o.type){case"text":case"error-text":s=o.value;break;case"execution-denied":s=null!=(t=o.reason)?t:"Tool execution denied.";break;case"content":case"json":case"error-json":s=JSON.stringify(o.value)}n.push({role:"tool",name:e.toolName,tool_call_id:e.toolCallId,content:s})}break;default:throw new Error(`Unsupported role: ${a}`)}}return n}function u({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function c(e){switch(e){case"stop":return"stop";case"length":case"model_length":return"length";case"tool_calls":return"tool-calls";default:return"other"}}var d=a.z.object({safePrompt:a.z.boolean().optional(),documentImageLimit:a.z.number().optional(),documentPageLimit:a.z.number().optional(),structuredOutputs:a.z.boolean().optional(),strictJsonSchema:a.z.boolean().optional(),parallelToolCalls:a.z.boolean().optional()}),p=a.z.object({object:a.z.literal("error"),message:a.z.string(),type:a.z.string(),param:a.z.string().nullable(),code:a.z.string().nullable()}),h=(0,s.createJsonErrorResponseHandler)({errorSchema:p,errorToMessage:e=>e.message}),m=class{constructor(e,t){var n;this.specificationVersion="v3",this.supportedUrls={"application/pdf":[/^https:\/\/.*$/]},this.modelId=e,this.config=t,this.generateId=null!=(n=t.generateId)?n:s.generateId}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:a,topK:r,frequencyPenalty:i,presencePenalty:u,stopSequences:c,responseFormat:p,seed:h,providerOptions:m,tools:g,toolChoice:f}){var y,b,z,v;const w=[],_=null!=(y=await(0,s.parseProviderOptions)({provider:"mistral",providerOptions:m,schema:d}))?y:{};null!=r&&w.push({type:"unsupported",feature:"topK"}),null!=i&&w.push({type:"unsupported",feature:"frequencyPenalty"}),null!=u&&w.push({type:"unsupported",feature:"presencePenalty"}),null!=c&&w.push({type:"unsupported",feature:"stopSequences"});const x=null==(b=_.structuredOutputs)||b,j=null!=(z=_.strictJsonSchema)&&z;"json"!==(null==p?void 0:p.type)||(null==p?void 0:p.schema)||(e=(0,s.injectJsonInstructionIntoMessages)({messages:e,schema:p.schema}));const k={model:this.modelId,safe_prompt:_.safePrompt,max_tokens:t,temperature:n,top_p:a,random_seed:h,response_format:"json"===(null==p?void 0:p.type)?x&&null!=(null==p?void 0:p.schema)?{type:"json_schema",json_schema:{schema:p.schema,strict:j,name:null!=(v=p.name)?v:"response",description:p.description}}:{type:"json_object"}:void 0,document_image_limit:_.documentImageLimit,document_page_limit:_.documentPageLimit,messages:l(e)},{tools:C,toolChoice:T,toolWarnings:I}=function({tools:e,toolChoice:t}){const n=[];if(null==(e=(null==e?void 0:e.length)?e:void 0))return{tools:void 0,toolChoice:void 0,toolWarnings:n};const s=[];for(const t of e)"provider"===t.type?n.push({type:"unsupported",feature:`provider-defined tool ${t.id}`}):s.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema,...null!=t.strict?{strict:t.strict}:{}}});if(null==t)return{tools:s,toolChoice:void 0,toolWarnings:n};const a=t.type;switch(a){case"auto":case"none":return{tools:s,toolChoice:a,toolWarnings:n};case"required":return{tools:s,toolChoice:"any",toolWarnings:n};case"tool":return{tools:s.filter(e=>e.function.name===t.toolName),toolChoice:"any",toolWarnings:n};default:{const e=a;throw new o.b8({functionality:`tool choice type: ${e}`})}}}({tools:g,toolChoice:f});return{args:{...k,tools:C,tool_choice:T,...null!=C&&void 0!==_.parallelToolCalls?{parallel_tool_calls:_.parallelToolCalls}:{}},warnings:[...w,...I]}}async doGenerate(e){var t;const{args:n,warnings:o}=await this.getArgs(e),{responseHeaders:a,value:i,rawValue:l}=await(0,s.postJsonToApi)({url:`${this.config.baseURL}/chat/completions`,headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:n,failedResponseHandler:h,successfulResponseHandler:(0,s.createJsonResponseHandler)(z),abortSignal:e.abortSignal,fetch:this.config.fetch}),d=i.choices[0],p=[];if(null!=d.message.content&&Array.isArray(d.message.content))for(const e of d.message.content)if("thinking"===e.type){const t=g(e.thinking);t.length>0&&p.push({type:"reasoning",text:t})}else"text"===e.type&&e.text.length>0&&p.push({type:"text",text:e.text});else{const e=f(d.message.content);null!=e&&e.length>0&&p.push({type:"text",text:e})}if(null!=d.message.tool_calls)for(const e of d.message.tool_calls)p.push({type:"tool-call",toolCallId:e.id,toolName:e.function.name,input:e.function.arguments});return{content:p,finishReason:{unified:c(d.finish_reason),raw:null!=(t=d.finish_reason)?t:void 0},usage:r(i.usage),request:{body:n},response:{...u(i),headers:a,body:l},warnings:o}}async doStream(e){const{args:t,warnings:n}=await this.getArgs(e),o={...t,stream:!0},{responseHeaders:a,value:i}=await(0,s.postJsonToApi)({url:`${this.config.baseURL}/chat/completions`,headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:o,failedResponseHandler:h,successfulResponseHandler:(0,s.createEventSourceResponseHandler)(v),abortSignal:e.abortSignal,fetch:this.config.fetch});let l,d={unified:"other",raw:void 0},p=!0,m=!1,y=null;const b=this.generateId;return{stream:i.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return void n.enqueue({type:"error",error:t.error});const o=t.value;p&&(p=!1,n.enqueue({type:"response-metadata",...u(o)})),null!=o.usage&&(l=o.usage);const s=o.choices[0],a=s.delta,r=f(a.content);if(null!=a.content&&Array.isArray(a.content))for(const e of a.content)if("thinking"===e.type){const t=g(e.thinking);t.length>0&&(null==y&&(m&&(n.enqueue({type:"text-end",id:"0"}),m=!1),y=b(),n.enqueue({type:"reasoning-start",id:y})),n.enqueue({type:"reasoning-delta",id:y,delta:t}))}if(null!=r&&r.length>0&&(m||(null!=y&&(n.enqueue({type:"reasoning-end",id:y}),y=null),n.enqueue({type:"text-start",id:"0"}),m=!0),n.enqueue({type:"text-delta",id:"0",delta:r})),null!=(null==a?void 0:a.tool_calls))for(const e of a.tool_calls){const t=e.id,o=e.function.name,s=e.function.arguments;n.enqueue({type:"tool-input-start",id:t,toolName:o}),n.enqueue({type:"tool-input-delta",id:t,delta:s}),n.enqueue({type:"tool-input-end",id:t}),n.enqueue({type:"tool-call",toolCallId:t,toolName:o,input:s})}null!=s.finish_reason&&(d={unified:c(s.finish_reason),raw:s.finish_reason})},flush(e){null!=y&&e.enqueue({type:"reasoning-end",id:y}),m&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:d,usage:r(l)})}})),request:{body:o},response:{headers:a}}}};function g(e){return e.filter(e=>"text"===e.type).map(e=>e.text).join("")}function f(e){if("string"==typeof e)return e;if(null==e)return;const t=[];for(const n of e){const{type:e}=n;switch(e){case"text":t.push(n.text);break;case"thinking":case"image_url":case"reference":break;default:throw new Error(`Unsupported type: ${e}`)}}return t.length?t.join(""):void 0}var y=a.z.union([a.z.string(),a.z.array(a.z.discriminatedUnion("type",[a.z.object({type:a.z.literal("text"),text:a.z.string()}),a.z.object({type:a.z.literal("image_url"),image_url:a.z.union([a.z.string(),a.z.object({url:a.z.string(),detail:a.z.string().nullable()})])}),a.z.object({type:a.z.literal("reference"),reference_ids:a.z.array(a.z.number())}),a.z.object({type:a.z.literal("thinking"),thinking:a.z.array(a.z.object({type:a.z.literal("text"),text:a.z.string()}))})]))]).nullish(),b=a.z.object({prompt_tokens:a.z.number(),completion_tokens:a.z.number(),total_tokens:a.z.number()}),z=a.z.object({id:a.z.string().nullish(),created:a.z.number().nullish(),model:a.z.string().nullish(),choices:a.z.array(a.z.object({message:a.z.object({role:a.z.literal("assistant"),content:y,tool_calls:a.z.array(a.z.object({id:a.z.string(),function:a.z.object({name:a.z.string(),arguments:a.z.string()})})).nullish()}),index:a.z.number(),finish_reason:a.z.string().nullish()})),object:a.z.literal("chat.completion"),usage:b}),v=a.z.object({id:a.z.string().nullish(),created:a.z.number().nullish(),model:a.z.string().nullish(),choices:a.z.array(a.z.object({delta:a.z.object({role:a.z.enum(["assistant"]).optional(),content:y,tool_calls:a.z.array(a.z.object({id:a.z.string(),function:a.z.object({name:a.z.string(),arguments:a.z.string()})})).nullish()}),finish_reason:a.z.string().nullish(),index:a.z.number()})),usage:b.nullish()}),w=class{constructor(e,t){this.specificationVersion="v3",this.maxEmbeddingsPerCall=32,this.supportsParallelCalls=!1,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,abortSignal:t,headers:n}){if(e.length>this.maxEmbeddingsPerCall)throw new o.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:a,value:r,rawValue:i}=await(0,s.postJsonToApi)({url:`${this.config.baseURL}/embeddings`,headers:(0,s.combineHeaders)(this.config.headers(),n),body:{model:this.modelId,input:e,encoding_format:"float"},failedResponseHandler:h,successfulResponseHandler:(0,s.createJsonResponseHandler)(_),abortSignal:t,fetch:this.config.fetch});return{warnings:[],embeddings:r.data.map(e=>e.embedding),usage:r.usage?{tokens:r.usage.prompt_tokens}:void 0,response:{headers:a,body:i}}}},_=a.z.object({data:a.z.array(a.z.object({embedding:a.z.array(a.z.number())})),usage:a.z.object({prompt_tokens:a.z.number()}).nullish()}),x="3.0.1";function j(e={}){var t;const n=null!=(t=(0,s.withoutTrailingSlash)(e.baseURL))?t:"https://api.mistral.ai/v1",a=()=>(0,s.withUserAgentSuffix)({Authorization:`Bearer ${(0,s.loadApiKey)({apiKey:e.apiKey,environmentVariableName:"MISTRAL_API_KEY",description:"Mistral"})}`,...e.headers},`ai-sdk/mistral/${x}`),r=t=>new m(t,{provider:"mistral.chat",baseURL:n,headers:a,fetch:e.fetch,generateId:e.generateId}),i=t=>new w(t,{provider:"mistral.embedding",baseURL:n,headers:a,fetch:e.fetch}),l=function(e){if(new.target)throw new Error("The Mistral model function cannot be called with the new keyword.");return r(e)};return l.specificationVersion="v3",l.languageModel=r,l.chat=r,l.embedding=i,l.embeddingModel=i,l.textEmbedding=i,l.textEmbeddingModel=i,l.imageModel=e=>{throw new o.eM({modelId:e,modelType:"imageModel"})},l}var k=j()}}]);