"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[482],{6482:(e,t,o)=>{o.r(t),o.d(t,{VERSION:()=>r,createGoogleGenerativeAI:()=>L,google:()=>G});var n=o(116),i=o(2100),a=o(337),r="3.0.1",s=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({error:a.z.object({code:a.z.number().nullable(),message:a.z.string(),status:a.z.string()})}))),l=(0,n.createJsonErrorResponseHandler)({errorSchema:s,errorToMessage:e=>e.error.message}),u=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({outputDimensionality:a.z.number().optional(),taskType:a.z.enum(["SEMANTIC_SIMILARITY","CLASSIFICATION","CLUSTERING","RETRIEVAL_DOCUMENT","RETRIEVAL_QUERY","QUESTION_ANSWERING","FACT_VERIFICATION","CODE_RETRIEVAL_QUERY"]).optional()}))),d=class{constructor(e,t){this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:o,providerOptions:a}){const r=await(0,n.parseProviderOptions)({provider:"google",providerOptions:a,schema:u});if(e.length>this.maxEmbeddingsPerCall)throw new i.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const s=(0,n.combineHeaders)(await(0,n.resolve)(this.config.headers),t);if(1===e.length){const{responseHeaders:t,value:i,rawValue:a}=await(0,n.postJsonToApi)({url:`${this.config.baseURL}/models/${this.modelId}:embedContent`,headers:s,body:{model:`models/${this.modelId}`,content:{parts:[{text:e[0]}]},outputDimensionality:null==r?void 0:r.outputDimensionality,taskType:null==r?void 0:r.taskType},failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(p),abortSignal:o,fetch:this.config.fetch});return{warnings:[],embeddings:[i.embedding.values],usage:void 0,response:{headers:t,body:a}}}const{responseHeaders:d,value:g,rawValue:h}=await(0,n.postJsonToApi)({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:s,body:{requests:e.map(e=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:e}]},outputDimensionality:null==r?void 0:r.outputDimensionality,taskType:null==r?void 0:r.taskType}))},failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(c),abortSignal:o,fetch:this.config.fetch});return{warnings:[],embeddings:g.embeddings.map(e=>e.values),usage:void 0,response:{headers:d,body:h}}}},c=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({embeddings:a.z.array(a.z.object({values:a.z.array(a.z.number())}))}))),p=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({embedding:a.z.object({values:a.z.array(a.z.number())})})));function g(e){var t,o,n,i;if(null==e)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const a=null!=(t=e.promptTokenCount)?t:0,r=null!=(o=e.candidatesTokenCount)?o:0,s=null!=(n=e.cachedContentTokenCount)?n:0,l=null!=(i=e.thoughtsTokenCount)?i:0;return{inputTokens:{total:a,noCache:a-s,cacheRead:s,cacheWrite:void 0},outputTokens:{total:r+l,text:r,reasoning:l},raw:e}}function h(e,t=!0){if(null==e)return;if(function(e){return null!=e&&"object"==typeof e&&"object"===e.type&&(null==e.properties||0===Object.keys(e.properties).length)&&!e.additionalProperties}(e)){if(t)return;return"object"==typeof e&&e.description?{type:"object",description:e.description}:{type:"object"}}if("boolean"==typeof e)return{type:"boolean",properties:{}};const{type:o,description:n,required:i,properties:a,items:r,allOf:s,anyOf:l,oneOf:u,format:d,const:c,minLength:p,enum:g}=e,m={};if(n&&(m.description=n),i&&(m.required=i),d&&(m.format=d),void 0!==c&&(m.enum=[c]),o)if(Array.isArray(o)){const e=o.includes("null"),t=o.filter(e=>"null"!==e);0===t.length?m.type="null":(m.anyOf=t.map(e=>({type:e})),e&&(m.nullable=!0))}else m.type=o;if(void 0!==g&&(m.enum=g),null!=a&&(m.properties=Object.entries(a).reduce((e,[t,o])=>(e[t]=h(o,!1),e),{})),r&&(m.items=Array.isArray(r)?r.map(e=>h(e,!1)):h(r,!1)),s&&(m.allOf=s.map(e=>h(e,!1))),l)if(l.some(e=>"object"==typeof e&&"null"===(null==e?void 0:e.type))){const e=l.filter(e=>!("object"==typeof e&&"null"===(null==e?void 0:e.type)));if(1===e.length){const t=h(e[0],!1);"object"==typeof t&&(m.nullable=!0,Object.assign(m,t))}else m.anyOf=e.map(e=>h(e,!1)),m.nullable=!0}else m.anyOf=l.map(e=>h(e,!1));return u&&(m.oneOf=u.map(e=>h(e,!1))),void 0!==p&&(m.minLength=p),m}function m(e){return e.includes("/")?e:`models/${e}`}var f=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({responseModalities:a.z.array(a.z.enum(["TEXT","IMAGE"])).optional(),thinkingConfig:a.z.object({thinkingBudget:a.z.number().optional(),includeThoughts:a.z.boolean().optional(),thinkingLevel:a.z.enum(["minimal","low","medium","high"]).optional()}).optional(),cachedContent:a.z.string().optional(),structuredOutputs:a.z.boolean().optional(),safetySettings:a.z.array(a.z.object({category:a.z.enum(["HARM_CATEGORY_UNSPECIFIED","HARM_CATEGORY_HATE_SPEECH","HARM_CATEGORY_DANGEROUS_CONTENT","HARM_CATEGORY_HARASSMENT","HARM_CATEGORY_SEXUALLY_EXPLICIT","HARM_CATEGORY_CIVIC_INTEGRITY"]),threshold:a.z.enum(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"])})).optional(),threshold:a.z.enum(["HARM_BLOCK_THRESHOLD_UNSPECIFIED","BLOCK_LOW_AND_ABOVE","BLOCK_MEDIUM_AND_ABOVE","BLOCK_ONLY_HIGH","BLOCK_NONE","OFF"]).optional(),audioTimestamp:a.z.boolean().optional(),labels:a.z.record(a.z.string(),a.z.string()).optional(),mediaResolution:a.z.enum(["MEDIA_RESOLUTION_UNSPECIFIED","MEDIA_RESOLUTION_LOW","MEDIA_RESOLUTION_MEDIUM","MEDIA_RESOLUTION_HIGH"]).optional(),imageConfig:a.z.object({aspectRatio:a.z.enum(["1:1","2:3","3:2","3:4","4:3","4:5","5:4","9:16","16:9","21:9"]).optional(),imageSize:a.z.enum(["1K","2K","4K"]).optional()}).optional(),retrievalConfig:a.z.object({latLng:a.z.object({latitude:a.z.number(),longitude:a.z.number()}).optional()}).optional()})));function v({finishReason:e,hasToolCalls:t}){switch(e){case"STOP":return t?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"MALFORMED_FUNCTION_CALL":return"error";default:return"other"}}var y=class{constructor(e,t){var o;this.specificationVersion="v3",this.modelId=e,this.config=t,this.generateId=null!=(o=t.generateId)?o:n.generateId}get provider(){return this.config.provider}get supportedUrls(){var e,t,o;return null!=(o=null==(t=(e=this.config).supportedUrls)?void 0:t.call(e))?o:{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:o,topP:a,topK:r,frequencyPenalty:s,presencePenalty:l,stopSequences:u,responseFormat:d,seed:c,tools:p,toolChoice:g,providerOptions:m}){var v;const y=[],b=this.config.provider.includes("vertex")?"vertex":"google";let z=await(0,n.parseProviderOptions)({provider:b,providerOptions:m,schema:f});null==z&&"google"!==b&&(z=await(0,n.parseProviderOptions)({provider:"google",providerOptions:m,schema:f})),(null==p?void 0:p.some(e=>"provider"===e.type&&"google.vertex_rag_store"===e.id))&&!this.config.provider.startsWith("google.vertex.")&&y.push({type:"other",message:`The 'vertex_rag_store' tool is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});const S=this.modelId.toLowerCase().startsWith("gemma-"),{contents:C,systemInstruction:T}=function(e,t){var o,a,r;const s=[],l=[];let u=!0;const d=null!=(o=null==t?void 0:t.isGemmaModel)&&o,c=null!=(a=null==t?void 0:t.providerOptionsName)?a:"google";for(const{role:t,content:o}of e)switch(t){case"system":if(!u)throw new i.b8({functionality:"system messages are only supported at the beginning of the conversation"});s.push({text:o});break;case"user":{u=!1;const e=[];for(const t of o)switch(t.type){case"text":e.push({text:t.text});break;case"file":{const o="image/*"===t.mediaType?"image/jpeg":t.mediaType;e.push(t.data instanceof URL?{fileData:{mimeType:o,fileUri:t.data.toString()}}:{inlineData:{mimeType:o,data:(0,n.convertToBase64)(t.data)}});break}}l.push({role:"user",parts:e});break}case"assistant":u=!1,l.push({role:"model",parts:o.map(e=>{var t;const o=null==(t=e.providerOptions)?void 0:t[c],a=null!=(null==o?void 0:o.thoughtSignature)?String(o.thoughtSignature):void 0;switch(e.type){case"text":return 0===e.text.length?void 0:{text:e.text,thoughtSignature:a};case"reasoning":return 0===e.text.length?void 0:{text:e.text,thought:!0,thoughtSignature:a};case"file":if(e.data instanceof URL)throw new i.b8({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:e.mediaType,data:(0,n.convertToBase64)(e.data)},thoughtSignature:a};case"tool-call":return{functionCall:{name:e.toolName,args:e.input},thoughtSignature:a}}}).filter(e=>void 0!==e)});break;case"tool":{u=!1;const e=[];for(const t of o){if("tool-approval-response"===t.type)continue;const o=t.output;if("content"===o.type)for(const n of o.value)switch(n.type){case"text":e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:n.text}}});break;case"image-data":e.push({inlineData:{mimeType:n.mediaType,data:n.data}},{text:"Tool executed successfully and returned this image as a response"});break;default:e.push({text:JSON.stringify(n)})}else e.push({functionResponse:{name:t.toolName,response:{name:t.toolName,content:"execution-denied"===o.type?null!=(r=o.reason)?r:"Tool execution denied.":o.value}}})}l.push({role:"user",parts:e});break}}if(d&&s.length>0&&l.length>0&&"user"===l[0].role){const e=s.map(e=>e.text).join("\n\n");l[0].parts.unshift({text:e+"\n\n"})}return{systemInstruction:s.length>0&&!d?{parts:s}:void 0,contents:l}}(e,{isGemmaModel:S,providerOptionsName:b}),{tools:x,toolConfig:I,toolWarnings:R}=function({tools:e,toolChoice:t,modelId:o}){var n;e=(null==e?void 0:e.length)?e:void 0;const a=[],r=["gemini-flash-latest","gemini-flash-lite-latest","gemini-pro-latest"].some(e=>e===o),s=o.includes("gemini-2")||o.includes("gemini-3")||r,l=o.includes("gemini-1.5-flash")&&!o.includes("-8b"),u=o.includes("gemini-2.5");if(null==e)return{tools:void 0,toolConfig:void 0,toolWarnings:a};const d=e.some(e=>"function"===e.type),c=e.some(e=>"provider"===e.type);if(d&&c&&a.push({type:"unsupported",feature:"combination of function and provider-defined tools"}),c){const t=[];return e.filter(e=>"provider"===e.type).forEach(e=>{switch(e.id){case"google.google_search":s?t.push({googleSearch:{}}):l?t.push({googleSearchRetrieval:{dynamicRetrievalConfig:{mode:e.args.mode,dynamicThreshold:e.args.dynamicThreshold}}}):t.push({googleSearchRetrieval:{}});break;case"google.enterprise_web_search":s?t.push({enterpriseWebSearch:{}}):a.push({type:"unsupported",feature:`provider-defined tool ${e.id}`,details:"Enterprise Web Search requires Gemini 2.0 or newer."});break;case"google.url_context":s?t.push({urlContext:{}}):a.push({type:"unsupported",feature:`provider-defined tool ${e.id}`,details:"The URL context tool is not supported with other Gemini models than Gemini 2."});break;case"google.code_execution":s?t.push({codeExecution:{}}):a.push({type:"unsupported",feature:`provider-defined tool ${e.id}`,details:"The code execution tools is not supported with other Gemini models than Gemini 2."});break;case"google.file_search":u?t.push({fileSearch:{...e.args}}):a.push({type:"unsupported",feature:`provider-defined tool ${e.id}`,details:"The file search tool is only supported with Gemini 2.5 models."});break;case"google.vertex_rag_store":s?t.push({retrieval:{vertex_rag_store:{rag_resources:{rag_corpus:e.args.ragCorpus},similarity_top_k:e.args.topK}}}):a.push({type:"unsupported",feature:`provider-defined tool ${e.id}`,details:"The RAG store tool is not supported with other Gemini models than Gemini 2."});break;case"google.google_maps":s?t.push({googleMaps:{}}):a.push({type:"unsupported",feature:`provider-defined tool ${e.id}`,details:"The Google Maps grounding tool is not supported with Gemini models other than Gemini 2 or newer."});break;default:a.push({type:"unsupported",feature:`provider-defined tool ${e.id}`})}}),{tools:t.length>0?t:void 0,toolConfig:void 0,toolWarnings:a}}const p=[];for(const t of e)"function"===t.type?p.push({name:t.name,description:null!=(n=t.description)?n:"",parameters:h(t.inputSchema)}):a.push({type:"unsupported",feature:`function tool ${t.name}`});if(null==t)return{tools:[{functionDeclarations:p}],toolConfig:void 0,toolWarnings:a};const g=t.type;switch(g){case"auto":return{tools:[{functionDeclarations:p}],toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:a};case"none":return{tools:[{functionDeclarations:p}],toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:a};case"required":return{tools:[{functionDeclarations:p}],toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:a};case"tool":return{tools:[{functionDeclarations:p}],toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[t.toolName]}},toolWarnings:a};default:{const e=g;throw new i.b8({functionality:`tool choice type: ${e}`})}}}({tools:p,toolChoice:g,modelId:this.modelId});return{args:{generationConfig:{maxOutputTokens:t,temperature:o,topK:r,topP:a,frequencyPenalty:s,presencePenalty:l,stopSequences:u,seed:c,responseMimeType:"json"===(null==d?void 0:d.type)?"application/json":void 0,responseSchema:"json"!==(null==d?void 0:d.type)||null==d.schema||null!=(v=null==z?void 0:z.structuredOutputs)&&!v?void 0:h(d.schema),...(null==z?void 0:z.audioTimestamp)&&{audioTimestamp:z.audioTimestamp},responseModalities:null==z?void 0:z.responseModalities,thinkingConfig:null==z?void 0:z.thinkingConfig,...(null==z?void 0:z.mediaResolution)&&{mediaResolution:z.mediaResolution},...(null==z?void 0:z.imageConfig)&&{imageConfig:z.imageConfig}},contents:C,systemInstruction:S?void 0:T,safetySettings:null==z?void 0:z.safetySettings,tools:x,toolConfig:(null==z?void 0:z.retrievalConfig)?{...I,retrievalConfig:z.retrievalConfig}:I,cachedContent:null==z?void 0:z.cachedContent,labels:null==z?void 0:z.labels},warnings:[...y,...R],providerOptionsName:b}}async doGenerate(e){var t,o,i,a,r,s,u,d,c;const{args:p,warnings:h,providerOptionsName:f}=await this.getArgs(e),y=(0,n.combineHeaders)(await(0,n.resolve)(this.config.headers),e.headers),{responseHeaders:z,value:S,rawValue:C}=await(0,n.postJsonToApi)({url:`${this.config.baseURL}/${m(this.modelId)}:generateContent`,headers:y,body:p,failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(I),abortSignal:e.abortSignal,fetch:this.config.fetch}),T=S.candidates[0],x=[],R=null!=(o=null==(t=T.content)?void 0:t.parts)?o:[],E=S.usageMetadata;let w;for(const e of R)if("executableCode"in e&&(null==(i=e.executableCode)?void 0:i.code)){const t=this.config.generateId();w=t,x.push({type:"tool-call",toolCallId:t,toolName:"code_execution",input:JSON.stringify(e.executableCode),providerExecuted:!0})}else"codeExecutionResult"in e&&e.codeExecutionResult?(x.push({type:"tool-result",toolCallId:w,toolName:"code_execution",result:{outcome:e.codeExecutionResult.outcome,output:e.codeExecutionResult.output}}),w=void 0):"text"in e&&null!=e.text&&e.text.length>0?x.push({type:!0===e.thought?"reasoning":"text",text:e.text,providerMetadata:e.thoughtSignature?{[f]:{thoughtSignature:e.thoughtSignature}}:void 0}):"functionCall"in e?x.push({type:"tool-call",toolCallId:this.config.generateId(),toolName:e.functionCall.name,input:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{[f]:{thoughtSignature:e.thoughtSignature}}:void 0}):"inlineData"in e&&x.push({type:"file",data:e.inlineData.data,mediaType:e.inlineData.mimeType,providerMetadata:e.thoughtSignature?{[f]:{thoughtSignature:e.thoughtSignature}}:void 0});const _=null!=(a=b({groundingMetadata:T.groundingMetadata,generateId:this.config.generateId}))?a:[];for(const e of _)x.push(e);return{content:x,finishReason:{unified:v({finishReason:T.finishReason,hasToolCalls:x.some(e=>"tool-call"===e.type)}),raw:null!=(r=T.finishReason)?r:void 0},usage:g(E),warnings:h,providerMetadata:{[f]:{promptFeedback:null!=(s=S.promptFeedback)?s:null,groundingMetadata:null!=(u=T.groundingMetadata)?u:null,urlContextMetadata:null!=(d=T.urlContextMetadata)?d:null,safetyRatings:null!=(c=T.safetyRatings)?c:null,usageMetadata:null!=E?E:null}},request:{body:p},response:{headers:z,body:C}}}async doStream(e){const{args:t,warnings:o,providerOptionsName:i}=await this.getArgs(e),a=(0,n.combineHeaders)(await(0,n.resolve)(this.config.headers),e.headers),{responseHeaders:r,value:s}=await(0,n.postJsonToApi)({url:`${this.config.baseURL}/${m(this.modelId)}:streamGenerateContent?alt=sse`,headers:a,body:t,failedResponseHandler:l,successfulResponseHandler:(0,n.createEventSourceResponseHandler)(R),abortSignal:e.abortSignal,fetch:this.config.fetch});let u,d,c={unified:"other",raw:void 0};const p=this.config.generateId;let h=!1,f=null,y=null,z=0;const S=new Set;let C;return{stream:s.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,o){var n,a,r,s,l,g,m;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return void o.enqueue({type:"error",error:t.error});const T=t.value,x=T.usageMetadata;null!=x&&(u=x);const I=null==(n=T.candidates)?void 0:n[0];if(null==I)return;const R=I.content,E=b({groundingMetadata:I.groundingMetadata,generateId:p});if(null!=E)for(const e of E)"url"!==e.sourceType||S.has(e.url)||(S.add(e.url),o.enqueue(e));if(null!=R){const e=null!=(a=R.parts)?a:[];for(const t of e)if("executableCode"in t&&(null==(r=t.executableCode)?void 0:r.code)){const e=p();C=e,o.enqueue({type:"tool-call",toolCallId:e,toolName:"code_execution",input:JSON.stringify(t.executableCode),providerExecuted:!0}),h=!0}else if("codeExecutionResult"in t&&t.codeExecutionResult){const e=C;e&&(o.enqueue({type:"tool-result",toolCallId:e,toolName:"code_execution",result:{outcome:t.codeExecutionResult.outcome,output:t.codeExecutionResult.output}}),C=void 0)}else"text"in t&&null!=t.text&&t.text.length>0?!0===t.thought?(null!==f&&(o.enqueue({type:"text-end",id:f}),f=null),null===y&&(y=String(z++),o.enqueue({type:"reasoning-start",id:y,providerMetadata:t.thoughtSignature?{[i]:{thoughtSignature:t.thoughtSignature}}:void 0})),o.enqueue({type:"reasoning-delta",id:y,delta:t.text,providerMetadata:t.thoughtSignature?{[i]:{thoughtSignature:t.thoughtSignature}}:void 0})):(null!==y&&(o.enqueue({type:"reasoning-end",id:y}),y=null),null===f&&(f=String(z++),o.enqueue({type:"text-start",id:f,providerMetadata:t.thoughtSignature?{[i]:{thoughtSignature:t.thoughtSignature}}:void 0})),o.enqueue({type:"text-delta",id:f,delta:t.text,providerMetadata:t.thoughtSignature?{[i]:{thoughtSignature:t.thoughtSignature}}:void 0})):"inlineData"in t&&o.enqueue({type:"file",mediaType:t.inlineData.mimeType,data:t.inlineData.data});const t=function({parts:e,generateId:t,providerOptionsName:o}){const n=null==e?void 0:e.filter(e=>"functionCall"in e);return null==n||0===n.length?void 0:n.map(e=>({type:"tool-call",toolCallId:t(),toolName:e.functionCall.name,args:JSON.stringify(e.functionCall.args),providerMetadata:e.thoughtSignature?{[o]:{thoughtSignature:e.thoughtSignature}}:void 0}))}({parts:R.parts,generateId:p,providerOptionsName:i});if(null!=t)for(const e of t)o.enqueue({type:"tool-input-start",id:e.toolCallId,toolName:e.toolName,providerMetadata:e.providerMetadata}),o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:e.args,providerMetadata:e.providerMetadata}),o.enqueue({type:"tool-input-end",id:e.toolCallId,providerMetadata:e.providerMetadata}),o.enqueue({type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.args,providerMetadata:e.providerMetadata}),h=!0}null!=I.finishReason&&(c={unified:v({finishReason:I.finishReason,hasToolCalls:h}),raw:I.finishReason},d={[i]:{promptFeedback:null!=(s=T.promptFeedback)?s:null,groundingMetadata:null!=(l=I.groundingMetadata)?l:null,urlContextMetadata:null!=(g=I.urlContextMetadata)?g:null,safetyRatings:null!=(m=I.safetyRatings)?m:null}},null!=x&&(d[i].usageMetadata=x))},flush(e){null!==f&&e.enqueue({type:"text-end",id:f}),null!==y&&e.enqueue({type:"reasoning-end",id:y}),e.enqueue({type:"finish",finishReason:c,usage:g(u),providerMetadata:d})}})),response:{headers:r},request:{body:t}}}};function b({groundingMetadata:e,generateId:t}){var o,n,i,a,r;if(!(null==e?void 0:e.groundingChunks))return;const s=[];for(const l of e.groundingChunks)if(null!=l.web)s.push({type:"source",sourceType:"url",id:t(),url:l.web.uri,title:null!=(o=l.web.title)?o:void 0});else if(null!=l.retrievedContext){const e=l.retrievedContext.uri,o=l.retrievedContext.fileSearchStore;if(e&&(e.startsWith("http://")||e.startsWith("https://")))s.push({type:"source",sourceType:"url",id:t(),url:e,title:null!=(n=l.retrievedContext.title)?n:void 0});else if(e){const o=null!=(i=l.retrievedContext.title)?i:"Unknown Document";let n,a="application/octet-stream";e.endsWith(".pdf")?(a="application/pdf",n=e.split("/").pop()):e.endsWith(".txt")?(a="text/plain",n=e.split("/").pop()):e.endsWith(".docx")?(a="application/vnd.openxmlformats-officedocument.wordprocessingml.document",n=e.split("/").pop()):e.endsWith(".doc")?(a="application/msword",n=e.split("/").pop()):e.match(/\.(md|markdown)$/)?(a="text/markdown",n=e.split("/").pop()):n=e.split("/").pop(),s.push({type:"source",sourceType:"document",id:t(),mediaType:a,title:o,filename:n})}else if(o){const e=null!=(a=l.retrievedContext.title)?a:"Unknown Document";s.push({type:"source",sourceType:"document",id:t(),mediaType:"application/octet-stream",title:e,filename:o.split("/").pop()})}}else null!=l.maps&&l.maps.uri&&s.push({type:"source",sourceType:"url",id:t(),url:l.maps.uri,title:null!=(r=l.maps.title)?r:void 0});return s.length>0?s:void 0}var z=()=>a.z.object({webSearchQueries:a.z.array(a.z.string()).nullish(),retrievalQueries:a.z.array(a.z.string()).nullish(),searchEntryPoint:a.z.object({renderedContent:a.z.string()}).nullish(),groundingChunks:a.z.array(a.z.object({web:a.z.object({uri:a.z.string(),title:a.z.string().nullish()}).nullish(),retrievedContext:a.z.object({uri:a.z.string().nullish(),title:a.z.string().nullish(),text:a.z.string().nullish(),fileSearchStore:a.z.string().nullish()}).nullish(),maps:a.z.object({uri:a.z.string().nullish(),title:a.z.string().nullish(),text:a.z.string().nullish(),placeId:a.z.string().nullish()}).nullish()})).nullish(),groundingSupports:a.z.array(a.z.object({segment:a.z.object({startIndex:a.z.number().nullish(),endIndex:a.z.number().nullish(),text:a.z.string().nullish()}),segment_text:a.z.string().nullish(),groundingChunkIndices:a.z.array(a.z.number()).nullish(),supportChunkIndices:a.z.array(a.z.number()).nullish(),confidenceScores:a.z.array(a.z.number()).nullish(),confidenceScore:a.z.array(a.z.number()).nullish()})).nullish(),retrievalMetadata:a.z.union([a.z.object({webDynamicRetrievalScore:a.z.number()}),a.z.object({})]).nullish()}),S=()=>a.z.object({parts:a.z.array(a.z.union([a.z.object({functionCall:a.z.object({name:a.z.string(),args:a.z.unknown()}),thoughtSignature:a.z.string().nullish()}),a.z.object({inlineData:a.z.object({mimeType:a.z.string(),data:a.z.string()}),thoughtSignature:a.z.string().nullish()}),a.z.object({executableCode:a.z.object({language:a.z.string(),code:a.z.string()}).nullish(),codeExecutionResult:a.z.object({outcome:a.z.string(),output:a.z.string()}).nullish(),text:a.z.string().nullish(),thought:a.z.boolean().nullish(),thoughtSignature:a.z.string().nullish()})])).nullish()}),C=()=>a.z.object({category:a.z.string().nullish(),probability:a.z.string().nullish(),probabilityScore:a.z.number().nullish(),severity:a.z.string().nullish(),severityScore:a.z.number().nullish(),blocked:a.z.boolean().nullish()}),T=a.z.object({cachedContentTokenCount:a.z.number().nullish(),thoughtsTokenCount:a.z.number().nullish(),promptTokenCount:a.z.number().nullish(),candidatesTokenCount:a.z.number().nullish(),totalTokenCount:a.z.number().nullish(),trafficType:a.z.string().nullish()}),x=()=>a.z.object({urlMetadata:a.z.array(a.z.object({retrievedUrl:a.z.string(),urlRetrievalStatus:a.z.string()}))}),I=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({candidates:a.z.array(a.z.object({content:S().nullish().or(a.z.object({}).strict()),finishReason:a.z.string().nullish(),safetyRatings:a.z.array(C()).nullish(),groundingMetadata:z().nullish(),urlContextMetadata:x().nullish()})),usageMetadata:T.nullish(),promptFeedback:a.z.object({blockReason:a.z.string().nullish(),safetyRatings:a.z.array(C()).nullish()}).nullish()}))),R=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({candidates:a.z.array(a.z.object({content:S().nullish(),finishReason:a.z.string().nullish(),safetyRatings:a.z.array(C()).nullish(),groundingMetadata:z().nullish(),urlContextMetadata:x().nullish()})).nullish(),usageMetadata:T.nullish(),promptFeedback:a.z.object({blockReason:a.z.string().nullish(),safetyRatings:a.z.array(C()).nullish()}).nullish()}))),E=(0,n.createProviderToolFactoryWithOutputSchema)({id:"google.code_execution",inputSchema:a.z.object({language:a.z.string().describe("The programming language of the code."),code:a.z.string().describe("The code to be executed.")}),outputSchema:a.z.object({outcome:a.z.string().describe('The outcome of the execution (e.g., "OUTCOME_OK").'),output:a.z.string().describe("The output from the code execution.")})}),w=(0,n.createProviderToolFactory)({id:"google.enterprise_web_search",inputSchema:(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({})))}),_=a.z.object({fileSearchStoreNames:a.z.array(a.z.string()).describe("The names of the file_search_stores to retrieve from. Example: `fileSearchStores/my-file-search-store-123`"),topK:a.z.number().int().positive().describe("The number of file search retrieval chunks to retrieve.").optional(),metadataFilter:a.z.string().describe("Metadata filter to apply to the file search retrieval documents. See https://google.aip.dev/160 for the syntax of the filter expression.").optional()}).passthrough(),O=(0,n.lazySchema)(()=>(0,n.zodSchema)(_)),M=(0,n.createProviderToolFactory)({id:"google.file_search",inputSchema:O}),A=(0,n.createProviderToolFactory)({id:"google.google_maps",inputSchema:(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({})))}),N={googleSearch:(0,n.createProviderToolFactory)({id:"google.google_search",inputSchema:(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({mode:a.z.enum(["MODE_DYNAMIC","MODE_UNSPECIFIED"]).default("MODE_UNSPECIFIED"),dynamicThreshold:a.z.number().default(1)})))}),enterpriseWebSearch:w,googleMaps:A,urlContext:(0,n.createProviderToolFactory)({id:"google.url_context",inputSchema:(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({})))}),fileSearch:M,codeExecution:E,vertexRagStore:(0,n.createProviderToolFactory)({id:"google.vertex_rag_store",inputSchema:a.z.object({ragCorpus:a.z.string(),topK:a.z.number().optional()})})},k=class{constructor(e,t,o){this.modelId=e,this.settings=t,this.config=o,this.specificationVersion="v3"}get maxImagesPerCall(){var e;return null!=(e=this.settings.maxImagesPerCall)?e:4}get provider(){return this.config.provider}async doGenerate(e){var t,o,i;const{prompt:a,n:r=1,size:s,aspectRatio:u="1:1",seed:d,providerOptions:c,headers:p,abortSignal:g,files:h,mask:m}=e,f=[];if(null!=h&&h.length>0)throw new Error("Google Generative AI does not support image editing. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.");if(null!=m)throw new Error("Google Generative AI does not support image editing with masks. Use Google Vertex AI (@ai-sdk/google-vertex) for image editing capabilities.");null!=s&&f.push({type:"unsupported",feature:"size",details:"This model does not support the `size` option. Use `aspectRatio` instead."}),null!=d&&f.push({type:"unsupported",feature:"seed",details:"This model does not support the `seed` option through this provider."});const v=await(0,n.parseProviderOptions)({provider:"google",providerOptions:c,schema:D}),y=null!=(i=null==(o=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:o.call(t))?i:new Date,b={sampleCount:r};null!=u&&(b.aspectRatio=u),v&&Object.assign(b,v);const z={instances:[{prompt:a}],parameters:b},{responseHeaders:S,value:C}=await(0,n.postJsonToApi)({url:`${this.config.baseURL}/models/${this.modelId}:predict`,headers:(0,n.combineHeaders)(await(0,n.resolve)(this.config.headers),p),body:z,failedResponseHandler:l,successfulResponseHandler:(0,n.createJsonResponseHandler)(j),abortSignal:g,fetch:this.config.fetch});return{images:C.predictions.map(e=>e.bytesBase64Encoded),warnings:null!=f?f:[],providerMetadata:{google:{images:C.predictions.map(e=>({}))}},response:{timestamp:y,modelId:this.modelId,headers:S}}}},j=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({predictions:a.z.array(a.z.object({bytesBase64Encoded:a.z.string()})).default([])}))),D=(0,n.lazySchema)(()=>(0,n.zodSchema)(a.z.object({personGeneration:a.z.enum(["dont_allow","allow_adult","allow_all"]).nullish(),aspectRatio:a.z.enum(["1:1","3:4","4:3","9:16","16:9"]).nullish()})));function L(e={}){var t,o;const i=null!=(t=(0,n.withoutTrailingSlash)(e.baseURL))?t:"https://generativelanguage.googleapis.com/v1beta",a=null!=(o=e.name)?o:"google.generative-ai",s=()=>(0,n.withUserAgentSuffix)({"x-goog-api-key":(0,n.loadApiKey)({apiKey:e.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...e.headers},`ai-sdk/google/${r}`),l=t=>{var o;return new y(t,{provider:a,baseURL:i,headers:s,generateId:null!=(o=e.generateId)?o:n.generateId,supportedUrls:()=>({"*":[new RegExp(`^${i}/files/.*$`),new RegExp("^https://(?:www\\.)?youtube\\.com/watch\\?v=[\\w-]+(?:&[\\w=&.-]*)?$"),new RegExp("^https://youtu\\.be/[\\w-]+(?:\\?[\\w=&.-]*)?$")]}),fetch:e.fetch})},u=t=>new d(t,{provider:a,baseURL:i,headers:s,fetch:e.fetch}),c=(t,o={})=>new k(t,o,{provider:a,baseURL:i,headers:s,fetch:e.fetch}),p=function(e){if(new.target)throw new Error("The Google Generative AI model function cannot be called with the new keyword.");return l(e)};return p.specificationVersion="v3",p.languageModel=l,p.chat=l,p.generativeAI=l,p.embedding=u,p.embeddingModel=u,p.textEmbedding=u,p.textEmbeddingModel=u,p.image=c,p.imageModel=c,p.tools=N,p}var G=L()}}]);