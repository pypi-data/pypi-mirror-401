"use strict";(self.webpackChunk_jupyterlite_ai=self.webpackChunk_jupyterlite_ai||[]).push([[940],{2940:(e,t,n)=>{n.r(t),n.d(t,{OpenAICompatibleChatLanguageModel:()=>h,OpenAICompatibleCompletionLanguageModel:()=>w,OpenAICompatibleEmbeddingModel:()=>O,OpenAICompatibleImageModel:()=>R,VERSION:()=>C,createOpenAICompatible:()=>T});var o=n(2100),s=n(116),r=n(337),i={errorSchema:r.z.object({error:r.z.object({message:r.z.string(),type:r.z.string().nullish(),param:r.z.any().nullish(),code:r.z.union([r.z.string(),r.z.number()]).nullish()})}),errorToMessage:e=>e.error.message};function a(e){var t,n,o,s,r,i;if(null==e)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const a=null!=(t=e.prompt_tokens)?t:0,l=null!=(n=e.completion_tokens)?n:0,u=null!=(s=null==(o=e.prompt_tokens_details)?void 0:o.cached_tokens)?s:0,d=null!=(i=null==(r=e.completion_tokens_details)?void 0:r.reasoning_tokens)?i:0;return{inputTokens:{total:a,noCache:a-u,cacheRead:u,cacheWrite:void 0},outputTokens:{total:l,text:l-d,reasoning:d},raw:e}}function l(e){var t,n;return null!=(n=null==(t=null==e?void 0:e.providerOptions)?void 0:t.openaiCompatible)?n:{}}function u(e){var t;const n=[];for(const{role:r,content:i,...a}of e){const e=l({...a});switch(r){case"system":n.push({role:"system",content:i,...e});break;case"user":if(1===i.length&&"text"===i[0].type){n.push({role:"user",content:i[0].text,...l(i[0])});break}n.push({role:"user",content:i.map(e=>{const t=l(e);switch(e.type){case"text":return{type:"text",text:e.text,...t};case"file":if(e.mediaType.startsWith("image/")){const n="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${n};base64,${(0,s.convertToBase64)(e.data)}`},...t}}throw new o.b8({functionality:`file part media type ${e.mediaType}`})}}),...e});break;case"assistant":{let t="";const o=[];for(const e of i){const n=l(e);switch(e.type){case"text":t+=e.text;break;case"tool-call":o.push({id:e.toolCallId,type:"function",function:{name:e.toolName,arguments:JSON.stringify(e.input)},...n})}}n.push({role:"assistant",content:t,tool_calls:o.length>0?o:void 0,...e});break}case"tool":for(const e of i){if("tool-approval-response"===e.type)continue;const o=e.output;let s;switch(o.type){case"text":case"error-text":s=o.value;break;case"execution-denied":s=null!=(t=o.reason)?t:"Tool execution denied.";break;case"content":case"json":case"error-json":s=JSON.stringify(o.value)}const r=l(e);n.push({role:"tool",tool_call_id:e.toolCallId,content:s,...r})}break;default:throw new Error(`Unsupported role: ${r}`)}}return n}function d({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function c(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var p=r.z.object({user:r.z.string().optional(),reasoningEffort:r.z.string().optional(),textVerbosity:r.z.string().optional()}),h=class{constructor(e,t){var n,o;this.specificationVersion="v3",this.modelId=e,this.config=t;const r=null!=(n=t.errorStructure)?n:i;this.chunkSchema=v(r.errorSchema),this.failedResponseHandler=(0,s.createJsonErrorResponseHandler)(r),this.supportsStructuredOutputs=null!=(o=t.supportsStructuredOutputs)&&o}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get supportedUrls(){var e,t,n;return null!=(n=null==(t=(e=this.config).supportedUrls)?void 0:t.call(e))?n:{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:l,providerOptions:d,stopSequences:c,responseFormat:h,seed:m,toolChoice:g,tools:f}){var v,b,y,_;const z=[],w=Object.assign(null!=(v=await(0,s.parseProviderOptions)({provider:"openai-compatible",providerOptions:d,schema:p}))?v:{},null!=(b=await(0,s.parseProviderOptions)({provider:this.providerOptionsName,providerOptions:d,schema:p}))?b:{});null!=i&&z.push({type:"unsupported",feature:"topK"}),"json"!==(null==h?void 0:h.type)||null==h.schema||this.supportsStructuredOutputs||z.push({type:"unsupported",feature:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const{tools:k,toolChoice:x,toolWarnings:j}=function({tools:e,toolChoice:t}){const n=[];if(null==(e=(null==e?void 0:e.length)?e:void 0))return{tools:void 0,toolChoice:void 0,toolWarnings:n};const s=[];for(const t of e)"provider"===t.type?n.push({type:"unsupported",feature:`provider-defined tool ${t.id}`}):s.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema,...null!=t.strict?{strict:t.strict}:{}}});if(null==t)return{tools:s,toolChoice:void 0,toolWarnings:n};const r=t.type;switch(r){case"auto":case"none":case"required":return{tools:s,toolChoice:r,toolWarnings:n};case"tool":return{tools:s,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:n};default:{const e=r;throw new o.b8({functionality:`tool choice type: ${e}`})}}}({tools:f,toolChoice:g});return{args:{model:this.modelId,user:w.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:l,response_format:"json"===(null==h?void 0:h.type)?!0===this.supportsStructuredOutputs&&null!=h.schema?{type:"json_schema",json_schema:{schema:h.schema,name:null!=(y=h.name)?y:"response",description:h.description}}:{type:"json_object"}:void 0,stop:c,seed:m,...Object.fromEntries(Object.entries(null!=(_=null==d?void 0:d[this.providerOptionsName])?_:{}).filter(([e])=>!Object.keys(p.shape).includes(e))),reasoning_effort:w.reasoningEffort,verbosity:w.textVerbosity,messages:u(e),tools:k,tool_choice:x},warnings:[...z,...j]}}async doGenerate(e){var t,n,o,r,i,l;const{args:u,warnings:p}=await this.getArgs({...e}),h=JSON.stringify(u),{responseHeaders:m,value:f,rawValue:v}=await(0,s.postJsonToApi)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:u,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:(0,s.createJsonResponseHandler)(g),abortSignal:e.abortSignal,fetch:this.config.fetch}),b=f.choices[0],y=[],_=b.message.content;null!=_&&_.length>0&&y.push({type:"text",text:_});const z=null!=(t=b.message.reasoning_content)?t:b.message.reasoning;if(null!=z&&z.length>0&&y.push({type:"reasoning",text:z}),null!=b.message.tool_calls)for(const e of b.message.tool_calls)y.push({type:"tool-call",toolCallId:null!=(n=e.id)?n:(0,s.generateId)(),toolName:e.function.name,input:e.function.arguments});const w={[this.providerOptionsName]:{},...await(null==(r=null==(o=this.config.metadataExtractor)?void 0:o.extractMetadata)?void 0:r.call(o,{parsedBody:v}))},k=null==(i=f.usage)?void 0:i.completion_tokens_details;return null!=(null==k?void 0:k.accepted_prediction_tokens)&&(w[this.providerOptionsName].acceptedPredictionTokens=null==k?void 0:k.accepted_prediction_tokens),null!=(null==k?void 0:k.rejected_prediction_tokens)&&(w[this.providerOptionsName].rejectedPredictionTokens=null==k?void 0:k.rejected_prediction_tokens),{content:y,finishReason:{unified:c(b.finish_reason),raw:null!=(l=b.finish_reason)?l:void 0},usage:a(f.usage),providerMetadata:w,request:{body:h},response:{...d(f),headers:m,body:v},warnings:p}}async doStream(e){var t;const{args:n,warnings:r}=await this.getArgs({...e}),i={...n,stream:!0,stream_options:this.config.includeUsage?{include_usage:!0}:void 0},l=null==(t=this.config.metadataExtractor)?void 0:t.createStreamExtractor(),{responseHeaders:u,value:p}=await(0,s.postJsonToApi)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:i,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:(0,s.createEventSourceResponseHandler)(this.chunkSchema),abortSignal:e.abortSignal,fetch:this.config.fetch}),h=[];let m,g={unified:"other",raw:void 0},f=!0;const v=this.providerOptionsName;let b=!1,y=!1;return{stream:p.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:r})},transform(t,n){var r,i,a,u,p,v,_,z,w,k,x,j,S,O;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return g={unified:"error",raw:void 0},void n.enqueue({type:"error",error:t.error});if(null==l||l.processChunk(t.rawValue),"error"in t.value)return g={unified:"error",raw:void 0},void n.enqueue({type:"error",error:t.value.error.message});const I=t.value;f&&(f=!1,n.enqueue({type:"response-metadata",...d(I)})),null!=I.usage&&(m=I.usage);const R=I.choices[0];if(null!=(null==R?void 0:R.finish_reason)&&(g={unified:c(R.finish_reason),raw:null!=(r=R.finish_reason)?r:void 0}),null==(null==R?void 0:R.delta))return;const H=R.delta,q=null!=(i=H.reasoning_content)?i:H.reasoning;if(q&&(b||(n.enqueue({type:"reasoning-start",id:"reasoning-0"}),b=!0),n.enqueue({type:"reasoning-delta",id:"reasoning-0",delta:q})),H.content&&(y||(n.enqueue({type:"text-start",id:"txt-0"}),y=!0),n.enqueue({type:"text-delta",id:"txt-0",delta:H.content})),null!=H.tool_calls)for(const e of H.tool_calls){const t=e.index;if(null==h[t]){if(null==e.id)throw new o.xn({data:e,message:"Expected 'id' to be a string."});if(null==(null==(a=e.function)?void 0:a.name))throw new o.xn({data:e,message:"Expected 'function.name' to be a string."});n.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),h[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(u=e.function.arguments)?u:""},hasFinished:!1};const r=h[t];null!=(null==(p=r.function)?void 0:p.name)&&null!=(null==(v=r.function)?void 0:v.arguments)&&(r.function.arguments.length>0&&n.enqueue({type:"tool-input-delta",id:r.id,delta:r.function.arguments}),(0,s.isParsableJson)(r.function.arguments)&&(n.enqueue({type:"tool-input-end",id:r.id}),n.enqueue({type:"tool-call",toolCallId:null!=(_=r.id)?_:(0,s.generateId)(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0));continue}const r=h[t];r.hasFinished||(null!=(null==(z=e.function)?void 0:z.arguments)&&(r.function.arguments+=null!=(k=null==(w=e.function)?void 0:w.arguments)?k:""),n.enqueue({type:"tool-input-delta",id:r.id,delta:null!=(x=e.function.arguments)?x:""}),null!=(null==(j=r.function)?void 0:j.name)&&null!=(null==(S=r.function)?void 0:S.arguments)&&(0,s.isParsableJson)(r.function.arguments)&&(n.enqueue({type:"tool-input-end",id:r.id}),n.enqueue({type:"tool-call",toolCallId:null!=(O=r.id)?O:(0,s.generateId)(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0))}},flush(e){var t,n,o,r,i;b&&e.enqueue({type:"reasoning-end",id:"reasoning-0"}),y&&e.enqueue({type:"text-end",id:"txt-0"});for(const n of h.filter(e=>!e.hasFinished))e.enqueue({type:"tool-input-end",id:n.id}),e.enqueue({type:"tool-call",toolCallId:null!=(t=n.id)?t:(0,s.generateId)(),toolName:n.function.name,input:n.function.arguments});const u={[v]:{},...null==l?void 0:l.buildMetadata()};null!=(null==(n=null==m?void 0:m.completion_tokens_details)?void 0:n.accepted_prediction_tokens)&&(u[v].acceptedPredictionTokens=null==(o=null==m?void 0:m.completion_tokens_details)?void 0:o.accepted_prediction_tokens),null!=(null==(r=null==m?void 0:m.completion_tokens_details)?void 0:r.rejected_prediction_tokens)&&(u[v].rejectedPredictionTokens=null==(i=null==m?void 0:m.completion_tokens_details)?void 0:i.rejected_prediction_tokens),e.enqueue({type:"finish",finishReason:g,usage:a(m),providerMetadata:u})}})),request:{body:i},response:{headers:u}}}},m=r.z.object({prompt_tokens:r.z.number().nullish(),completion_tokens:r.z.number().nullish(),total_tokens:r.z.number().nullish(),prompt_tokens_details:r.z.object({cached_tokens:r.z.number().nullish()}).nullish(),completion_tokens_details:r.z.object({reasoning_tokens:r.z.number().nullish(),accepted_prediction_tokens:r.z.number().nullish(),rejected_prediction_tokens:r.z.number().nullish()}).nullish()}).nullish(),g=r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({message:r.z.object({role:r.z.literal("assistant").nullish(),content:r.z.string().nullish(),reasoning_content:r.z.string().nullish(),reasoning:r.z.string().nullish(),tool_calls:r.z.array(r.z.object({id:r.z.string().nullish(),function:r.z.object({name:r.z.string(),arguments:r.z.string()})})).nullish()}),finish_reason:r.z.string().nullish()})),usage:m}),f=r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({delta:r.z.object({role:r.z.enum(["assistant"]).nullish(),content:r.z.string().nullish(),reasoning_content:r.z.string().nullish(),reasoning:r.z.string().nullish(),tool_calls:r.z.array(r.z.object({index:r.z.number(),id:r.z.string().nullish(),function:r.z.object({name:r.z.string().nullish(),arguments:r.z.string().nullish()})})).nullish()}).nullish(),finish_reason:r.z.string().nullish()})),usage:m}),v=e=>r.z.union([f,e]);function b(e){var t,n;if(null==e)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};const o=null!=(t=e.prompt_tokens)?t:0,s=null!=(n=e.completion_tokens)?n:0;return{inputTokens:{total:o,noCache:o,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:s,text:s,reasoning:void 0},raw:e}}function y({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function _(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var z=r.z.object({echo:r.z.boolean().optional(),logitBias:r.z.record(r.z.string(),r.z.number()).optional(),suffix:r.z.string().optional(),user:r.z.string().optional()}),w=class{constructor(e,t){var n;this.specificationVersion="v3",this.modelId=e,this.config=t;const o=null!=(n=t.errorStructure)?n:i;this.chunkSchema=j(o.errorSchema),this.failedResponseHandler=(0,s.createJsonErrorResponseHandler)(o)}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get supportedUrls(){var e,t,n;return null!=(n=null==(t=(e=this.config).supportedUrls)?void 0:t.call(e))?n:{}}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:a,presencePenalty:l,stopSequences:u,responseFormat:d,seed:c,providerOptions:p,tools:h,toolChoice:m}){var g;const f=[],v=null!=(g=await(0,s.parseProviderOptions)({provider:this.providerOptionsName,providerOptions:p,schema:z}))?g:{};null!=i&&f.push({type:"unsupported",feature:"topK"}),(null==h?void 0:h.length)&&f.push({type:"unsupported",feature:"tools"}),null!=m&&f.push({type:"unsupported",feature:"toolChoice"}),null!=d&&"text"!==d.type&&f.push({type:"unsupported",feature:"responseFormat",details:"JSON response format is not supported."});const{prompt:b,stopSequences:y}=function({prompt:e,user:t="user",assistant:n="assistant"}){let s="";"system"===e[0].role&&(s+=`${e[0].content}\n\n`,e=e.slice(1));for(const{role:r,content:i}of e)switch(r){case"system":throw new o.M3({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":s+=`${t}:\n${i.map(e=>{if("text"===e.type)return e.text}).filter(Boolean).join("")}\n\n`;break;case"assistant":s+=`${n}:\n${i.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new o.b8({functionality:"tool-call messages"})}}).join("")}\n\n`;break;case"tool":throw new o.b8({functionality:"tool messages"});default:throw new Error(`Unsupported role: ${r}`)}return s+=`${n}:\n`,{prompt:s,stopSequences:[`\n${t}:`]}}({prompt:e}),_=[...null!=y?y:[],...null!=u?u:[]];return{args:{model:this.modelId,echo:v.echo,logit_bias:v.logitBias,suffix:v.suffix,user:v.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:a,presence_penalty:l,seed:c,...null==p?void 0:p[this.providerOptionsName],prompt:b,stop:_.length>0?_:void 0},warnings:f}}async doGenerate(e){const{args:t,warnings:n}=await this.getArgs(e),{responseHeaders:o,value:r,rawValue:i}=await(0,s.postJsonToApi)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:t,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:(0,s.createJsonResponseHandler)(x),abortSignal:e.abortSignal,fetch:this.config.fetch}),a=r.choices[0],l=[];return null!=a.text&&a.text.length>0&&l.push({type:"text",text:a.text}),{content:l,usage:b(r.usage),finishReason:{unified:_(a.finish_reason),raw:a.finish_reason},request:{body:t},response:{...y(r),headers:o,body:i},warnings:n}}async doStream(e){const{args:t,warnings:n}=await this.getArgs(e),o={...t,stream:!0,stream_options:this.config.includeUsage?{include_usage:!0}:void 0},{responseHeaders:r,value:i}=await(0,s.postJsonToApi)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:o,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:(0,s.createEventSourceResponseHandler)(this.chunkSchema),abortSignal:e.abortSignal,fetch:this.config.fetch});let a,l={unified:"other",raw:void 0},u=!0;return{stream:i.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){var o;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return l={unified:"error",raw:void 0},void n.enqueue({type:"error",error:t.error});const s=t.value;if("error"in s)return l={unified:"error",raw:void 0},void n.enqueue({type:"error",error:s.error});u&&(u=!1,n.enqueue({type:"response-metadata",...y(s)}),n.enqueue({type:"text-start",id:"0"})),null!=s.usage&&(a=s.usage);const r=s.choices[0];null!=(null==r?void 0:r.finish_reason)&&(l={unified:_(r.finish_reason),raw:null!=(o=r.finish_reason)?o:void 0}),null!=(null==r?void 0:r.text)&&n.enqueue({type:"text-delta",id:"0",delta:r.text})},flush(e){u||e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:l,usage:b(a)})}})),request:{body:o},response:{headers:r}}}},k=r.z.object({prompt_tokens:r.z.number(),completion_tokens:r.z.number(),total_tokens:r.z.number()}),x=r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({text:r.z.string(),finish_reason:r.z.string()})),usage:k.nullish()}),j=e=>r.z.union([r.z.object({id:r.z.string().nullish(),created:r.z.number().nullish(),model:r.z.string().nullish(),choices:r.z.array(r.z.object({text:r.z.string(),finish_reason:r.z.string().nullish(),index:r.z.number()})),usage:k.nullish()}),e]),S=r.z.object({dimensions:r.z.number().optional(),user:r.z.string().optional()}),O=class{constructor(e,t){this.specificationVersion="v3",this.modelId=e,this.config=t}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.config.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.config.supportsParallelCalls)||e}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){var a,l,u;const d=Object.assign(null!=(a=await(0,s.parseProviderOptions)({provider:"openai-compatible",providerOptions:r,schema:S}))?a:{},null!=(l=await(0,s.parseProviderOptions)({provider:this.providerOptionsName,providerOptions:r,schema:S}))?l:{});if(e.length>this.maxEmbeddingsPerCall)throw new o.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const{responseHeaders:c,value:p,rawValue:h}=await(0,s.postJsonToApi)({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:d.dimensions,user:d.user},failedResponseHandler:(0,s.createJsonErrorResponseHandler)(null!=(u=this.config.errorStructure)?u:i),successfulResponseHandler:(0,s.createJsonResponseHandler)(I),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:p.data.map(e=>e.embedding),usage:p.usage?{tokens:p.usage.prompt_tokens}:void 0,providerMetadata:p.providerMetadata,response:{headers:c,body:h}}}},I=r.z.object({data:r.z.array(r.z.object({embedding:r.z.array(r.z.number())})),usage:r.z.object({prompt_tokens:r.z.number()}).nullish(),providerMetadata:r.z.record(r.z.string(),r.z.record(r.z.string(),r.z.any())).optional()}),R=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxImagesPerCall=10}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:o,seed:r,providerOptions:a,headers:l,abortSignal:u,files:d,mask:c}){var p,h,m,g,f,v,b;const y=[];null!=o&&y.push({type:"unsupported",feature:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=r&&y.push({type:"unsupported",feature:"seed"});const _=null!=(m=null==(h=null==(p=this.config._internal)?void 0:p.currentDate)?void 0:h.call(p))?m:new Date;if(null!=d&&d.length>0){const{value:o,responseHeaders:r}=await(0,s.postFormDataToApi)({url:this.config.url({path:"/images/edits",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),l),formData:(0,s.convertToFormData)({model:this.modelId,prompt:e,image:await Promise.all(d.map(e=>q(e))),mask:null!=c?await q(c):void 0,n:t,size:n,...null!=(g=a.openai)?g:{}}),failedResponseHandler:(0,s.createJsonErrorResponseHandler)(null!=(f=this.config.errorStructure)?f:i),successfulResponseHandler:(0,s.createJsonResponseHandler)(H),abortSignal:u,fetch:this.config.fetch});return{images:o.data.map(e=>e.b64_json),warnings:y,response:{timestamp:_,modelId:this.modelId,headers:r}}}const{value:z,responseHeaders:w}=await(0,s.postJsonToApi)({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),l),body:{model:this.modelId,prompt:e,n:t,size:n,...null!=(v=a.openai)?v:{},response_format:"b64_json"},failedResponseHandler:(0,s.createJsonErrorResponseHandler)(null!=(b=this.config.errorStructure)?b:i),successfulResponseHandler:(0,s.createJsonResponseHandler)(H),abortSignal:u,fetch:this.config.fetch});return{images:z.data.map(e=>e.b64_json),warnings:y,response:{timestamp:_,modelId:this.modelId,headers:w}}}},H=r.z.object({data:r.z.array(r.z.object({b64_json:r.z.string()}))});async function q(e){if("url"===e.type)return(0,s.downloadBlob)(e.url);const t=e.data instanceof Uint8Array?e.data:(0,s.convertBase64ToUint8Array)(e.data);return new Blob([t],{type:e.mediaType})}var C="2.0.1";function T(e){const t=(0,s.withoutTrailingSlash)(e.baseURL),n=e.name,o={...e.apiKey&&{Authorization:`Bearer ${e.apiKey}`},...e.headers},r=()=>(0,s.withUserAgentSuffix)(o,`ai-sdk/openai-compatible/${C}`),i=o=>({provider:`${n}.${o}`,url:({path:n})=>{const o=new URL(`${t}${n}`);return e.queryParams&&(o.search=new URLSearchParams(e.queryParams).toString()),o.toString()},headers:r,fetch:e.fetch}),a=e=>l(e),l=t=>new h(t,{...i("chat"),includeUsage:e.includeUsage,supportsStructuredOutputs:e.supportsStructuredOutputs}),u=e=>new O(e,{...i("embedding")}),d=e=>a(e);return d.specificationVersion="v3",d.languageModel=a,d.chatModel=l,d.completionModel=t=>new w(t,{...i("completion"),includeUsage:e.includeUsage}),d.embeddingModel=u,d.textEmbeddingModel=u,d.imageModel=e=>new R(e,i("image")),d}}}]);