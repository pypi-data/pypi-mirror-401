[project]
name = "magical-athlete-simulator"
version = "0.7.0"
description = "A simulator for Magical Athlete"
authors = [{ name = "Philipp Schoneville", email = "philipp@schoneville.com" }]
license = "MIT"
readme = "README.md"
requires-python = "==3.12.7"
dependencies = ["rich>=13.7.1"]

[project.urls]
Repository = "https://github.com/pschonev/magical-athlete-simulator"
Changelog = "https://github.com/pschonev/magical-athlete-simulator/blob/main/CHANGELOG.md"

[project.optional-dependencies]
cli = [
    "cappa>=0.31.0",
    "duckdb-engine>=0.17.0",
    "msgspec>=0.20.0",
    "sqlmodel>=0.0.31",
    "tqdm>=4.67.1",
    "pyarrow>=22.0.0",
]

frontend = [
    "marimo==0.18.4",
    "altair==6.0.0",
    "polars==1.36.1",
    "sqlmodel==0.0.31",
]

[dependency-groups]
dev = [
    "pytest>=9.0.2",
    "basedpyright==1.23.0",
    "marimo[lsp]",
    "ruff>=0.14.10",
    "poethepoet>=0.40.0",
    "commitizen>=4.11.0",
]

[project.scripts]
magical-sim = "magical_athlete_simulator.cli:main"

[tool.ruff.lint]
select = ["ALL"]
ignore = [
    "D",
    "ANN",
    "PLR",
    "E501",
    "G004",
    "TRY003",
    "EM101",
    "S311",
    "C901",
    "RET505",
]

# Ruff
[tool.ruff]
exclude = ["tests"]
target-version = "py312"

# Pyright
[tool.basedpyright]
include = ["src", "tests"]
executionEnvironments = [{ root = "src" }, { root = "tests" }]

pythonVersion = "3.12"

reportImportCycles = "none"
reportAny = "none"
reportExplicitAny = "none"
reportUnusedCallResult = "none"
reportMissingTypeStubs = "none"
reportUnusedParameter = "none"

# Pytest
[tool.pytest.ini_options]
pythonpath = ["tests"]
testpaths = ["tests"]

# Commitizen
[tool.commitizen]
name = "cz_conventional_commits"
tag_format = "$version"
version_scheme = "pep440"
version_provider = "uv"
update_changelog_on_bump = true
major_version_zero = true


# Poe
[tool.poe]
envfile = ".env"

[tool.poe.tasks]
# Atomic steps
clean = "rm -rf dist"
bump-files = "cz bump --yes --files-only"
release-prep = "python scripts/release_prep.py"
release-commit = { shell = "git add pyproject.toml uv.lock CHANGELOG.md docs/ frontend/magical_athlete_analysis.py && git commit -m 'chore(release): prepare v$(python -c \"import tomllib; print(tomllib.load(open('pyproject.toml', 'rb'))['project']['version'])\" )'" }
release-build = "uv build"
release-publish = "uv publish"
release-tags = "git push --tags"
release-github = "sh -c 'cz changelog --incremental --unreleased-version \"$(cz version)\" --dry-run > /tmp/release_notes.md && gh release create \"$(cz version)\" --notes-file /tmp/release_notes.md'"

# Single command release
release = { sequence = [
    "clean",
    "bump-files",
    "release-prep",
    "release-commit",
    "release-build",
    "release-publish",
    "release-tags",
    "release-github",
] }


[build-system]
requires = ["uv_build>=0.9.10,<0.10.0"]
build-backend = "uv_build"
