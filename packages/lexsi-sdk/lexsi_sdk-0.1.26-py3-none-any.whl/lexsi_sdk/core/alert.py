from typing import List, Optional
from pydantic import BaseModel
import pandas as pd


class Alert(BaseModel):
    """Represents a monitoring alert generated by a model. Provides helper methods to inspect drift, unused features, and alert metadata."""

    info: dict
    detailed_report: Optional[List[dict] | dict] = None
    not_used_features: Optional[List[dict]] = None

    def __init__(self, **kwargs):
        """Initialize base model without extra behavior.
        Stores configuration and prepares the object for use."""
        super().__init__(**kwargs)

    def view_info(self) -> pd.DataFrame:
        """Return basic information about an alert, such as its type, category, severity, and timestamp.

        :return: _description_
        """
        if not self.info:
            return "There was an error while executing the alert."

        return pd.DataFrame([self.info])

    def view_detailed_report(self) -> pd.DataFrame:
        """Return a detailed report for the alert, containing analysis and potential remediation recommendations.

        :return: _description_
        """
        if not self.detailed_report:
            return "No detailed report found for the alert."

        if isinstance(self.detailed_report, list):
            detailed_report = [
                {
                    key: value
                    for key, value in feature.items()
                    if key != "current_small_hist" and key != "ref_small_hist"
                }
                for feature in self.detailed_report
            ]
        if isinstance(self.detailed_report, dict):
            detailed_report = [self.detailed_report]

        return pd.DataFrame(detailed_report)

    def view_not_used_features(self) -> pd.DataFrame:
        """Return features that were not used in the modelâ€™s decision-making for the alert. Helps identify features excluded from analysis.

        :return: _description_
        """
        if not self.not_used_features:
            return "Not used features is empty."

        return pd.DataFrame(self.not_used_features)
