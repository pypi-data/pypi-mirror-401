"use strict";(self.webpackChunk_jlab_enhanced_favorites=self.webpackChunk_jlab_enhanced_favorites||[]).push([[693],{693:(e,t,a)=>{a.r(t),a.d(t,{FAVORITE_TAG:()=>b,IFavorites:()=>F,default:()=>Y,notebookFactoryPlugin:()=>G});var o=a(469),i=a(581),s=a(428),n=a(205),r=a(490),l=a(840),c=a(247),d=a(345),v=a.n(d),h=a(602);const u=new l.LabIcon({name:"jupyterlab-favorites:filledStar",svgstr:'<svg\n  xmlns="http://www.w3.org/2000/svg"\n  viewBox="0 0 24 24"\n>\n  <path\n    d="M0 0h24v24H0z"\n    fill="none"\n  />\n  \x3c!-- The "fill" property has been modified from the original --\x3e\n  <path class="jp-icon3"  fill="rgb(97,97,97)"\n    d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"\n  />\n  <path\n    d="M0 0h24v24H0z"\n    fill="none"\n  />\n</svg>'}),g=new l.LabIcon({name:"jupyterlab-favorites:star",svgstr:'<svg\n  xmlns="http://www.w3.org/2000/svg"\n  viewBox="0 0 24 24"\n>\n  \x3c!-- The "fill" property has been modified from the original --\x3e\n  <path class="jp-icon3"  fill="rgb(97,97,97)"\n    d="M22 9.24l-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28L12 15.4z"\n  />\n  <path\n    d="M0 0h24v24H0z"\n    fill="none"\n  />\n</svg>'});var f,m,p,y=a(262);!function(e){e.favorites="jupyterlab-favorites",e.notebookFactory="favorites-notebook-factory"}(f||(f={})),function(e){e.addOrRemoveFavorite=`${f.favorites}:add-or-remove-favorite`,e.removeFavorite=`${f.favorites}:remove-favorite`,e.renameFavorite=`${f.favorites}:rename-favorite`,e.openFavorite=`${f.favorites}:open-favorite`,e.toggleFavoritesWidget=`${f.favorites}:toggle-favorites-widget`,e.restoreDefaults=`${f.favorites}:restore-defaults`,e.clearFavorites=`${f.favorites}:clear-favorites`,e.toggleCellsVisibility=`${f.favorites}:toggle-cell-visibility`,e.addFavoriteClasses=`${f.favorites}:toggle-favorite-classes`,e.toggleCellFavorite=`${f.favorites}:toggle-cell-favorite`}(m||(m={})),function(e){e.themes="@jupyterlab/apputils-extension:themes",e.favorites="@jlab-enhanced/favorites:favorites"}(p||(p={}));const F=new y.Token("jupyterlab-favorites:IFavorites"),b="favorite",C="jp-favorite-cell",w="jp-Favorites-show-all-stars",_="jp-Favorites-never-show-stars";function I(e){return e?u:g}function x(e){return[o.PathExt.basename(e),o.PathExt.dirname(e)]}function j(e){return(e?"Remove":"Add")+" Favorite"}function M(e,t){return o.PathExt.join(e,t)}function R(e){let t=e.getMetadata("tags");if(Array.isArray(t)){const a=t.indexOf(b);t=-1===a?[...t,b]:t.filter(e=>e!==b),0===t.length?e.deleteMetadata("tags"):e.setMetadata("tags",t)}else e.setMetadata("tags",[b])}function k(e){const t=e.model.getMetadata("tags");Array.isArray(t)&&t.includes(b)?e.addClass(C):e.removeClass(C)}function L(e,t){if(!t||!t.content)return;const a=t.content,o=(e,t)=>{t?a.node.classList.contains(e)||a.node.classList.add(e):a.node.classList.contains(e)&&a.node.classList.remove(e)};"allCells"===e?(o(_,!1),o(w,!0)):"onlyFavoriteCells"===e?(o(_,!1),o(w,!1)):"never"===e&&(o(w,!1),o(_,!0))}var S=a(355);const E=e=>{const{favorite:t,handleClick:a}=e;let o,[i,s]=x(t.path);return t.name?(i=t.name,s=""):s="/"+s,o=t.iconLabel?l.LabIcon.resolve({icon:t.iconLabel}):"directory"===t.contentType?l.folderIcon:l.fileIcon,d.createElement("div",{className:"jp-Favorites-item",title:M(t.root,t.path),onClick:e=>{a(t)},"data-path":t.path},d.createElement(o.react,{className:"jp-Favorites-itemIcon",tag:"span"}),d.createElement("span",{className:"jp-Favorites-itemText"},i,d.createElement("span",{className:"jp-Favorites-dirname"},s)))},W=e=>{const t=e.currentPath;return t?d.createElement(l.UseSignal,{signal:e.manager.favoritesChanged,initialSender:e.manager},a=>{var o;const i=null!==(o=null==a?void 0:a.hasFavorite(t))&&void 0!==o&&o,s=I(i);return d.createElement("button",{className:"jp-ToolbarButtonComponent jp-Button jp-mod-minimal",title:j(i),onClick:a=>{e.handleClick(t)}},d.createElement(s.react,{className:"jp-Favorites-BreadCrumbs-Icon",tag:"span"}))}):null};function T({visibleFavorites:e,manager:t}){const a=d.useRef(null),[o,i]=d.useState(!1),s=d.useRef(null),n=d.useCallback(e=>{if(!o)return;const t=a.current;if(!t)return;const i=t.closest(".jp-FileBrowser"),s=null==i?void 0:i.getBoundingClientRect();if(!s)return;const n=t.getBoundingClientRect(),r=e.clientY-n.top,l=s.height-100;r>24&&r<l&&(t.style.maxHeight=l+"px",t.style.height=r+"px")},[o]),r=d.useCallback(()=>{var e;i(!1),null===(e=s.current)||void 0===e||e.dispose(),s.current=null},[]);return d.useEffect(()=>{if(o)return document.addEventListener("mousemove",n),document.addEventListener("mouseup",r),()=>{document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",r)}},[o,n,r]),d.useEffect(()=>()=>{var e;null===(e=s.current)||void 0===e||e.dispose()},[]),d.createElement(d.Fragment,null,d.createElement("div",{ref:a,className:"jp-Favorites-container"},(null!=e?e:[]).map(e=>d.createElement(E,{key:`favorites-item-${e.path}`,favorite:e,handleClick:t.handleClick.bind(t)}))),d.createElement("div",{className:"jp-Favorites-resize-handle",onMouseDown:()=>{i(!0),s.current=S.Drag.overrideCursor("ns-resize")}}))}class A extends l.ReactWidget{constructor(e,t){super(),this.pathChanged=new h.Signal(this),this.manager=e,this.filebrowser=t,this.addClass("jp-Favorites"),this.filebrowser.model.pathChanged.connect((e,t)=>{const a=t.newValue;this.pathChanged.emit(a)})}render(){return d.createElement(l.UseSignal,{signal:this.manager.favoritesChanged,initialSender:this.manager,initialArgs:this.manager.visibleFavorites()},(e,t)=>d.createElement("div",null,d.createElement(l.UseSignal,{signal:e.visibilityChanged,initialSender:e,initialArgs:e.isVisible()},(e,a)=>a&&d.createElement(d.Fragment,null,d.createElement("div",{className:"jp-Favorites-header"},"Favorites"),d.createElement(T,{visibleFavorites:t,manager:e}),d.createElement("div",{className:"jp-FileBrowser-header"},"File Browser")))))}}class O{constructor(e,t,a,o){this.favoritesChanged=new h.Signal(this),this.visibilityChanged=new h.Signal(this),this._favorites=[],this._showWidget=!1,this._sortOrder="name",this._groupByType=!0,this._showWidget=!0,this._serverRoot=e,this._commandRegistry=t,this._settingsRegistry=a,this._contentsManager=o,this.favoritesMenu=new c.Menu({commands:this._commandRegistry}),this.favoritesMenu.title.label="Favorites",this._settingsRegistry.pluginChanged.connect(async(e,t)=>{t===p.favorites&&this.loadFavorites()}),this.favoritesChanged.connect(async e=>{this._showWidget=await this.loadShowWidget(),this.syncFavoritesMenu(),this.visibilityChanged.emit(this.isVisible())})}get serverRoot(){return this._serverRoot}get favorites(){return this._favorites.filter(e=>e.root===this.serverRoot)}set favorites(e){this._favorites=e,this.favoritesChanged.emit(this.visibleFavorites())}async addFavorite(e){const t=this._favorites.slice(),a=t.findIndex(t=>t.root===this.serverRoot&&t.path===e.path),o=t[a];o?o.hidden&&(o.hidden=!1,this.saveSettings({favorites:t})):this.saveSettings({favorites:t.concat([e])})}clearFavorites(){this.clearFavoritesOrRestoreDefaults(!0)}init(){this.loadFavorites()}isVisible(){return this._showWidget&&this.visibleFavorites(!1).length>0}hasFavorite(e){return this.visibleFavorites(!1).findIndex(t=>t.path===e)>=0}handleClick(e){this._commandRegistry.execute(m.openFavorite,{favorite:e})}async overwriteSettings(e){const t=JSON.stringify(e,null,4);this._settingsRegistry.upload(p.favorites,t)}async renameFavorite(e,t){const a=this._favorites.slice(),o=a.find(t=>t.root===this.serverRoot&&t.path===e);o&&(o.name=t,this.saveSettings({favorites:a}))}async removeFavorite(e){const t=this._favorites.slice(),a=t.findIndex(t=>t.root===this.serverRoot&&t.path===e),o=t[a];o&&(o.default?o.hidden=!0:t.splice(a,1),this.saveSettings({favorites:t}))}async removeFavoriteIfInvalid(e){this._contentsManager.get(e.path,{content:!1}).catch(t=>{404===t.response.status&&this.removeFavorite(e.path)})}restoreDefaults(){this.clearFavoritesOrRestoreDefaults(!1)}async saveSettings(e){void 0!==e.favorites&&await this._settingsRegistry.set(p.favorites,"favorites",e.favorites),void 0!==e.showWidget&&this._settingsRegistry.set(p.favorites,"showWidget",e.showWidget)}visibleFavorites(e=!0){const t=this.favorites.filter(e=>!e.hidden);return e&&"unsorted"!==this._sortOrder?t.sort((e,t)=>{if(this._groupByType&&e.contentType!==t.contentType)return e.contentType<t.contentType?-1:1;if("name"===this._sortOrder){const a=e.name||x(e.path)[0],o=t.name||x(t.path)[0];return a.localeCompare(o)}return e.path.localeCompare(t.path)}):t}clearFavoritesOrRestoreDefaults(e){const t=this._favorites,a=[];t.forEach(t=>{t.default&&(t.hidden=e,a.push(t))}),this.overwriteSettings({favorites:a})}async loadFavorites(){var e,t,a;const o=null!==(e=(await this._settingsRegistry.get(p.favorites,"favorites")).composite)&&void 0!==e?e:[],i=await this._settingsRegistry.get(p.favorites,"sortOrder");this._sortOrder=null!==(t=i.composite)&&void 0!==t?t:"name";const s=await this._settingsRegistry.get(p.favorites,"groupByType");this._groupByType=null===(a=s.composite)||void 0===a||a,this.favorites=o.map(e=>{var t;return{...e,root:null!==(t=e.root)&&void 0!==t?t:this.serverRoot}})}async loadShowWidget(){var e;return null!==(e=(await this._settingsRegistry.get(p.favorites,"showWidget")).composite)&&void 0!==e&&e}syncFavoritesMenu(){this.favoritesMenu.clearItems();const e=this.visibleFavorites();e.length>0&&(e.forEach(e=>{this.favoritesMenu.addItem({command:m.openFavorite,args:{favorite:e}})}),this.favoritesMenu.addItem({type:"separator"}));const t=this._showWidget;this.favoritesMenu.addItem({command:m.toggleFavoritesWidget,args:{showWidget:t}}),this.favoritesMenu.addItem({command:m.restoreDefaults}),this.favoritesMenu.addItem({command:m.clearFavorites})}}var N=a(14),B=a(570),P=a(711),D=a(283);const V="jp-Favorites-base-star-class";class $ extends c.Widget{constructor(e){super(),this._app=e,this._executionCount=null,this.addClass("jp-InputPrompt");const t=this.layout=new c.BoxLayout({direction:"right-to-left"});this._promptIndicator=new D.InputPrompt,this._promptIndicator.node.classList.add("jp-Favorites-InputPromptNumber"),t.addWidget(this._promptIndicator),this._favoriteIconOff=new l.ToolbarButton({icon:g,onClick:()=>{this._app.commands.execute(m.toggleCellFavorite)},tooltip:"Mark as favorite"}),this._favoriteIconOff.addClass("jp-Favorites-star-class-off"),this._favoriteIconOff.addClass(V),this._favoriteIconOn=new l.ToolbarButton({icon:u,onClick:()=>{this._app.commands.execute(m.toggleCellFavorite)},tooltip:"Remove from favorites"}),this._favoriteIconOn.addClass("jp-Favorites-star-class"),this._favoriteIconOn.addClass(V),t.addWidget(this._favoriteIconOff),t.addWidget(this._favoriteIconOn)}get executionCount(){return this._executionCount}set executionCount(e){this._executionCount=e,this._promptIndicator.executionCount=e}}class z extends s.Notebook{constructor(e){super(e)}get activeCellIndex(){return this.model&&this.widgets.length?super.activeCellIndex:-1}set activeCellIndex(e){const t=super.activeCellIndex;if(this.model&&this.widgets.length?(e=Math.max(e,0),e=Math.min(e,this.widgets.length-1)):e=-1,!this._isFavoritesFilterActive())return void(super.activeCellIndex=e);if(this._isCellFavorite(e))return void(super.activeCellIndex=e);const a=e>t?1:-1,o=this._findNearestFavoriteCell(e,a);if(-1===o){const t=this._findNearestFavoriteCell(e,a>0?-1:1);super.activeCellIndex=t}else super.activeCellIndex=o}_isCellFavorite(e){if(e<0||e>=this.widgets.length)return!1;const t=this.widgets[e].model.getMetadata("tags");return Array.isArray(t)&&t.includes(b)}_isFavoritesFilterActive(){return this.node.classList.contains("jp-favorites-filter-active")}_findNearestFavoriteCell(e,t){let a=e+t;for(;a>=0&&a<this.widgets.length;){if(this._isCellFavorite(a))return a;a+=t}return-1}}class H extends s.NotebookPanel.ContentFactory{constructor(e){super(e),this._app=e.app,this._mystFactory=e.mystFactory}createInputPrompt(){return new $(this._app)}createMarkdownCell(e){return this._mystFactory?this._mystFactory.createMarkdownCell(e):new D.MarkdownCell(e).initializeState()}createNotebook(e){return new z(e)}}const q="jp-favorites-filter-active",U="showStarsOnCells",J={id:f.favorites,autoStart:!0,requires:[i.IFileBrowserFactory,r.ISettingRegistry,s.INotebookTracker],provides:F,optional:[B.ITranslator,i.IDefaultFileBrowser,n.IMainMenu,N.IToolbarWidgetRegistry,N.ICommandPalette],activate:async(e,t,a,i,s,n,r,d,h)=>{console.log("JupyterLab extension jupyterlab-favorites is activated!");const u=(null!=s?s:B.nullTranslator).load("jupyterlab"),f=e.docRegistry,{commands:y,serviceManager:F}=e,w=new O(o.PageConfig.getOption("serverRoot")||"Jupyter Server Root",y,a,F.contents);w.init();const _=await a.load(p.favorites);if(n){const e=new A(w,n);n.layout.insertWidget(0,e);const t=n.node.querySelector(".jp-FileBrowser-crumbs");if(t){const e=()=>{if(!t.isConnected)return;n.model.pathChanged.disconnect(e);const a=l.ReactWidget.create(v().createElement(l.UseSignal,{signal:n.model.pathChanged,initialSender:n.model},e=>v().createElement(W,{currentPath:(null==e?void 0:e.path)||"",manager:w,handleClick:e=>{if(w.hasFavorite(e))w.removeFavorite(e);else{const t={root:w.serverRoot,contentType:"directory",iconLabel:l.folderIcon.name,path:e};w.addFavorite(t)}}})));a.addClass("jp-Favorites-pinner"),c.Widget.attach(a,t),t.insertAdjacentElement("beforebegin",a.node),t.classList.add("jp-Favorites-crumbs")};n.model.pathChanged.connect(e),e()}}const x=()=>{const e=S.currentWidget;return e?Array.from(e.selectedItems()):[]},{tracker:S}=t;null==d||d.addFactory("Cell","cellFavoriteToggle",e=>{const t=e.model,a=t.getMetadata("tags"),o=Array.isArray(a)&&a.includes(b),i=new l.ToolbarButton({tooltip:o?"Unfavorite cell":"Favorite cell",icon:I(o),onClick:()=>R(t)});return t.metadataChanged.connect(()=>{!function(e,t){const a=t.model.getMetadata("tags"),o=Array.isArray(a)&&a.includes(b);o?t.addClass(C):t.removeClass(C);const i=o?"Unfavorite cell":"Favorite cell",s=e.node.querySelector("jp-button");s&&(s.setAttribute("aria-label",i),s.setAttribute("title",i)),e.node.setAttribute("title",i);const n=I(o),r=e.node.querySelector("svg");r?r.outerHTML=n.svgstr:e.node.innerHTML=n.svgstr}(i,e)}),i}),y.addCommand(m.addOrRemoveFavorite,{execute:()=>{var e;const t=x();if(t.length>0){const a=t[0];if(w.hasFavorite(a.path))w.removeFavorite(a.path);else{const t=f.getFileTypeForModel(a);w.addFavorite({root:w.serverRoot,path:a.path,contentType:t.contentType,iconLabel:null===(e=t.icon)||void 0===e?void 0:e.name})}}},isVisible:()=>1===x().length,icon:()=>{const e=x()[0];return I(!w.hasFavorite(e.path))},label:()=>{const e=x()[0];return j(w.hasFavorite(e.path))}}),y.addCommand(m.removeFavorite,{execute:()=>{const t=e.contextMenuHitTest(e=>e.classList.contains("jp-Favorites-item")).dataset.path;w.removeFavorite(t)},icon:g,label:"Remove Favorite"}),y.addCommand(m.toggleCellFavorite,{execute:()=>{const e=i.currentWidget;if(!e||!e.content)return;const t=e.content.activeCell;t?R(t.model):console.warn("No active cell found to toggle favorite")}});const E=e=>{e&&e.content&&(L(_.get(U).composite,e),e.content.cellInViewportChanged.connect((e,t)=>{k(t)}),e.disposed.connect(()=>{e.content.cellInViewportChanged.disconnect((e,t)=>{k(t)})}))};if(i.forEach(e=>{E(e)}),i.widgetAdded.connect((e,t)=>{E(t)}),i.currentChanged.connect((e,t)=>{L(_.get(U).composite,t)}),_.changed.connect(()=>{L(_.get(U).composite,i.currentWidget)}),y.addCommand(m.toggleCellsVisibility,{isToggled:()=>{const e=i.currentWidget;return!(!e||!e.content)&&e.content.node.classList.contains(q)},label:"Show Only Favorite Cells",execute:()=>{const e=i.currentWidget;if(!e||!e.content)return;const t=e.content;t.node.classList.contains(q)?t.node.classList.remove(q):t.node.classList.add(q),function(e){e.widgets.forEach(e=>{const t=e,a=t.model.getMetadata("tags");Array.isArray(a)&&a.includes(b)?t.node.classList.add(C):t.node.classList.remove(C)})}(t)},isEnabled:()=>{const t=e.shell.currentWidget,a=i.currentWidget;return!(null===a||a!==t)}}),y.addCommand(m.renameFavorite,{execute:async t=>{var a;let{path:o,displayName:i}=t;if(o||(o=e.contextMenuHitTest(e=>e.classList.contains("jp-Favorites-item")).dataset.path),o){if(!i){const e=await N.InputDialog.getText({title:"Rename favorite",label:`Name for favorite at '${o}'`,okLabel:"Rename",placeholder:"Display name"});i=e.button.accept&&null!==(a=e.value)&&void 0!==a?a:""}i&&w.renameFavorite(o,i)}},label:"Rename Favorite"}),y.addCommand(m.openFavorite,{execute:async e=>{const t=e.favorite,a=""===t.path?"/":t.path;await y.execute("filebrowser:open-path",{path:a})},label:e=>{const t=e.favorite;return M(t.root,t.path)}}),y.addCommand(m.toggleFavoritesWidget,{execute:async e=>{const t=e.showWidget;w.saveSettings({showWidget:!t})},label:e=>(e.showWidget?"Hide":"Show")+" Favorites Widget",isVisible:()=>w.visibleFavorites().length>0}),y.addCommand(m.restoreDefaults,{execute:()=>w.restoreDefaults(),label:"Restore Defaults"}),y.addCommand(m.clearFavorites,{execute:()=>w.clearFavorites(),label:"Clear Favorites"}),null==h||h.addItem({command:m.toggleCellsVisibility,category:u.__("Notebook Operations")}),r){r.fileMenu.addGroup([{type:"submenu",submenu:w.favoritesMenu}],1);try{const e=r.fileMenu._ranks;let t=0,a=-1;for(let o=0;o<e.length;o++)1===e[o].rank&&(t+=1,a<0&&(a=o));if(2===t){const t=e[a];t.size=t.size+1,e.splice(a+1,1);const o=r.fileMenu.menu,i=o._items;let s=!1;for(let e=i.length-1;e>0;e--){const t=i[e];if("filebrowser:open-path"===t.command)break;s&&"separator"===t.type?o.removeItemAt(e):"submenu"===t.type&&"Favorites"===t.submenu.title.label&&(s=!0)}}}catch(e){console.log(e)}}return w}},G={id:f.notebookFactory,description:"Provides notebook cell factory with star icons",provides:s.NotebookPanel.IContentFactory,requires:[P.IEditorServices],autoStart:!0,activate:async(e,t)=>{var o,i;let n;if(e.hasPlugin("jupyterlab-myst:content-factory")){const t=(await a.e(66).then(a.t.bind(a,66,23))).default.filter(e=>e.provides===s.NotebookPanel.IContentFactory)[0];if(t){const a=await Promise.all([...(null!==(o=t.requires)&&void 0!==o?o:[]).map(t=>e.resolveRequiredService(t)),...(null!==(i=t.optional)&&void 0!==i?i:[]).map(t=>e.resolveOptionalService(t))]);n=await t.activate(e,...a)}else console.error("jupyterlab-favorites found jupyterlab-myst:content-factory plugin, but could not activate content factory for compatibility fix")}const r=t.factoryService.newInlineEditor;return new H({editorFactory:r,app:e,mystFactory:n})}},Y=[J,G]}}]);