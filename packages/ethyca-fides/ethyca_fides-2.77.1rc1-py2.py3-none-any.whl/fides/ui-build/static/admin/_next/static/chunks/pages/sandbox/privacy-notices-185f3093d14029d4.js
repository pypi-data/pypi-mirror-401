(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7093],{16207:function(e,t,l){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sandbox/privacy-notices",function(){return l(52640)}])},58754:function(e,t,l){"use strict";var n=l(24246),a=l(49617),r=l(70788);t.Z=e=>{let{heading:t,breadcrumbItems:l,isSticky:i=!0,children:s,rightContent:c,style:o,...d}=e;return(0,n.jsxs)("div",{...d,style:i?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...o}:{paddingBottom:"24px",...o},children:[(0,n.jsxs)(a.jqI,{justify:"space-between",children:["string"==typeof t?(0,n.jsx)(a.lQT,{className:l||s?"pb-4":void 0,level:1,"data-testid":"page-heading",children:t}):t,c&&(0,n.jsx)("div",{"data-testid":"page-header-right-content",children:c})]}),!!l&&(0,n.jsx)(r.m,{className:s?"pb-4":void 0,items:l,"data-testid":"page-breadcrumb"}),s]})}},70788:function(e,t,l){"use strict";l.d(t,{m:function(){return o}});var n=l(24246),a=l(49617),r=l(79894),i=l.n(r),s=l(27378);let{Text:c}=a.AntTypography,o=e=>{let{items:t,...l}=e,r=(0,s.useMemo)(()=>null==t?void 0:t.map((e,l)=>{let r=l===t.length-1,s={...e},o=s.onClick&&!s.href;return("string"==typeof s.title&&(s.title=(0,n.jsx)(c,{style:{color:"inherit",maxWidth:r?void 0:400},ellipsis:!r,id:r?"breadcrumb-current-page":void 0,children:s.title})),o)?s.title=(0,n.jsx)(a.wpx,{type:"text",size:"small",icon:s.icon,onClick:s.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:s.title}):(s.icon&&(s.title=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"anticon align-text-bottom",children:s.icon}),s.title]})),s.href&&s.title&&(s.title=(0,n.jsx)(i(),{href:s.href,className:"ant-breadcrumb-link",children:s.title}),delete s.href)),s}),[t]);return(0,n.jsx)(a.zrq,{items:r,...l})}},52640:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return S}});var n,a,r=l(24246),i=l(49617),s=l(58754),c=l(27378),o=l(812),d=l(18850),p=l(64705),h=l(3124),y=l.n(h),u=e=>{let{title:t,height:l="400px",header:n,headerColor:a,body:s,emptyMessage:c,children:o}=e;return(0,r.jsxs)("div",{children:[(0,r.jsx)(i.AntTypography.Text,{strong:!0,className:"mb-4 block",children:t}),(0,r.jsx)(i.V4A,{className:"bg-gray-50 font-mono text-xs",styles:{body:{padding:"18px"}},children:(0,r.jsxs)("div",{className:"overflow-auto",style:{height:l},children:[n&&(0,r.jsx)(i.AntTypography.Text,{strong:!0,size:"sm",className:"mb-2 block",style:{color:a},children:n}),o||(null!=s?(0,r.jsx)("pre",{className:"m-0 whitespace-pre-wrap",children:JSON.stringify(s,null,2)}):c?(0,r.jsx)(i.jqI,{vertical:!0,align:"center",justify:"center",className:"h-full",children:(0,r.jsx)(i.AntTypography.Text,{type:"secondary",children:c})}):null)]})})]})};let x=e=>{let{privacyNotices:t}=e;return 0===t.length?null:(0,r.jsx)("div",{className:"max-h-60 overflow-y-auto",children:(0,r.jsx)("ul",{className:"m-0 list-inside list-disc pl-2",children:t.map(e=>(0,r.jsx)("li",{className:"list-none",children:(0,r.jsxs)("ul",{className:"m-0 list-inside list-disc",children:[(0,r.jsx)("li",{className:"py-1",children:e.name}),e.children&&e.children.length>0&&e.children.map(e=>(0,r.jsx)("li",{className:"py-1 pl-5",children:e.name},e.id))]})},e.id))})})};var g=e=>{let{region:t,onRegionChange:l,propertyId:n,onPropertyIdChange:a,onFetchExperience:s,isLoading:c,errorMessage:o,privacyNotices:d}=e;return(0,r.jsxs)(i.jqI,{vertical:!0,gap:"small",children:[(0,r.jsx)(i.AntTypography.Title,{level:3,children:"Configuration"}),(0,r.jsxs)(i.jqI,{gap:"large",children:[(0,r.jsxs)(i.jqI,{vertical:!0,flex:1,style:{minWidth:0},children:[(0,r.jsx)(i.AntTypography.Text,{strong:!0,className:"mb-2 block",children:"Experience region"}),(0,r.jsxs)(i.jqI,{gap:"small",className:"mb-4",children:[(0,r.jsx)(i.uFc,{placeholder:"Enter region (e.g., us_ca)",value:t,onChange:e=>l(e.target.value),className:"w-64"}),(0,r.jsx)(i.wpx,{type:"primary",onClick:s,loading:c,disabled:!t,children:"Fetch experience"})]}),(0,r.jsx)(i.AntTypography.Text,{strong:!0,className:"mb-2 block",children:"Property ID (optional)"}),(0,r.jsx)(i.AntTypography.Text,{type:"secondary",className:"mb-2 block",children:"Leave empty to retrieve experience with no property"}),(0,r.jsx)(i.jqI,{gap:"small",className:"mb-4",children:(0,r.jsx)(i.uFc,{placeholder:"Property ID (e.g. FDS-1234)",value:n,onChange:e=>a(e.target.value),className:"w-64"})}),o&&(0,r.jsx)(i.AntTypography.Text,{type:"danger",className:"mb-4 block",children:o})]}),(0,r.jsx)(i.jqI,{vertical:!0,flex:1,children:(0,r.jsx)(u,{title:"Available notices",height:"200px",headerColor:y().FIDESUI_MINOS,emptyMessage:"Available notices will appear here after fetching experience",children:d.length>0?(0,r.jsx)(x,{privacyNotices:d}):null})})]})]})},m=e=>{let{email:t,onEmailChange:l,selectedNoticeKeys:n,onSelectedNoticeKeysChange:a,parentNoticeKeys:s,onFetchCurrentPreferences:c,isLoading:o,isError:d,error:p,getCurrentResponse:h}=e;return(0,r.jsxs)(i.jqI,{gap:"large",children:[(0,r.jsx)(i.jqI,{vertical:!0,flex:1,children:(0,r.jsxs)(i.jqI,{vertical:!0,className:"pr-24",children:[(0,r.jsx)(i.AntTypography.Text,{strong:!0,className:"mb-2 block",children:"User email (identity)"}),(0,r.jsx)(i.uFc,{placeholder:"Enter email address",value:t,onChange:e=>l(e.target.value),className:"mb-4"}),(0,r.jsx)(i.AntTypography.Text,{strong:!0,className:"mb-2 block",children:"Notice keys"}),(0,r.jsx)(i.WPr,{mode:"multiple",placeholder:"All notices",value:n,onChange:a,options:s,className:"mb-4 w-full",allowClear:!0,"aria-label":"Notice keys"}),(0,r.jsx)(i.wpx,{type:"primary",onClick:c,loading:o,disabled:!t,className:"mb-4 self-start",children:"Fetch current preferences"}),d&&(0,r.jsxs)(i.AntTypography.Text,{type:"danger",className:"mb-4 block",children:["Error fetching current preferences: ",p||"Unknown error"]})]})}),(0,r.jsx)(i.jqI,{vertical:!0,flex:1,className:"min-w-0",children:(0,r.jsx)(u,{title:"GET response",header:h?"GET /api/v3/privacy-preferences/current?identity.email=".concat(t).concat(n.length>0?"&notice_keys=".concat(n.join(","),"&include_descendants=true"):""):null,headerColor:y().FIDESUI_SUCCESS,body:h,emptyMessage:"GET response will appear here after fetching preferences"})})]})};let j=e=>{let t=[],l=e=>e.map(e=>{var n,a;let r=(null===(a=e.translations)||void 0===a?void 0:null===(n=a[0])||void 0===n?void 0:n.privacy_notice_history_id)||e.id,i={title:e.name,key:e.notice_key,noticeHistoryId:r,noticeKey:e.notice_key};return t.push(i.key),e.children&&e.children.length>0&&(i.children=l(e.children)),i});return{treeData:l(e),allKeys:t}};var v=e=>{let{privacyNotices:t,checkedKeys:l,onCheckedKeysChange:n,onExplicitChange:a}=e,{treeData:s,allKeys:o}=(0,c.useMemo)(()=>j(t),[t]),[d,p]=(0,c.useState)(o),[h,y]=(0,c.useState)(!0);(0,c.useEffect)(()=>{p(o)},[o]);let u=(0,c.useCallback)(e=>{p(e),y(!1)},[]),x=(0,c.useCallback)(e=>{let t=Array.isArray(e)?e:e.checked,r=t.filter(e=>!l.includes(e)),i=l.filter(e=>!t.includes(e)),s=r.length>0?r[0]:i[0];void 0!==s&&a&&a(s),n(t)},[l,n,a]);return(0,r.jsx)("div",{className:"max-w-lg",children:(0,r.jsx)(i.a$q,{checkable:!0,checkStrictly:!0,onExpand:u,expandedKeys:d,autoExpandParent:h,onCheck:x,checkedKeys:l,selectable:!1,treeData:s})})};(n=a||(a={})).SYSTEM_ENFORCED="system_enforced",n.CASCADE_DOWN="cascade_down",n.CASCADE_UP="cascade_up",n.CASCADE_UP_AND_DOWN="cascade_up_and_down",n.PREFER_OPT_IN="prefer_opt_in";var f=e=>{let{value:t,onChange:l}=e,n=[{value:a.SYSTEM_ENFORCED,label:"System enforced"},{value:a.CASCADE_DOWN,label:"Cascade down"},{value:a.CASCADE_UP,label:"Cascade up"},{value:a.CASCADE_UP_AND_DOWN,label:"Cascade up and down"},{value:a.PREFER_OPT_IN,label:"Prefer opt in"}];return(0,r.jsxs)(i.jqI,{align:"center",gap:3,className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"policy-select",id:"policy-select-label",children:(0,r.jsx)(i.AntTypography.Text,{strong:!0,style:{whiteSpace:"nowrap"},children:"Propagation policy:"})}),(0,r.jsx)(i.WPr,{id:"policy-select",value:null!=t?t:void 0,onChange:e=>{l(void 0===e?null:e)},style:{width:200},placeholder:"System enforced",allowClear:!0,options:n,"aria-labelledby":"policy-select-label"})]})},_=e=>{let{policy:t,onPolicyChange:l,privacyNotices:n,preferenceState:a,noticeMappings:s,experienceConfigHistoryId:h,email:x,hasCurrentResponse:g,explicitlyChangedKeys:m,onExplicitlyChangedKeysChange:j}=e,{checkedKeys:_,fetchedCheckedKeys:N,onCheckedKeysChange:b,onFetchedKeysChange:C}=a,{noticeKeyToHistoryMap:S}=s,[T,k]=(0,c.useState)(null),[E,{isLoading:A,isError:w,error:I}]=(0,d.ZR)(),P=(0,c.useCallback)(()=>({fetchedSet:new Set(N.map(e=>e.toString())),currentSet:new Set(_.map(e=>e.toString()))}),[N,_]),D=(0,c.useMemo)(()=>{let{fetchedSet:e,currentSet:t}=P();return Array.from(S.keys()).some(l=>e.has(l)!==t.has(l))},[P,S]),O=(0,c.useCallback)(async()=>{let{fetchedSet:e,currentSet:l}=P(),n=Array.from(S.keys()).filter(t=>e.has(t)!==l.has(t));if(0===n.length)return;let a=m.filter(e=>n.includes(String(e))).map(e=>{let t=String(e),n=S.get(t)||"",a=l.has(t);return{notice_key:t,notice_history_id:n,value:a?p.p.OPT_IN:p.p.OPT_OUT,collected_at:new Date().toISOString(),meta:{fides:{experience_config_history_id:h}}}});try{let e=await E({body:{identity:{email:{value:x}},preferences:a},policy:t}).unwrap();k(e);let l=e.preferences.filter(e=>e.value===p.p.OPT_IN).map(e=>e.notice_key);b(l),C(l),j([])}catch(e){}},[P,S,t,h,x,E,b,C,m,j]);return(0,r.jsxs)(i.jqI,{gap:"large",children:[(0,r.jsxs)(i.jqI,{vertical:!0,flex:1,children:[(0,r.jsx)(i.AntTypography.Title,{level:4,style:{fontSize:14,marginBottom:8},children:"Current preferences"}),g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f,{value:t,onChange:l}),(0,r.jsx)(v,{privacyNotices:n,checkedKeys:_,onCheckedKeysChange:b,onExplicitChange:e=>{j([...m.filter(t=>t!==e),e])}}),(0,r.jsx)(i.wpx,{type:"primary",onClick:O,loading:A,disabled:!D,className:"mt-4 self-start",children:"Save preferences"}),w&&I&&(0,r.jsxs)(i.AntTypography.Text,{type:"danger",className:"mt-2 block",children:["Error saving preferences: ",(0,o.e$)(I)]})]}):(0,r.jsx)(i.jqI,{vertical:!0,align:"center",justify:"center",flex:1,children:(0,r.jsx)(i.oj8,{description:"Fetch current preferences to manage user consent"})})]}),(0,r.jsx)(i.jqI,{vertical:!0,flex:1,className:"min-w-0",children:(0,r.jsx)(u,{title:"POST response",header:T?"POST /api/v3/privacy-preferences".concat(t?"?policy=".concat(t):""):null,headerColor:y().FIDESUI_ALERT,body:T,emptyMessage:"POST response will appear here after saving preferences"})})]})};let N={REGION:"us_ca",SHOW_DISABLED:!1};var b=()=>{let[e,t]=(0,c.useState)(N.REGION),[l,n]=(0,c.useState)(""),[a,s]=(0,c.useState)(""),[h,y]=(0,c.useState)(null),[u,x]=(0,c.useState)([]),[j,v]=(0,c.useState)([]),[f,b]=(0,c.useState)([]),[C,S]=(0,c.useState)([]),[T,k]=(0,c.useState)([]),[E,A]=(0,c.useState)(null),[w,I]=(0,c.useState)(null),[P,D]=(0,c.useState)(""),[O,{isLoading:F}]=(0,d.nU)(),[q,{isLoading:L,isError:M,error:R}]=(0,d.Lg)(),{noticeKeyToHistoryMap:U,parentNoticeKeys:K}=(0,c.useMemo)(()=>{let e=new Map,t=[],l=(n,a)=>{n.forEach(n=>{var r,i,s;let c=(null===(i=n.translations)||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:r.privacy_notice_history_id)||n.id;e.set(n.notice_key,c),a||t.push({label:n.name,value:n.notice_key}),(null===(s=n.children)||void 0===s?void 0:s.length)&&l(n.children,n.notice_key)})};return l(T),{noticeKeyToHistoryMap:e,parentNoticeKeys:t}},[T]),W=(0,c.useCallback)(async()=>{if(D(""),!e){D("Please enter a region");return}try{let r=await O({region:e,show_disabled:N.SHOW_DISABLED,...l&&{property_id:l}}).unwrap();if(r.items&&r.items.length>0){let e=r.items[0];if("privacy_notices"in e&&e.privacy_notices&&e.privacy_notices.length>0){var t,n,a;k(e.privacy_notices);let l=(null===(a=e.experience_config)||void 0===a?void 0:null===(n=a.translations)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.privacy_experience_config_history_id)||null;A(l),x([]),v([]),S([])}}}catch(e){D("Failed to fetch privacy experience")}},[O,e,l]),B=(0,c.useCallback)(async()=>{try{let e={"identity.email":a};C.length>0&&(e.notice_keys=C);let t=await q(e).unwrap();I(t);let l=t.filter(e=>e.value===p.p.OPT_IN).map(e=>e.notice_key);x(l),v(l),b([])}catch(e){}},[a,C,q]);return(0,r.jsxs)("div",{className:"mt-5 space-y-8",children:[(0,r.jsx)(i.DUx,{type:"info",message:"This page makes real API calls to the Consent V3 API.",description:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.AntTypography.Paragraph,{className:"mb-0 mt-3",children:"Before using this sandbox, ensure you have:"}),(0,r.jsxs)("ul",{className:"mb-0 ml-6 mt-2 space-y-1",children:[(0,r.jsxs)("li",{children:["The consent v3 API enabled via the env var"," ",(0,r.jsx)(i.AntTypography.Text,{code:!0,children:"FIDESPLUS__EXPERIMENTAL__CONSENT_V3_ENABLED=true"})]}),(0,r.jsx)("li",{children:"An email identity definition configured in your system"}),(0,r.jsx)("li",{children:"A privacy experience set up with at least one privacy notice in the selected region"})]})]}),showIcon:!0}),(0,r.jsx)(g,{region:e,onRegionChange:t,propertyId:l,onPropertyIdChange:n,onFetchExperience:W,isLoading:F,errorMessage:P,privacyNotices:T}),(0,r.jsx)(i.htM,{}),(0,r.jsxs)(i.jqI,{vertical:!0,gap:"small",children:[(0,r.jsx)(i.AntTypography.Title,{level:3,children:"User preferences"}),0===T.length&&(0,r.jsx)(i.oj8,{description:"Load an experience in order to manage user preferences"}),T.length>0&&(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(m,{email:a,onEmailChange:s,selectedNoticeKeys:C,onSelectedNoticeKeysChange:S,parentNoticeKeys:K,onFetchCurrentPreferences:B,isLoading:L,isError:M,error:R?(0,o.e$)(R):null,getCurrentResponse:w}),(0,r.jsx)(_,{policy:h,onPolicyChange:y,privacyNotices:T,preferenceState:{checkedKeys:u,fetchedCheckedKeys:j,onCheckedKeysChange:x,onFetchedKeysChange:v},noticeMappings:{noticeKeyToHistoryMap:U},experienceConfigHistoryId:E,email:a,hasCurrentResponse:null!==w,explicitlyChangedKeys:f,onExplicitlyChangedKeysChange:b})]})]})]})};let{Content:C}=i.AntLayout;var S=()=>(0,r.jsx)(i.AntLayout,{children:(0,r.jsxs)(C,{className:"overflow-auto px-10 py-6",children:[(0,r.jsx)(s.Z,{heading:"Privacy Notices Sandbox"}),(0,r.jsx)(b,{})]})})}},function(e){e.O(0,[2888,9774,179],function(){return e(e.s=16207)}),_N_E=e.O()}]);