(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[845],{56141:function(e,t,i){var s=i(32866);e.exports=function(e,t){return s(e,t)}},13910:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/settings/custom-fields/[id]",function(){return i(63730)}])},34435:function(e,t,i){"use strict";var s=i(24246),l=i(41725),n=i(86677),r=i(812),a=i(77830),o=i(19904),d=i(8917),u=i(67522),c=i(66006),p=i(66236),m=i(32885),x=i(60240),h=i(31883);let y=()=>(0,s.jsxs)(l.OdW,{active:!0,children:[(0,s.jsx)(l.OdW.Input,{}),(0,s.jsx)(l.OdW.Input,{}),(0,s.jsx)(l.OdW.Input,{}),(0,s.jsx)(l.OdW.Input,{}),(0,s.jsx)(l.OdW.Button,{})]}),v=e=>d.uP.has(e)?d.uP.get(e):e.startsWith("taxonomy:")||e.startsWith("system:")?e:"taxonomy:".concat(e);t.Z=e=>{var t;let{initialField:i,isLoading:_}=e,[f]=l.l09.useForm(),j=l.l09.useWatch("value_type",f),E=l.l09.useWatch("name",f),g=(0,n.useRouter)(),{resource_type:P}=g.query,T=(0,l.UD8)(),b=(0,l.ddY)(),{createOrUpdate:I}=(0,u.Z)(),{data:C,isLoading:L}=(0,m.vA)(null==i?void 0:i.allow_list_id,{skip:!(null==i?void 0:i.allow_list_id)}),[k,{isLoading:S}]=(0,m.UF)(),{data:w,isLoading:N}=(0,m.Az)(),{valueTypeOptions:O}=(0,c.Z)(),U=(0,o.Tg)([x.Sh.CUSTOM_FIELD_DELETE])&&!!i,W=async()=>{if(!i)return;let{id:e,resource_type:t,field_type:s}=i,l=await k({id:e,resource_type:t,field_type:s});if((0,h.D4)(l)){T.error((0,r.e$)(l.error));return}T.success("Custom field deleted successfully"),g.push(a.WC)},F=async e=>{let t=await I(e,i,C);if(!t){T.error("An unexpected error occurred");return}if((0,h.D4)(t)){T.error((0,r.e$)(t.error));return}T.success("Custom field ".concat(i?"updated":"created"," successfully")),g.push(a.WC)},A=(e=>{var t;if(e)return{...e,value_type:e.field_type,field_type:(0,p._)(e),resource_type:v(e.resource_type),options:null!==(t=null==C?void 0:C.allowed_values)&&void 0!==t?t:[]}})(i),q=P?{...A,resource_type:"taxonomy:".concat(P)}:A;if(_||L||N)return(0,s.jsx)(y,{});let D=O.some(e=>e.value===j);return(0,s.jsxs)(l.l09,{form:f,layout:"vertical",initialValues:q||{},validateTrigger:["onBlur","onChange"],onFinish:F,children:[(0,s.jsx)(l.l09.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Please enter a name"}],children:(0,s.jsx)(l.QcG,{options:O,onSelect:(e,t)=>{f.setFieldsValue({name:t.label,value_type:t.value})},disabled:D,"data-testid":"input-name-autocomplete",children:(0,s.jsx)(l.IIB,{"data-testid":"input-name",suffix:D?(0,s.jsx)(l.zxk,{size:"small",type:"text",icon:(0,s.jsx)(l.PJP.x8P,{}),onClick:()=>{f.setFieldsValue({name:void 0,value_type:void 0})}}):void 0})})}),(0,s.jsx)(l.l09.Item,{label:"Type",name:"value_type",hidden:!0,children:(0,s.jsx)(l.PhF,{options:O,getPopupContainer:e=>e.parentElement||document.body,"data-testid":"select-value-type"})}),!!E&&!D&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.l09.Item,{label:"Description",name:"description",children:(0,s.jsx)(l.IIB.TextArea,{rows:2,"data-testid":"input-description"})}),(0,s.jsx)(l.l09.Item,{label:"Field type",name:"field_type",rules:[{required:!0,message:"Please select a field type"}],children:(0,s.jsx)(l.PhF,{options:d.TY,getPopupContainer:e=>e.parentElement||document.body,"data-testid":"select-field-type"})}),(0,s.jsx)(l.l09.Item,{noStyle:!0,shouldUpdate:(e,t)=>e.field_type!==t.field_type,children:e=>{let{getFieldValue:t}=e,i=t("field_type");return(i===d.Uv.SINGLE_SELECT||i===d.Uv.MULTIPLE_SELECT)&&(0,s.jsx)(l.l09.List,{name:"options",rules:[{validator:async(e,t)=>!t||t.length<1?Promise.reject(Error("At least one option is required for selects")):Promise.resolve()}],children:(e,i,n)=>{let{add:r,remove:a}=i,{errors:o}=n;return(0,s.jsxs)(s.Fragment,{children:[e.map((i,n)=>(0,s.jsx)(l.l09.Item,{required:!1,label:0===n?"Options":"","data-testid":"options-form-item",children:(0,s.jsxs)(l.kCb,{gap:"middle",children:[(0,s.jsx)(l.l09.Item,{...i,validateTrigger:["onChange","onBlur"],rules:[{required:!0,whitespace:!0,message:"Options cannot be empty"},()=>({validator:(e,i)=>t("options").filter(e=>e===i).length>1?Promise.reject(Error("Option values must be unique")):Promise.resolve()})],noStyle:!0,children:(0,s.jsx)(l.IIB,{placeholder:"Enter option value","data-testid":"input-option-".concat(n)})}),e.length>1&&(0,s.jsx)(l.zxk,{icon:(0,s.jsx)(l.PJP.ZNm,{}),onClick:()=>a(i.name),"aria-label":"Remove option"})]})},i.key)),(0,s.jsx)(l.l09.Item,{children:(0,s.jsx)(l.zxk,{type:"dashed",onClick:()=>r(),icon:(0,s.jsx)(l.PJP.mm_,{}),"data-testid":"add-option-btn",children:"Add select option"})}),(0,s.jsx)(l.l09.ErrorList,{errors:o,className:"-mt-4 mb-4"})]})}})}})]}),(0,s.jsx)(l.l09.Item,{label:"Applies to",name:"resource_type",rules:[{required:!0,message:"Please select a location"}],tooltip:"Choose where this field applies, including taxonomies",children:(0,s.jsx)(l.PhF,{options:null!==(t=null==w?void 0:w.map(e=>({label:e,value:e})))&&void 0!==t?t:[],getPopupContainer:e=>e.parentElement||document.body,disabled:!!i,"data-testid":"select-resource-type"})}),(0,s.jsxs)(l.kCb,{justify:"space-between",children:[U&&(0,s.jsx)(l.zxk,{danger:!0,onClick:()=>{var e;b.confirm({title:"Delete custom field?",content:(0,s.jsxs)(l.Typography.Paragraph,{children:["Are you sure you want to delete"," ",(0,s.jsx)("strong",{children:null!==(e=null==i?void 0:i.name)&&void 0!==e?e:"this custom field"}),"? This action cannot be undone."]}),onOk:W,okType:"primary",okText:"Delete",centered:!0})},loading:S,"data-testid":"delete-btn",children:"Delete"}),(0,s.jsx)(l.zxk,{type:"primary",htmlType:"submit","data-testid":"save-btn",children:"Save"})]})]})}},66236:function(e,t,i){"use strict";i.d(t,{S:function(){return r},_:function(){return n}});var s=i(20987),l=i(8917);let n=e=>e.field_type===s.H.STRING_ARRAY?l.Uv.MULTIPLE_SELECT:e.allow_list_id?l.Uv.SINGLE_SELECT:e.field_type===s.H.STRING?l.Uv.OPEN_TEXT:e.field_type,r=e=>{let t=n(e);return t===l.Uv.OPEN_TEXT||t===l.Uv.SINGLE_SELECT||t===l.Uv.MULTIPLE_SELECT?l.P3[t]:t}},63730:function(e,t,i){"use strict";i.r(t);var s=i(24246),l=i(86677),n=i(77213),r=i(77830),a=i(58754),o=i(34435),d=i(32885);t.default=()=>{var e;let{id:t}=(0,l.useRouter)().query,{data:i,isLoading:u}=(0,d.s0)({id:t});return(0,s.jsxs)(n.Z,{title:"Edit custom field",mainProps:{maxWidth:"720px"},children:[(0,s.jsx)(a.Z,{heading:"Custom fields",breadcrumbItems:[{title:"All custom fields",href:r.WC},{title:null!==(e=null==i?void 0:i.name)&&void 0!==e?e:t}]}),(0,s.jsx)(o.Z,{initialField:i,isLoading:u})]})}}},function(e){e.O(0,[590,2888,9774,179],function(){return e(e.s=13910)}),_N_E=e.O()}]);