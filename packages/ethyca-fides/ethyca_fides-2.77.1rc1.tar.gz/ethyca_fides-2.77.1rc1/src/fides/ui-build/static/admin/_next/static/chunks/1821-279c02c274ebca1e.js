"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1821],{95492:function(e,s,n){n.d(s,{l:function(){return i}});var t=n(24246);let i=(0,n(49617).IUT)({displayName:"TrashCanSolidIcon",viewBox:"0 0 12 15",path:(0,t.jsx)("path",{d:"M8.37857 1.18083C8.23393 0.892838 7.93661 0.710938 7.6125 0.710938H4.3875C4.06339 0.710938 3.76607 0.892838 3.62143 1.18083L3.42857 1.56094H0.857143C0.383036 1.56094 -1.19209e-07 1.94158 -1.19209e-07 2.41094C-1.19209e-07 2.8803 0.383036 3.26094 0.857143 3.26094H11.1429C11.6162 3.26094 12 2.8803 12 2.41094C12 1.94158 11.6162 1.56094 11.1429 1.56094H8.57143L8.37857 1.18083ZM11.167 4.11094H0.857143V12.6109C0.857143 13.5486 1.62589 14.3109 2.57143 14.3109H9.45268C10.3754 14.3109 11.167 13.5486 11.167 12.6109V4.11094ZM9.02411 6.23594V12.1859C9.02411 12.4197 8.80714 12.6109 8.59554 12.6109C8.33571 12.6109 8.16696 12.4197 8.16696 12.1859V6.23594C8.16696 6.00219 8.33571 5.81094 8.59554 5.81094C8.80714 5.81094 9.02411 6.00219 9.02411 6.23594ZM6.45268 6.23594V12.1859C6.45268 12.4197 6.23571 12.6109 6.02411 12.6109C5.76429 12.6109 5.57143 12.4197 5.57143 12.1859V6.23594C5.57143 6.00219 5.76429 5.81094 6.02411 5.81094C6.23571 5.81094 6.45268 6.00219 6.45268 6.23594ZM3.85714 6.23594V12.1859C3.85714 12.4197 3.66429 12.6109 3.42857 12.6109C3.19286 12.6109 3 12.4197 3 12.1859V6.23594C3 6.00219 3.19286 5.81094 3.42857 5.81094C3.66429 5.81094 3.85714 6.00219 3.85714 6.23594Z",fill:"currentColor"})})},77213:function(e,s,n){n.d(s,{Z:function(){return p}});var t=n(24246),i=n(49617),a=n(88038),r=n.n(a),l=n(86677);n(27378);var o=n(25980),d=n(90867),c=n(42478),u=n(77830),m=()=>{let e=(0,l.useRouter)();return(0,t.jsx)(i.xuv,{bg:"gray.50",border:"1px solid",borderColor:"blue.400",borderRadius:"md",justifyContent:"space-between",p:5,mb:5,mt:5,children:(0,t.jsxs)(i.xuv,{children:[(0,t.jsxs)(i.Kqy,{direction:{base:"column",sm:"row"},justifyContent:"space-between",children:[(0,t.jsx)(i.xvT,{fontWeight:"semibold",children:"Configure your storage and messaging provider"}),(0,t.jsx)(i.wpx,{onClick:()=>{e.push(u.AD)},children:"Configure"})]}),(0,t.jsxs)(i.xvT,{children:["Before Fides can process your privacy requests we need two simple steps to configure your storage and email client."," "]})]})})},p=e=>{let{children:s,title:n,padded:a=!0,mainProps:u}=e,p=(0,o.hz)(),h=(0,l.useRouter)(),g="/privacy-requests"===h.pathname||"/datastore-connection"===h.pathname,x=!(p.flags.messagingConfiguration&&g),{data:f}=(0,c.JE)(void 0,{skip:x}),{data:j}=(0,d.PW)(void 0,{skip:x}),w=p.flags.messagingConfiguration&&(!f||!j)&&g;return(0,t.jsxs)(i.kCb,{"data-testid":n,direction:"column",h:"100vh",children:[(0,t.jsxs)(r(),{children:[(0,t.jsxs)("title",{children:["Fides Admin UI - ",n]}),(0,t.jsx)("meta",{name:"description",content:"Privacy Engineering Platform"}),(0,t.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,t.jsxs)(i.kCb,{as:"main",direction:"column",py:a?6:0,px:a?10:0,h:a?"calc(100% - 48px)":"full",flex:1,minWidth:0,overflow:"auto",...u,children:[w?(0,t.jsx)(m,{}):null,s]})]})}},58754:function(e,s,n){var t=n(24246),i=n(49617),a=n(70788);s.Z=e=>{let{heading:s,breadcrumbItems:n,isSticky:r=!0,children:l,rightContent:o,style:d,...c}=e;return(0,t.jsxs)("div",{...c,style:r?{position:"sticky",top:"-24px",paddingTop:"24px",paddingBottom:"24px",paddingLeft:"40px",marginLeft:"-40px",paddingRight:"40px",marginRight:"-40px",marginTop:"-24px",left:0,zIndex:20,backgroundColor:"white",...d}:{paddingBottom:"24px",...d},children:[(0,t.jsxs)(i.jqI,{justify:"space-between",children:["string"==typeof s?(0,t.jsx)(i.lQT,{className:n||l?"pb-4":void 0,level:1,"data-testid":"page-heading",children:s}):s,o&&(0,t.jsx)("div",{"data-testid":"page-header-right-content",children:o})]}),!!n&&(0,t.jsx)(a.m,{className:l?"pb-4":void 0,items:n,"data-testid":"page-breadcrumb"}),l]})}},19904:function(e,s,n){n.d(s,{Tg:function(){return r}});var t=n(24246),i=n(16134),a=n(31793);let r=e=>(0,i.C)(a.uu).filter(s=>e.includes(s)).length>0;s.ZP=e=>{let{scopes:s,children:n}=e;return r(s)?(0,t.jsx)(t.Fragment,{children:n}):null}},70788:function(e,s,n){n.d(s,{m:function(){return d}});var t=n(24246),i=n(49617),a=n(79894),r=n.n(a),l=n(27378);let{Text:o}=i.AntTypography,d=e=>{let{items:s,...n}=e,a=(0,l.useMemo)(()=>null==s?void 0:s.map((e,n)=>{let a=n===s.length-1,l={...e},d=l.onClick&&!l.href;return("string"==typeof l.title&&(l.title=(0,t.jsx)(o,{style:{color:"inherit",maxWidth:a?void 0:400},ellipsis:!a,id:a?"breadcrumb-current-page":void 0,children:l.title})),d)?l.title=(0,t.jsx)(i.wpx,{type:"text",size:"small",icon:l.icon,onClick:l.onClick,className:"ant-breadcrumb-link -mt-px px-1 text-inherit",children:l.title}):(l.icon&&(l.title=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"anticon align-text-bottom",children:l.icon}),l.title]})),l.href&&l.title&&(l.title=(0,t.jsx)(r(),{href:l.href,className:"ant-breadcrumb-link",children:l.title}),delete l.href)),l}),[s]);return(0,t.jsx)(i.zrq,{items:a,...n})}},42478:function(e,s,n){n.d(s,{FU:function(){return d},JE:function(){return i},Ki:function(){return u},SU:function(){return m},W:function(){return p},h9:function(){return a},jc:function(){return t},qt:function(){return o},sn:function(){return c}});let{useGetEmailInviteStatusQuery:t,useGetActiveMessagingProviderQuery:i,useCreateMessagingConfigurationMutation:a,useCreateMessagingConfigurationSecretsMutation:r,useGetMessagingConfigurationDetailsQuery:l,useGetMessagingConfigurationsQuery:o,useGetMessagingConfigurationByKeyQuery:d,useUpdateMessagingConfigurationByKeyMutation:c,useUpdateMessagingConfigurationSecretsByKeyMutation:u,useCreateTestConnectionMessageMutation:m,useDeleteMessagingConfigurationByKeyMutation:p}=n(78780).u.injectEndpoints({endpoints:e=>({getEmailInviteStatus:e.query({query:()=>({url:"/messaging/email-invite/status"}),providesTags:()=>["Email Invite Status"]}),createMessagingConfiguration:e.mutation({query:e=>({url:"messaging/config",method:"POST",body:e}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getActiveMessagingProvider:e.query({queryFn:async(e,s,n,t)=>{let i=await t({url:"messaging/default/active"});return i.error&&404===i.error.status?{data:null}:i},providesTags:["Messaging Config"]}),createMessagingConfigurationSecrets:e.mutation({query:e=>({url:"messaging/default/".concat(e.service_type,"/secret"),method:"PUT",body:e.details}),invalidatesTags:["Messaging Config","Configuration Settings"]}),getMessagingConfigurationDetails:e.query({query:e=>({url:"messaging/default/".concat(e.type)}),providesTags:["Messaging Config"]}),getMessagingConfigurations:e.query({query:()=>({url:"messaging/config"}),providesTags:["Messaging Config"]}),getMessagingConfigurationByKey:e.query({query:e=>({url:"messaging/config/".concat(e.key)}),providesTags:["Messaging Config"]}),createTestConnectionMessage:e.mutation({query:e=>({url:"messaging/test/".concat(e.service_type),method:"POST",body:e.details}),invalidatesTags:["Messaging Config"]}),updateMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"PATCH",body:e.config}),invalidatesTags:["Messaging Config","Configuration Settings"]}),updateMessagingConfigurationSecretsByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key,"/secret"),method:"PUT",body:e.secrets}),invalidatesTags:["Messaging Config","Configuration Settings"]}),deleteMessagingConfigurationByKey:e.mutation({query:e=>({url:"messaging/config/".concat(e.key),method:"DELETE"}),invalidatesTags:["Messaging Config","Configuration Settings"]})})})},61038:function(e,s,n){var t=n(24246),i=n(49617),a=n(34090),r=n(86677);n(27378);var l=n(55484),o=n(16134),d=n(40324),c=n(812),u=n(77830),m=n(46628),p=n(65497);let h={username:"",usernameConfirmation:""},g=e=>{let{id:s,username:n,onClose:t}=e,a=(0,i.pmc)(),d=(0,r.useRouter)(),h=(0,o.T)(),[g]=(0,p.I1)();return{handleDeleteUser:async()=>{let e=await g(s);(0,c.D4)(e)?a((0,m.Vo)((0,c.e$)(e.error))):(a((0,m.t5)("Successfully deleted user")),t()),h((0,p.Vv)(void 0)),d.push(u.e3)},validationSchema:l.Ry().shape({usernameConfirmation:l.Z_().required().oneOf([n],"Confirmation input must match the username").label("Username confirmation")})}};s.Z=e=>{let{user:s,...n}=e,{isOpen:r,onClose:l}=n,{handleDeleteUser:o,validationSchema:c}=g({id:s.id,username:s.username,onClose:l});return(0,t.jsxs)(i.u_l,{isCentered:!0,isOpen:r,onClose:l,children:[(0,t.jsx)(i.ZAr,{}),(0,t.jsx)(i.hzk,{"data-testid":"delete-user-modal",children:(0,t.jsx)(a.J9,{initialValues:h,validationSchema:c,onSubmit:o,children:e=>{let{isSubmitting:n,dirty:r,isValid:o}=e;return(0,t.jsxs)(a.l0,{children:[(0,t.jsx)(i.xBx,{children:"Delete User"}),(0,t.jsx)(i.olH,{}),(0,t.jsxs)(i.fef,{children:[(0,t.jsxs)(i.bZj,{status:"warning",overflow:"visible",colorScheme:"warn",marginBottom:4,children:[(0,t.jsx)(i.zMQ,{}),(0,t.jsxs)(i.XaZ,{children:[(0,t.jsx)(i.xvT,{as:"span",mb:2,children:"You are about to delete the user\xa0"}),(0,t.jsxs)(i.xvT,{as:"span",mb:2,fontStyle:"italic",fontWeight:"semibold",children:[s.username,"."]}),(0,t.jsx)(i.xvT,{mb:2,children:"This action cannot be undone. To confirm, please enter the userâ€™s username below."})]})]}),(0,t.jsx)(i.Kqy,{direction:"column",spacing:4,children:(0,t.jsx)(d.j0,{name:"usernameConfirmation",label:"Confirm username",placeholder:"Type the username to delete"})})]}),(0,t.jsx)(i.mzw,{children:(0,t.jsxs)("div",{className:"flex w-full gap-2",children:[(0,t.jsx)(i.wpx,{onClick:l,className:"w-1/2",children:"Cancel"}),(0,t.jsx)(i.wpx,{type:"primary",disabled:!r||!o,loading:n,htmlType:"submit",className:"w-1/2","data-testid":"submit-btn",children:"Delete User"})]})})]})}})})]})}},83696:function(e,s,n){n.d(s,{Z:function(){return et}});var t=n(24246),i=n(49617),a=n(91437),r=()=>(0,t.jsxs)(i.xuv,{children:[(0,t.jsx)(i.xuv,{pb:4,fontSize:"18px",fontWeight:"semibold",children:"Role Description"}),(0,t.jsx)(i.gCW,{spacing:4,children:a.K.map(e=>(0,t.jsxs)(i.xuv,{width:"100%",padding:4,borderRadius:"md",backgroundColor:"gray.75",fontSize:"14px",children:[(0,t.jsx)(i.xuv,{fontWeight:"semibold",children:e.label}),(0,t.jsx)(i.xuv,{color:"gray.700",children:e.description})]},e.roleKey))})]}),l=n(16134),o=n(60240),d=n(19904),c=n(34090),u=n(86677),m=n(27378),p=n(812),h=n(46238),g=n(58452),x=n(77830),f=n(46628),j=n(26917),w=n(1315),y=n(95492),b=n(65497);let v=e=>{let{assignedSystems:s,onAssignedSystemChange:n}=e,a=(0,l.C)(b.Ux);if((0,b.d6)(a,{skip:!a}),0===s.length)return null;let r=e=>{n(s.filter(s=>s.fides_key!==e.fides_key))};return(0,t.jsxs)(i.iA_,{size:"sm","data-testid":"assign-systems-delete-table",children:[(0,t.jsx)(i.hrZ,{children:(0,t.jsxs)(i.Tr,{children:[(0,t.jsx)(i.Th,{children:"System"}),(0,t.jsx)(i.Th,{})]})}),(0,t.jsx)(i.p3B,{children:s.map(e=>(0,t.jsxs)(i.Tr,{_hover:{bg:"gray.50"},"data-testid":"row-".concat(e.fides_key),children:[(0,t.jsx)(i.Td,{children:e.name}),(0,t.jsx)(i.Td,{textAlign:"end",children:(0,t.jsx)(i.wpx,{"aria-label":"Unassign system from user",icon:(0,t.jsx)(y.l,{}),onClick:()=>r(e),"data-testid":"unassign-btn"})})]},e.fides_key))})]})};var C=e=>{let{allSystems:s,assignedSystems:n,onChange:a}=e,r=e=>{n.find(s=>s.fides_key===e.fides_key)?a(n.filter(s=>s.fides_key!==e.fides_key)):a([...n,e])};return(0,t.jsx)(i.xuv,{overflowY:"auto",maxHeight:"300px",children:(0,t.jsxs)(i.iA_,{size:"sm","data-testid":"assign-systems-table",maxHeight:"50vh",overflowY:"scroll",children:[(0,t.jsx)(i.hrZ,{position:"sticky",top:0,background:"white",zIndex:1,children:(0,t.jsxs)(i.Tr,{children:[(0,t.jsx)(i.Th,{children:"System"}),(0,t.jsx)(i.Th,{children:"Assign"})]})}),(0,t.jsx)(i.p3B,{children:s.map(e=>{let s=!!n.find(s=>s.fides_key===e.fides_key);return(0,t.jsxs)(i.Tr,{_hover:{bg:"gray.50"},"data-testid":"row-".concat(e.fides_key),children:[(0,t.jsx)(i.Td,{children:e.name}),(0,t.jsx)(i.Td,{children:(0,t.jsx)(i.rAg,{checked:s,onChange:()=>r(e),"data-testid":"assign-switch"})})]},e.fides_key)})})]})})};let _=(e,s)=>{var n,t;return(null===(n=e.name)||void 0===n?void 0:n.toLocaleLowerCase().includes(s.toLocaleLowerCase()))||(null===(t=e.description)||void 0===t?void 0:t.toLocaleLowerCase().includes(s.toLocaleLowerCase()))};var S=e=>{let{isOpen:s,onClose:n,assignedSystems:a,onAssignedSystemChange:r}=e,{data:l}=(0,w.K3)(),[o,d]=(0,m.useState)(""),[c,u]=(0,m.useState)(a),p=async()=>{r(c),n()},h=!l||0===l.length,g=(0,m.useMemo)(()=>l?l.filter(e=>_(e,o)):[],[l,o]),x=(0,m.useMemo)(()=>{let e=new Set(c.map(e=>e.fides_key));return g.every(s=>e.has(s.fides_key))},[g,c]);return(0,t.jsxs)(i.u_l,{isOpen:s,onClose:n,size:"2xl",children:[(0,t.jsx)(i.ZAr,{}),(0,t.jsxs)(i.hzk,{p:8,"data-testid":"confirmation-modal",children:[(0,t.jsxs)(i.xBx,{fontWeight:"medium",display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,t.jsx)(i.xvT,{children:"Assign systems"}),(0,t.jsxs)(i.j8w,{color:"success",children:["Assigned to ",a.length," systems"]})]}),(0,t.jsx)(i.fef,{"data-testid":"assign-systems-modal-body",children:h?(0,t.jsx)(i.xvT,{children:"No systems found"}):(0,t.jsxs)(i.Kqy,{spacing:4,children:[(0,t.jsxs)(i.kCb,{justifyContent:"space-between",children:[(0,t.jsx)(i.xvT,{fontSize:"sm",flexGrow:1,fontWeight:"medium",children:"Assign systems in your organization to this user"}),(0,t.jsx)(i.xuv,{children:(0,t.jsxs)(i.NIc,{display:"flex",alignItems:"center",children:[(0,t.jsx)(i.lXp,{fontSize:"sm",htmlFor:"assign-all-systems",mb:"0",children:"Assign all systems"}),(0,t.jsx)(i.rAg,{size:"small",id:"assign-all-systems",checked:x,onChange:e=>{e&&l?u(g):u(l?l.filter(e=>!g.includes(e)):[])},"data-testid":"assign-all-systems-toggle"})]})})]}),(0,t.jsx)(j.Z,{value:o,onChange:d,placeholder:"Search for systems","data-testid":"system-search"}),(0,t.jsx)(C,{allSystems:g,assignedSystems:c,onChange:u})]})}),(0,t.jsx)(i.mzw,{justifyContent:"flex-start",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(i.wpx,{onClick:n,className:"mr-2","data-testid":"cancel-btn",children:"Cancel"}),h?null:(0,t.jsx)(i.wpx,{type:"primary",onClick:p,"data-testid":"confirm-btn",children:"Confirm"})]})})]})]})},T=e=>{let{label:s,roleKey:n,isSelected:a,isDisabled:r,assignedSystems:l,onAssignedSystemChange:d}=e,{setFieldValue:u}=(0,c.u6)(),m=(0,i.qY0)(),p=r?"You do not have sufficient permissions to assign this role.":void 0;return a?(0,t.jsxs)(i.Kqy,{borderRadius:"md",border:"1px solid",borderColor:"gray.200",p:4,backgroundColor:"gray.50","aria-selected":"true",spacing:4,"data-testid":"selected",children:[(0,t.jsxs)(i.kCb,{alignItems:"center",justifyContent:"space-between",children:[(0,t.jsx)(i.xvT,{fontSize:"md",fontWeight:"semibold",children:s}),(0,t.jsx)(i.StI,{})]}),n!==o.A7.APPROVER&&n!==o.A7.RESPONDENT&&n!==o.A7.EXTERNAL_RESPONDENT?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.kCb,{alignItems:"center",children:[(0,t.jsx)(i.xvT,{fontSize:"sm",fontWeight:"semibold",mr:1,children:"Assigned systems"}),(0,t.jsx)(h.b,{label:"Assigned systems refer to those systems that have been specifically allocated to a user for management purposes. Users assigned to a system possess full edit permissions and are listed as the Data Steward for the respective system."})]}),(0,t.jsx)(i.wpx,{disabled:r,title:p,type:"primary",size:"small",onClick:m.onOpen,"data-testid":"assign-systems-btn",children:"Assign systems +"}),(0,t.jsx)(v,{assignedSystems:l,onAssignedSystemChange:d}),m.isOpen?(0,t.jsx)(S,{isOpen:m.isOpen,onClose:m.onClose,assignedSystems:l,onAssignedSystemChange:d}):null]}):null]}):(0,t.jsx)(i.wpx,{onClick:()=>{u("roles",[n])},"data-testid":"role-option-".concat(s),title:p,disabled:r,children:s})};let k={roles:[]};var E=()=>{var e,s;let n=(0,i.pmc)(),r=(0,u.useRouter)(),j=(0,l.C)(b.Ux);(0,b.d6)(j,{skip:!j});let{isOpen:w,onOpen:y,onClose:v}=(0,i.qY0)(),C=(0,l.C)(b.R$),[_,S]=(0,m.useState)(C),[E]=(0,b.G$)();(0,m.useEffect)(()=>{S(C)},[C]);let{data:R,isLoading:A}=(0,b.gU)(null!=j?j:"",{skip:!j}),[P]=(0,b.lD)(),N=!!(null==R?void 0:null===(e=R.roles)||void 0===e?void 0:e.includes(o.A7.EXTERNAL_RESPONDENT)),q=async e=>{if(w&&v(),!j)return;let s=e.roles.includes(o.A7.APPROVER),t=await P({user_id:j,payload:{roles:e.roles}});if((0,p.D4)(t)){n((0,f.Vo)((0,p.e$)(t.error)));return}if(!s){let e=_.map(e=>e.fides_key),s=await E({userId:j,fidesKeys:e});if((0,p.D4)(s)){n((0,f.Vo)((0,p.e$)(s.error)));return}}n((0,f.t5)("Permissions updated"))},O=async e=>{j&&(_.length>0&&e.roles.includes(o.A7.APPROVER)?y():await q(e))},I=(0,d.Tg)([o.Sh.USER_PERMISSION_ASSIGN_OWNERS]);if(!j)return null;if(A)return(0,t.jsx)(i.$jN,{});if(!I&&(null==R?void 0:null===(s=R.roles)||void 0===s?void 0:s.includes(o.A7.OWNER)))return(0,t.jsx)(i.xvT,{"data-testid":"insufficient-access",children:"You do not have sufficient access to change this user's permissions."});let M=(null==R?void 0:R.roles)?{roles:R.roles}:k,z=a.K.filter(e=>N?e.roleKey===o.A7.EXTERNAL_RESPONDENT:e.roleKey!==o.A7.EXTERNAL_RESPONDENT),D=N?"External respondent role cannot be changed":void 0;return(0,t.jsx)(c.J9,{onSubmit:O,initialValues:M,enableReinitialize:!0,children:e=>{let{values:s,isSubmitting:n,dirty:a}=e;return(0,t.jsxs)(c.l0,{children:[(0,t.jsxs)(i.Kqy,{spacing:7,children:[(0,t.jsxs)(i.Kqy,{spacing:3,"data-testid":"role-options",children:[(0,t.jsxs)(i.kCb,{alignItems:"center",children:[(0,t.jsx)(i.xvT,{fontSize:"sm",fontWeight:"semibold",mr:1,children:"User role"}),(0,t.jsx)(h.b,{label:"A user's role in the organization determines what parts of the UI they can access and which functions are available to them."})]}),z.map(e=>{let n=s.roles.indexOf(e.roleKey)>=0,i=e.roleKey===o.A7.OWNER?!I:N;return(0,t.jsx)(T,{isSelected:n,isDisabled:i,assignedSystems:_,onAssignedSystemChange:S,...e},e.roleKey)}),!N&&(0,t.jsx)(i.esZ,{title:"To invite a new External respondent user, create a manual task integration and then click on the 'Manage secure access' button",children:(0,t.jsx)(i.wpx,{disabled:!0,"data-testid":"role-option-External respondent",children:"External respondent"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.wpx,{onClick:()=>r.push(x.e3),children:"Cancel"}),(0,t.jsx)(i.esZ,{title:D,children:(0,t.jsx)(i.wpx,{className:"ml-2",type:"primary",htmlType:"submit",loading:n,disabled:!a&&_===C||N,"data-testid":"save-btn",children:"Save"})})]})]}),(0,t.jsx)(g.Z,{isOpen:w,onClose:v,onConfirm:()=>q(s),title:"Change role to Approver",testId:"downgrade-to-approver-confirmation-modal",continueButtonText:"Yes",message:(0,t.jsx)(i.xvT,{children:"Switching to an approver role will remove all assigned systems. Do you wish to proceed?"})})]})}})},R=n(61038),A=n(55484),P=n(25980),N=n(40324),q=n(96006),O=n(7426),I=n(42478),M=n(76174),z=n(91317),D=n(16125),V=n(36835),U=n(31883),Z=n(52253);let K=(e,s,n)=>{var t;try{localStorage.removeItem(Z.xH)}catch(e){}e((0,V.kS)()),null==n||null===(t=n.onClose)||void 0===t||t.call(n),s.push(Z._e)},W=A.Ry().shape({password:q.a.label("Password"),passwordConfirmation:A.Z_().required().oneOf([A.iH("password")],"Passwords must match").label("Password confirmation")}),B={password:"",passwordConfirmation:""},L=e=>{let s=(0,i.qY0)(),n=(0,i.pmc)(),[t]=(0,b.ls)(),a=(0,u.useRouter)(),r=(0,D.I0)(),o=(0,l.C)(V.dy),d=async i=>{let l=await t({id:e,new_password:i.password});(0,U.D4)(l)?n((0,f.Vo)((0,p.e$)(l.error))):(n((0,f.t5)("Successfully reset user's password. Please inform the user of their new password.")),s.onClose(),(null==o?void 0:o.id)===e&&K(r,a))};return{...s,handleResetPassword:d}};var H=e=>{let{id:s}=e,{handleResetPassword:n,isOpen:a,onClose:r,onOpen:l}=L(s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.wpx,{onClick:l,"data-testid":"reset-password-btn",children:"Reset password"}),(0,t.jsxs)(i.u_l,{isCentered:!0,isOpen:a,onClose:r,children:[(0,t.jsx)(i.ZAr,{}),(0,t.jsx)(i.hzk,{children:(0,t.jsx)(c.J9,{initialValues:B,validationSchema:W,onSubmit:n,children:e=>{let{isSubmitting:s,dirty:n,isValid:a}=e;return(0,t.jsxs)(c.l0,{children:[(0,t.jsx)(i.xBx,{children:"Reset Password"}),(0,t.jsx)(i.olH,{}),(0,t.jsx)(i.fef,{children:(0,t.jsxs)(i.Kqy,{direction:"column",spacing:4,children:[(0,t.jsx)(i.xvT,{mb:2,children:"Choose a new password for this user."}),(0,t.jsx)(N.j0,{name:"password",label:"Password",placeholder:"********",type:"password",tooltip:"Password must contain at least 8 characters, 1 number, 1 capital letter, 1 lowercase letter, and at least 1 symbol.",autoComplete:"new-password"}),(0,t.jsx)(N.j0,{name:"passwordConfirmation",label:"Confirm Password",placeholder:"********",type:"password",tooltip:"Must match above password.",autoComplete:"confirm-password"})]})}),(0,t.jsx)(i.mzw,{children:(0,t.jsxs)("div",{className:"w-full gap-2",children:[(0,t.jsx)(i.wpx,{onClick:r,className:"w-1/2",children:"Cancel"}),(0,t.jsx)(i.wpx,{type:"primary",disabled:!n||!a,loading:s,htmlType:"submit",className:"w-1/2","data-testid":"submit-btn",children:"Change Password"})]})})]})}})})]})]})};let F=e=>{let s=(0,i.qY0)(),n=(0,i.pmc)(),[t,a]=(0,m.useState)(""),[r,l]=(0,m.useState)(""),[o,{isLoading:d}]=(0,b.ev)(),c=(0,u.useRouter)(),p=(0,D.I0)(),h=!!(e&&r&&t),g=async()=>{h&&o({id:e,old_password:t,new_password:r}).unwrap().then(()=>{n((0,f.t5)("Password updated")),K(p,c,{onClose:s.onClose})})};return{...s,changePasswordValidation:h,handleChange:e=>{"oldPassword"===e.target.name?a(e.target.value):l(e.target.value)},handleChangePassword:g,isLoading:d,newPasswordValue:r,oldPasswordValue:t}};var Y=e=>{let{id:s}=e,{changePasswordValidation:n,handleChange:a,handleChangePassword:r,isLoading:l,isOpen:o,newPasswordValue:d,oldPasswordValue:c,onClose:u,onOpen:m}=F(s);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.wpx,{onClick:m,"data-testid":"update-password-btn",children:"Update password"}),(0,t.jsxs)(i.u_l,{isCentered:!0,isOpen:o,onClose:u,children:[(0,t.jsx)(i.ZAr,{}),(0,t.jsxs)(i.hzk,{children:[(0,t.jsx)(i.xBx,{children:"Update Password"}),(0,t.jsx)(i.olH,{}),(0,t.jsx)(i.fef,{pb:6,children:(0,t.jsxs)(i.Kqy,{direction:"column",spacing:"15px",children:[(0,t.jsx)(i.NIc,{children:(0,t.jsx)(i.IIB,{isRequired:!0,name:"oldPassword",onChange:a,placeholder:"Old Password",type:"password",value:c,"data-testid":"input-oldPassword"})}),(0,t.jsx)(i.NIc,{children:(0,t.jsx)(i.IIB,{isRequired:!0,name:"newPassword",onChange:a,placeholder:"New Password",type:"password",value:d,"data-testid":"input-newPassword"})})]})}),(0,t.jsxs)(i.mzw,{children:[(0,t.jsx)(i.wpx,{onClick:u,className:"mr-2 w-1/2",children:"Cancel"}),(0,t.jsx)(i.wpx,{type:"primary",disabled:!n,loading:l,onClick:r,htmlType:"submit",className:"mr-3 w-1/2","data-testid":"submit-btn",children:"Change Password"})]})]})]})]})},X=()=>{var e;let s=(0,l.C)(b.Ux),n=(0,l.C)(z.dy),a=!!n&&n.id===s,{data:r}=(0,b.gU)(null!=s?s:"",{skip:!s});return(null==r?void 0:null===(e=r.roles)||void 0===e?void 0:e.includes(o.A7.EXTERNAL_RESPONDENT))?null:(0,t.jsx)(i.xuv,{children:s?(0,t.jsxs)(i.Ugi,{children:[a?(0,t.jsx)(Y,{id:s}):null,(0,t.jsx)(d.ZP,{scopes:[o.Sh.USER_PASSWORD_RESET],children:(0,t.jsx)(H,{id:s})})]}):null})};let $=(e,s,n,t)=>!e||e&&!s||e&&s&&!0===n&&!!t,J=(e,s,n)=>!!(e&&s&&n),G=(e,s,n,t,i,a)=>!!e&&!s&&$(n,t,i,a),Q=(e,s,n,t)=>$(e,s,n,t),ee={username:"",first_name:"",email_address:"",last_name:"",password:"",password_login_enabled:!1},es=(e,s,n,t,i)=>A.Ry().shape({username:A.Z_().required().label("Username"),email_address:A.Z_().email().required().label("Email address"),first_name:A.Z_().label("First name"),last_name:A.Z_().label("Last name"),password:A.Z_().when(["password_login_enabled"],{is:a=>G(e,s,n,t,i,a),then:()=>q.a.label("Password"),otherwise:()=>A.Z_().optional().label("Password")}),password_login_enabled:A.O7().label("Allow password login")});var en=e=>{let{onSubmit:s,initialValues:n,canEditNames:a}=e,r=(0,u.useRouter)(),o=(0,i.pmc)(),d=(0,l.T)(),m=(0,i.qY0)(),{data:h}=(0,I.jc)(),{data:g}=(0,M.qv)();(0,O.tB)({api_set:!1});let j=(0,l.C)(b.ZC),w=(0,l.C)(O.iR),{plus:v}=(0,P.hz)(),C=(null==h?void 0:h.enabled)||!1,_=(null==w?void 0:w.allow_username_password_login)||!1,S=!j,T=!S&&!a,k=g&&g.length>0||!1,E=J(v,k,_),A=null!=n?n:ee;j&&"password_login_enabled"in j&&(A={...A,password_login_enabled:!!j.password_login_enabled});let q=es(S,C,v,k,_),z=async e=>{let n=G(S,C,v,k,_,e.password_login_enabled),t={username:e.username,email_address:e.email_address,first_name:e.first_name,last_name:e.last_name};E&&(t.password_login_enabled=e.password_login_enabled),n&&e.password&&(t.password=e.password);let i=await s(t);if((0,p.D4)(i)){o((0,f.Vo)((0,p.e$)(i.error)));return}o((0,f.t5)("".concat(S?"User created. By default, new users are set to the Viewer role. To change the role, please go to the Permissions tab.":"User updated."))),(null==i?void 0:i.data)&&d((0,b.Vv)(i.data.id))};return(0,t.jsx)(c.J9,{onSubmit:z,initialValues:A,validationSchema:q,"data-testid":"user-form",children:e=>{let{dirty:s,isSubmitting:n,isValid:a,values:l}=e;return(0,t.jsx)(c.l0,{children:(0,t.jsxs)(i.Kqy,{maxW:["xs","xs","100%"],width:"100%",spacing:7,children:[(0,t.jsxs)(i.Kqy,{spacing:6,maxWidth:"55%",children:[(0,t.jsxs)(i.kCb,{children:[(0,t.jsxs)(i.xvT,{display:"flex",alignItems:"center",fontSize:"sm",fontWeight:"semibold",children:["Profile"," ",(null==j?void 0:j.disabled)&&(0,t.jsx)(i.j8w,{color:"success",className:"ml-2","data-testid":"invite-sent-badge",children:"Invite sent"})]}),(0,t.jsx)(i.xuv,{marginLeft:"auto",children:(0,t.jsxs)(i.Ugi,{children:[Q(v,k,_||!1,l.password_login_enabled)&&(0,t.jsx)(X,{"data-testid":"password-management"}),S?null:(0,t.jsxs)(i.xuv,{children:[(0,t.jsx)(i.wpx,{"aria-label":"delete",icon:(0,t.jsx)(y.l,{}),onClick:m.onOpen,"data-testid":"delete-user-btn"}),(0,t.jsx)(R.Z,{user:j,...m})]})]})})]}),(0,t.jsx)(N.j0,{name:"username",label:"Username",variant:"block",placeholder:"Enter new username",disabled:!S,isRequired:!0,"data-testid":"input-username"}),(0,t.jsx)(N.j0,{name:"email_address",label:"Email address",variant:"block",placeholder:"Enter email of user",isRequired:!0,"data-testid":"input-email-address"}),(0,t.jsx)(N.j0,{name:"first_name",label:"First name",variant:"block",placeholder:"Enter first name of user",disabled:T,"data-testid":"input-first-name"}),(0,t.jsx)(N.j0,{name:"last_name",label:"Last name",variant:"block",placeholder:"Enter last name of user",disabled:T,"data-testid":"input-last-name"}),E&&(0,t.jsx)(N.w8,{name:"password_login_enabled",label:"Allow password login",tooltip:"When enabled, user can log in with username and password. When disabled, user must use SSO.",variant:"stacked",isDisabled:!S,"data-testid":"toggle-allow-password-login",size:"default"}),G(S,C,v,k,_,l.password_login_enabled)&&(0,t.jsx)(N.j0,{name:"password",label:"Password",variant:"block",placeholder:"********",type:"password",tooltip:"Password must contain at least 8 characters, 1 number, 1 capital letter, 1 lowercase letter, and at least 1 symbol.",isRequired:!0,"data-testid":"input-password"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(i.wpx,{onClick:()=>r.push(x.e3),className:"mr-3","data-testid":"cancel-btn",children:"Cancel"}),(0,t.jsx)(i.wpx,{htmlType:"submit",type:"primary",disabled:!s||!a,loading:n,"data-testid":"save-user-btn",children:"Save"})]})]})})}})},et=e=>{let{onSubmit:s,initialValues:n,...a}=e,c=(0,l.C)(b.Ux);(0,b.Fk)(c,{skip:!c});let u=(0,d.Tg)([o.Sh.USER_PERMISSION_UPDATE]),m=!c||!u,p=[{label:"Profile",key:"profile",children:(0,t.jsx)(en,{onSubmit:s,initialValues:n,...a})},{label:"Permissions",key:"permissions",children:(0,t.jsxs)(i.kCb,{gap:"97px",children:[(0,t.jsx)(i.xuv,{w:{base:"100%",md:"50%",xl:"50%"},children:(0,t.jsx)(E,{})}),(0,t.jsx)(i.xuv,{position:"absolute",top:"96px",right:6,height:"calc(100% + 100px)",overflowY:"scroll",padding:6,w:"35%",borderLeftWidth:"1px",children:(0,t.jsx)(r,{})})]}),disabled:m,forceRender:!m}];return(0,t.jsx)(i.A5g,{items:p})}},91437:function(e,s,n){n.d(s,{K:function(){return i}});var t=n(60240);let i=[{label:"Owner",permissions_label:"Owner",roleKey:t.A7.OWNER,description:"Owners have view and edit access to the whole organization and can create new users"},{label:"Contributor",permissions_label:"Contributor",roleKey:t.A7.CONTRIBUTOR,description:"Contributors can create new users and have view and edit access to the whole organization. Contributors cannot configure storage and messaging services"},{label:"Viewer",permissions_label:"Viewer",roleKey:t.A7.VIEWER,description:"Viewers have view access to the Data Map and all systems"},{label:"Viewer & Approver",permissions_label:"Viewer & Approver",roleKey:t.A7.VIEWER_AND_APPROVER,description:"Viewer & Approvers have view access to the Data Map but can also manage Privacy Requests"},{label:"Approver",permissions_label:"Approver",roleKey:t.A7.APPROVER,description:"Approvers can only access the Privacy Requests portal to review, approve, and create new requests"},{label:"Internal respondent",permissions_label:"Internal respondent",roleKey:t.A7.RESPONDENT,description:"Internal respondents have limited access and can only view and complete manual DSR tasks assigned to them"},{label:"External respondent",permissions_label:"External respondent",roleKey:t.A7.EXTERNAL_RESPONDENT,description:"External respondents can only access the external task portal to complete manual DSR tasks assigned to them"}]},31883:function(e,s,n){n.d(s,{Bw:function(){return t.Bw},D4:function(){return t.D4}});var t=n(19043)}}]);