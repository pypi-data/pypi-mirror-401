(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4496],{12197:function(e){var t;t=function(){"use strict";var e={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(s,i,n){var a,l=function(e,s,i){void 0===i&&(i={});var n,a,l,r,o=new Date(e);return(void 0===(n=i)&&(n={}),(r=t[l=s+"|"+(a=n.timeZoneName||"short")])||(r=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:a}),t[l]=r),r).formatToParts(o)},r=function(t,s){for(var i=l(t,s),a=[],r=0;r<i.length;r+=1){var o=i[r],c=o.type,d=o.value,u=e[c];u>=0&&(a[u]=parseInt(d,10))}var m=a[3],f=a[0]+"-"+a[1]+"-"+a[2]+" "+(24===m?0:m)+":"+a[4]+":"+a[5]+":000",h=+t;return(n.utc(f).valueOf()-(h-=h%1e3))/6e4},o=i.prototype;o.tz=function(e,t){void 0===e&&(e=a);var s,i=this.utcOffset(),l=this.toDate(),r=l.toLocaleString("en-US",{timeZone:e}),o=Math.round((l-new Date(r))/1e3/60),c=-(15*Math.round(l.getTimezoneOffset()/15))-o;if(Number(c)){if(s=n(r,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(c,!0),t){var d=s.utcOffset();s=s.add(i-d,"minute")}}else s=this.utcOffset(0,t);return s.$x.$timezone=e,s},o.offsetName=function(e){var t=this.$x.$timezone||n.tz.guess(),s=l(this.valueOf(),t,{timeZoneName:e}).find(function(e){return"timezonename"===e.type.toLowerCase()});return s&&s.value};var c=o.startOf;o.startOf=function(e,t){if(!this.$x||!this.$x.$timezone)return c.call(this,e,t);var s=n(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return c.call(s,e,t).tz(this.$x.$timezone,!0)},n.tz=function(e,t,s){var i=s&&t,l=s||t||a,o=r(+n(),l);if("string"!=typeof e)return n(e).tz(l);var c=function(e,t,s){var i=e-60*t*1e3,n=r(i,s);if(t===n)return[i,t];var a=r(i-=60*(n-t)*1e3,s);return n===a?[i,n]:[e-60*Math.min(n,a)*1e3,Math.max(n,a)]}(n.utc(e,i).valueOf(),o,l),d=c[0],u=c[1],m=n(d).utcOffset(u);return m.$x.$timezone=l,m},n.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},n.tz.setDefault=function(e){a=e}}},e.exports=t()},4496:function(e,t,s){"use strict";s.d(t,{Z:function(){return w}});var i=s(24246),n=s(49617),a=s(86677),l=s(27378),r=s(812),o=s(58452),c=s(77830),d=s(19904),u=s(60240),m=s(35493),f=s(40822),h=s(54458),g=s(27693),y=s.n(g),p=s(12197),x=s.n(p),v=s(96600),j=s.n(v),D=s(81179);y().extend(j()),y().extend(x());let{Text:S}=n.AntTypography,N="09:00",_=D.eO.MONDAY,b=[{label:"Daily",value:D.Di.DAILY},{label:"Weekly",value:D.Di.WEEKLY},{label:"Weekdays",value:D.Di.WEEKDAYS},{label:"Monthly",value:D.Di.MONTHLY}];var T=e=>{let{value:t,onChange:s,onTimezoneChange:a,timezone:r}=e,[o,c]=(0,l.useState)(D.Di.WEEKLY),[d,u]=(0,l.useState)(1),[m,f]=(0,l.useState)(!1),g=(0,l.useRef)(!1),p=y().tz.guess(),x=r||p,v=(0,l.useMemo)(()=>{let e=new Date,t=(0,h.WU)(e,"O",{timeZone:x}),s=x.split("/");return{cityName:s[s.length-1].replace(/_/g," "),gmtOffset:t}},[x]);(0,l.useEffect)(()=>{r||null==a||a(p)},[p,a,r]),(0,l.useEffect)(()=>{if(t&&!g.current){let e=(0,D.se)(t);e?(f(!1),c(e.frequency),void 0!==e.dayOfMonth&&u(e.dayOfMonth)):f(!0),g.current=!0}},[t]),(0,l.useEffect)(()=>{let e={frequency:o,time:N,...o===D.Di.WEEKLY&&{dayOfWeek:_},...o===D.Di.MONTHLY&&{dayOfMonth:d}};try{let t=(0,D.Ns)(e);null==s||s(t)}catch(e){console.error("Error generating cron expression:",e)}},[o,d,s]);let j={frequency:o,time:N,...o===D.Di.WEEKLY&&{dayOfWeek:_},...o===D.Di.MONTHLY&&{dayOfMonth:d}};return(0,i.jsxs)(n.vyj,{direction:"vertical",size:"middle",className:"w-full",children:[m&&(0,i.jsx)(n.DUx,{message:"Custom Cron Expression",description:"This digest uses a custom cron expression that cannot be edited with the picker. Changing the schedule will replace the custom expression.",type:"warning",closable:!0,onClose:()=>f(!1)}),(0,i.jsxs)("div",{children:[(0,i.jsx)(S,{strong:!0,className:"mb-1 block",children:"Frequency"}),(0,i.jsx)(n.WPr,{value:o,onChange:c,options:b,"data-testid":"select-frequency",className:"w-full",id:"select-frequency","aria-label":"Frequency"})]}),o===D.Di.MONTHLY&&(0,i.jsxs)("div",{children:[(0,i.jsx)(S,{strong:!0,className:"mb-1 block",children:"Day of Month"}),(0,i.jsx)(n.W7D,{value:d,onChange:e=>{null!==e&&(0,D.Ch)(e)&&u(e)},min:1,max:31,"data-testid":"input-day-of-month",className:"w-full"}),d>28&&(0,i.jsx)(S,{type:"secondary",className:"mt-1 block text-xs",children:"Note: Days 29-31 will not trigger in all months"})]}),(0,i.jsx)("div",{className:"rounded-md bg-gray-50 p-3",children:(0,i.jsxs)(S,{type:"secondary",className:"text-xs",children:["Schedule: ",(0,D.qV)(j)," ",v.cityName," (",v.gmtOffset,")"]})})]})},P=e=>{let{isOpen:t,onClose:s,digestConfigId:a,digestType:l}=e,[o]=n.PPS.useForm(),c=(0,n.UD8)(),[d,{isLoading:u}]=(0,f.ch)(),m=async e=>{let t=await d({digest_config_id:a,digest_config_type:l,test_email:e.email});if((0,r.D4)(t)){c.error((0,r.e$)(t.error));return}c.success("Test email sent to ".concat(e.email)),o.resetFields(),s()},h=()=>{o.resetFields(),s()};return(0,i.jsx)(n.$zI,{title:"Send Test Email",open:t,onCancel:h,footer:null,destroyOnClose:!0,children:(0,i.jsxs)(n.PPS,{form:o,layout:"vertical",onFinish:m,initialValues:{email:""},children:[(0,i.jsx)(n.PPS.Item,{label:"Email Address",name:"email",rules:[{required:!0,message:"Please enter an email address"},{type:"email",message:"Please enter a valid email address"}],children:(0,i.jsx)(n.uFc,{type:"email",placeholder:"user@example.com","data-testid":"test-email-input"})}),(0,i.jsx)(n.PPS.Item,{children:(0,i.jsxs)(n.vyj,{className:"w-full justify-end",children:[(0,i.jsx)(n.wpx,{onClick:h,"data-testid":"cancel-test-btn",children:"Cancel"}),(0,i.jsx)(n.wpx,{type:"primary",htmlType:"submit",loading:u,"data-testid":"send-test-btn",children:"Send Test"})]})})]})})},w=e=>{let{initialValues:t,isLoading:s}=e,[h]=n.PPS.useForm(),g=(0,a.useRouter)(),y=(0,n.UD8)(),[p,x]=(0,l.useState)(!1),[v,j]=(0,l.useState)(!1),[D,S]=(0,l.useState)((null==t?void 0:t.timezone)||m.EW),[N,{isLoading:_}]=(0,f.m1)(),[b,{isLoading:w}]=(0,f.zb)(),[O]=(0,f.yG)(),A=!!(null==t?void 0:t.id),C=(0,d.Tg)([u.Sh.DIGEST_CONFIG_DELETE])&&A,E=async()=>{let e=await O({config_id:null==t?void 0:t.id,digest_config_type:u.tB.MANUAL_TASKS});if((0,r.D4)(e)){y.error((0,r.e$)(e.error)),j(!1);return}y.success("Digest configuration deleted successfully",void 0,()=>{g.push(c.DN)})},M=async e=>{var s;let{id:i,...n}=e,a={...n,messaging_service_type:n.messaging_service_type||u.qr.EMAIL,enabled:null===(s=null==t?void 0:t.enabled)||void 0===s||s,timezone:D};if(A&&i){let e=await b({config_id:i,digest_config_type:u.tB.MANUAL_TASKS,data:a});if((0,r.D4)(e)){y.error((0,r.e$)(e.error));return}y.success({content:"Digest configuration updated successfully",duration:3}),setTimeout(()=>{g.push(c.DN)},500)}else{let e=await N({digest_config_type:u.tB.MANUAL_TASKS,data:a});if((0,r.D4)(e)){y.error((0,r.e$)(e.error));return}y.success({content:"Digest configuration created successfully",duration:3}),setTimeout(()=>{g.push(c.DN)},500)}},L=t||{name:"",digest_type:u.tB.MANUAL_TASKS,messaging_service_type:u.qr.EMAIL,cron_expression:m.by,timezone:m.EW,config_metadata:null};return s?(0,i.jsx)("div",{children:"Loading..."}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.PPS,{form:h,layout:"vertical",initialValues:L,onFinish:M,className:"max-w-2xl",children:[(0,i.jsx)(n.PPS.Item,{label:"Digest Type",name:"digest_type",tooltip:"Type of content this digest will contain",children:(0,i.jsx)(n.WPr,{disabled:!0,options:[{label:"Manual Tasks",value:u.tB.MANUAL_TASKS}],"data-testid":"select-digest-type","aria-label":"Digest Type"})}),(0,i.jsx)(n.PPS.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Please enter a name"}],tooltip:"A descriptive name for this digest configuration",children:(0,i.jsx)(n.uFc,{"data-testid":"input-name",placeholder:"e.g., Weekly Manual Tasks Summary"})}),(0,i.jsx)(n.PPS.Item,{name:"id",hidden:!0,children:(0,i.jsx)(n.uFc,{})}),(0,i.jsx)(n.PPS.Item,{name:"messaging_service_type",hidden:!0,children:(0,i.jsx)(n.uFc,{})}),(0,i.jsx)(n.PPS.Item,{name:"cron_expression",rules:[{required:!0,message:"Please configure a schedule"}],tooltip:"Configure when the digest should be sent",children:(0,i.jsx)(T,{onTimezoneChange:S,timezone:null==t?void 0:t.timezone})}),(0,i.jsx)(n.PPS.Item,{children:(0,i.jsxs)(n.vyj,{className:"w-full justify-between",children:[(0,i.jsxs)(n.vyj,{children:[A&&(0,i.jsx)(n.wpx,{onClick:()=>x(!0),"data-testid":"test-email-btn",children:"Send test"}),C&&(0,i.jsx)(n.wpx,{danger:!0,onClick:()=>{j(!0)},"data-testid":"delete-btn",children:"Delete"})]}),(0,i.jsxs)(n.vyj,{children:[(0,i.jsx)(n.wpx,{onClick:()=>g.push(c.DN),"data-testid":"cancel-btn",children:"Cancel"}),(0,i.jsx)(n.wpx,{type:"primary",htmlType:"submit",loading:_||w,"data-testid":"submit-btn",children:A?"Update":"Create"})]})]})})]}),A&&(null==t?void 0:t.id)&&(0,i.jsx)(P,{isOpen:p,onClose:()=>x(!1),digestConfigId:t.id,digestType:u.tB.MANUAL_TASKS}),(0,i.jsx)(o.Z,{isOpen:v,onClose:()=>{j(!1)},onConfirm:E,title:"Delete digest configuration",message:(0,i.jsxs)("span",{className:"text-gray-500",children:['Are you sure you want to delete the digest "',null==t?void 0:t.name,'"? This action cannot be undone.']}),continueButtonText:"Delete",isCentered:!0,icon:(0,i.jsx)(n.aNP,{})})]})}}}]);