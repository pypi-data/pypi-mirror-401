(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8538],{73846:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dataset/new",function(){return t(17294)}])},39715:function(e,a,t){"use strict";var s=t(24246),r=t(49617);t(27378),a.Z=e=>{let{isEmptyState:a,yamlError:t}=e;return(0,s.jsxs)(r.xuv,{w:"fit-content",bg:"white",p:3,borderRadius:3,children:[(0,s.jsxs)(r.Ugi,{children:[(0,s.jsx)(r.X6q,{as:"h5",color:"gray.700",size:"xs",children:"YAML"}),(0,s.jsx)(r.Vp9,{colorScheme:"red",size:"sm",variant:"solid",children:"Error"})]}),(0,s.jsx)(r.xuv,{bg:"red.50",border:"1px solid",borderColor:"red.300",color:"red.300",mt:"16px",borderRadius:"6px",children:(0,s.jsxs)(r.Ugi,{alignItems:"flex-start",margin:["14px","17px","14px","17px"],children:[(0,s.jsx)(r.f9v,{}),a&&(0,s.jsxs)(r.xuv,{children:[(0,s.jsx)(r.X6q,{as:"h5",color:"red.500",fontWeight:"semibold",size:"xs",children:"Error message:"}),(0,s.jsx)(r.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"400",children:"Yaml system is required"})]}),t&&(0,s.jsxs)(r.xuv,{children:[(0,s.jsx)(r.X6q,{as:"h5",color:"red.500",fontWeight:"semibold",size:"xs",children:"Error message:"}),(0,s.jsx)(r.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"400",children:t.message}),(0,s.jsx)(r.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"400",children:t.reason}),(0,s.jsxs)(r.xvT,{color:"gray.700",fontSize:"sm",fontWeight:"400",children:["Ln ",(0,s.jsx)("b",{children:t.mark.line}),", Col"," ",(0,s.jsx)("b",{children:t.mark.column}),", Pos"," ",(0,s.jsx)("b",{children:t.mark.position})]})]})]})})]})}},41207:function(e,a,t){"use strict";t.d(a,{F:function(){return i},M:function(){return n}});var s=t(76649),r=t(65218);let n=t.n(r)()(()=>t.e(7088).then(t.bind(t,57088)).then(e=>e.default),{loadableGenerated:{webpack:()=>[57088]},ssr:!1}),i=e=>(0,s.Ln)({name:"string"},e)&&"YAMLException"===e.name},17294:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return T}});var s=t(24246),r=t(49617),n=t(27378),i=t(77213),l=t(77830),o=t(58754),d=t(34090),c=t(86677),u=t(16125),h=t(55484),m=t(25980),x=t(40324),y=t(812),f=t(58452),g=t(46628),p=t(83265),j=t(32885),b=t(60240),v=t(20386);let w=e=>!("system_type"in e),C={url:"",classify:!1,classifyConfirmed:!1},_=h.Ry().shape({url:h.Z_().required().label("Database URL"),classify:h.O7(),classifyConfirmed:h.O7().when(["url","classify"],{is:(e,a)=>e&&a,then:()=>h.O7().equals([!0])})});var S=()=>{let[e,{isLoading:a}]=(0,v.pR)(),[t,{isLoading:n}]=(0,v.IR)(),[i,{isLoading:o}]=(0,j.Du)(),h=a||n||o,S=(0,r.pmc)(),k=(0,c.useRouter)(),z=(0,m.hz)(),A=(0,u.I0)(),E=async a=>{var t;let s=await e({organization_key:p.Av,generate:{config:{connection_string:a.url},target:b.GC.DB,type:b.j.DATASETS}});if((0,y.D4)(s))return{error:(0,y.e$)(s.error)};let r=(null!==(t=s.data.generate_results)&&void 0!==t?t:[]).filter(w);return r&&r.length>0?{datasets:r}:{error:"Unable to generate a dataset with this connection."}},L=async e=>{let a=await t(e);return(0,y.D4)(a)?{error:(0,y.e$)(a.error)}:{dataset:a.data}},T=async e=>{let{values:a,datasets:t}=e,s=await i({dataset_schemas:t.map(e=>{let{name:a,fides_key:t}=e;return{fides_key:t,name:a}}),schema_config:{organization_key:p.Av,generate:{config:{connection_string:a.url},target:b.GC.DB,type:b.j.DATASETS}}});return(0,y.D4)(s)?{error:(0,y.e$)(s.error)}:{classifyInstances:s.data.classify_instances}},D=async e=>{var a;let t=await E(e);if("error"in t){S((0,g.Vo)(t.error));return}let s=await Promise.all(t.datasets.map(e=>L(e))),r=null!==(a=s.find(e=>"error"in e))&&void 0!==a?a:s[0];if("error"in r){S((0,g.Vo)(r.error));return}if(!e.classify){S((0,g.t5)("Generated ".concat(r.dataset.name," dataset"))),k.push({pathname:l.o5,query:{datasetId:r.dataset.fides_key}});return}let n=await T({values:e,datasets:t.datasets});if("error"in n){S((0,g.Vo)(n.error));return}S((0,g.t5)("Generate and classify are now in progress")),A((0,v.Zl)(r.dataset.fides_key)),k.push("/dataset")};return(0,s.jsx)(d.J9,{initialValues:{...C,classify:z.plus},validationSchema:_,onSubmit:D,validateOnChange:!1,validateOnBlur:!1,children:e=>{let{isSubmitting:a,errors:t,values:n,submitForm:i,resetForm:l,setFieldValue:o}=e;return(0,s.jsxs)(d.l0,{children:[(0,s.jsxs)(r.gCW,{spacing:8,align:"left",children:[(0,s.jsx)(r.xvT,{size:"sm",color:"gray.700",children:"Connect to a database using the connection URL. You may have received this URL from a colleague or your Ethyca developer support engineer."}),(0,s.jsx)(r.xuv,{children:(0,s.jsx)(x.j0,{name:"url",label:"Database URL"})}),z.plus?(0,s.jsx)(x.w8,{name:"classify",label:"Classify dataset",tooltip:"Use Fides Classify to suggest labels based on your data."}):null,(0,s.jsx)(r.xuv,{children:(0,s.jsx)(r.wpx,{type:"primary",htmlType:"submit",loading:a||h,disabled:a||h,"data-testid":"create-dataset-btn",children:"Generate dataset"})})]}),(0,s.jsx)(f.Z,{title:"Generate and classify this dataset",message:"You have chosen to generate and classify this dataset. This process may take several minutes. In the meantime you can continue using Fides. You will receive a notification when the process is complete.",isOpen:void 0!==t.classifyConfirmed,onClose:()=>{l({values:{...n,classifyConfirmed:!1}})},onConfirm:()=>{o("classifyConfirmed",!0),setTimeout(()=>{i()},0)}})]})}})},k=t(66527),z=t(17245),A=t(41207),E=t(39715),L=()=>{let[e]=(0,v.IR)(),[a,t]=(0,n.useState)(!0),[i,o]=(0,n.useState)(!1),[d,u]=(0,n.useState)(!1),h=(0,n.useRef)(null),m=(0,c.useRouter)(),x=(0,r.pmc)(),{errorAlert:f}=(0,z.VY)(),[p,j]=(0,n.useState)(void 0),b=e=>{k.ZP.load(e,{json:!0}),j(void 0)},w=async a=>{let t;return"object"==typeof a&&null!==a&&"dataset"in a&&Array.isArray(a.dataset)?[t]=a.dataset:Array.isArray(a)?[t]=a:t=a,e(t)},C=e=>{x((0,g.t5)("Successfully loaded new dataset YAML")),(0,v.Zl)(e.fides_key),m.push({pathname:l.o5,query:{datasetId:e.fides_key}})},_=async()=>{o(!0);let e=h.current.getValue(),a=k.ZP.load(e,{json:!0}),t=await w(a);(0,y.D4)(t)?x((0,g.Vo)((0,y.e$)(t.error))):"data"in t&&C(t.data),o(!1)};return(0,s.jsxs)(r.kCb,{gap:"97px",children:[(0,s.jsxs)(r.xuv,{w:"75%",children:[(0,s.jsx)(r.xuv,{color:"gray.700",fontSize:"14px",mb:4,children:"Get started creating your first dataset by pasting your dataset yaml below! You may have received this yaml from a colleague or your Ethyca developer support engineer."}),(0,s.jsxs)(r.gCW,{align:"stretch",children:[(0,s.jsx)(r.izJ,{color:"gray.100"}),(0,s.jsx)(A.M,{defaultLanguage:"yaml",height:"calc(100vh - 515px)",onChange:e=>{try{u(!0),b(e),t(!!(!e||""===e.trim()))}catch(e){(0,A.F)(e)?j(e):f("Could not parse the supplied YAML")}},onMount:e=>{h.current=e,h.current.focus()},options:{fontFamily:"Menlo",fontSize:13,minimap:{enabled:!0}},theme:"light"}),(0,s.jsx)(r.izJ,{color:"gray.100"}),(0,s.jsx)(r.wpx,{type:"primary",disabled:a||!!p||i,loading:i,onClick:_,htmlType:"submit",className:"mt-6 w-fit",children:"Create dataset"})]})]}),(0,s.jsx)(r.xuv,{children:d&&(a||p)&&(0,s.jsx)(E.Z,{isEmptyState:a,yamlError:p})})]})},T=()=>{let[e,a]=(0,n.useState)(null);return(0,s.jsxs)(i.Z,{title:"Create New Dataset",children:[(0,s.jsx)(o.Z,{heading:"Datasets",breadcrumbItems:[{title:"All datasets",href:l.$m},{title:"Create new"}]}),(0,s.jsxs)(r.Kqy,{spacing:8,children:[(0,s.jsxs)(r.xuv,{children:[(0,s.jsx)(r.wpx,{onClick:()=>a("yaml"),"data-testid":"upload-yaml-btn",className:"mr-2",children:"Upload a Dataset YAML"}),(0,s.jsx)(r.wpx,{onClick:()=>a("database"),ghost:"database"===e,className:"mr-2","data-testid":"connect-db-btn",children:"Connect to a database"})]}),"database"===e&&(0,s.jsx)(r.xuv,{w:{base:"100%",lg:"50%"},children:(0,s.jsx)(S,{})}),"yaml"===e&&(0,s.jsx)(r.xuv,{w:{base:"100%"},children:(0,s.jsx)(L,{})})]})]})}}},function(e){e.O(0,[431,6527,7245,7476,2888,9774,179],function(){return e(e.s=73846)}),_N_E=e.O()}]);