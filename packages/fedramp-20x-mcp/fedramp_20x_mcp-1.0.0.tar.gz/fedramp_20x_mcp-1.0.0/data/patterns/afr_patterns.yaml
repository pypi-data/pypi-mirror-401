pattern_id: afr.crypto.weak_algorithms
name: Weak or Deprecated Cryptographic Algorithms
description: Detects use of weak cryptographic algorithms (MD5, SHA1, DES, RC4, TLS
  1.0/1.1) that do not meet FedRAMP requirements. KSI-AFR-11 mandates FIPS 140-2/3
  approved algorithms only.
severity: CRITICAL
family: AFR
pattern_type: function_call
ksi_id: KSI-AFR-11
nist_controls: &id001
- sc-13
- sc-17
category: cryptography
languages:
  python:
    ast_queries:
    - node_type: attribute
      pattern: hashlib\.(md5|sha1|md4)
      message: Weak hash algorithm detected - use SHA-256 or stronger
    regex_fallback: (hashlib\.(md5|sha1|md4)|Crypto\.Cipher\.(DES|RC4|ARC4)|ssl\.PROTOCOL_(TLSv1|SSLv[23]))
  csharp:
    ast_queries:
    - node_type: method_call
      pattern: (MD5|SHA1)\.(Create|ComputeHash)
      message: Weak hash algorithm detected - use SHA-256 or stronger
    regex_fallback: (MD5\.(Create|ComputeHash)|SHA1\.(Create|ComputeHash)|DESCryptoServiceProvider|RC2CryptoServiceProvider|TripleDESCryptoServiceProvider)
  java:
    ast_queries:
    - node_type: method_invocation
      pattern: MessageDigest\.getInstance.*["'](MD5|SHA-1|MD4)["']
      message: Weak hash algorithm detected - use SHA-256 or stronger
    regex_fallback: (MessageDigest\.getInstance\(["'](MD5|SHA-1|MD4)["']\)|Cipher\.getInstance\(["'](DES|DESede|RC4)["']\))
  typescript:
    ast_queries:
    - node_type: call_expression
      pattern: crypto\.createHash\(["'](md5|sha1)["']\)
      message: Weak hash algorithm detected - use SHA-256 or stronger
    regex_fallback: (crypto\.createHash\(["'](md5|sha1)["']\)|crypto\.createCipher\(["'](des|rc4)["']\))
  bicep:
    ast_queries:
    - resource_type: Microsoft.Storage/storageAccounts
      property_path: properties.minimumTlsVersion
      conditions:
      - value_in:['TLS1_0', 'TLS1_1']
    - resource_type: Microsoft.Sql/servers
      property_path: properties.minimalTlsVersion
      conditions:
      - value_in:['1.0', '1.1']
    regex_fallback: (minimumTlsVersion['"]?\s*[:=]\s*['"]?(TLS1_0|TLS1_1)|minimalTlsVersion['"]?\s*[:=]\s*['"]?(1\.0|1\.1))
  terraform:
    regex_fallback: (min_tls_version\s*=\s*["'](1\.0|1\.1)["']|tls_version\s*=\s*["'](TLSv1|TLSv1_0|TLSv1_1)["'])
  github_actions:
    regex_fallback: (uses:.*sslscan.*|uses:.*testssl.*)
remediation: "Replace weak cryptographic algorithms with FIPS 140-2/3 approved alternatives:\n\
  \n**Python:**\n```python\nimport hashlib\nfrom cryptography.hazmat.primitives.ciphers\
  \ import Cipher, algorithms, modes\nfrom cryptography.hazmat.backends import default_backend\n\
  \n# Replace MD5/SHA1 with SHA-256 or stronger\nhash_obj = hashlib.sha256(data.encode())\n\
  digest = hash_obj.hexdigest()\n\n# For password hashing, use bcrypt or Argon2\n\
  from bcrypt import hashpw, gensalt\nhashed_password = hashpw(password.encode(),\
  \ gensalt())\n\n# Replace DES/RC4 with AES-256-GCM\ncipher = Cipher(\n    algorithms.AES(key),\n\
  \    modes.GCM(iv),\n    backend=default_backend()\n)\n\n# Configure TLS 1.2+ only\n\
  import ssl\ncontext = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)\ncontext.minimum_version\
  \ = ssl.TLSVersion.TLSv1_2\n```\n\n**C#:**\n```csharp\nusing System.Security.Cryptography;\n\
  \n// Replace MD5/SHA1 with SHA-256 or stronger\nusing (var sha256 = SHA256.Create())\n\
  {\n    byte[] hash = sha256.ComputeHash(data);\n}\n\n// Replace DES with AES-256\n\
  using (var aes = Aes.Create())\n{\n    aes.KeySize = 256;\n    aes.Mode = CipherMode.GCM;\n\
  \    // ... encryption logic\n}\n\n// Configure TLS 1.2+ in .NET\nServicePointManager.SecurityProtocol\
  \ = SecurityProtocolType.Tls12 | SecurityProtocolType.Tls13;\n```\n\n**Bicep (Azure\
  \ Storage):**\n```bicep\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01'\
  \ = {\n  name: storageAccountName\n  properties: {\n    minimumTlsVersion: 'TLS1_2'\
  \  // Require TLS 1.2 minimum\n    supportsHttpsTrafficOnly: true\n    encryption:\
  \ {\n      keySource: 'Microsoft.Storage'\n      services: {\n        blob: {\n\
  \          enabled: true\n          keyType: 'Account'\n        }\n      }\n   \
  \ }\n  }\n}\n```\n\n**Terraform (Azure SQL):**\n```hcl\nresource \"azurerm_mssql_server\"\
  \ \"example\" {\n  name                         = \"example-sqlserver\"\n  minimal_tls_version\
  \          = \"1.2\"  # Enforce TLS 1.2+\n  public_network_access_enabled = false\n\
  }\n```\n\n**References:**\n- NIST FIPS 140-3: https://csrc.nist.gov/publications/detail/fips/140/3/final\n\
  - NIST SP 800-52 Rev 2 (TLS): https://csrc.nist.gov/publications/detail/sp/800-52/rev-2/final\n\
  - NIST SP 800-57 Part 1 (Key Management): https://csrc.nist.gov/publications/detail/sp/800-57-part-1/rev-5/final\n\
  - FedRAMP UCM Guidance: https://www.fedramp.gov/using-cryptographic-modules/\n"
finding:
  title: Weak cryptographic algorithm detected
  description: Code uses weak cryptographic algorithms that do not meet FIPS 140-2/3
    requirements
  recommendation: Replace with FIPS-approved algorithms (SHA-256+, AES-256, TLS 1.2+)
  references:
  - KSI-AFR-11
  - NIST FIPS 140-3
evidence_artifacts:
- artifact_type: logs
  name: AFR operational logs
  source: Azure Monitor - Application/Resource Logs
  frequency: continuous
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: AFR configuration export
  source: Azure Portal or IaC templates
  frequency: weekly
  retention_months: 36
  format: JSON/Bicep/Terraform
- artifact_type: report
  name: AFR compliance validation report
  source: Automated testing pipeline
  frequency: daily
  retention_months: 12
  format: HTML/PDF
evidence_collection:
  azure_monitor_kql:
  - query: 'AppTraces

      | where TimeGenerated > ago(30d)

      | where Message contains "afr"

      | summarize count() by bin(TimeGenerated, 1d), SeverityLevel

      | order by TimeGenerated desc'
    description: Track AFR related operations over last 30 days
    retention_days: 730
  azure_cli:
  - command: az monitor log-analytics query --workspace $WORKSPACE_ID --analytics-query
      "AppTraces | where Message contains 'afr' | take 100"
    description: Query recent AFR events
    output_format: json
  powershell:
  - script: '# Query AFR configuration

      Get-AzAFRResource | Select-Object Name, Location, Properties'
    description: Get AFR resource configuration
automation:
  policy_enforcement:
    description: Azure Policy for AFR compliance enforcement
    implementation: "# Azure Policy definition for AFR\nresource policyDef 'Microsoft.Authorization/policyDefinitions@2021-06-01'\
      \ = {\n  name: 'afr.crypto.weak_algorithms-policy'\n  properties: {\n    policyType:\
      \ 'Custom'\n    mode: 'All'\n    displayName: 'AFR Compliance Policy'\n    description:\
      \ 'Enforces AFR compliance requirements'\n    policyRule: {\n      if: {\n \
      \       // Add specific conditions\n      }\n      then: {\n        effect:\
      \ 'audit'\n      }\n    }\n  }\n}"
    azure_services:
    - Azure Policy
    - Azure Monitor
  continuous_monitoring:
    description: Azure Monitor alerts for AFR violations
    implementation: "resource alert 'Microsoft.Insights/metricAlerts@2018-03-01' =\
      \ {\n  name: 'afr.crypto.weak_algorithms-alert'\n  location: 'global'\n  properties:\
      \ {\n    description: 'Alert on AFR compliance violations'\n    severity: 2\n\
      \    enabled: true\n    evaluationFrequency: 'PT5M'\n    windowSize: 'PT15M'\n\
      \  }\n}"
    azure_services:
    - Azure Monitor
    - Application Insights
  cicd_validation:
    description: CI/CD pipeline validation for AFR
    implementation: "# GitHub Actions\n- name: Validate AFR Compliance\n  run: |\n\
      \    python -m fedramp_20x_mcp.analyzers.generic_analyzer \\\n      --pattern-file\
      \ data/patterns/afr_patterns.yaml \\\n      --code-path ./src\n      \n# Azure\
      \ Pipelines  \n- task: PowerShell@2\n  displayName: 'AFR Compliance Check'\n\
      \  inputs:\n    script: |\n      # Run compliance validation\n      python validate_afr.py"
    azure_services:
    - Azure Pipelines
    - GitHub Actions
implementation:
  prerequisites:
  - Azure subscription with Contributor access
  - Required Azure services provisioned
  - AFR requirements documented and approved
  - Development and testing environment configured
  steps:
  - step: 1
    action: Review AFR FedRAMP requirements
    azure_service: null
    validation: Requirements documented and team trained
  - step: 2
    action: Design AFR implementation architecture
    azure_service: null
    validation: Architecture review completed and approved
  - step: 3
    action: Implement AFR controls in code/IaC
    azure_service: Application code and IaC
    validation: Code review completed, unit tests pass
  - step: 4
    action: Configure Azure services for AFR
    azure_service: Azure Portal
    validation: Services configured per requirements
    bicep_template: templates/bicep/afr/main.bicep
  - step: 5
    action: Set up monitoring and alerting
    azure_service: Azure Monitor
    validation: Alerts configured and tested
  - step: 6
    action: Implement automated compliance checking
    azure_service: Azure Pipelines
    validation: CI/CD pipeline validates compliance
  - step: 7
    action: Document implementation and evidence collection
    azure_service: null
    validation: Documentation complete and reviewed
  validation_queries:
  - az resource list --resource-group $RG --query "[?contains(type, 'AFR')]"
  - az monitor metrics list --resource $RESOURCE_ID
ssp_mapping:
  control_family: AFR - AFR
  control_numbers: *id001
  ssp_sections:
  - section: 'sc-13: Implementation'
    description_template: The system implements AFR controls in accordance with FedRAMP
      20x requirements. AFR Requirements is addressed through a combination of Azure
      native services, application-level controls, and automated monitoring.
    implementation_details: Azure services are configured to enforce AFR compliance
      requirements. Infrastructure-as-code (Bicep/Terraform) ensures consistent deployment.
      Automated compliance checking in CI/CD pipeline validates all deployments against
      AFR requirements.
    evidence_references:
    - AFR configuration exports from Azure Portal
    - Azure Monitor logs showing compliance status
    - CI/CD pipeline validation results
    - Automated compliance scan reports
azure_guidance:
  recommended_services:
  - service: Azure Monitor
    tier: Standard
    purpose: Primary service for AFR compliance
    alternatives:
    - Alternative Azure services or third-party tools
  well_architected_framework:
    pillar: Security
    design_area: AFR implementation
    recommendation_id: SEC-01
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
  cloud_adoption_framework:
    stage: Secure
    guidance: Implement AFR controls as part of secure baseline
    reference_url: https://learn.microsoft.com/azure/cloud-adoption-framework/secure/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-AFR-11
    requirement_name: Using Cryptographic Modules
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant python code sample
    code_sample: '# python code that meets requirements

      # Add specific example'
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant python code
    code_sample: '# python code that violates requirements

      # Add specific example'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts:
  - tests/test_afr_patterns.py::test_afr_crypto_weak_algorithms
tags:
  - cryptography
  - fips
  - security
related_ksis:
  - KSI-AFR-11
---
pattern_id: afr.config.debug_mode
name: Debug Mode Enabled in Production
description: Detects debug mode enabled in production environments. KSI-AFR-07 requires
  secure default configurations - debug mode exposes sensitive information and stack
  traces.
severity: HIGH
family: AFR
pattern_type: configuration
ksi_id: KSI-AFR-07
nist_controls: &id001
- cm-6
- si-11
category: configuration
languages:
  python:
    regex_fallback: (debug\s*=\s*True|DEBUG\s*=\s*True|app\.debug\s*=\s*True)
  csharp:
    regex_fallback: (UseDeveloperExceptionPage|DetailedErrors\s*=\s*true)
  java:
    regex_fallback: (spring\.devtools\.enabled=true|logging\.level\.root\s*=\s*DEBUG)
  typescript:
    regex_fallback: (NODE_ENV\s*===?\s*["']development["']|process\.env\.DEBUG)
  bicep:
    ast_queries:
    - resource_type: Microsoft.Web/sites
      property_path: properties.siteConfig.appSettings
      conditions:
      - array_contains:name=ASPNETCORE_ENVIRONMENT,value=Development
    regex_fallback: (name['"]?\s*[:=]\s*['"]ASPNETCORE_ENVIRONMENT['"].*?value['"]?\s*[:=]\s*['"]Development['"]|ASPNETCORE_ENVIRONMENT.*?Development)
  azure_pipelines:
    regex_fallback: (BuildConfiguration.*Debug|dotnet.*--configuration\s+Debug)
remediation: "Disable debug mode in production environments:\n\n**Python (Flask):**\n\
  ```python\nimport os\n\napp = Flask(__name__)\n\n# Use environment variable, default\
  \ to False\napp.config['DEBUG'] = os.getenv('DEBUG', 'False') == 'True'\n\n# Or\
  \ explicitly set based on environment\nif os.getenv('ENVIRONMENT') == 'production':\n\
  \    app.config['DEBUG'] = False\n```\n\n**Python (Django settings.py):**\n```python\n\
  import os\n\nDEBUG = os.getenv('DEBUG', 'False') == 'True'\n\n# Only allow debug\
  \ in development\nif os.getenv('ENVIRONMENT') == 'production':\n    DEBUG = False\n\
  \    ALLOWED_HOSTS = ['yourdomain.com']\n```\n\n**C# (ASP.NET Core Startup.cs):**\n\
  ```csharp\npublic void Configure(IApplicationBuilder app, IWebHostEnvironment env)\n\
  {\n    if (env.IsDevelopment())\n    {\n        app.UseDeveloperExceptionPage();\n\
  \    }\n    else\n    {\n        app.UseExceptionHandler(\"/Error\");\n        app.UseHsts();\n\
  \    }\n}\n```\n\n**Bicep (App Service):**\n```bicep\nresource appService 'Microsoft.Web/sites@2023-01-01'\
  \ = {\n  name: appServiceName\n  properties: {\n    siteConfig: {\n      appSettings:\
  \ [\n        {\n          name: 'ASPNETCORE_ENVIRONMENT'\n          value: 'Production'\
  \  // Use Production, not Development\n        }\n        {\n          name: 'DEBUG'\n\
  \          value: 'false'\n        }\n      ]\n    }\n  }\n}\n```\n\n**Azure Pipelines:**\n\
  ```yaml\n- task: DotNetCoreCLI@2\n  inputs:\n    command: 'build'\n    arguments:\
  \ '--configuration Release'  # Use Release, not Debug\n```\n\n**References:**\n\
  - OWASP: https://owasp.org/www-community/vulnerabilities/Information_exposure_through_debug_information\n\
  - NIST SC-7: Boundary Protection\n"
finding:
  title: Debug mode enabled in production
  description: Application has debug mode enabled which may expose sensitive information
  recommendation: Disable debug mode in production environments
  references:
  - KSI-AFR-07
  - FRR-RSC-01
evidence_artifacts:
- artifact_type: logs
  name: AFR operational logs
  source: Azure Monitor - Application/Resource Logs
  frequency: continuous
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: AFR configuration export
  source: Azure Portal or IaC templates
  frequency: weekly
  retention_months: 36
  format: JSON/Bicep/Terraform
- artifact_type: report
  name: AFR compliance validation report
  source: Automated testing pipeline
  frequency: daily
  retention_months: 12
  format: HTML/PDF
evidence_collection:
  azure_monitor_kql:
  - query: 'AppTraces

      | where TimeGenerated > ago(30d)

      | where Message contains "afr"

      | summarize count() by bin(TimeGenerated, 1d), SeverityLevel

      | order by TimeGenerated desc'
    description: Track AFR related operations over last 30 days
    retention_days: 730
  azure_cli:
  - command: az monitor log-analytics query --workspace $WORKSPACE_ID --analytics-query
      "AppTraces | where Message contains 'afr' | take 100"
    description: Query recent AFR events
    output_format: json
  powershell:
  - script: '# Query AFR configuration

      Get-AzAFRResource | Select-Object Name, Location, Properties'
    description: Get AFR resource configuration
automation:
  policy_enforcement:
    description: Azure Policy for AFR compliance enforcement
    implementation: "# Azure Policy definition for AFR\nresource policyDef 'Microsoft.Authorization/policyDefinitions@2021-06-01'\
      \ = {\n  name: 'afr.config.debug_mode-policy'\n  properties: {\n    policyType:\
      \ 'Custom'\n    mode: 'All'\n    displayName: 'AFR Compliance Policy'\n    description:\
      \ 'Enforces AFR compliance requirements'\n    policyRule: {\n      if: {\n \
      \       // Add specific conditions\n      }\n      then: {\n        effect:\
      \ 'audit'\n      }\n    }\n  }\n}"
    azure_services:
    - Azure Policy
    - Azure Monitor
  continuous_monitoring:
    description: Azure Monitor alerts for AFR violations
    implementation: "resource alert 'Microsoft.Insights/metricAlerts@2018-03-01' =\
      \ {\n  name: 'afr.config.debug_mode-alert'\n  location: 'global'\n  properties:\
      \ {\n    description: 'Alert on AFR compliance violations'\n    severity: 2\n\
      \    enabled: true\n    evaluationFrequency: 'PT5M'\n    windowSize: 'PT15M'\n\
      \  }\n}"
    azure_services:
    - Azure Monitor
    - Application Insights
  cicd_validation:
    description: CI/CD pipeline validation for AFR
    implementation: "# GitHub Actions\n- name: Validate AFR Compliance\n  run: |\n\
      \    python -m fedramp_20x_mcp.analyzers.generic_analyzer \\\n      --pattern-file\
      \ data/patterns/afr_patterns.yaml \\\n      --code-path ./src\n      \n# Azure\
      \ Pipelines  \n- task: PowerShell@2\n  displayName: 'AFR Compliance Check'\n\
      \  inputs:\n    script: |\n      # Run compliance validation\n      python validate_afr.py"
    azure_services:
    - Azure Pipelines
    - GitHub Actions
implementation:
  prerequisites:
  - Azure subscription with Contributor access
  - Required Azure services provisioned
  - AFR requirements documented and approved
  - Development and testing environment configured
  steps:
  - step: 1
    action: Review AFR FedRAMP requirements
    azure_service: null
    validation: Requirements documented and team trained
  - step: 2
    action: Design AFR implementation architecture
    azure_service: null
    validation: Architecture review completed and approved
  - step: 3
    action: Implement AFR controls in code/IaC
    azure_service: Application code and IaC
    validation: Code review completed, unit tests pass
  - step: 4
    action: Configure Azure services for AFR
    azure_service: Azure Portal
    validation: Services configured per requirements
    bicep_template: templates/bicep/afr/main.bicep
  - step: 5
    action: Set up monitoring and alerting
    azure_service: Azure Monitor
    validation: Alerts configured and tested
  - step: 6
    action: Implement automated compliance checking
    azure_service: Azure Pipelines
    validation: CI/CD pipeline validates compliance
  - step: 7
    action: Document implementation and evidence collection
    azure_service: null
    validation: Documentation complete and reviewed
  validation_queries:
  - az resource list --resource-group $RG --query "[?contains(type, 'AFR')]"
  - az monitor metrics list --resource $RESOURCE_ID
ssp_mapping:
  control_family: AFR - AFR
  control_numbers: *id001
  ssp_sections:
  - section: 'cm-6: Implementation'
    description_template: The system implements AFR controls in accordance with FedRAMP
      20x requirements. AFR Requirements is addressed through a combination of Azure
      native services, application-level controls, and automated monitoring.
    implementation_details: Azure services are configured to enforce AFR compliance
      requirements. Infrastructure-as-code (Bicep/Terraform) ensures consistent deployment.
      Automated compliance checking in CI/CD pipeline validates all deployments against
      AFR requirements.
    evidence_references:
    - AFR configuration exports from Azure Portal
    - Azure Monitor logs showing compliance status
    - CI/CD pipeline validation results
    - Automated compliance scan reports
azure_guidance:
  recommended_services:
  - service: Azure Monitor
    tier: Standard
    purpose: Primary service for AFR compliance
    alternatives:
    - Alternative Azure services or third-party tools
  well_architected_framework:
    pillar: Security
    design_area: AFR implementation
    recommendation_id: SEC-01
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
  cloud_adoption_framework:
    stage: Secure
    guidance: Implement AFR controls as part of secure baseline
    reference_url: https://learn.microsoft.com/azure/cloud-adoption-framework/secure/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-AFR-07
    requirement_name: Recommended Secure Configuration
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant python code sample
    code_sample: '# python code that meets requirements

      # Add specific example'
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant python code
    code_sample: '# python code that violates requirements

      # Add specific example'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts:
  - tests/test_afr_patterns.py::test_afr_config_debug_mode
---
pattern_id: afr.scanning.missing_vulnerability_scan
name: Missing Vulnerability Scanning Configuration
description: Detects missing vulnerability scanning (SAST, dependency scanning, container
  scanning) in CI/CD pipelines. KSI-AFR-04 requires comprehensive vulnerability detection
  per FedRAMP VDR process.
severity: HIGH
family: AFR
pattern_type: pipeline
ksi_id: KSI-AFR-04
nist_controls: &id001
- ra-5
- sa-11
category: vulnerability_detection
languages:
  github_actions:
    regex_fallback: (uses:.*security-scan|uses:.*trivy|uses:.*codeql|uses:.*dependency-review)
  azure_pipelines:
    regex_fallback: (task:\s*WhiteSource|task:\s*CredScan|task:\s*Trivy|task:\s*SecurityCodeScan)
  gitlab_ci:
    regex_fallback: (include:.*Security/SAST|include:.*Security/Dependency-Scanning|include:.*Security/Container-Scanning)
  bicep:
    ast_queries:
    - resource_type: Microsoft.Security/pricings
      property_path: properties.pricingTier
      conditions:
      - value_equals:'Standard'
    regex_fallback: (Microsoft\.Security/pricings.*?pricingTier['"]?\s*[:=]\s*['"]?Standard)
  terraform:
    regex_fallback: (resource\s+"azurerm_security_center_subscription_pricing")
remediation: "Implement comprehensive vulnerability scanning in CI/CD pipelines:\n\
  \n**GitHub Actions (.github/workflows/security.yml):**\n```yaml\nname: Security\
  \ Scanning\n\non: [push, pull_request]\n\njobs:\n  sast:\n    runs-on: ubuntu-latest\n\
  \    steps:\n      - uses: actions/checkout@v4\n      \n      # SAST: CodeQL for\
  \ static analysis\n      - uses: github/codeql-action/init@v3\n        with:\n \
  \         languages: 'python, javascript'\n      - uses: github/codeql-action/analyze@v3\n\
  \      \n      # Dependency scanning\n      - uses: actions/dependency-review-action@v4\n\
  \      \n      # Container scanning with Trivy\n      - uses: aquasecurity/trivy-action@master\n\
  \        with:\n          scan-type: 'fs'\n          scan-ref: '.'\n          format:\
  \ 'sarif'\n          output: 'trivy-results.sarif'\n      \n      # Upload results\
  \ to Security tab\n      - uses: github/codeql-action/upload-sarif@v3\n        with:\n\
  \          sarif_file: 'trivy-results.sarif'\n```\n\n**Azure Pipelines (azure-pipelines.yml):**\n\
  ```yaml\ntrigger:\n  - main\n\njobs:\n- job: SecurityScanning\n  pool:\n    vmImage:\
  \ 'ubuntu-latest'\n  steps:\n    # SAST with Security Code Scan\n    - task: SecurityCodeScan@1\n\
  \      inputs:\n        targetDirectory: '$(Build.SourcesDirectory)'\n    \n   \
  \ # Dependency scanning with WhiteSource Bolt\n    - task: WhiteSource@21\n    \
  \  inputs:\n        cwd: '$(Build.SourcesDirectory)'\n    \n    # Container scanning\
  \ with Trivy\n    - task: CmdLine@2\n      inputs:\n        script: |\n        \
  \  wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key\
  \ add -\n          echo \"deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release\
  \ -sc) main\" | sudo tee -a /etc/apt/sources.list.d/trivy.list\n          sudo apt-get\
  \ update\n          sudo apt-get install trivy\n          trivy fs --severity HIGH,CRITICAL\
  \ .\n```\n\n**Bicep (Enable Microsoft Defender for Cloud):**\n```bicep\n// Enable\
  \ Defender for Servers\nresource defenderServers 'Microsoft.Security/pricings@2024-01-01'\
  \ = {\n  name: 'VirtualMachines'\n  properties: {\n    pricingTier: 'Standard' \
  \ // Enable advanced threat protection\n  }\n}\n\n// Enable Defender for Containers\n\
  resource defenderContainers 'Microsoft.Security/pricings@2024-01-01' = {\n  name:\
  \ 'Containers'\n  properties: {\n    pricingTier: 'Standard'\n  }\n}\n\n// Enable\
  \ Defender for App Service\nresource defenderAppService 'Microsoft.Security/pricings@2024-01-01'\
  \ = {\n  name: 'AppServices'\n  properties: {\n    pricingTier: 'Standard'\n  }\n\
  }\n```\n\n**Terraform (Enable Defender for Cloud):**\n```hcl\n# Enable Defender\
  \ for Servers\nresource \"azurerm_security_center_subscription_pricing\" \"servers\"\
  \ {\n  tier          = \"Standard\"\n  resource_type = \"VirtualMachines\"\n}\n\n\
  # Enable Defender for Containers\nresource \"azurerm_security_center_subscription_pricing\"\
  \ \"containers\" {\n  tier          = \"Standard\"\n  resource_type = \"Containers\"\
  \n}\n\n# Enable Defender for App Service\nresource \"azurerm_security_center_subscription_pricing\"\
  \ \"app_service\" {\n  tier          = \"Standard\"\n  resource_type = \"AppServices\"\
  \n}\n```\n\n**Scanning Frequency:**\n- Daily automated scans (CI/CD integration)\n\
  - Weekly scheduled full scans (GitHub security tab, Azure Security Center)\n- Monthly\
  \ compliance reports\n\n**References:**\n- FedRAMP VDR Process: https://www.fedramp.gov/vulnerability-detection-and-response/\n\
  - NIST SP 800-53 RA-5: https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final\n\
  - Microsoft Defender for Cloud: https://learn.microsoft.com/en-us/azure/defender-for-cloud/\n"
finding:
  title: Missing vulnerability scanning configuration
  description: No vulnerability scanning detected in CI/CD pipeline or IaC
  recommendation: Implement SAST, dependency scanning, and container scanning
  references:
  - KSI-AFR-04
  - FRR-VDR-01
evidence_artifacts:
- artifact_type: logs
  name: AFR operational logs
  source: Azure Monitor - Application/Resource Logs
  frequency: continuous
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: AFR configuration export
  source: Azure Portal or IaC templates
  frequency: weekly
  retention_months: 36
  format: JSON/Bicep/Terraform
- artifact_type: report
  name: AFR compliance validation report
  source: Automated testing pipeline
  frequency: daily
  retention_months: 12
  format: HTML/PDF
evidence_collection:
  azure_monitor_kql:
  - query: 'AppTraces

      | where TimeGenerated > ago(30d)

      | where Message contains "afr"

      | summarize count() by bin(TimeGenerated, 1d), SeverityLevel

      | order by TimeGenerated desc'
    description: Track AFR related operations over last 30 days
    retention_days: 730
  azure_cli:
  - command: az monitor log-analytics query --workspace $WORKSPACE_ID --analytics-query
      "AppTraces | where Message contains 'afr' | take 100"
    description: Query recent AFR events
    output_format: json
  powershell:
  - script: '# Query AFR configuration

      Get-AzAFRResource | Select-Object Name, Location, Properties'
    description: Get AFR resource configuration
automation:
  policy_enforcement:
    description: Azure Policy for AFR compliance enforcement
    implementation: "# Azure Policy definition for AFR\nresource policyDef 'Microsoft.Authorization/policyDefinitions@2021-06-01'\
      \ = {\n  name: 'afr.scanning.missing_vulnerability_scan-policy'\n  properties:\
      \ {\n    policyType: 'Custom'\n    mode: 'All'\n    displayName: 'AFR Compliance\
      \ Policy'\n    description: 'Enforces AFR compliance requirements'\n    policyRule:\
      \ {\n      if: {\n        // Add specific conditions\n      }\n      then: {\n\
      \        effect: 'audit'\n      }\n    }\n  }\n}"
    azure_services:
    - Azure Policy
    - Azure Monitor
  continuous_monitoring:
    description: Azure Monitor alerts for AFR violations
    implementation: "resource alert 'Microsoft.Insights/metricAlerts@2018-03-01' =\
      \ {\n  name: 'afr.scanning.missing_vulnerability_scan-alert'\n  location: 'global'\n\
      \  properties: {\n    description: 'Alert on AFR compliance violations'\n  \
      \  severity: 2\n    enabled: true\n    evaluationFrequency: 'PT5M'\n    windowSize:\
      \ 'PT15M'\n  }\n}"
    azure_services:
    - Azure Monitor
    - Application Insights
  cicd_validation:
    description: CI/CD pipeline validation for AFR
    implementation: "# GitHub Actions\n- name: Validate AFR Compliance\n  run: |\n\
      \    python -m fedramp_20x_mcp.analyzers.generic_analyzer \\\n      --pattern-file\
      \ data/patterns/afr_patterns.yaml \\\n      --code-path ./src\n      \n# Azure\
      \ Pipelines  \n- task: PowerShell@2\n  displayName: 'AFR Compliance Check'\n\
      \  inputs:\n    script: |\n      # Run compliance validation\n      python validate_afr.py"
    azure_services:
    - Azure Pipelines
    - GitHub Actions
implementation:
  prerequisites:
  - Azure subscription with Contributor access
  - Required Azure services provisioned
  - AFR requirements documented and approved
  - Development and testing environment configured
  steps:
  - step: 1
    action: Review AFR FedRAMP requirements
    azure_service: null
    validation: Requirements documented and team trained
  - step: 2
    action: Design AFR implementation architecture
    azure_service: null
    validation: Architecture review completed and approved
  - step: 3
    action: Implement AFR controls in code/IaC
    azure_service: Application code and IaC
    validation: Code review completed, unit tests pass
  - step: 4
    action: Configure Azure services for AFR
    azure_service: Azure Portal
    validation: Services configured per requirements
    bicep_template: templates/bicep/afr/main.bicep
  - step: 5
    action: Set up monitoring and alerting
    azure_service: Azure Monitor
    validation: Alerts configured and tested
  - step: 6
    action: Implement automated compliance checking
    azure_service: Azure Pipelines
    validation: CI/CD pipeline validates compliance
  - step: 7
    action: Document implementation and evidence collection
    azure_service: null
    validation: Documentation complete and reviewed
  validation_queries:
  - az resource list --resource-group $RG --query "[?contains(type, 'AFR')]"
  - az monitor metrics list --resource $RESOURCE_ID
ssp_mapping:
  control_family: AFR - AFR
  control_numbers: *id001
  ssp_sections:
  - section: 'ra-5: Implementation'
    description_template: The system implements AFR controls in accordance with FedRAMP
      20x requirements. AFR Requirements is addressed through a combination of Azure
      native services, application-level controls, and automated monitoring.
    implementation_details: Azure services are configured to enforce AFR compliance
      requirements. Infrastructure-as-code (Bicep/Terraform) ensures consistent deployment.
      Automated compliance checking in CI/CD pipeline validates all deployments against
      AFR requirements.
    evidence_references:
    - AFR configuration exports from Azure Portal
    - Azure Monitor logs showing compliance status
    - CI/CD pipeline validation results
    - Automated compliance scan reports
azure_guidance:
  recommended_services:
  - service: Azure Monitor
    tier: Standard
    purpose: Primary service for AFR compliance
    alternatives:
    - Alternative Azure services or third-party tools
  well_architected_framework:
    pillar: Security
    design_area: AFR implementation
    recommendation_id: SEC-01
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
  cloud_adoption_framework:
    stage: Secure
    guidance: Implement AFR controls as part of secure baseline
    reference_url: https://learn.microsoft.com/azure/cloud-adoption-framework/secure/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-AFR-04
    requirement_name: Vulnerability Detection and Response
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant github_actions code sample
    code_sample: '# github_actions code that meets requirements

      # Add specific example'
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant github_actions code
    code_sample: '# github_actions code that violates requirements

      # Add specific example'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts:
  - tests/test_afr_patterns.py::test_afr_scanning_missing_vulnerability_scan
---
pattern_id: afr.config.insecure_defaults
name: Insecure Default Configurations Detected
description: Detects insecure default configurations such as public network access
  enabled, HTTPS not required, or missing encryption. KSI-AFR-07 requires secure-by-default
  configurations.
severity: HIGH
family: AFR
pattern_type: resource
ksi_id: KSI-AFR-07
nist_controls: &id001
- cm-6
- sc-8
category: configuration
languages:
  bicep:
    ast_queries:
    - resource_type: Microsoft.Storage/storageAccounts
      property_path: properties.supportsHttpsTrafficOnly
      conditions:
      - value_equals:false
      - property_missing
    - resource_type: Microsoft.Sql/servers
      property_path: properties.publicNetworkAccess
      conditions:
      - value_equals:'Enabled'
    - resource_type: Microsoft.KeyVault/vaults
      property_path: properties.enableSoftDelete
      conditions:
      - value_equals:false
      - property_missing
    regex_fallback: (supportsHttpsTrafficOnly['"]?\s*[:=]\s*false|publicNetworkAccess['"]?\s*[:=]\s*['"]?Enabled|enableSoftDelete['"]?\s*[:=]\s*false)
  terraform:
    ast_queries:
    - resource_type: azurerm_storage_account
      property_path: enable_https_traffic_only
      conditions:
      - value_equals:false
      - property_missing
    - resource_type: azurerm_mssql_server
      property_path: public_network_access_enabled
      conditions:
      - value_equals:true
    regex_fallback: (enable_https_traffic_only\s*=\s*false|public_network_access_enabled\s*=\s*true)
remediation: "Configure secure defaults for all Azure resources:\n\n**Bicep (Storage\
  \ Account - Secure Defaults):**\n```bicep\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01'\
  \ = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_GRS'\
  \  // Geo-redundant for DR\n  }\n  kind: 'StorageV2'\n  properties: {\n    // CRITICAL:\
  \ Enforce HTTPS only\n    supportsHttpsTrafficOnly: true\n    \n    // Enforce TLS\
  \ 1.2 minimum\n    minimumTlsVersion: 'TLS1_2'\n    \n    // Disable public blob\
  \ access\n    allowBlobPublicAccess: false\n    \n    // Enable infrastructure encryption\n\
  \    encryption: {\n      keySource: 'Microsoft.Storage'\n      requireInfrastructureEncryption:\
  \ true\n      services: {\n        blob: {\n          enabled: true\n          keyType:\
  \ 'Account'\n        }\n        file: {\n          enabled: true\n          keyType:\
  \ 'Account'\n        }\n      }\n    }\n    \n    // Network restrictions\n    networkAcls:\
  \ {\n      defaultAction: 'Deny'\n      bypass: 'AzureServices'\n    }\n  }\n}\n\
  ```\n\n**Bicep (SQL Server - Secure Defaults):**\n```bicep\nresource sqlServer 'Microsoft.Sql/servers@2023-05-01-preview'\
  \ = {\n  name: sqlServerName\n  location: location\n  properties: {\n    // Disable\
  \ public network access\n    publicNetworkAccess: 'Disabled'\n    \n    // Enforce\
  \ TLS 1.2+\n    minimalTlsVersion: '1.2'\n    \n    // Use Azure AD authentication\n\
  \    administrators: {\n      azureADOnlyAuthentication: true\n      principalType:\
  \ 'Group'\n      login: 'SQL Administrators'\n      sid: sqlAdminGroupObjectId\n\
  \    }\n  }\n}\n```\n\n**Bicep (Key Vault - Secure Defaults):**\n```bicep\nresource\
  \ keyVault 'Microsoft.KeyVault/vaults@2023-07-01' = {\n  name: keyVaultName\n  location:\
  \ location\n  properties: {\n    // Enable soft delete (required for production)\n\
  \    enableSoftDelete: true\n    softDeleteRetentionInDays: 90\n    \n    // Enable\
  \ purge protection\n    enablePurgeProtection: true\n    \n    // Disable public\
  \ network access\n    publicNetworkAccess: 'Disabled'\n    \n    // Enable RBAC\n\
  \    enableRbacAuthorization: true\n    \n    // Network restrictions\n    networkAcls:\
  \ {\n      defaultAction: 'Deny'\n      bypass: 'AzureServices'\n    }\n  }\n}\n\
  ```\n\n**Terraform (Storage Account - Secure Defaults):**\n```hcl\nresource \"azurerm_storage_account\"\
  \ \"example\" {\n  name                      = \"examplestorageacct\"\n  resource_group_name\
  \       = azurerm_resource_group.example.name\n  location                  = azurerm_resource_group.example.location\n\
  \  account_tier              = \"Standard\"\n  account_replication_type  = \"GRS\"\
  \  # Geo-redundant\n  \n  # CRITICAL: Enforce HTTPS only\n  enable_https_traffic_only\
  \ = true\n  \n  # Enforce TLS 1.2 minimum\n  min_tls_version = \"TLS1_2\"\n  \n\
  \  # Disable public blob access\n  allow_nested_items_to_be_public = false\n  \n\
  \  # Enable infrastructure encryption\n  infrastructure_encryption_enabled = true\n\
  \  \n  # Network restrictions\n  network_rules {\n    default_action = \"Deny\"\n\
  \    bypass         = [\"AzureServices\"]\n  }\n}\n```\n\n**References:**\n- Azure\
  \ Security Baseline: https://learn.microsoft.com/en-us/security/benchmark/azure/\n\
  - CIS Azure Foundations Benchmark: https://www.cisecurity.org/benchmark/azure\n\
  - NIST SC-7: Boundary Protection\n"
finding:
  title: Insecure default configuration detected
  description: Resource configured with insecure defaults (public access, HTTP allowed,
    etc.)
  recommendation: Enable secure defaults per Azure Security Baseline
  references:
  - KSI-AFR-07
  - FRR-RSC-01
evidence_artifacts:
- artifact_type: logs
  name: AFR operational logs
  source: Azure Monitor - Application/Resource Logs
  frequency: continuous
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: AFR configuration export
  source: Azure Portal or IaC templates
  frequency: weekly
  retention_months: 36
  format: JSON/Bicep/Terraform
- artifact_type: report
  name: AFR compliance validation report
  source: Automated testing pipeline
  frequency: daily
  retention_months: 12
  format: HTML/PDF
evidence_collection:
  azure_monitor_kql:
  - query: 'AppTraces

      | where TimeGenerated > ago(30d)

      | where Message contains "afr"

      | summarize count() by bin(TimeGenerated, 1d), SeverityLevel

      | order by TimeGenerated desc'
    description: Track AFR related operations over last 30 days
    retention_days: 730
  azure_cli:
  - command: az monitor log-analytics query --workspace $WORKSPACE_ID --analytics-query
      "AppTraces | where Message contains 'afr' | take 100"
    description: Query recent AFR events
    output_format: json
  powershell:
  - script: '# Query AFR configuration

      Get-AzAFRResource | Select-Object Name, Location, Properties'
    description: Get AFR resource configuration
automation:
  policy_enforcement:
    description: Azure Policy for AFR compliance enforcement
    implementation: "# Azure Policy definition for AFR\nresource policyDef 'Microsoft.Authorization/policyDefinitions@2021-06-01'\
      \ = {\n  name: 'afr.config.insecure_defaults-policy'\n  properties: {\n    policyType:\
      \ 'Custom'\n    mode: 'All'\n    displayName: 'AFR Compliance Policy'\n    description:\
      \ 'Enforces AFR compliance requirements'\n    policyRule: {\n      if: {\n \
      \       // Add specific conditions\n      }\n      then: {\n        effect:\
      \ 'audit'\n      }\n    }\n  }\n}"
    azure_services:
    - Azure Policy
    - Azure Monitor
  continuous_monitoring:
    description: Azure Monitor alerts for AFR violations
    implementation: "resource alert 'Microsoft.Insights/metricAlerts@2018-03-01' =\
      \ {\n  name: 'afr.config.insecure_defaults-alert'\n  location: 'global'\n  properties:\
      \ {\n    description: 'Alert on AFR compliance violations'\n    severity: 2\n\
      \    enabled: true\n    evaluationFrequency: 'PT5M'\n    windowSize: 'PT15M'\n\
      \  }\n}"
    azure_services:
    - Azure Monitor
    - Application Insights
  cicd_validation:
    description: CI/CD pipeline validation for AFR
    implementation: "# GitHub Actions\n- name: Validate AFR Compliance\n  run: |\n\
      \    python -m fedramp_20x_mcp.analyzers.generic_analyzer \\\n      --pattern-file\
      \ data/patterns/afr_patterns.yaml \\\n      --code-path ./src\n      \n# Azure\
      \ Pipelines  \n- task: PowerShell@2\n  displayName: 'AFR Compliance Check'\n\
      \  inputs:\n    script: |\n      # Run compliance validation\n      python validate_afr.py"
    azure_services:
    - Azure Pipelines
    - GitHub Actions
implementation:
  prerequisites:
  - Azure subscription with Contributor access
  - Required Azure services provisioned
  - AFR requirements documented and approved
  - Development and testing environment configured
  steps:
  - step: 1
    action: Review AFR FedRAMP requirements
    azure_service: null
    validation: Requirements documented and team trained
  - step: 2
    action: Design AFR implementation architecture
    azure_service: null
    validation: Architecture review completed and approved
  - step: 3
    action: Implement AFR controls in code/IaC
    azure_service: Application code and IaC
    validation: Code review completed, unit tests pass
  - step: 4
    action: Configure Azure services for AFR
    azure_service: Azure Portal
    validation: Services configured per requirements
    bicep_template: templates/bicep/afr/main.bicep
  - step: 5
    action: Set up monitoring and alerting
    azure_service: Azure Monitor
    validation: Alerts configured and tested
  - step: 6
    action: Implement automated compliance checking
    azure_service: Azure Pipelines
    validation: CI/CD pipeline validates compliance
  - step: 7
    action: Document implementation and evidence collection
    azure_service: null
    validation: Documentation complete and reviewed
  validation_queries:
  - az resource list --resource-group $RG --query "[?contains(type, 'AFR')]"
  - az monitor metrics list --resource $RESOURCE_ID
ssp_mapping:
  control_family: AFR - AFR
  control_numbers: *id001
  ssp_sections:
  - section: 'cm-6: Implementation'
    description_template: The system implements AFR controls in accordance with FedRAMP
      20x requirements. AFR Requirements is addressed through a combination of Azure
      native services, application-level controls, and automated monitoring.
    implementation_details: Azure services are configured to enforce AFR compliance
      requirements. Infrastructure-as-code (Bicep/Terraform) ensures consistent deployment.
      Automated compliance checking in CI/CD pipeline validates all deployments against
      AFR requirements.
    evidence_references:
    - AFR configuration exports from Azure Portal
    - Azure Monitor logs showing compliance status
    - CI/CD pipeline validation results
    - Automated compliance scan reports
azure_guidance:
  recommended_services:
  - service: Azure Monitor
    tier: Standard
    purpose: Primary service for AFR compliance
    alternatives:
    - Alternative Azure services or third-party tools
  well_architected_framework:
    pillar: Security
    design_area: AFR implementation
    recommendation_id: SEC-01
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
  cloud_adoption_framework:
    stage: Secure
    guidance: Implement AFR controls as part of secure baseline
    reference_url: https://learn.microsoft.com/azure/cloud-adoption-framework/secure/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-AFR-07
    requirement_name: Recommended Secure Configuration
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant bicep code sample
    code_sample: '# bicep code that meets requirements

      # Add specific example'
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant bicep code
    code_sample: '# bicep code that violates requirements

      # Add specific example'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts:
  - tests/test_afr_patterns.py::test_afr_config_insecure_defaults
---
pattern_id: afr.compliance.ksi_afr_01
name: Minimum Assessment Scope Detection
description: Detects compliance indicators for KSI-AFR-01 - Minimum Assessment Scope
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Minimum Assessment Scope compliance check
  description_template: Configuration may not fully implement KSI-AFR-01 - Minimum Assessment Scope
  remediation_template: Review and implement KSI-AFR-01 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-01
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-01
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-01 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-01 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-01 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-01 compliance
      # GitHub Actions
      - name: KSI-AFR-01 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_01 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-01 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-01 compliance
            python validate.py --pattern afr.compliance.ksi_afr_01
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-01
    implementation: |
      # Azure Monitor for KSI-AFR-01 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-01"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_02
name: Key Security Indicators Detection
description: Detects compliance indicators for KSI-AFR-02 - Key Security Indicators
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Key Security Indicators compliance check
  description_template: Configuration may not fully implement KSI-AFR-02 - Key Security Indicators
  remediation_template: Review and implement KSI-AFR-02 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-02
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-02
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-02 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-02 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-02 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-02 compliance
      # GitHub Actions
      - name: KSI-AFR-02 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_02 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-02 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-02 compliance
            python validate.py --pattern afr.compliance.ksi_afr_02
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-02
    implementation: |
      # Azure Monitor for KSI-AFR-02 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-02"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_03
name: Authorization Data Sharing Detection
description: Detects compliance indicators for KSI-AFR-03 - Authorization Data Sharing
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Authorization Data Sharing compliance check
  description_template: Configuration may not fully implement KSI-AFR-03 - Authorization Data Sharing
  remediation_template: Review and implement KSI-AFR-03 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-03
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-03
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-03 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-03 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-03 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-03 compliance
      # GitHub Actions
      - name: KSI-AFR-03 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_03 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-03 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-03 compliance
            python validate.py --pattern afr.compliance.ksi_afr_03
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-03
    implementation: |
      # Azure Monitor for KSI-AFR-03 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-03"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_04
name: Vulnerability Detection and Response Detection
description: Detects compliance indicators for KSI-AFR-04 - Vulnerability Detection and Response
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Vulnerability Detection and Response compliance check
  description_template: Configuration may not fully implement KSI-AFR-04 - Vulnerability Detection and Response
  remediation_template: Review and implement KSI-AFR-04 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-04
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-04
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-04 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-04 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-04 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-04 compliance
      # GitHub Actions
      - name: KSI-AFR-04 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_04 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-04 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-04 compliance
            python validate.py --pattern afr.compliance.ksi_afr_04
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-04
    implementation: |
      # Azure Monitor for KSI-AFR-04 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-04"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_05
name: Significant Change Notifications Detection
description: Detects compliance indicators for KSI-AFR-05 - Significant Change Notifications
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Significant Change Notifications compliance check
  description_template: Configuration may not fully implement KSI-AFR-05 - Significant Change Notifications
  remediation_template: Review and implement KSI-AFR-05 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-05
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-05
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-05 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-05 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-05 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-05 compliance
      # GitHub Actions
      - name: KSI-AFR-05 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_05 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-05 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-05 compliance
            python validate.py --pattern afr.compliance.ksi_afr_05
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-05
    implementation: |
      # Azure Monitor for KSI-AFR-05 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-05"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_06
name: Collaborative Continuous Monitoring Detection
description: Detects compliance indicators for KSI-AFR-06 - Collaborative Continuous Monitoring
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Collaborative Continuous Monitoring compliance check
  description_template: Configuration may not fully implement KSI-AFR-06 - Collaborative Continuous Monitoring
  remediation_template: Review and implement KSI-AFR-06 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-06
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-06
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-06 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-06 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-06 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-06 compliance
      # GitHub Actions
      - name: KSI-AFR-06 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_06 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-06 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-06 compliance
            python validate.py --pattern afr.compliance.ksi_afr_06
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-06
    implementation: |
      # Azure Monitor for KSI-AFR-06 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-06"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_07
name: Recommended Secure Configuration Detection
description: Detects compliance indicators for KSI-AFR-07 - Recommended Secure Configuration
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Recommended Secure Configuration compliance check
  description_template: Configuration may not fully implement KSI-AFR-07 - Recommended Secure Configuration
  remediation_template: Review and implement KSI-AFR-07 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-07
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-07
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-07 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-07 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-07 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-07 compliance
      # GitHub Actions
      - name: KSI-AFR-07 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_07 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-07 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-07 compliance
            python validate.py --pattern afr.compliance.ksi_afr_07
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-07
    implementation: |
      # Azure Monitor for KSI-AFR-07 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-07"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_08
name: FedRAMP Security Inbox Detection
description: Detects compliance indicators for KSI-AFR-08 - FedRAMP Security Inbox
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: FedRAMP Security Inbox compliance check
  description_template: Configuration may not fully implement KSI-AFR-08 - FedRAMP Security Inbox
  remediation_template: Review and implement KSI-AFR-08 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-08
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-08
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-08 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-08 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-08 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-08 compliance
      # GitHub Actions
      - name: KSI-AFR-08 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_08 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-08 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-08 compliance
            python validate.py --pattern afr.compliance.ksi_afr_08
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-08
    implementation: |
      # Azure Monitor for KSI-AFR-08 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-08"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_09
name: Persistent Validation and Assessment Detection
description: Detects compliance indicators for KSI-AFR-09 - Persistent Validation and Assessment
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Persistent Validation and Assessment compliance check
  description_template: Configuration may not fully implement KSI-AFR-09 - Persistent Validation and Assessment
  remediation_template: Review and implement KSI-AFR-09 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-09
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-09
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-09 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-09 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-09 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-09 compliance
      # GitHub Actions
      - name: KSI-AFR-09 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_09 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-09 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-09 compliance
            python validate.py --pattern afr.compliance.ksi_afr_09
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-09
    implementation: |
      # Azure Monitor for KSI-AFR-09 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-09"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_10
name: Incident Communications Procedures Detection
description: Detects compliance indicators for KSI-AFR-10 - Incident Communications Procedures
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Incident Communications Procedures compliance check
  description_template: Configuration may not fully implement KSI-AFR-10 - Incident Communications Procedures
  remediation_template: Review and implement KSI-AFR-10 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-10
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-10
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-10 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-10 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-10 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-10 compliance
      # GitHub Actions
      - name: KSI-AFR-10 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_10 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-10 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-10 compliance
            python validate.py --pattern afr.compliance.ksi_afr_10
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-10
    implementation: |
      # Azure Monitor for KSI-AFR-10 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-10"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.compliance.ksi_afr_11
name: Using Cryptographic Modules Detection
description: Detects compliance indicators for KSI-AFR-11 - Using Cryptographic Modules
family: AFR
severity: MEDIUM
pattern_type: configuration
languages:
  bicep:
    regex_fallback: ".*"
  terraform:
    regex_fallback: ".*"
finding:
  title_template: Using Cryptographic Modules compliance check
  description_template: Configuration may not fully implement KSI-AFR-11 - Using Cryptographic Modules
  remediation_template: Review and implement KSI-AFR-11 requirements per FedRAMP 20x guidance
  evidence_collection:
  - Configuration exports from Azure resources
  - Policy compliance reports
  - Automated scanning results
  azure_services:
  - Azure Policy
  - Microsoft Defender for Cloud
tags:
- afr
- compliance
- ksi-afr-11
nist_controls:
- fedramp-20x
related_ksis:
- KSI-AFR-11
evidence_artifacts:
- artifact_type: configuration
  name: KSI-AFR-11 compliance configuration
  source: Azure Resource Graph
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: report
  name: KSI-AFR-11 compliance report
  source: Microsoft Defender for Cloud
  frequency: weekly
  retention_months: 36
  format: JSON
automation:
  automation_1:
    description: Azure Policy for KSI-AFR-11 compliance enforcement
    implementation: |
      # Azure Policy for KSI-AFR-11 compliance
      # GitHub Actions
      - name: KSI-AFR-11 Compliance Check
        run: |
          python -m fedramp_20x_mcp.analyzers.generic_analyzer \
            --pattern afr.compliance.ksi_afr_11 \
            --code-path ./src
      
      # Azure Pipelines
      - task: PowerShell@2
        displayName: 'KSI-AFR-11 Validation'
        inputs:
          script: |
            # Validate KSI-AFR-11 compliance
            python validate.py --pattern afr.compliance.ksi_afr_11
    azure_services:
    - Azure Policy
    - Azure Monitor
    - Microsoft Defender for Cloud
  automation_2:
    description: Continuous monitoring for KSI-AFR-11
    implementation: |
      # Azure Monitor for KSI-AFR-11 continuous monitoring
      # Log Analytics Query
      AzureActivity
      | where CategoryValue == "Policy"
      | where OperationNameValue contains "KSI-AFR-11"
      | project TimeGenerated, ResourceId, OperationName, ActivityStatusValue
    azure_services:
    - Azure Monitor
    - Log Analytics
impact_levels: ['Low', 'Moderate']
---
pattern_id: afr.security_goals.no_validation
name: No Automated Security Goals Validation
description: Detects lack of automated monitoring/validation of security goals (AFR-02 violation)
family: AFR
severity: HIGH
pattern_type: code_smell
languages:
  python:
    regex_fallback: "(?i)(no.*automat.*monitor|manual.*track.*only|no.*alert|no.*progress.*dashboard|security.*goal.*exist.*no.*validation)"
  csharp:
    regex_fallback: "(?i)(no.*automat.*monitor|manual.*track.*only|no.*alert|no.*progress.*dashboard|security.*goal.*exist.*no.*validation)"
  java:
    regex_fallback: "(?i)(no.*automat.*monitor|manual.*track.*only|no.*alert|no.*progress.*dashboard|security.*goal.*exist.*no.*validation)"
  typescript:
    regex_fallback: "(?i)(no.*automat.*monitor|manual.*track.*only|no.*alert|no.*progress.*dashboard|security.*goal.*exist.*no.*validation)"
  yaml:
    regex_fallback: "(?i)(no.*automat.*monitor|manual.*track.*only|no.*alert|no.*dashboard)"
finding:
  title: Missing Automated Security Goals Validation
  description: Code lacks automated monitoring and validation mechanisms for security goals. FedRAMP requires automated tracking and alerting.
  recommendation: Implement automated monitoring dashboards and alerting for security goal progress validation.
tags:
  - authorization
  - monitoring
  - automation
related_ksis:
  - KSI-AFR-02

---
pattern_id: afr.data_sharing.no_process
name: No Authorization Data Sharing Process
description: Detects lack of authorization data sharing infrastructure/process (AFR-03 violation)
family: AFR
severity: HIGH
pattern_type: code_smell
languages:
  python:
    regex_fallback: "(?i)(no.*data.*shar.*mechanism|no.*trust.*center|no.*document.*process|no.*version|no.*access.*control)"
  csharp:
    regex_fallback: "(?i)(no.*data.*shar.*mechanism|no.*trust.*center|no.*document.*process|no.*version|no.*access.*control)"
  java:
    regex_fallback: "(?i)(no.*data.*shar.*mechanism|no.*trust.*center|no.*document.*process|no.*version|no.*access.*control)"
  typescript:
    regex_fallback: "(?i)(no.*data.*shar.*mechanism|no.*trust.*center|no.*document.*process|no.*version|no.*access.*control)"
  yaml:
    regex_fallback: "(?i)(no.*data.*shar|no.*trust.*center|no.*process)"
finding:
  title: Missing Authorization Data Sharing Process
  description: Code lacks documented authorization data sharing mechanism. FedRAMP requires versioned, controlled data sharing process.
  recommendation: Implement Azure Storage with versioning and access controls for FedRAMP authorization data sharing.
tags:
  - authorization
  - data-sharing
  - documentation
related_ksis:
  - KSI-AFR-03

---
pattern_id: afr.vulnerability.no_scanning
name: No Vulnerability Detection
description: Detects lack of vulnerability scanning and response process (AFR-04 violation)
family: AFR
severity: CRITICAL
pattern_type: code_smell
languages:
  python:
    regex_fallback: "(?i)(no.*vulnerab.*detect|no.*scan.*tool|no.*automat.*alert|no.*response.*process|no.*documentation)"
  csharp:
    regex_fallback: "(?i)(no.*vulnerab.*detect|no.*scan.*tool|no.*automat.*alert|no.*response.*process|no.*documentation)"
  java:
    regex_fallback: "(?i)(no.*vulnerab.*detect|no.*scan.*tool|no.*automat.*alert|no.*response.*process|no.*documentation)"
  typescript:
    regex_fallback: "(?i)(no.*vulnerab.*detect|no.*scan.*tool|no.*automat.*alert|no.*response.*process|no.*documentation)"
  yaml:
    regex_fallback: "(?i)(no.*scan|no.*vulnerab.*detect|no.*alert)"
finding:
  title: Missing Vulnerability Detection and Response
  description: Code lacks vulnerability scanning infrastructure and automated response. FedRAMP requires continuous vulnerability detection.
  recommendation: Implement Azure Security Center vulnerability scanning with automated alerting and response workflows.
tags:
  - vulnerability
  - scanning
  - security
related_ksis:
  - KSI-AFR-04

---
pattern_id: afr.change_tracking.no_notification
name: No Change Tracking and Notification
description: Detects lack of significant change tracking and FedRAMP notification (AFR-05 violation)
family: AFR
severity: HIGH
pattern_type: code_smell
languages:
  python:
    regex_fallback: "(?i)(no.*change.*notif.*process|change.*without.*track|no.*notif.*fedramp|no.*documentation|no.*approval.*workflow)"
  csharp:
    regex_fallback: "(?i)(no.*change.*notif.*process|change.*without.*track|no.*notif.*fedramp|no.*documentation|no.*approval.*workflow)"
  java:
    regex_fallback: "(?i)(no.*change.*notif.*process|change.*without.*track|no.*notif.*fedramp|no.*documentation|no.*approval.*workflow)"
  typescript:
    regex_fallback: "(?i)(no.*change.*notif.*process|change.*without.*track|no.*notif.*fedramp|no.*documentation|no.*approval.*workflow)"
  yaml:
    regex_fallback: "(?i)(no.*change.*track|no.*notif|no.*approval)"
finding:
  title: Missing Change Tracking and Notification
  description: Code lacks change tracking and FedRAMP notification process. Significant changes must be tracked and reported.
  recommendation: Implement Azure Monitor activity log alerts with action groups for FedRAMP PMO notifications on significant changes.
tags:
  - change-management
  - notification
  - compliance
related_ksis:
  - KSI-AFR-05

---
pattern_id: afr.ongoing_auth.no_reporting
name: No Ongoing Authorization Reporting
description: Detects lack of quarterly FedRAMP ongoing authorization reports (AFR-06 violation)
family: AFR
severity: HIGH
pattern_type: code_smell
languages:
  python:
    regex_fallback: "(?i)(no.*quarterly.*report|no.*automat.*report|no.*ccm.*process|missing.*required.*documentation)"
  csharp:
    regex_fallback: "(?i)(no.*quarterly.*report|no.*automat.*report|no.*ccm.*process|missing.*required.*documentation)"
  java:
    regex_fallback: "(?i)(no.*quarterly.*report|no.*automat.*report|no.*ccm.*process|missing.*required.*documentation)"
  typescript:
    regex_fallback: "(?i)(no.*quarterly.*report|no.*automat.*report|no.*ccm.*process|missing.*required.*documentation)"
  yaml:
    regex_fallback: "(?i)(no.*quarterly|no.*report|no.*automat.*report)"
finding:
  title: Missing Ongoing Authorization Reporting
  description: Code lacks automated quarterly reporting infrastructure. FedRAMP requires ongoing authorization reports via CCM process.
  recommendation: Implement Azure Automation schedules for quarterly report generation and submission to FedRAMP.
tags:
  - authorization
  - reporting
  - compliance
related_ksis:
  - KSI-AFR-06

---
pattern_id: afr.secure_inbox.missing
name: No Secure Inbox for FedRAMP Communications
description: Detects lack of secure inbox for critical FedRAMP communications (AFR-08 violation)
family: AFR
severity: HIGH
pattern_type: code_smell
languages:
  python:
    regex_fallback: "(?i)(no.*secure.*inbox|using.*regular.*email|no.*encrypt|no.*monitor|no.*document.*process)"
  csharp:
    regex_fallback: "(?i)(no.*secure.*inbox|using.*regular.*email|no.*encrypt|no.*monitor|no.*document.*process)"
  java:
    regex_fallback: "(?i)(no.*secure.*inbox|using.*regular.*email|no.*encrypt|no.*monitor|no.*document.*process)"
  typescript:
    regex_fallback: "(?i)(no.*secure.*inbox|using.*regular.*email|no.*encrypt|no.*monitor|no.*document.*process)"
  yaml:
    regex_fallback: "(?i)(no.*secure.*inbox|regular.*email|no.*encrypt)"
finding:
  title: Missing Secure Inbox for FedRAMP Communications
  description: Code lacks secure inbox infrastructure for critical FedRAMP communications. Using regular email is non-compliant.
  recommendation: Implement Azure Storage Queue or secure messaging with encryption and monitoring for FedRAMP communications.
tags:
  - communication
  - encryption
  - security
related_ksis:
  - KSI-AFR-08

---
pattern_id: afr.continuous_validation.missing
name: No Persistent Validation and Assessment
description: Detects lack of continuous validation and assessment automation (AFR-09 violation)
family: AFR
severity: HIGH
pattern_type: code_smell
languages:
  python:
    regex_fallback: "(?i)(no.*persist.*valid|manual.*assess.*only|no.*automat|no.*continuous.*monitor|no.*report)"
  csharp:
    regex_fallback: "(?i)(no.*persist.*valid|manual.*assess.*only|no.*automat|no.*continuous.*monitor|no.*report)"
  java:
    regex_fallback: "(?i)(no.*persist.*valid|manual.*assess.*only|no.*automat|no.*continuous.*monitor|no.*report)"
  typescript:
    regex_fallback: "(?i)(no.*persist.*valid|manual.*assess.*only|no.*automat|no.*continuous.*monitor|no.*report)"
  yaml:
    regex_fallback: "(?i)(no.*continuous|no.*persist.*valid|manual.*only)"
finding:
  title: Missing Persistent Validation and Assessment
  description: Code lacks continuous validation infrastructure. FedRAMP requires persistent automated assessment of security controls.
  recommendation: Implement Azure Policy assignments with continuous compliance assessment and automated reporting.
tags:
  - validation
  - assessment
  - automation
related_ksis:
  - KSI-AFR-09

---
pattern_id: afr.incident_comms.no_integration
name: No FedRAMP Incident Communications Integration
description: Detects lack of FedRAMP ICP integration for incident communications (AFR-10 violation)
family: AFR
severity: HIGH
pattern_type: code_smell
languages:
  python:
    regex_fallback: "(?i)(no.*fedramp.*icp.*integrat|internal.*incident.*only|no.*fedramp.*notif|no.*document.*integrat)"
  csharp:
    regex_fallback: "(?i)(no.*fedramp.*icp.*integrat|internal.*incident.*only|no.*fedramp.*notif|no.*document.*integrat)"
  java:
    regex_fallback: "(?i)(no.*fedramp.*icp.*integrat|internal.*incident.*only|no.*fedramp.*notif|no.*document.*integrat)"
  typescript:
    regex_fallback: "(?i)(no.*fedramp.*icp.*integrat|internal.*incident.*only|no.*fedramp.*notif|no.*document.*integrat)"
  yaml:
    regex_fallback: "(?i)(no.*fedramp.*icp|internal.*only|no.*integrat)"
finding:
  title: Missing FedRAMP Incident Communications Integration
  description: Code lacks integration with FedRAMP Incident Communications Procedures. Internal-only incident response is non-compliant.
  recommendation: Implement Azure Monitor action groups with FedRAMP PMO email receivers and webhook integration for incident notifications.
tags:
  - incident-response
  - communication
  - integration
related_ksis:
  - KSI-AFR-10
