pattern_id: piy.inventory.automated_discovery
name: Automated Resource Inventory
description: Detects automated resource inventory using Azure Resource Graph or similar tools
family: PIY
severity: INFO
pattern_type: resource
languages:
  terraform:
    ast_queries:
    - resource_type: azurerm_log_analytics_query_pack_query
      conditions:
      - property_contains:body:Resources
    - resource_type: azurerm_resource_group_policy_assignment
    regex_fallback: azurerm_log_analytics_query_pack_query|Resources\s*\|
    positive_indicators:
    - azurerm_log_analytics_query_pack_query
    - "Resources |"
    - resource inventory
  bicep:
    ast_queries:
    - resource_type: Microsoft.OperationalInsights/queryPacks/queries
    regex_fallback: Microsoft\.OperationalInsights/queryPacks
    positive_indicators:
    - queryPacks/queries
  python:
    ast_queries:
    - query_type: import_statement
      target: azure.mgmt.resourcegraph
    regex_fallback: from\s+azure\.mgmt\.resourcegraph|import\s+azure\.mgmt\.resourcegraph
    positive_indicators:
    - azure.mgmt.resourcegraph
    - ResourceGraphClient
  csharp:
    ast_queries:
    - query_type: import_statement
      target: ResourceGraph
    - query_type: class_definition
      target: ResourceGraphClient
    regex_fallback: "(?i)(Azure\\.ResourceManager\\.ResourceGraph|ResourceGraphClient|using.*ResourceGraph)"
    positive_indicators:
    - ResourceGraphClient
  java:
    ast_queries:
    - query_type: import_statement
      target: resourcegraph
    - query_type: class_definition
      target: ResourceGraphClient
    regex_fallback: "(?i)(azure\\.resourcemanager\\.resourcegraph|ResourceGraphClient|import.*resourcegraph)"
    positive_indicators:
    - ResourceGraphClient
  typescript:
    ast_queries:
    - query_type: import_statement
      target: resourcegraph
    - query_type: class_definition
      target: ResourceGraphClient
    regex_fallback: "(?i)(@azure/arm-resourcegraph|ResourceGraphClient|import.*resourcegraph)"
    positive_indicators:
    - ResourceGraphClient
finding:
  title_template: Automated resource inventory detected
  description_template: Code implements automated resource inventory using Azure Resource Graph or similar authoritative sources, compliant with KSI-PIY-01.
  remediation_template: N/A - Positive finding
tags:
- inventory
- automation
- positive
nist_controls:
- cm-8
related_ksis:
- KSI-PIY-01
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-01
    requirement_name: Automated Inventory
    impact_levels:
    - Low
    - Moderate
    - High
evidence_collection:
  azure_monitor_kql:
  - query: 'Resources
      | where type !~ "microsoft.resources/deployments"
      | summarize ResourceCount=count() by type, location
      | order by ResourceCount desc
      '
    description: Query all resources for inventory tracking
    retention_days: 90
    schedule: daily
---
pattern_id: piy.inventory.manual_tracking
name: Manual Inventory Tracking
description: Detects manual inventory tracking instead of automated discovery from authoritative sources
family: PIY
severity: MEDIUM
pattern_type: code_pattern
languages:
  python:
    ast_queries:
    - query_type: function_definition
      target: manual_inventory|inventory_check
      conditions:
      - contains:inventory_list
      - not_contains:azure.mgmt.resourcegraph
    regex_fallback: def\s+(manual_inventory|inventory_check).*:\s*.*inventory_list\s*=\s*\[
    negative_indicators:
    - manual_inventory
    - inventory_list =
  csharp:
    ast_queries:
    - query_type: function_definition
      target: ManualInventory
    - query_type: assignment
      target: inventoryList
    regex_fallback: "(?i)(ManualInventory|inventory.*=.*new List|inventoryList.*=.*new)"
    negative_indicators:
    - ManualInventory
    - inventoryList
  java:
    ast_queries:
    - query_type: function_definition
      target: manualInventory
    - query_type: assignment
      target: inventoryList
    regex_fallback: "(?i)(manualInventory|inventory.*=.*new ArrayList|inventoryList.*=.*new)"
    negative_indicators:
    - manualInventory
    - inventoryList
  typescript:
    ast_queries:
    - query_type: function_definition
      target: manualInventory
    - query_type: assignment
      target: inventoryList
    regex_fallback: "(?i)(manualInventory|inventory.*=.*\\[|inventoryList.*=.*\\[)"
    negative_indicators:
    - manualInventory
    - inventoryList
finding:
  title_template: Manual inventory tracking detected
  description_template: Code uses manual inventory tracking. KSI-PIY-01 requires automated inventory from authoritative sources like Azure Resource Graph.
  remediation_template: 'Implement automated inventory using Azure Resource Graph:

    Python:

    from azure.mgmt.resourcegraph import ResourceGraphClient

    from azure.identity import DefaultAzureCredential


    credential = DefaultAzureCredential()

    client = ResourceGraphClient(credential)


    query = """

    Resources

    | where type !~ "microsoft.resources/deployments"

    | project name, type, location, resourceGroup

    """


    result = client.resources(query={"query": query, "subscriptions": [subscription_id]})

    '
tags:
- inventory
- manual
- gap
nist_controls:
- cm-8
related_ksis:
- KSI-PIY-01
---
pattern_id: piy.pii.logging_detection
name: PII in Logging Statements
description: 'Detects potential PII being logged - security best practice per NIST AR/PT/SI controls'
family: PIY
severity: CRITICAL
pattern_type: code_pattern
languages:
  python:
    ast_queries:
    - query_type: function_call
      target: logger.info|logger.debug|logger.warning|logger.error|print
      conditions:
      - arg_contains:ssn|social_security|credit_card|email|phone|address|birthdate|password
    regex_fallback: (logger\.(info|debug|warning|error)|print)\([^)]*\b(ssn|social_security|social
      security number|credit_card|creditcard|email|phone|telephone|address|birthdate|birth
      date|date of birth|dob|password|passwd)\b
  csharp:
    ast_queries:
    - query_type: method_call
      target: Log|WriteLine|Debug|Info|Warn|Error
      conditions:
      - arg_contains:ssn|socialSecurity|creditCard|email|phone|address|birthDate|password
    regex_fallback: (Log|WriteLine|Debug|Info|Warn|Error)\([^)]*\b(ssn|social.?security|credit.?card|email|phone|address|birth.?date|password)\b
  java:
    ast_queries:
    - query_type: method_call
      target: log|println|debug|info|warn|error
      conditions:
      - arg_contains:ssn|socialSecurity|creditCard|email|phone|address|birthDate|password
    regex_fallback: (log|println|debug|info|warn|error)\([^)]*\b(ssn|socialSecurity|creditCard|email|phone|address|birthDate|password)\b
  typescript:
    ast_queries:
    - query_type: function_call
      target: console.log|console.debug|console.info|console.warn|console.error|logger.log
      conditions:
      - arg_contains:ssn|socialSecurity|creditCard|email|phone|address|birthDate|password
    regex_fallback: (console\.(log|debug|info|warn|error)|logger\.log)\([^)]*\b(ssn|social.?security|credit.?card|email|phone|address|birth.?date|password)\b
finding:
  title_template: Potential PII in logging statement
  description_template: Logging statement may contain Personally Identifiable Information
    (PII). NIST controls AR-4, PT-2, SI-12 require PII to be masked or excluded from logs.
  remediation_template: "Remove or mask PII in logs:\n\nPython (Masking PII):\nimport\
    \ re\n\ndef mask_pii(text: str) -> str:\n    \"\"\"Mask PII in log messages\"\"\
    \"\n    # Mask SSN (XXX-XX-1234)\n    text = re.sub(r'\\b\\d{3}-\\d{2}-(\\d{4})\\\
    b', r'XXX-XX-\\1', text)\n    \n    # Mask credit card (XXXX-XXXX-XXXX-1234)\n\
    \    text = re.sub(r'\\b(\\d{4}[-\\s]?\\d{4}[-\\s]?\\d{4}[-\\s]?)(\\d{4})\\b',\
    \ r'XXXX-XXXX-XXXX-\\2', text)\n    \n    # Mask email (us**@example.com)\n  \
    \  text = re.sub(r'\\b([a-zA-Z0-9._%+-]{2})[a-zA-Z0-9._%+-]*@', r'\\1**@', text)\n\
    \    \n    # Mask phone ((XXX) XXX-1234)\n    text = re.sub(r'\\b(\\+?1[-.\\s]?)?\\\
    (?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?(\\d{4})\\b', r'(XXX) XXX-\\2', text)\n    \n\
    \    return text\n\n# Use structured logging with PII exclusion\nlogger.info(\n\
    \    \"User operation completed\",\n    extra={\n        'user_id': user_id, \
    \ # OK: Non-PII identifier\n        'operation': operation,\n        # DO NOT\
    \ LOG: user.email, user.ssn, user.phone\n    }\n)\n\n# If PII must be logged (debugging\
    \ only), mask it\nlogger.debug(f\"User email: {mask_pii(user.email)}\")\n\nC#\
    \ (Masking PII):\nusing System.Text.RegularExpressions;\n\npublic static string\
    \ MaskPii(string text)\n{\n    // Mask SSN\n    text = Regex.Replace(text, @\"\
    \\b\\d{3}-\\d{2}-(\\d{4})\\b\", \"XXX-XX-$1\");\n    \n    // Mask credit card\n\
    \    text = Regex.Replace(text, @\"\\b(\\d{4}[-\\s]?\\d{4}[-\\s]?\\d{4}[-\\s]?)(\\\
    d{4})\\b\", \"XXXX-XXXX-XXXX-$2\");\n    \n    // Mask email\n    text = Regex.Replace(text,\
    \ @\"\\b([a-zA-Z0-9._%+-]{2})[a-zA-Z0-9._%+-]*@\", \"$1**@\");\n    \n    return\
    \ text;\n}\n\n// Structured logging without PII\n_logger.LogInformation(\n   \
    \ \"User operation: {Operation} for user {UserId}\",\n    operation,\n    userId\
    \  // OK: Non-PII identifier\n    // DO NOT LOG: user.Email, user.SSN, user.Phone\n\
    );\n\nBest Practices:\n1. **Never log**: SSN, credit card numbers, passwords,\
    \ full emails, phone numbers\n2. **Use identifiers**: Log user_id, session_id,\
    \ transaction_id instead\n3. **Mask if necessary**: Last 4 digits only, partial\
    \ emails (us**@example.com)\n4. **Structured logging**: Use key-value pairs, exclude\
    \ PII fields\n5. **Log retention**: Apply shorter retention for logs with masked\
    \ PII\n"
  evidence_collection:
  - Code review showing PII masking implementation
  - Logging configuration excluding PII fields
  - Sample logs demonstrating PII masking
  - Developer training documentation on PII handling
  azure_services:
  - Azure Monitor
  - Application Insights
  - Azure Purview
tags:
- pii
- privacy
- data-protection
- critical-gap
nist_controls:
- ar-4
- ar-5
- pt-2
- pt-3
- si-12
# Note: No direct KSI mapping for PII logging - covered by NIST controls above
evidence_artifacts:
- artifact_type: logs
  name: Authentication logs with MFA details
  source: Azure Monitor - SigninLogs
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: Conditional Access policies export
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: JSON
- artifact_type: report
  name: Authentication methods compliance report
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: CSV
automation:
  automation_1:
    description: Azure Policy for compliance enforcement
    implementation: "# Azure Policy for compliance enforcement\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.pii.logging_detection \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.pii.logging_detection\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.pii.logging_detection\
      \ compliance\n      python validate.py --pattern piy.pii.logging_detection"
    azure_services: &id001
    - Azure Blob Storage
    - Azure Confidential Computing
    - Azure Monitor
    - Azure Private Link
    - Azure Resource Graph query validation
    - Azure SDK inventory queries
    - Log Analytics
  automation_2:
    description: Azure Monitor for continuous monitoring
    implementation: "# Azure Monitor for continuous monitoring\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.pii.logging_detection \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.pii.logging_detection\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.pii.logging_detection\
      \ compliance\n      python validate.py --pattern piy.pii.logging_detection"
    azure_services: *id001
  automation_3:
    description: Log Analytics queries for compliance validation
    implementation: "# Log Analytics queries for compliance validation\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.pii.logging_detection \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.pii.logging_detection\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.pii.logging_detection\
      \ compliance\n      python validate.py --pattern piy.pii.logging_detection"
    azure_services: *id001
implementation:
  prerequisites:
  - Azure subscription with required permissions
  - Microsoft Entra ID tenant configured
  steps:
  - step: 1
    action: Review FedRAMP 20x requirement documentation
    azure_service: null
    validation: Manual verification required
  - step: 2
    action: Identify systems and resources in scope
    azure_service: null
    validation: Manual verification required
  - step: 3
    action: Create resource group for FedRAMP resources
    azure_service: null
    validation: Manual verification required
  - step: 4
    action: Set up Azure Key Vault for secrets management
    azure_service: null
    validation: Manual verification required
  - step: 5
    action: Configure Log Analytics workspace
    azure_service: null
    validation: Manual verification required
  - step: 6
    action: Generate infrastructure-as-code templates (Bicep/Terraform)
    azure_service: null
    validation: Manual verification required
  - step: 7
    action: Deploy infrastructure via CI/CD pipeline
    azure_service: null
    validation: Manual verification required
  - step: 8
    action: Implement automated compliance checking
    azure_service: null
    validation: Manual verification required
  - step: 9
    action: Set up automated evidence collection
    azure_service: null
    validation: Manual verification required
  - step: 10
    action: Test detection logic against sample code
    azure_service: null
    validation: Manual verification required
ssp_mapping:
  control_family: AR - Unknown
  control_numbers:
  - AR-4
  - AR-5
  - PT-2
  - PT-3
  - SI-12
  ssp_sections:
  - section: 'AR-4: Automated Inventory'
    description_template: The system implements Automated Inventory controls in accordance
      with FedRAMP 20x requirements. Use authoritative sources to automatically maintain
      real-time inventories of all information resources.... Implementation leverages
      Azure native services combined with application-level controls and automated
      monitoring to ensure continuous compliance.
    implementation_details: Azure services including Azure Blob Storage, Azure Confidential
      Computing, Azure Monitor are configured to enforce compliance requirements.
      Infrastructure-as-code (Bicep/Terraform) templates ensure consistent deployment
      across environments. Automated compliance checking in CI/CD pipelines validates
      all changes against Automated Inventory requirements before deployment.
    evidence_references:
    - Configuration exports
    - Compliance reports
azure_guidance:
  recommended_services:
  - service: Azure Blob Storage
    tier: Standard
    purpose: Required for Azure Blob Storage functionality
    alternatives: []
  - service: Azure Confidential Computing
    tier: Standard
    purpose: Required for Azure Confidential Computing functionality
    alternatives: []
  - service: Azure Monitor
    tier: Standard
    purpose: Required for Azure Monitor functionality
    alternatives: []
  - service: Azure Private Link
    tier: Standard
    purpose: Required for Azure Private Link functionality
    alternatives: []
  - service: Azure Resource Graph query validation
    tier: Standard
    purpose: Required for Azure Resource Graph query validation functionality
    alternatives: []
  well_architected_framework:
    pillar: Security
    design_area: Identity and Access Management
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-01
    requirement_name: Automated Inventory
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant python implementation of piy.pii.logging_detection
    code_sample: "# Python compliant code for piy.pii.logging_detection\nimport logging\n\
      \ndef compliant_function():\n    \"\"\"Implements piy.pii.logging_detection\
      \ requirements.\"\"\"\n    logging.info(\"Compliant implementation\")\n    return\
      \ True"
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant python code violating piy.pii.logging_detection
    code_sample: "# Python non-compliant code for piy.pii.logging_detection\ndef non_compliant_function():\n\
      \    # Missing required implementation\n    pass"
    expected_severity: HIGH
    expected_finding: true
  validation_scripts: []
---
pattern_id: piy.retention.missing_policy
name: Missing Data Retention Policy
description: 'Detects missing data retention configuration - aligns with NIST SI-12 (Data Retention)'
family: PIY
severity: HIGH
pattern_type: resource_configuration
languages:
  bicep:
    ast_queries:
    - resource_type: Microsoft.Storage/storageAccounts/blobServices
      conditions:
      - not_has_property:deleteRetentionPolicy
    - resource_type: Microsoft.OperationalInsights/workspaces
      property_path: properties.retentionInDays
      conditions:
      - value_less_than:90
      - property_missing
    - resource_type: Microsoft.Sql/servers/databases
      conditions:
      - not_has_property:longTermRetentionPolicy
    regex_fallback: (Microsoft\.Storage/storageAccounts/blobServices)(?!.*deleteRetentionPolicy)|(Microsoft\.OperationalInsights/workspaces)(?!.*retentionInDays)|(Microsoft\.Sql/servers/databases)(?!.*longTermRetentionPolicy)
  terraform:
    ast_queries:
    - resource_type: azurerm_storage_account
      conditions:
      - not_has_block:blob_properties.delete_retention_policy
    - resource_type: azurerm_log_analytics_workspace
      property_path: retention_in_days
      conditions:
      - value_less_than:90
      - property_missing
    regex_fallback: resource\s+"azurerm_storage_account"(?!.*delete_retention_policy)|resource\s+"azurerm_log_analytics_workspace"(?!.*retention_in_days)
finding:
  title_template: Resource lacks data retention policy
  description_template: '{resource_type} does not have data retention policy configured.
    NIST SI-12 requires documented retention periods per data classification.'
  remediation_template: "Configure data retention policies:\n\nBicep (Storage Account\
    \ Retention):\nresource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01'\
    \ = {\n  name: storageAccountName\n  location: location\n  sku: {\n    name: 'Standard_LRS'\n\
    \  }\n  kind: 'StorageV2'\n}\n\nresource blobServices 'Microsoft.Storage/storageAccounts/blobServices@2023-01-01'\
    \ = {\n  parent: storageAccount\n  name: 'default'\n  properties: {\n    deleteRetentionPolicy:\
    \ {\n      enabled: true\n      days: 30  // 30-day soft delete (FedRAMP minimum)\n\
    \    }\n    containerDeleteRetentionPolicy: {\n      enabled: true\n      days:\
    \ 30\n    }\n    changeFeed: {\n      enabled: true\n      retentionInDays: 90\
    \  // 90-day change feed retention\n    }\n  }\n}\n\n// Lifecycle management for\
    \ automated deletion\nresource lifecyclePolicy 'Microsoft.Storage/storageAccounts/managementPolicies@2023-01-01'\
    \ = {\n  parent: storageAccount\n  name: 'default'\n  properties: {\n    policy:\
    \ {\n      rules: [\n        {\n          name: 'DeleteOldLogs'\n          enabled:\
    \ true\n          type: 'Lifecycle'\n          definition: {\n            filters:\
    \ {\n              blobTypes: ['blockBlob']\n              prefixMatch: ['logs/']\n\
    \            }\n            actions: {\n              baseBlob: {\n          \
    \      delete: {\n                  daysAfterModificationGreaterThan: 2555  //\
    \ 7 years (FedRAMP)\n                }\n              }\n            }\n     \
    \     }\n        }\n        {\n          name: 'DeleteOldBackups'\n          enabled:\
    \ true\n          type: 'Lifecycle'\n          definition: {\n            filters:\
    \ {\n              blobTypes: ['blockBlob']\n              prefixMatch: ['backups/']\n\
    \            }\n            actions: {\n              baseBlob: {\n          \
    \      delete: {\n                  daysAfterModificationGreaterThan: 2555  //\
    \ 7 years\n                }\n              }\n            }\n          }\n  \
    \      }\n      ]\n    }\n  }\n}\n\nBicep (Log Analytics Retention):\nresource\
    \ logAnalytics 'Microsoft.OperationalInsights/workspaces@2022-10-01' = {\n  name:\
    \ workspaceName\n  location: location\n  properties: {\n    sku: {\n      name:\
    \ 'PerGB2018'\n    }\n    retentionInDays: 90  // 90-day minimum (FedRAMP), can\
    \ be up to 730\n    features: {\n      enableDataExport: true\n    }\n  }\n}\n\
    \nTerraform:\nresource \"azurerm_storage_account\" \"main\" {\n  name        \
    \             = \"mystorageaccount\"\n  resource_group_name      = azurerm_resource_group.main.name\n\
    \  location                 = azurerm_resource_group.main.location\n  account_tier\
    \             = \"Standard\"\n  account_replication_type = \"GRS\"\n  \n  blob_properties\
    \ {\n    delete_retention_policy {\n      days = 30  # 30-day soft delete\n  \
    \  }\n    \n    container_delete_retention_policy {\n      days = 30\n    }\n\
    \  }\n}\n\nresource \"azurerm_storage_management_policy\" \"main\" {\n  storage_account_id\
    \ = azurerm_storage_account.main.id\n  \n  rule {\n    name    = \"DeleteOldLogs\"\
    \n    enabled = true\n    \n    filters {\n      prefix_match = [\"logs/\"]\n\
    \      blob_types   = [\"blockBlob\"]\n    }\n    \n    actions {\n      base_blob\
    \ {\n        delete_after_days_since_modification_greater_than = 2555  # 7 years\n\
    \      }\n    }\n  }\n}\n\nresource \"azurerm_log_analytics_workspace\" \"main\"\
    \ {\n  name                = \"myworkspace\"\n  location            = azurerm_resource_group.main.location\n\
    \  resource_group_name = azurerm_resource_group.main.name\n  sku             \
    \    = \"PerGB2018\"\n  retention_in_days   = 90  # 90-day minimum\n}\n\nFedRAMP\
    \ Data Retention Requirements:\n\n**By Data Type:**\n- **Audit logs**: 90 days\
    \ minimum (online), 7 years (archive)\n- **Security logs**: 90 days minimum (online),\
    \ 7 years (archive)\n- **Backups**: 7 years minimum\n- **User data**: Per data\
    \ classification and business requirements\n- **System logs**: 30 days minimum\n\
    \n**By Classification:**\n- **High sensitivity** (PII, PHI): 7 years + legal hold\
    \ capability\n- **Medium sensitivity**: 3-5 years typical\n- **Low sensitivity**:\
    \ 1-3 years typical\n- **Temporary data**: Delete within 30-90 days\n\n**Required\
    \ Capabilities:**\n1. Soft delete (30 days minimum)\n2. Lifecycle management policies\n\
    3. Immutable storage for audit logs\n4. Legal hold capability\n5. Documented retention\
    \ schedule by data type\n"
  evidence_collection:
  - Data retention policy document with retention periods
  - Data classification matrix
  - Storage/database retention configuration
  - Lifecycle management policies
  - Legal hold procedures
  azure_services:
  - Azure Storage
  - Azure Backup
  - Azure Log Analytics
  - Azure Purview
tags:
- data-retention
- privacy
- compliance
- security-gap
nist_controls:
- si-12
- au-11
- mp-6
related_ksis:
- KSI-PIY-02
evidence_artifacts:
- artifact_type: logs
  name: Authentication logs with MFA details
  source: Azure Monitor - SigninLogs
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: Conditional Access policies export
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: JSON
- artifact_type: report
  name: Authentication methods compliance report
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: CSV
automation:
  automation_1:
    description: Azure Policy for compliance enforcement
    implementation: "# Azure Policy for compliance enforcement\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.retention.missing_policy \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.retention.missing_policy\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.retention.missing_policy\
      \ compliance\n      python validate.py --pattern piy.retention.missing_policy"
    azure_services: &id001
    - Azure Blob Storage
    - Azure Confidential Computing
    - Azure Monitor
    - Azure Private Link
    - Log Analytics
  automation_2:
    description: Azure Monitor for continuous monitoring
    implementation: "# Azure Monitor for continuous monitoring\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.retention.missing_policy \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.retention.missing_policy\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.retention.missing_policy\
      \ compliance\n      python validate.py --pattern piy.retention.missing_policy"
    azure_services: *id001
  automation_3:
    description: Log Analytics queries for compliance validation
    implementation: "# Log Analytics queries for compliance validation\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.retention.missing_policy \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.retention.missing_policy\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.retention.missing_policy\
      \ compliance\n      python validate.py --pattern piy.retention.missing_policy"
    azure_services: *id001
implementation:
  prerequisites:
  - Azure subscription with required permissions
  - Microsoft Entra ID tenant configured
  steps:
  - step: 1
    action: Review FedRAMP 20x requirement documentation
    azure_service: null
    validation: Manual verification required
  - step: 2
    action: Identify systems and resources in scope
    azure_service: null
    validation: Manual verification required
  - step: 3
    action: Create resource group for FedRAMP resources
    azure_service: null
    validation: Manual verification required
  - step: 4
    action: Set up Azure Key Vault for secrets management
    azure_service: null
    validation: Manual verification required
  - step: 5
    action: Configure Log Analytics workspace
    azure_service: null
    validation: Manual verification required
  - step: 6
    action: Generate infrastructure-as-code templates (Bicep/Terraform)
    azure_service: null
    validation: Manual verification required
  - step: 7
    action: Deploy infrastructure via CI/CD pipeline
    azure_service: null
    validation: Manual verification required
  - step: 8
    action: Implement automated compliance checking
    azure_service: null
    validation: Manual verification required
  - step: 9
    action: Set up automated evidence collection
    azure_service: null
    validation: Manual verification required
  - step: 10
    action: Test detection logic against sample code
    azure_service: null
    validation: Manual verification required
ssp_mapping:
  control_family: SI - System and Information Integrity
  control_numbers:
  - SI-12
  - AU-11
  - MP-6
  ssp_sections:
  - section: 'SI-12: Data Minimization'
    description_template: The system implements Data Minimization controls in accordance
      with FedRAMP 20x requirements. Minimize data collection to necessary fields
      only.... Implementation leverages Azure native services combined with application-level
      controls and automated monitoring to ensure continuous compliance.
    implementation_details: Azure services including Azure Blob Storage, Azure Confidential
      Computing, Azure Monitor are configured to enforce compliance requirements.
      Infrastructure-as-code (Bicep/Terraform) templates ensure consistent deployment
      across environments. Automated compliance checking in CI/CD pipelines validates
      all changes against Data Minimization requirements before deployment.
    evidence_references:
    - Configuration exports
    - Compliance reports
azure_guidance:
  recommended_services:
  - service: Azure Blob Storage
    tier: Standard
    purpose: Required for Azure Blob Storage functionality
    alternatives: []
  - service: Azure Confidential Computing
    tier: Standard
    purpose: Required for Azure Confidential Computing functionality
    alternatives: []
  - service: Azure Monitor
    tier: Standard
    purpose: Required for Azure Monitor functionality
    alternatives: []
  - service: Azure Private Link
    tier: Standard
    purpose: Required for Azure Private Link functionality
    alternatives: []
  - service: Log Analytics
    tier: Standard
    purpose: Required for Log Analytics functionality
    alternatives: []
  well_architected_framework:
    pillar: Security
    design_area: Identity and Access Management
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-02
    requirement_name: Security Objectives and Requirements
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant bicep implementation of piy.retention.missing_policy
    code_sample: "// Bicep compliant configuration for piy.retention.missing_policy\n\
      resource compliantResource 'Microsoft.Resources/example@2021-01-01' = {\n  name:\
      \ 'compliant-resource'\n  properties: {\n    // Compliant configuration\n  }\n\
      }"
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant bicep code violating piy.retention.missing_policy
    code_sample: '# Non-compliant code missing piy.retention.missing_policy requirements'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts: []
---
pattern_id: piy.vdp.missing_program
name: Missing Vulnerability Disclosure Program
description: Detects absence of vulnerability disclosure mechanisms (KSI-PIY-03)
family: PIY
severity: HIGH
ksi_id: KSI-PIY-03
nist_controls:
- si-2
- pm-15
- ra-5
category: vulnerability_management
pattern_type: documentation_pattern
languages:
  markdown:
    regex_fallback: (?i)(SECURITY\.md|vulnerability.*disclosure|responsible.*disclosure|bug.*bounty|security.*txt)
    positive_indicators:
    - security.md
    - SECURITY.md
    - .well-known/security.txt
    - vulnerability disclosure
    - responsible disclosure
    - bug bounty
    - security@
    negative_indicators:
    - 'email:'
    - 'contact:'
    - 'report:'
    - disclosure timeline
  github_actions:
    regex_fallback: (?i)(codeql|snyk|trivy|dependabot)
    positive_indicators:
    - github/codeql-action
    - snyk/actions
    - aquasecurity/trivy-action
    - .github/dependabot.yml
finding:
  title_template: Missing Vulnerability Disclosure Program
  description_template: Repository or application lacks vulnerability disclosure program.
    KSI-PIY-03 requires published VDP with contact information and disclosure timeline.
  remediation_template: "Create Vulnerability Disclosure Program (VDP):\n\n**SECURITY.md\
    \ (GitHub/Root Directory):**\n```markdown\n# Security Policy\n\n## Supported Versions\n\
    \n| Version | Supported          |\n| ------- | ------------------ |\n| 1.0.x\
    \   | :white_check_mark: |\n| < 1.0   | :x:                |\n\n## Reporting a\
    \ Vulnerability\n\n**DO NOT create public GitHub issues for security vulnerabilities!**\n\
    \n### Reporting Process\n\n1. **Email:** security@yourcompany.com\n2. **Subject:**\
    \ [SECURITY] Brief description\n3. **Include:**\n   - Vulnerability description\n\
    \   - Steps to reproduce\n   - Potential impact\n   - Suggested remediation (optional)\n\
    \n### Response Timeline\n\n- **Initial Response:** Within 24 hours\n- **Triage:**\
    \ Within 72 hours\n- **Status Updates:** Weekly\n- **Resolution Target:** 30-90\
    \ days (severity-dependent)\n\n### Disclosure Timeline\n\n- **Critical:** 15 days\
    \ coordinated disclosure\n- **High:** 30 days coordinated disclosure\n- **Medium:**\
    \ 60 days coordinated disclosure\n- **Low:** 90 days coordinated disclosure\n\n\
    ### Scope\n\n**In Scope:**\n- yourapp.com and *.yourapp.com\n- API endpoints (api.yourapp.com)\n\
    - Mobile applications (iOS, Android)\n\n**Out of Scope:**\n- Social engineering\
    \ attacks\n- Physical attacks\n- Denial of Service (DoS)\n- SPF/DMARC misconfigurations\n\
    \n### Recognition\n\nWe maintain a Security Researchers Hall of Fame and may offer:\n\
    - Public recognition (with permission)\n- Swag/merchandise\n- Monetary rewards\
    \ (for qualifying vulnerabilities)\n\n### Legal Safe Harbor\n\nWe will not pursue\
    \ legal action against security researchers who:\n- Report vulnerabilities in\
    \ good faith\n- Avoid violating privacy, destroying data, or disrupting services\n\
    - Follow responsible disclosure guidelines\n- Give us reasonable time to remediate\
    \ before public disclosure\n\n## Security Best Practices\n\n- Enable MFA on all\
    \ accounts\n- Use strong, unique passwords\n- Keep software up to date\n- Report\
    \ suspicious activity to security@yourcompany.com\n```\n\n**.well-known/security.txt\
    \ (RFC 9116 Compliant):**\n```\nContact: mailto:security@yourcompany.com\nContact:\
    \ https://yourcompany.com/security/report\nExpires: 2026-12-31T23:59:59.000Z\n\
    Encryption: https://yourcompany.com/security/pgp-key.txt\nAcknowledgments: https://yourcompany.com/security/hall-of-fame\n\
    Preferred-Languages: en\nCanonical: https://yourcompany.com/.well-known/security.txt\n\
    Policy: https://yourcompany.com/security/disclosure-policy\nHiring: https://yourcompany.com/careers/security-jobs\n\
    ```\n\n**Internal VDP Process Document:**\n```yaml\nvulnerability_disclosure_program:\n\
    \  contacts:\n    primary_email: security@yourcompany.com\n    backup_email: security-backup@yourcompany.com\n\
    \    pgp_key_url: https://yourcompany.com/security/pgp-key.txt\n    \n  response_sla:\n\
    \    initial_acknowledgment: 24h\n    triage_completion: 72h\n    status_updates:\
    \ weekly\n    critical_fix: 15d\n    high_fix: 30d\n    medium_fix: 60d\n    low_fix:\
    \ 90d\n    \n  disclosure_timeline:\n    critical: 15d\n    high: 30d\n    medium:\
    \ 60d\n    low: 90d\n    \n  severity_criteria:\n    critical:\n      - Remote\
    \ code execution\n      - Authentication bypass\n      - SQL injection with data\
    \ access\n      - Privilege escalation (user to admin)\n    high:\n      - Cross-site\
    \ scripting (XSS) with auth bypass\n      - CSRF on sensitive operations\n   \
    \   - Information disclosure (PII, credentials)\n    medium:\n      - XSS (reflected,\
    \ non-auth)\n      - CSRF on non-critical operations\n      - Open redirects\n\
    \    low:\n      - Informational findings\n      - Best practice violations\n\
    \      \n  rewards:\n    critical: $5000-$10000\n    high: $1000-$5000\n    medium:\
    \ $500-$1000\n    low: $100-$500\n    \n  legal_safe_harbor:\n    - Good faith\
    \ security research\n    - Responsible disclosure\n    - No data destruction\n\
    \    - No service disruption\n    - Reasonable disclosure timeline\n```\n\n**GitHub\
    \ Security Advisories:**\nEnable Private Vulnerability Reporting in repository\
    \ settings:\nSettings → Code security and analysis → Private vulnerability reporting\
    \ → Enable\n\n**Bug Bounty Platforms (Optional):**\n- HackerOne: https://hackerone.com\n\
    - Bugcrowd: https://bugcrowd.com\n- Synack: https://synack.com\n- YesWeHack: https://yeswehack.com\n\
    \n**Required VDP Components (FedRAMP):**\n1. Published security policy (SECURITY.md\
    \ or website)\n2. Security contact email\n3. Disclosure timeline by severity\n\
    4. Scope definition (in-scope/out-of-scope assets)\n5. Legal safe harbor statement\n\
    6. Response SLA commitments\n7. Recognition/reward program (recommended)\n"
  evidence_collection:
  - SECURITY.md or published VDP
  - .well-known/security.txt
  - VDP process documentation
  - Vulnerability intake tracking
  - Disclosure timeline compliance
  azure_services:
  - Azure Defender for Cloud
  - Microsoft Security Response Center (MSRC) process
tags:
- vulnerability-disclosure
- vdp
- security-program
- critical-gap
related_ksis:
- KSI-PIY-03
evidence_artifacts:
- artifact_type: logs
  name: Authentication logs with MFA details
  source: Azure Monitor - SigninLogs
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: Conditional Access policies export
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: JSON
- artifact_type: report
  name: Authentication methods compliance report
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: CSV
automation:
  automation_1:
    description: Azure Policy for compliance enforcement
    implementation: "# Azure Policy for compliance enforcement\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.vdp.missing_program \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.vdp.missing_program\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.vdp.missing_program\
      \ compliance\n      python validate.py --pattern piy.vdp.missing_program"
    azure_services: &id001
    - Azure Blob Storage
    - Azure Confidential Computing
    - Azure Monitor
    - Azure Pipelines
    - Azure Private Link
    - Log Analytics
  automation_2:
    description: Azure Monitor for continuous monitoring
    implementation: "# Azure Monitor for continuous monitoring\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.vdp.missing_program \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.vdp.missing_program\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.vdp.missing_program\
      \ compliance\n      python validate.py --pattern piy.vdp.missing_program"
    azure_services: *id001
  automation_3:
    description: Log Analytics queries for compliance validation
    implementation: "# Log Analytics queries for compliance validation\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.vdp.missing_program \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.vdp.missing_program\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.vdp.missing_program\
      \ compliance\n      python validate.py --pattern piy.vdp.missing_program"
    azure_services: *id001
implementation:
  prerequisites:
  - Azure subscription with required permissions
  - Microsoft Entra ID tenant configured
  steps:
  - step: 1
    action: Review FedRAMP 20x requirement documentation
    azure_service: null
    validation: Manual verification required
  - step: 2
    action: Identify systems and resources in scope
    azure_service: null
    validation: Manual verification required
  - step: 3
    action: Create resource group for FedRAMP resources
    azure_service: null
    validation: Manual verification required
  - step: 4
    action: Set up Azure Key Vault for secrets management
    azure_service: null
    validation: Manual verification required
  - step: 5
    action: Configure Log Analytics workspace
    azure_service: null
    validation: Manual verification required
  - step: 6
    action: Create Standard Operating Procedures (SOPs)
    azure_service: null
    validation: Manual verification required
  - step: 7
    action: Get policy documentation approved by stakeholders
    azure_service: null
    validation: Manual verification required
  - step: 8
    action: Train staff on new procedures
    azure_service: null
    validation: Manual verification required
  - step: 9
    action: Set up periodic compliance reviews
    azure_service: null
    validation: Manual verification required
  - step: 10
    action: Document evidence collection process
    azure_service: null
    validation: Manual verification required
ssp_mapping:
  control_family: SI - System and Information Integrity
  control_numbers:
  - SI-2
  - PM-15
  - RA-5
  ssp_sections:
  - section: 'SI-2: Vulnerability Disclosure Program'
    description_template: The system implements Vulnerability Disclosure Program controls
      in accordance with FedRAMP 20x requirements. Maintain a vulnerability disclosure
      program.... Implementation leverages Azure native services combined with application-level
      controls and automated monitoring to ensure continuous compliance.
    implementation_details: Azure services including Azure Blob Storage, Azure Confidential
      Computing, Azure Monitor are configured to enforce compliance requirements.
      Infrastructure-as-code (Bicep/Terraform) templates ensure consistent deployment
      across environments. Automated compliance checking in CI/CD pipelines validates
      all changes against Vulnerability Disclosure Program requirements before deployment.
    evidence_references:
    - Configuration exports
    - Compliance reports
azure_guidance:
  recommended_services:
  - service: Azure Blob Storage
    tier: Standard
    purpose: Required for Azure Blob Storage functionality
    alternatives: []
  - service: Azure Confidential Computing
    tier: Standard
    purpose: Required for Azure Confidential Computing functionality
    alternatives: []
  - service: Azure Monitor
    tier: Standard
    purpose: Required for Azure Monitor functionality
    alternatives: []
  - service: Azure Pipelines
    tier: Standard
    purpose: Required for Azure Pipelines functionality
    alternatives: []
  - service: Azure Private Link
    tier: Standard
    purpose: Required for Azure Private Link functionality
    alternatives: []
  well_architected_framework:
    pillar: Security
    design_area: Identity and Access Management
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-03
    requirement_name: Vulnerability Disclosure Program
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant markdown implementation of piy.vdp.missing_program
    code_sample: |
      # SECURITY.md - Vulnerability Disclosure Program
      
      ## Reporting Security Vulnerabilities
      
      We take security seriously. If you discover a security vulnerability, please:
      
      **Email:** security@yourcompany.com  
      **PGP Key:** https://yourcompany.com/security/pgp-key.txt  
      
      ### What to Include
      - Description of the vulnerability
      - Steps to reproduce
      - Potential impact
      - Suggested remediation (optional)
      
      ### Response Timeline
      - **Initial Response:** Within 24 hours
      - **Triage:** Within 72 hours  
      - **Critical Fix:** 15 days
      - **High Fix:** 30 days
      
      ### Disclosure Timeline
      - **Critical:** 15 days coordinated disclosure
      - **High:** 30 days coordinated disclosure
      
      ### Legal Safe Harbor
      We will not pursue legal action against security researchers who:
      - Report vulnerabilities in good faith
      - Avoid violating privacy or disrupting services
      - Follow responsible disclosure guidelines
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant markdown code violating piy.vdp.missing_program
    code_sample: '# Non-compliant code missing piy.vdp.missing_program requirements'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts: []
---
pattern_id: piy.secure_by_design.missing_practices
name: Missing CISA Secure By Design Practices
description: Detects absence of CISA Secure By Design principles (KSI-PIY-04)
family: PIY
severity: HIGH
ksi_id: KSI-PIY-04
nist_controls:
- sa-8
- sa-11
- sa-15
- si-7
category: secure_development
pattern_type: code_pattern
languages:
  python:
    regex_fallback: (?i)(hardcoded.*password|secret.*=|api.*key.*=|exec\(|eval\(|pickle\.loads|yaml\.load\((?!.*safe_load))
    positive_indicators:
    - exec(
    - eval(
    - pickle.loads
    - yaml.load(
    - password =
    - api_key =
    - secret =
    negative_indicators:
    - os.environ
    - getenv
    - yaml.safe_load
    - '# nosec'
  java:
    regex_fallback: (?i)(hardcoded.*password|SecretKey\s*=|Password\s*=\s*["']|Runtime\.exec|Statement.*\+)
    positive_indicators:
    - hardcoded
    - password
    - SecretKey =
    - Password =
    - Runtime.exec
    - Statement
    negative_indicators:
    - System.getenv
    - Properties.getProperty
    - KeyStore
  csharp:
    regex_fallback: (?i)(hardcoded.*password|SecretKey\s*=|Password\s*=\s*["']|Process\.Start|SqlCommand.*\+)
    positive_indicators:
    - hardcoded
    - password
    - SecretKey =
    - Password =
    - Process.Start
    - SqlCommand
    negative_indicators:
    - Environment.GetEnvironmentVariable
    - ConfigurationManager
    - SecureString
  typescript:
    regex_fallback: (?i)(hardcoded.*password|apiKey:\s*["']|eval\(|innerHTML\s*=|dangerouslySetInnerHTML)
    positive_indicators:
    - hardcoded
    - password
    - apiKey:
    - eval(
    - innerHTML =
    - dangerouslySetInnerHTML
    negative_indicators:
    - process.env
    - dotenv
    - config
  bicep:
    regex_fallback: (?i)(password\s*:\s*["']|adminPassword\s*:|@secure\(\)\s*param.*=)
    positive_indicators:
    - 'password: '''
    - 'adminPassword:'
    - secureString
    negative_indicators:
    - '@secure()'
    - keyVault
    - secretReference
finding:
  title_template: CISA Secure By Design principle violation
  description_template: Code violates CISA Secure By Design principles. KSI-PIY-04
    requires security built-in from design phase.
  remediation_template: "Implement CISA Secure By Design Principles:\n\n**1. Default\
    \ Security (Secure Out-of-the-Box):**\n\nPython - Environment Variables for Secrets:\n\
    ```python\nimport os\nfrom azure.keyvault.secrets import SecretClient\nfrom azure.identity\
    \ import DefaultAzureCredential\n\n# BAD: Hardcoded secrets\n# api_key = \"sk-1234567890abcdef\"\
    \  # NEVER DO THIS\n\n# GOOD: Environment variables\napi_key = os.environ.get('API_KEY')\n\
    if not api_key:\n    raise ValueError(\"API_KEY environment variable not set\"\
    )\n\n# BETTER: Azure Key Vault\ncredential = DefaultAzureCredential()\nclient\
    \ = SecretClient(vault_url=\"https://myvault.vault.azure.net/\", credential=credential)\n\
    api_key = client.get_secret(\"api-key\").value\n```\n\nBicep - Secrets Management:\n\
    ```bicep\n@description('Admin password from Key Vault')\n@secure()\nparam adminPassword\
    \ string\n\n// Reference existing Key Vault\nresource keyVault 'Microsoft.KeyVault/vaults@2023-02-01'\
    \ existing = {\n  name: keyVaultName\n  scope: resourceGroup(keyVaultResourceGroup)\n\
    }\n\n// Retrieve secret\nmodule vm './vm.bicep' = {\n  name: 'vmDeployment'\n\
    \  params: {\n    adminPassword: keyVault.getSecret('adminPassword')\n  }\n}\n\
    ```\n\n**2. Radical Transparency (Security Visibility):**\n\nPython - Comprehensive\
    \ Logging:\n```python\nimport logging\nimport structlog\nfrom azure.monitor.opentelemetry\
    \ import configure_azure_monitor\n\n# Configure structured logging\nstructlog.configure(\n\
    \    processors=[\n        structlog.contextvars.merge_contextvars,\n        structlog.processors.add_log_level,\n\
    \        structlog.processors.TimeStamper(fmt=\"iso\"),\n        structlog.processors.JSONRenderer()\n\
    \    ]\n)\nlog = structlog.get_logger()\n\n# Security-focused logging\ndef authenticate_user(username,\
    \ password):\n    try:\n        user = User.authenticate(username, password)\n\
    \        log.info(\"authentication_success\", \n                username=username,\n\
    \                ip=request.remote_addr,\n                user_agent=request.headers.get('User-Agent'))\n\
    \        return user\n    except AuthenticationError as e:\n        log.warning(\"\
    authentication_failure\",\n                   username=username,\n           \
    \        ip=request.remote_addr,\n                   reason=str(e))\n        raise\n\
    ```\n\n**3. Vulnerability Disclosure (Proactive):**\nSee KSI-PIY-03 remediation\
    \ for VDP implementation.\n\n**4. Automated Secure Development:**\n\nGitHub Actions\
    \ - Security Automation:\n```yaml\nname: Security Checks\n\non: [push, pull_request]\n\
    \njobs:\n  security-scan:\n    runs-on: ubuntu-latest\n    steps:\n      - uses:\
    \ actions/checkout@v4\n      \n      # SAST (Static Analysis)\n      - name: Run\
    \ CodeQL\n        uses: github/codeql-action/init@v3\n        with:\n        \
    \  languages: python, javascript\n          \n      - name: Perform CodeQL Analysis\n\
    \        uses: github/codeql-action/analyze@v3\n        \n      # Dependency Scanning\n\
    \      - name: Run Snyk\n        uses: snyk/actions/python@master\n        with:\n\
    \          command: test\n          args: --severity-threshold=high\n        \
    \  \n      # Secret Scanning\n      - name: Run TruffleHog\n        uses: trufflesecurity/trufflehog@main\n\
    \        with:\n          path: ./\n          base: ${{ github.event.repository.default_branch\
    \ }}\n          head: HEAD\n          \n      # Container Scanning\n      - name:\
    \ Run Trivy\n        uses: aquasecurity/trivy-action@master\n        with:\n \
    \         scan-type: 'fs'\n          scan-ref: '.'\n          severity: 'CRITICAL,HIGH'\n\
    ```\n\n**5. Memory Safety:**\n\nPython - Input Validation:\n```python\nfrom pydantic\
    \ import BaseModel, Field, EmailStr, validator\nfrom typing import Optional\n\
    import re\n\nclass UserInput(BaseModel):\n    username: str = Field(..., min_length=3,\
    \ max_length=32, regex=\"^[a-zA-Z0-9_-]+$\")\n    email: EmailStr\n    age: Optional[int]\
    \ = Field(None, ge=13, le=120)\n    \n    @validator('username')\n    def validate_username(cls,\
    \ v):\n        if v.lower() in ['admin', 'root', 'system']:\n            raise\
    \ ValueError('Reserved username')\n        return v\n\n# Usage\ntry:\n    user\
    \ = UserInput(username=\"john_doe\", email=\"john@example.com\", age=25)\nexcept\
    \ ValueError as e:\n    log.error(\"invalid_input\", error=str(e))\n    raise\n\
    ```\n\n**CISA Secure By Design Pledge Commitments:**\n\n1. **Multi-Factor Authentication\
    \ (MFA):**\n   - Mandatory for all users\n   - Phishing-resistant MFA for admins\n\
    \   - No SMS-based MFA\n\n2. **Default Passwords:**\n   - No default passwords\n\
    \   - Force password change on first login\n   - Generate unique passwords per\
    \ installation\n\n3. **Reducing Classes of Vulnerabilities:**\n   - Eliminate\
    \ SQL injection (use parameterized queries)\n   - Eliminate XSS (use templating\
    \ with auto-escaping)\n   - Eliminate command injection (avoid shell execution)\n\
    \n4. **Security Patches:**\n   - Critical vulnerabilities patched within 14 days\n\
    \   - High vulnerabilities within 30 days\n   - Automated update mechanism\n\n\
    5. **CVE Assignment:**\n   - Obtain CVEs for all security issues\n   - Public\
    \ vulnerability disclosure\n\n6. **Vulnerability Disclosure Policy:**\n   - Published\
    \ VDP (see KSI-PIY-03)\n   - Clear reporting process\n   - Legal safe harbor\n\
    \n7. **Artifact Signing:**\n   - Code signing for all releases\n   - SBOM generation\n\
    \   - Supply chain security (Sigstore, SLSA)\n"
  evidence_collection:
  - Secure By Design commitment documentation
  - Security-first architecture diagrams
  - Automated security testing results
  - Default secure configuration
  - MFA implementation evidence
  azure_services:
  - Azure Active Directory (Entra ID) MFA
  - Azure Key Vault
  - Microsoft Defender for Cloud
  - Azure DevOps Security
tags:
- secure-by-design
- cisa
- secure-development
- security-gap
related_ksis:
- KSI-PIY-04
- KSI-PIY-03
evidence_artifacts:
- artifact_type: logs
  name: Authentication logs with MFA details
  source: Azure Monitor - SigninLogs
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: Conditional Access policies export
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: JSON
- artifact_type: report
  name: Authentication methods compliance report
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: CSV
automation:
  automation_1:
    description: Azure Policy for compliance enforcement
    implementation: "# Azure Policy for compliance enforcement\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.secure_by_design.missing_practices \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.secure_by_design.missing_practices\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.secure_by_design.missing_practices\
      \ compliance\n      python validate.py --pattern piy.secure_by_design.missing_practices"
    azure_services: &id001
    - Azure Blob Storage
    - Azure Confidential Computing
    - Azure Monitor
    - Azure Pipelines
    - Azure Private Link
    - Log Analytics
  automation_2:
    description: Azure Monitor for continuous monitoring
    implementation: "# Azure Monitor for continuous monitoring\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.secure_by_design.missing_practices \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.secure_by_design.missing_practices\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.secure_by_design.missing_practices\
      \ compliance\n      python validate.py --pattern piy.secure_by_design.missing_practices"
    azure_services: *id001
  automation_3:
    description: Log Analytics queries for compliance validation
    implementation: "# Log Analytics queries for compliance validation\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.secure_by_design.missing_practices \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.secure_by_design.missing_practices\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.secure_by_design.missing_practices\
      \ compliance\n      python validate.py --pattern piy.secure_by_design.missing_practices"
    azure_services: *id001
implementation:
  prerequisites:
  - Azure subscription with required permissions
  - Microsoft Entra ID tenant configured
  steps:
  - step: 1
    action: Review FedRAMP 20x requirement documentation
    azure_service: null
    validation: Manual verification required
  - step: 2
    action: Identify systems and resources in scope
    azure_service: null
    validation: Manual verification required
  - step: 3
    action: Create resource group for FedRAMP resources
    azure_service: null
    validation: Manual verification required
  - step: 4
    action: Set up Azure Key Vault for secrets management
    azure_service: null
    validation: Manual verification required
  - step: 5
    action: Configure Log Analytics workspace
    azure_service: null
    validation: Manual verification required
  - step: 6
    action: Create Standard Operating Procedures (SOPs)
    azure_service: null
    validation: Manual verification required
  - step: 7
    action: Get policy documentation approved by stakeholders
    azure_service: null
    validation: Manual verification required
  - step: 8
    action: Train staff on new procedures
    azure_service: null
    validation: Manual verification required
  - step: 9
    action: Set up periodic compliance reviews
    azure_service: null
    validation: Manual verification required
  - step: 10
    action: Document evidence collection process
    azure_service: null
    validation: Manual verification required
ssp_mapping:
  control_family: SA - System and Services Acquisition
  control_numbers:
  - SA-8
  - SA-11
  - SA-15
  - SI-7
  ssp_sections:
  - section: 'SA-8: CISA Secure By Design'
    description_template: The system implements CISA Secure By Design controls in
      accordance with FedRAMP 20x requirements. Monitor the effectiveness of building
      security and privacy considerations into the Software Development Lifecycle
      and aligning with CISA Secure By Design principles.... Implementation leverages
      Azure native services combined with application-level controls and automated
      monitoring to ensure continuous compliance.
    implementation_details: Azure services including Azure Blob Storage, Azure Confidential
      Computing, Azure Monitor are configured to enforce compliance requirements.
      Infrastructure-as-code (Bicep/Terraform) templates ensure consistent deployment
      across environments. Automated compliance checking in CI/CD pipelines validates
      all changes against CISA Secure By Design requirements before deployment.
    evidence_references:
    - Configuration exports
    - Compliance reports
azure_guidance:
  recommended_services:
  - service: Azure Blob Storage
    tier: Standard
    purpose: Required for Azure Blob Storage functionality
    alternatives: []
  - service: Azure Confidential Computing
    tier: Standard
    purpose: Required for Azure Confidential Computing functionality
    alternatives: []
  - service: Azure Monitor
    tier: Standard
    purpose: Required for Azure Monitor functionality
    alternatives: []
  - service: Azure Pipelines
    tier: Standard
    purpose: Required for Azure Pipelines functionality
    alternatives: []
  - service: Azure Private Link
    tier: Standard
    purpose: Required for Azure Private Link functionality
    alternatives: []
  well_architected_framework:
    pillar: Security
    design_area: Identity and Access Management
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-04
    requirement_name: CISA Secure By Design
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant python implementation of piy.secure_by_design.missing_practices
    code_sample: "# Python compliant code for piy.secure_by_design.missing_practices\n\
      import logging\n\ndef compliant_function():\n    \"\"\"Implements piy.secure_by_design.missing_practices\
      \ requirements.\"\"\"\n    logging.info(\"Compliant implementation\")\n    return\
      \ True"
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant python code violating piy.secure_by_design.missing_practices
    code_sample: "# Python non-compliant code for piy.secure_by_design.missing_practices\n\
      def non_compliant_function():\n    # Missing required implementation\n    pass"
    expected_severity: HIGH
    expected_finding: true
  validation_scripts: []
---
pattern_id: piy.evaluation.missing_validation
name: Missing Implementation Validation
description: Detects absence of security control validation (KSI-PIY-05)
family: PIY
severity: MEDIUM
ksi_id: KSI-PIY-05
nist_controls:
- ca-2
- ca-7
- sa-11
- sa-15.7
category: testing_validation
pattern_type: ci_cd_pattern
languages:
  github_actions:
    regex_fallback: (?i)(pytest|unittest|jest|mocha|selenium|cypress)
    positive_indicators:
    - pytest
    - unittest
    - jest
    - mocha
    - selenium
    - cypress
    - test
    negative_indicators:
    - security
    - penetration
    - zap
    - burp
finding:
  title_template: Missing security control validation testing
  description_template: CI/CD pipeline lacks security control validation tests. KSI-PIY-05
    requires automated testing of security implementations.
  remediation_template: "Implement Security Control Validation Testing:\n\n**1. Unit\
    \ Tests for Security Controls:**\n\nPython - pytest Security Tests:\n```python\n\
    import pytest\nfrom app.auth import AuthService\nfrom app.crypto import EncryptionService\n\
    \nclass TestAuthenticationControls:\n    \"\"\"Test suite for authentication security\
    \ controls\"\"\"\n    \n    def test_password_complexity_enforced(self):\n   \
    \     \"\"\"Verify password complexity requirements\"\"\"\n        auth = AuthService()\n\
    \        \n        # Weak passwords should be rejected\n        weak_passwords\
    \ = [\n            \"password\",\n            \"12345678\",\n            \"abcdefgh\"\
    ,\n            \"Password\"  # No numbers/symbols\n        ]\n        \n     \
    \   for pwd in weak_passwords:\n            with pytest.raises(ValueError, match=\"\
    password complexity\"):\n                auth.create_user(\"user\", pwd)\n   \
    \ \n    def test_account_lockout_after_failed_attempts(self):\n        \"\"\"\
    Verify account lockout mechanism\"\"\"\n        auth = AuthService()\n       \
    \ auth.create_user(\"test_user\", \"SecureP@ss123\")\n        \n        # 5 failed\
    \ attempts should lock account\n        for i in range(5):\n            assert\
    \ not auth.authenticate(\"test_user\", \"wrong_password\")\n        \n       \
    \ # Account should be locked\n        assert auth.is_locked(\"test_user\")\n \
    \       \n        # Even correct password should fail\n        assert not auth.authenticate(\"\
    test_user\", \"SecureP@ss123\")\n    \n    def test_session_timeout_enforced(self):\n\
    \        \"\"\"Verify session timeout\"\"\"\n        auth = AuthService()\n  \
    \      session = auth.create_session(\"user\")\n        \n        # Wait for session\
    \ timeout (30 minutes)\n        import time\n        time.sleep(1800)\n      \
    \  \n        assert not auth.validate_session(session.id)\n    \n    def test_mfa_required_for_privileged_users(self):\n\
    \        \"\"\"Verify MFA enforcement\"\"\"\n        auth = AuthService()\n  \
    \      admin_user = auth.create_user(\"admin\", \"SecureP@ss123\", roles=[\"admin\"\
    ])\n        \n        # First-factor authentication\n        session = auth.authenticate(\"\
    admin\", \"SecureP@ss123\")\n        assert session.requires_mfa\n        \n \
    \       # Second-factor required\n        with pytest.raises(ValueError, match=\"\
    MFA required\"):\n            session.access_resource()\n\nclass TestEncryptionControls:\n\
    \    \"\"\"Test suite for encryption security controls\"\"\"\n    \n    def test_data_encrypted_at_rest(self):\n\
    \        \"\"\"Verify data encryption\"\"\"\n        crypto = EncryptionService()\n\
    \        plaintext = \"sensitive data\"\n        \n        encrypted = crypto.encrypt(plaintext)\n\
    \        assert encrypted != plaintext\n        assert len(encrypted) > len(plaintext)\
    \  # Includes IV/metadata\n        \n        decrypted = crypto.decrypt(encrypted)\n\
    \        assert decrypted == plaintext\n    \n    def test_encryption_uses_approved_algorithms(self):\n\
    \        \"\"\"Verify FIPS 140-2 approved algorithms\"\"\"\n        crypto = EncryptionService()\n\
    \        \n        assert crypto.algorithm == \"AES-256-GCM\"\n        assert\
    \ crypto.key_length == 256\n    \n    def test_keys_rotated_regularly(self):\n\
    \        \"\"\"Verify key rotation\"\"\"\n        crypto = EncryptionService()\n\
    \        \n        # Keys should have creation timestamp\n        assert crypto.current_key.created_at\
    \ is not None\n        \n        # Keys older than 90 days should trigger rotation\n\
    \        import datetime\n        if (datetime.datetime.now() - crypto.current_key.created_at).days\
    \ > 90:\n            pytest.fail(\"Encryption key not rotated in 90 days\")\n\
    ```\n\n**2. Integration Tests for Security Workflows:**\n\nPython - pytest Integration\
    \ Tests:\n```python\nimport pytest\nimport requests\nfrom azure.identity import\
    \ DefaultAzureCredential\nfrom azure.keyvault.secrets import SecretClient\n\n\
    @pytest.fixture\ndef app_url():\n    return os.environ.get('APP_URL', 'https://staging.example.com')\n\
    \nclass TestSecurityWorkflows:\n    \"\"\"Integration tests for security workflows\"\
    \"\"\n    \n    def test_unauthorized_access_blocked(self, app_url):\n       \
    \ \"\"\"Verify unauthorized access is denied\"\"\"\n        response = requests.get(f\"\
    {app_url}/api/admin\")\n        assert response.status_code == 401\n    \n   \
    \ def test_https_enforced(self, app_url):\n        \"\"\"Verify HTTP redirects\
    \ to HTTPS\"\"\"\n        http_url = app_url.replace('https://', 'http://')\n\
    \        response = requests.get(http_url, allow_redirects=False)\n        assert\
    \ response.status_code == 301\n        assert response.headers['Location'].startswith('https://')\n\
    \    \n    def test_security_headers_present(self, app_url):\n        \"\"\"Verify\
    \ security headers\"\"\"\n        response = requests.get(app_url)\n        \n\
    \        required_headers = {\n            'Strict-Transport-Security': 'max-age=31536000',\n\
    \            'X-Content-Type-Options': 'nosniff',\n            'X-Frame-Options':\
    \ 'DENY',\n            'Content-Security-Policy': \"default-src 'self'\"\n   \
    \     }\n        \n        for header, expected_value in required_headers.items():\n\
    \            assert header in response.headers\n            assert expected_value\
    \ in response.headers[header]\n    \n    def test_rate_limiting_enforced(self,\
    \ app_url):\n        \"\"\"Verify rate limiting\"\"\"\n        for i in range(100):\n\
    \            response = requests.get(f\"{app_url}/api/search\")\n            if\
    \ response.status_code == 429:\n                break\n        else:\n       \
    \     pytest.fail(\"Rate limiting not enforced after 100 requests\")\n```\n\n\
    **3. Penetration Testing Automation:**\n\nGitHub Actions - DAST with OWASP ZAP:\n\
    ```yaml\nname: Security Validation\n\non:\n  schedule:\n    - cron: '0 2 * * *'\
    \  # Daily at 2 AM\n  workflow_dispatch:\n\njobs:\n  dast-scan:\n    runs-on:\
    \ ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n     \
    \ - name: Deploy to staging\n        run: |\n          # Deploy application to\
    \ staging environment\n          az webapp deploy --name staging-app --resource-group\
    \ staging-rg\n      \n      - name: OWASP ZAP Baseline Scan\n        uses: zaproxy/action-baseline@v0.10.0\n\
    \        with:\n          target: 'https://staging.example.com'\n          rules_file_name:\
    \ '.zap/rules.tsv'\n          cmd_options: '-a'\n      \n      - name: OWASP ZAP\
    \ Full Scan\n        uses: zaproxy/action-full-scan@v0.8.0\n        with:\n  \
    \        target: 'https://staging.example.com'\n          rules_file_name: '.zap/rules.tsv'\n\
    \          cmd_options: '-j'\n      \n      - name: Upload ZAP Results\n     \
    \   uses: actions/upload-artifact@v4\n        with:\n          name: zap-results\n\
    \          path: |\n            report_html.html\n            report_json.json\n\
    ```\n\n**4. Compliance Testing:**\n\nPython - Compliance Validation:\n```python\n\
    import pytest\nfrom azure.mgmt.security import SecurityCenter\nfrom azure.identity\
    \ import DefaultAzureCredential\n\nclass TestFedRAMPCompliance:\n    \"\"\"Test\
    \ FedRAMP compliance controls\"\"\"\n    \n    @pytest.fixture\n    def security_client(self):\n\
    \        credential = DefaultAzureCredential()\n        return SecurityCenter(credential,\
    \ subscription_id=os.environ['SUBSCRIPTION_ID'])\n    \n    def test_encryption_enabled_for_all_storage(self,\
    \ security_client):\n        \"\"\"Verify all storage accounts use encryption\"\
    \"\"\n        assessments = security_client.assessments.list()\n        \n   \
    \     for assessment in assessments:\n            if 'storage' in assessment.resource_details.id.lower():\n\
    \                assert assessment.status.code == 'Healthy', f\"Storage encryption\
    \ failed: {assessment.display_name}\"\n    \n    def test_network_security_groups_configured(self,\
    \ security_client):\n        \"\"\"Verify NSGs properly configured\"\"\"\n   \
    \     assessments = security_client.assessments.list()\n        \n        for\
    \ assessment in assessments:\n            if 'network' in assessment.resource_details.id.lower():\n\
    \                assert assessment.status.code == 'Healthy', f\"NSG misconfigured:\
    \ {assessment.display_name}\"\n    \n    def test_vulnerability_scanning_enabled(self,\
    \ security_client):\n        \"\"\"Verify vulnerability assessment enabled\"\"\
    \"\n        auto_provisioning = security_client.auto_provisioning_settings.list()\n\
    \        \n        vulnerability_assessment_enabled = any(\n            setting.auto_provision\
    \ == 'On' \n            for setting in auto_provisioning \n            if 'vulnerability'\
    \ in setting.name.lower()\n        )\n        \n        assert vulnerability_assessment_enabled,\
    \ \"Vulnerability assessment not enabled\"\n```\n\n**Required Testing Types:**\n\
    1. Unit tests for security functions\n2. Integration tests for security workflows\n\
    3. Penetration testing (DAST)\n4. Static analysis (SAST)\n5. Compliance validation\n\
    6. Performance/load testing under security constraints\n"
  evidence_collection:
  - Security test results
  - Penetration testing reports
  - Compliance validation results
  - Test coverage reports (>80% for security controls)
  - Automated testing pipeline configuration
  azure_services:
  - Azure DevTest Labs
  - Microsoft Defender for Cloud
  - Azure Security Center assessments
tags:
- validation
- testing
- penetration-testing
- security-gap
related_ksis:
- KSI-PIY-05
evidence_artifacts:
- artifact_type: logs
  name: Authentication logs with MFA details
  source: Azure Monitor - SigninLogs
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: Conditional Access policies export
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: JSON
- artifact_type: report
  name: Authentication methods compliance report
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: CSV
automation:
  automation_1:
    description: Azure Policy for compliance enforcement
    implementation: "# Azure Policy for compliance enforcement\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.evaluation.missing_validation \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.evaluation.missing_validation\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.evaluation.missing_validation\
      \ compliance\n      python validate.py --pattern piy.evaluation.missing_validation"
    azure_services: &id001
    - Azure Blob Storage
    - Azure Confidential Computing
    - Azure Monitor
    - Azure Pipelines
    - Azure Private Link
    - Log Analytics
  automation_2:
    description: Azure Monitor for continuous monitoring
    implementation: "# Azure Monitor for continuous monitoring\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.evaluation.missing_validation \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.evaluation.missing_validation\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.evaluation.missing_validation\
      \ compliance\n      python validate.py --pattern piy.evaluation.missing_validation"
    azure_services: *id001
  automation_3:
    description: Log Analytics queries for compliance validation
    implementation: "# Log Analytics queries for compliance validation\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.evaluation.missing_validation \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.evaluation.missing_validation\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.evaluation.missing_validation\
      \ compliance\n      python validate.py --pattern piy.evaluation.missing_validation"
    azure_services: *id001
implementation:
  prerequisites:
  - Azure subscription with required permissions
  - Microsoft Entra ID tenant configured
  steps:
  - step: 1
    action: Review FedRAMP 20x requirement documentation
    azure_service: null
    validation: Manual verification required
  - step: 2
    action: Identify systems and resources in scope
    azure_service: null
    validation: Manual verification required
  - step: 3
    action: Create resource group for FedRAMP resources
    azure_service: null
    validation: Manual verification required
  - step: 4
    action: Set up Azure Key Vault for secrets management
    azure_service: null
    validation: Manual verification required
  - step: 5
    action: Configure Log Analytics workspace
    azure_service: null
    validation: Manual verification required
  - step: 6
    action: Create Standard Operating Procedures (SOPs)
    azure_service: null
    validation: Manual verification required
  - step: 7
    action: Get policy documentation approved by stakeholders
    azure_service: null
    validation: Manual verification required
  - step: 8
    action: Train staff on new procedures
    azure_service: null
    validation: Manual verification required
  - step: 9
    action: Set up periodic compliance reviews
    azure_service: null
    validation: Manual verification required
  - step: 10
    action: Document evidence collection process
    azure_service: null
    validation: Manual verification required
ssp_mapping:
  control_family: CA - Assessment, Authorization, and Monitoring
  control_numbers:
  - CA-2
  - CA-7
  - SA-11
  - SA-15.7
  ssp_sections:
  - section: 'CA-2: Evaluate Implementations'
    description_template: The system implements Evaluate Implementations controls
      in accordance with FedRAMP 20x requirements. Document methods used to evaluate
      information resource implementations.... Implementation leverages Azure native
      services combined with application-level controls and automated monitoring to
      ensure continuous compliance.
    implementation_details: Azure services including Azure Blob Storage, Azure Confidential
      Computing, Azure Monitor are configured to enforce compliance requirements.
      Infrastructure-as-code (Bicep/Terraform) templates ensure consistent deployment
      across environments. Automated compliance checking in CI/CD pipelines validates
      all changes against Evaluate Implementations requirements before deployment.
    evidence_references:
    - Configuration exports
    - Compliance reports
azure_guidance:
  recommended_services:
  - service: Azure Blob Storage
    tier: Standard
    purpose: Required for Azure Blob Storage functionality
    alternatives: []
  - service: Azure Confidential Computing
    tier: Standard
    purpose: Required for Azure Confidential Computing functionality
    alternatives: []
  - service: Azure Monitor
    tier: Standard
    purpose: Required for Azure Monitor functionality
    alternatives: []
  - service: Azure Pipelines
    tier: Standard
    purpose: Required for Azure Pipelines functionality
    alternatives: []
  - service: Azure Private Link
    tier: Standard
    purpose: Required for Azure Private Link functionality
    alternatives: []
  well_architected_framework:
    pillar: Security
    design_area: Identity and Access Management
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-05
    requirement_name: Evaluate Implementations
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant github_actions implementation of piy.evaluation.missing_validation
    code_sample: |
      # GitHub Actions - Security Control Validation Testing
      name: Security Validation
      on: [push, pull_request]
      jobs:
        security-tests:
          runs-on: ubuntu-latest
          steps:
            - uses: actions/checkout@v4
            
            - name: Set up Python
              uses: actions/setup-python@v4
              with:
                python-version: '3.11'
            
            - name: Install dependencies
              run: |
                pip install pytest pytest-cov
                pip install -r requirements.txt
            
            - name: Run Security Control Unit Tests
              run: |
                pytest tests/security/ -v --cov=app.security
            
            - name: Run Authentication Tests
              run: |
                pytest tests/security/test_auth_controls.py -v
            
            - name: Run Encryption Tests
              run: |
                pytest tests/security/test_encryption.py -v
            
            - name: Generate Coverage Report
              run: |
                pytest --cov-report=html --cov-report=xml
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant github_actions code violating piy.evaluation.missing_validation
    code_sample: '# Non-compliant code missing piy.evaluation.missing_validation requirements'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts: []
---
pattern_id: piy.investment.missing_metrics
name: Missing Security Investment Metrics
description: Detects absence of security effectiveness measurement (KSI-PIY-06)
family: PIY
severity: MEDIUM
ksi_id: KSI-PIY-06
nist_controls:
- pm-9
- pm-14
- ca-7
category: security_metrics
pattern_type: documentation_pattern
languages:
  markdown:
    regex_fallback: (?i)(security.*metric|roi|return.*investment|effectiveness|kpi|key.*performance)
    positive_indicators:
    - security metrics
    - ROI
    - KPI
    - effectiveness
    - measurement
    negative_indicators:
    - MTTR
    - MTTD
    - vulnerability count
    - patch compliance
finding:
  title_template: Missing security investment effectiveness metrics
  description_template: Organization lacks documented security investment effectiveness
    metrics. KSI-PIY-06 requires measurement of security program ROI.
  remediation_template: "Implement Security Investment Effectiveness Metrics:\n\n\
    **1. Key Performance Indicators (KPIs):**\n\n```yaml\nsecurity_kpis:\n  detection_response:\n\
    \    mttr:  # Mean Time To Respond\n      target: 4h\n      current: 6h\n    \
    \  trend: improving\n      \n    mttd:  # Mean Time To Detect\n      target: 1h\n\
    \      current: 2h\n      trend: improving\n      \n    mttr_critical:  # Critical\
    \ incident response time\n      target: 15m\n      current: 30m\n      trend:\
    \ stable\n      \n  vulnerability_management:\n    critical_patching:\n      target:\
    \ 14d\n      current: 10d\n      trend: excellent\n      \n    high_patching:\n\
    \      target: 30d\n      current: 25d\n      trend: good\n      \n    vulnerability_scan_coverage:\n\
    \      target: 100%\n      current: 98%\n      trend: stable\n      \n    false_positive_rate:\n\
    \      target: <5%\n      current: 8%\n      trend: needs_improvement\n      \n\
    \  security_awareness:\n    training_completion:\n      target: 100%\n      current:\
    \ 95%\n      trend: improving\n      \n    phishing_click_rate:\n      target:\
    \ <5%\n      current: 12%\n      trend: needs_improvement\n      \n    security_incidents_reported:\n\
    \      target: +20% YoY  # More reporting is good\n      current: +15% YoY\n \
    \     trend: improving\n      \n  access_management:\n    mfa_adoption:\n    \
    \  target: 100%\n      current: 92%\n      trend: improving\n      \n    privileged_account_review:\n\
    \      target: quarterly\n      current: quarterly\n      trend: on_track\n  \
    \    \n    dormant_account_removal:\n      target: 30d\n      current: 45d\n \
    \     trend: needs_improvement\n```\n\n**2. ROI Calculation Framework:**\n\nPython\
    \ - Security ROI Calculator:\n```python\nfrom dataclasses import dataclass\nfrom\
    \ typing import List, Dict\nimport pandas as pd\n\n@dataclass\nclass SecurityInvestment:\n\
    \    name: str\n    annual_cost: float\n    implementation_cost: float\n    \n\
    @dataclass\nclass RiskReduction:\n    threat: str\n    likelihood_before: float\
    \  # 0-1\n    likelihood_after: float   # 0-1\n    impact: float             #\
    \ Dollar value\n    \nclass SecurityROICalculator:\n    \"\"\"Calculate ROI for\
    \ security investments\"\"\"\n    \n    def __init__(self, time_horizon_years:\
    \ int = 3):\n        self.time_horizon = time_horizon_years\n        \n    def\
    \ calculate_risk_reduction_value(self, reductions: List[RiskReduction]) -> float:\n\
    \        \"\"\"Calculate annual value of risk reduction\"\"\"\n        total_value\
    \ = 0\n        \n        for reduction in reductions:\n            # Annual Loss\
    \ Expectancy (ALE) before = Likelihood × Impact\n            ale_before = reduction.likelihood_before\
    \ * reduction.impact\n            \n            # ALE after investment\n     \
    \       ale_after = reduction.likelihood_after * reduction.impact\n          \
    \  \n            # Value = Reduction in ALE\n            value = ale_before -\
    \ ale_after\n            total_value += value\n            \n        return total_value\n\
    \    \n    def calculate_roi(self, \n                     investment: SecurityInvestment,\n\
    \                     risk_reductions: List[RiskReduction],\n                \
    \     operational_savings: float = 0) -> Dict:\n        \"\"\"\n        Calculate\
    \ ROI for security investment\n        \n        ROI = (Gain - Cost) / Cost\n\
    \        \"\"\"\n        # Annual benefit\n        risk_value = self.calculate_risk_reduction_value(risk_reductions)\n\
    \        annual_benefit = risk_value + operational_savings\n        \n       \
    \ # Total cost over time horizon\n        total_cost = (\n            investment.implementation_cost\
    \ + \n            (investment.annual_cost * self.time_horizon)\n        )\n  \
    \      \n        # Total benefit over time horizon\n        total_benefit = annual_benefit\
    \ * self.time_horizon\n        \n        # ROI calculation\n        roi = (total_benefit\
    \ - total_cost) / total_cost if total_cost > 0 else 0\n        \n        # Payback\
    \ period (years)\n        payback_period = total_cost / annual_benefit if annual_benefit\
    \ > 0 else float('inf')\n        \n        return {\n            'investment_name':\
    \ investment.name,\n            'total_cost': total_cost,\n            'annual_cost':\
    \ investment.annual_cost,\n            'implementation_cost': investment.implementation_cost,\n\
    \            'annual_benefit': annual_benefit,\n            'total_benefit': total_benefit,\n\
    \            'roi_percentage': roi * 100,\n            'payback_period_years':\
    \ payback_period,\n            'npv': total_benefit - total_cost  # Net Present\
    \ Value (simplified)\n        }\n\n# Example: Calculate ROI for SIEM investment\n\
    siem_investment = SecurityInvestment(\n    name=\"SIEM Platform\",\n    annual_cost=100000,\
    \  # Licensing + operational\n    implementation_cost=50000\n)\n\nrisk_reductions\
    \ = [\n    RiskReduction(\n        threat=\"Data breach\",\n        likelihood_before=0.15,\
    \  # 15% annual probability\n        likelihood_after=0.05,   # 5% after SIEM\n\
    \        impact=5000000           # $5M average breach cost\n    ),\n    RiskReduction(\n\
    \        threat=\"Ransomware\",\n        likelihood_before=0.10,\n        likelihood_after=0.03,\n\
    \        impact=2000000\n    ),\n    RiskReduction(\n        threat=\"Insider\
    \ threat\",\n        likelihood_before=0.08,\n        likelihood_after=0.02,\n\
    \        impact=1000000\n    )\n]\n\ncalculator = SecurityROICalculator(time_horizon_years=3)\n\
    results = calculator.calculate_roi(\n    siem_investment, \n    risk_reductions,\n\
    \    operational_savings=50000  # Reduced analyst time\n)\n\nprint(f\"SIEM Investment\
    \ ROI: {results['roi_percentage']:.1f}%\")\nprint(f\"Payback Period: {results['payback_period_years']:.1f}\
    \ years\")\nprint(f\"Net Present Value: ${results['npv']:,.0f}\")\n```\n\n**3.\
    \ Security Metrics Dashboard:**\n\nPython - Azure Monitor Integration:\n```python\n\
    from azure.monitor.query import LogsQueryClient, MetricsQueryClient\nfrom azure.identity\
    \ import DefaultAzureCredential\nfrom datetime import datetime, timedelta\n\n\
    class SecurityMetricsDashboard:\n    \"\"\"Collect and analyze security metrics\"\
    \"\"\n    \n    def __init__(self, workspace_id: str):\n        credential = DefaultAzureCredential()\n\
    \        self.logs_client = LogsQueryClient(credential)\n        self.metrics_client\
    \ = MetricsQueryClient(credential)\n        self.workspace_id = workspace_id\n\
    \        \n    def get_security_incidents_count(self, days: int = 30) -> int:\n\
    \        \"\"\"Count security incidents\"\"\"\n        query = \"\"\"\n      \
    \  SecurityIncident\n        | where TimeGenerated > ago({}d)\n        | summarize\
    \ count()\n        \"\"\".format(days)\n        \n        response = self.logs_client.query_workspace(\n\
    \            self.workspace_id,\n            query,\n            timespan=timedelta(days=days)\n\
    \        )\n        \n        return response.tables[0].rows[0][0]\n    \n   \
    \ def get_mttr(self, days: int = 30) -> float:\n        \"\"\"Calculate Mean Time\
    \ To Respond\"\"\"\n        query = \"\"\"\n        SecurityIncident\n       \
    \ | where TimeGenerated > ago({}d)\n        | where Status == \"Closed\"\n   \
    \     | extend ResolutionTime = datetime_diff('hour', ClosedTime, CreatedTime)\n\
    \        | summarize MTTR = avg(ResolutionTime)\n        \"\"\".format(days)\n\
    \        \n        response = self.logs_client.query_workspace(\n            self.workspace_id,\n\
    \            query,\n            timespan=timedelta(days=days)\n        )\n  \
    \      \n        return response.tables[0].rows[0][0]\n    \n    def get_vulnerability_metrics(self)\
    \ -> Dict:\n        \"\"\"Get vulnerability management metrics\"\"\"\n       \
    \ query = \"\"\"\n        SecurityVulnerability\n        | where TimeGenerated\
    \ > ago(30d)\n        | summarize \n            Total = count(),\n           \
    \ Critical = countif(Severity == \"Critical\"),\n            High = countif(Severity\
    \ == \"High\"),\n            Medium = countif(Severity == \"Medium\"),\n     \
    \       Low = countif(Severity == \"Low\"),\n            AvgTimeToRemediate =\
    \ avg(TimeToRemediate)\n        \"\"\"\n        \n        response = self.logs_client.query_workspace(\n\
    \            self.workspace_id,\n            query,\n            timespan=timedelta(days=30)\n\
    \        )\n        \n        row = response.tables[0].rows[0]\n        return\
    \ {\n            'total': row[0],\n            'critical': row[1],\n         \
    \   'high': row[2],\n            'medium': row[3],\n            'low': row[4],\n\
    \            'avg_time_to_remediate_hours': row[5]\n        }\n    \n    def generate_executive_report(self)\
    \ -> Dict:\n        \"\"\"Generate executive security metrics report\"\"\"\n \
    \       return {\n            'period': '30 days',\n            'incidents': self.get_security_incidents_count(),\n\
    \            'mttr_hours': self.get_mttr(),\n            'vulnerabilities': self.get_vulnerability_metrics(),\n\
    \            'generated_at': datetime.utcnow().isoformat()\n        }\n```\n\n\
    **4. FedRAMP Required Metrics:**\n\n- **Security Assessment Metrics:**\n  - Number\
    \ of security controls assessed\n  - Pass/fail rate by control family\n  - Remediation\
    \ timeline for findings\n  \n- **Continuous Monitoring Metrics:**\n  - Configuration\
    \ change frequency\n  - Unauthorized change detection rate\n  - Asset inventory\
    \ accuracy\n  \n- **Incident Response Metrics:**\n  - Incident count by severity\n\
    \  - Mean Time To Detect (MTTD)\n  - Mean Time To Respond (MTTR)\n  - Mean Time\
    \ To Recover (MTTR)\n  \n- **Vulnerability Management Metrics:**\n  - Vulnerability\
    \ scan coverage\n  - Critical vulnerability patching timeline\n  - False positive\
    \ rate\n  \n"
  evidence_collection:
  - Security metrics dashboard
  - ROI calculation documentation
  - Executive security reports
  - Trend analysis
  - Investment justification
  azure_services:
  - Azure Monitor
  - Microsoft Sentinel
  - Power BI
  - Azure Log Analytics
tags:
- metrics
- roi
- effectiveness
- security-gap
related_ksis:
- KSI-PIY-06
evidence_artifacts:
- artifact_type: logs
  name: Authentication logs with MFA details
  source: Azure Monitor - SigninLogs
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: Conditional Access policies export
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: JSON
- artifact_type: report
  name: Authentication methods compliance report
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: CSV
automation:
  automation_1:
    description: Azure Policy for compliance enforcement
    implementation: "# Azure Policy for compliance enforcement\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.investment.missing_metrics \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.investment.missing_metrics\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.investment.missing_metrics\
      \ compliance\n      python validate.py --pattern piy.investment.missing_metrics"
    azure_services: &id001
    - Azure Blob Storage
    - Azure Confidential Computing
    - Azure Monitor
    - Azure Pipelines
    - Azure Private Link
    - Log Analytics
  automation_2:
    description: Azure Monitor for continuous monitoring
    implementation: "# Azure Monitor for continuous monitoring\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.investment.missing_metrics \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.investment.missing_metrics\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.investment.missing_metrics\
      \ compliance\n      python validate.py --pattern piy.investment.missing_metrics"
    azure_services: *id001
  automation_3:
    description: Log Analytics queries for compliance validation
    implementation: "# Log Analytics queries for compliance validation\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.investment.missing_metrics \\\n      --code-path ./src\n\
      \    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.investment.missing_metrics\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.investment.missing_metrics\
      \ compliance\n      python validate.py --pattern piy.investment.missing_metrics"
    azure_services: *id001
implementation:
  prerequisites:
  - Azure subscription with required permissions
  - Microsoft Entra ID tenant configured
  steps:
  - step: 1
    action: Review FedRAMP 20x requirement documentation
    azure_service: null
    validation: Manual verification required
  - step: 2
    action: Identify systems and resources in scope
    azure_service: null
    validation: Manual verification required
  - step: 3
    action: Create resource group for FedRAMP resources
    azure_service: null
    validation: Manual verification required
  - step: 4
    action: Set up Azure Key Vault for secrets management
    azure_service: null
    validation: Manual verification required
  - step: 5
    action: Configure Log Analytics workspace
    azure_service: null
    validation: Manual verification required
  - step: 6
    action: Create Standard Operating Procedures (SOPs)
    azure_service: null
    validation: Manual verification required
  - step: 7
    action: Get policy documentation approved by stakeholders
    azure_service: null
    validation: Manual verification required
  - step: 8
    action: Train staff on new procedures
    azure_service: null
    validation: Manual verification required
  - step: 9
    action: Set up periodic compliance reviews
    azure_service: null
    validation: Manual verification required
  - step: 10
    action: Document evidence collection process
    azure_service: null
    validation: Manual verification required
ssp_mapping:
  control_family: PM - Program Management
  control_numbers:
  - PM-9
  - PM-14
  - CA-7
  ssp_sections:
  - section: 'PM-9: Security Investment Effectiveness'
    description_template: The system implements Security Investment Effectiveness
      controls in accordance with FedRAMP 20x requirements. Monitor the effectiveness
      of the organization's investments in achieving security objectives.... Implementation
      leverages Azure native services combined with application-level controls and
      automated monitoring to ensure continuous compliance.
    implementation_details: Azure services including Azure Blob Storage, Azure Confidential
      Computing, Azure Monitor are configured to enforce compliance requirements.
      Infrastructure-as-code (Bicep/Terraform) templates ensure consistent deployment
      across environments. Automated compliance checking in CI/CD pipelines validates
      all changes against Security Investment Effectiveness requirements before deployment.
    evidence_references:
    - Configuration exports
    - Compliance reports
azure_guidance:
  recommended_services:
  - service: Azure Blob Storage
    tier: Standard
    purpose: Required for Azure Blob Storage functionality
    alternatives: []
  - service: Azure Confidential Computing
    tier: Standard
    purpose: Required for Azure Confidential Computing functionality
    alternatives: []
  - service: Azure Monitor
    tier: Standard
    purpose: Required for Azure Monitor functionality
    alternatives: []
  - service: Azure Pipelines
    tier: Standard
    purpose: Required for Azure Pipelines functionality
    alternatives: []
  - service: Azure Private Link
    tier: Standard
    purpose: Required for Azure Private Link functionality
    alternatives: []
  well_architected_framework:
    pillar: Security
    design_area: Identity and Access Management
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-06
    requirement_name: Security Investment Effectiveness
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant markdown implementation of piy.investment.missing_metrics
    code_sample: |
      # Security Investment Metrics Dashboard
      
      ## Executive Summary - Q4 2024
      
      **Overall Security Posture:** 🟢 GREEN  
      **Trend:** ↗️ Improving  
      **ROI:** 287% (3-year horizon)
      
      ## Key Performance Indicators
      
      | Metric | Target | Actual | Status |
      |--------|--------|--------|--------|
      | Mean Time To Detect | <1h | 45m | 🟢 |
      | Mean Time To Respond | <4h | 3.5h | 🟢 |
      | Critical Vulns Patched | 100% in 14d | 100% | 🟢 |
      | Security Incidents | <5/month | 3 | 🟢 |
      | MFA Adoption | 100% | 95% | 🟡 |
      
      ## Investment ROI Analysis
      
      ### SIEM Platform
      - **Investment:** $350K (3-year)
      - **Annual Benefit:** $640K (risk reduction)
      - **ROI:** 287%
      - **Payback Period:** 1.6 years
      
      ### Zero Trust Implementation  
      - **Investment:** $500K (3-year)
      - **Annual Benefit:** $800K (reduced breach risk)
      - **ROI:** 380%
      - **Payback Period:** 1.9 years
      
      ## Risk Reduction Value
      
      - **Data Breach Risk:** Reduced from 15% to 5% annually
      - **Ransomware Risk:** Reduced from 10% to 3% annually  
      - **Total Risk Value:** $850K/year reduction
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant markdown code violating piy.investment.missing_metrics
    code_sample: '# Non-compliant code missing piy.investment.missing_metrics requirements'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts: []
---
pattern_id: piy.supply_chain.unvetted_dependencies
name: Unvetted Supply Chain Dependencies
description: Detects dependencies without supply chain security validation (KSI-PIY-07)
family: PIY
severity: HIGH
ksi_id: KSI-PIY-07
nist_controls:
- sa-9
- sa-12
- sr-2
- sr-3
- sr-4
- sr-5
category: supply_chain_security
pattern_type: dependency_pattern
languages:
  python:
    regex_fallback: (?i)(requirements\.txt|pyproject\.toml|setup\.py|pipfile)
    positive_indicators:
    - requirements.txt
    - pyproject.toml
    negative_indicators:
    - '# vetted'
    - '# approved'
    - '# sbom'
  java:
    regex_fallback: (pom\.xml|build\.gradle|dependency>)
    positive_indicators:
    - dependency
    - groupId
    - artifactId
    - version
    negative_indicators:
    - verified
    - scanned
    - approved
  typescript:
    regex_fallback: (package\.json|package-lock\.json|yarn\.lock)
    positive_indicators:
    - package.json
    - package-lock.json
    - yarn.lock
    - dependencies
    negative_indicators:
    - vetted
    - approved
    - sbom
    - scanned
  csharp:
    regex_fallback: (\.csproj|packages\.config|paket\.dependencies)
    positive_indicators:
    - .csproj
    - packages.config
    - paket.dependencies
    - PackageReference
    negative_indicators:
    - vetted
    - approved
    - scanned
    - verified
finding:
  title_template: Unvetted supply chain dependencies detected
  description_template: Dependencies lack supply chain security vetting. KSI-PIY-07
    requires vendor/dependency risk assessment.
  remediation_template: "Implement Supply Chain Security for Dependencies:\n\n**1.\
    \ Dependency Vetting Process:**\n\nDependency Approval Checklist:\n```yaml\ndependency_approval_criteria:\n\
    \  licensing:\n    - Approved licenses: [MIT, Apache-2.0, BSD-3-Clause]\n    -\
    \ Prohibited licenses: [GPL, AGPL, Commercial-Unknown]\n    - License compatibility\
    \ verified\n    \n  security:\n    - No known critical vulnerabilities\n    -\
    \ Active security response team\n    - CVE response time < 30 days\n    - Security\
    \ advisories published\n    \n  maintenance:\n    - Active development (commits\
    \ in last 90 days)\n    - Responsive maintainers\n    - Version release cadence\n\
    \    - Long-term support commitment\n    \n  provenance:\n    - Official package\
    \ repository only (PyPI, npm, NuGet)\n    - Package signing verified\n    - Maintainer\
    \ identity verified\n    - No typosquatting risk\n    \n  alternatives:\n    -\
    \ Evaluated 3+ alternatives\n    - Justification documented\n    - Cost-benefit\
    \ analysis\n```\n\n**2. Automated Supply Chain Scanning:**\n\nGitHub Actions -\
    \ Comprehensive Supply Chain Security:\n```yaml\nname: Supply Chain Security\n\
    \non:\n  push:\n    paths:\n      - 'requirements.txt'\n      - 'package.json'\n\
    \      - '*.csproj'\n  schedule:\n    - cron: '0 0 * * *'  # Daily\n\njobs:\n\
    \  supply-chain-scan:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\
    \      \n      # Dependency Review (GitHub native)\n      - name: Dependency Review\n\
    \        uses: actions/dependency-review-action@v4\n        with:\n          fail-on-severity:\
    \ high\n          \n      # SBOM Generation\n      - name: Generate SBOM\n   \
    \     uses: anchore/sbom-action@v0\n        with:\n          format: cyclonedx-json\n\
    \          output-file: sbom.json\n          \n      - name: Upload SBOM\n   \
    \     uses: actions/upload-artifact@v4\n        with:\n          name: sbom\n\
    \          path: sbom.json\n          \n      # Vulnerability Scanning\n     \
    \ - name: Scan dependencies (Snyk)\n        uses: snyk/actions/python@master\n\
    \        env:\n          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}\n        with:\n\
    \          command: test\n          args: --severity-threshold=high --file=requirements.txt\n\
    \          \n      # Supply Chain Levels for Software Artifacts (SLSA)\n     \
    \ - name: SLSA Provenance\n        uses: slsa-framework/slsa-github-generator@v1.9.0\n\
    \        with:\n          provenance-name: provenance.intoto.jsonl\n         \
    \ \n      # License Compliance\n      - name: Check Licenses\n        uses: fossas/fossa-action@main\n\
    \        with:\n          api-key: ${{ secrets.FOSSA_API_KEY }}\n      \n    \
    \  # Dependency Confusion Protection\n      - name: Check for Dependency Confusion\n\
    \        run: |\n          pip install pip-audit\n          pip-audit --desc --fix\n\
    ```\n\n**3. Approved Dependency Registry:**\n\nPython - Vetted Dependencies List:\n\
    ```yaml\n# approved_dependencies.yaml\n# All production dependencies must be on\
    \ this list\n\npython:\n  frameworks:\n    - name: fastapi\n      versions: [\"\
    >=0.100.0,<1.0.0\"]\n      vetted_date: \"2024-01-15\"\n      vetted_by: \"security-team\"\
    \n      justification: \"Modern async framework, active security team\"\n    \
    \  alternatives_considered: [\"flask\", \"django\"]\n      \n    - name: django\n\
    \      versions: [\">=4.2.0,<5.0.0\"]\n      vetted_date: \"2024-01-15\"\n   \
    \   vetted_by: \"security-team\"\n      justification: \"Mature framework, excellent\
    \ security record\"\n      \n  security:\n    - name: cryptography\n      versions:\
    \ [\">=41.0.0\"]\n      vetted_date: \"2024-01-15\"\n      vetted_by: \"security-team\"\
    \n      justification: \"FIPS 140-2 validated, industry standard\"\n      \n \
    \ azure_sdk:\n    - name: azure-identity\n      versions: [\">=1.15.0\"]\n   \
    \   vetted_date: \"2024-01-15\"\n      vetted_by: \"security-team\"\n      justification:\
    \ \"Official Microsoft SDK\"\n      \nprohibited_packages:\n  - name: pickle\n\
    \    reason: \"Insecure deserialization risk\"\n    alternatives: [\"json\", \"\
    msgpack\"]\n    \n  - name: eval/exec\n    reason: \"Code injection risk\"\n \
    \   alternatives: [\"ast.literal_eval for data\", \"custom parsers\"]\n```\n\n\
    **4. Continuous Monitoring:**\n\nPython - Dependency Monitoring Service:\n```python\n\
    import requests\nfrom typing import List, Dict\nfrom dataclasses import dataclass\n\
    \n@dataclass\nclass Vulnerability:\n    cve_id: str\n    severity: str\n    package:\
    \ str\n    affected_versions: str\n    fixed_version: str\n    \nclass SupplyChainMonitor:\n\
    \    \"\"\"Monitor dependencies for new vulnerabilities\"\"\"\n    \n    def __init__(self,\
    \ github_token: str):\n        self.github_token = github_token\n        self.headers\
    \ = {\n            'Authorization': f'token {github_token}',\n            'Accept':\
    \ 'application/vnd.github.v3+json'\n        }\n        \n    def check_github_advisories(self,\
    \ package: str) -> List[Vulnerability]:\n        \"\"\"Check GitHub Security Advisories\"\
    \"\"\n        url = f\"https://api.github.com/advisories?affects={package}\"\n\
    \        response = requests.get(url, headers=self.headers)\n        \n      \
    \  vulnerabilities = []\n        for advisory in response.json():\n          \
    \  vulnerabilities.append(Vulnerability(\n                cve_id=advisory['cve_id'],\n\
    \                severity=advisory['severity'],\n                package=package,\n\
    \                affected_versions=advisory['vulnerable_versions'],\n        \
    \        fixed_version=advisory['patched_versions']\n            ))\n        \n\
    \        return vulnerabilities\n    \n    def monitor_dependencies(self, requirements_file:\
    \ str) -> Dict:\n        \"\"\"Monitor all dependencies for vulnerabilities\"\"\
    \"\n        with open(requirements_file) as f:\n            packages = [\n   \
    \             line.strip().split('==')[0] \n                for line in f \n \
    \               if line.strip() and not line.startswith('#')\n            ]\n\
    \        \n        all_vulnerabilities = {}\n        for package in packages:\n\
    \            vulns = self.check_github_advisories(package)\n            if vulns:\n\
    \                all_vulnerabilities[package] = vulns\n        \n        return\
    \ {\n            'total_packages': len(packages),\n            'vulnerable_packages':\
    \ len(all_vulnerabilities),\n            'vulnerabilities': all_vulnerabilities,\n\
    \            'critical_count': sum(\n                1 for vulns in all_vulnerabilities.values()\
    \ \n                for v in vulns \n                if v.severity == 'critical'\n\
    \            )\n        }\n```\n\n**5. FedRAMP Supply Chain Requirements:**\n\n\
    - **Vendor Risk Assessment:**\n  - Security posture evaluation\n  - Financial\
    \ stability check\n  - Compliance certifications\n  - Incident response capability\n\
    \  \n- **Software Bill of Materials (SBOM):**\n  - CycloneDX or SPDX format\n\
    \  - Component name, version, supplier\n  - License information\n  - Known vulnerabilities\n\
    \  \n- **Continuous Monitoring:**\n  - Daily vulnerability scanning\n  - License\
    \ compliance checks\n  - Dependency update tracking\n  - Security advisory monitoring\n\
    \  \n- **Incident Response:**\n  - Supply chain incident plan\n  - Vendor breach\
    \ notification process\n  - Rapid patching capability\n  \n"
  evidence_collection:
  - Approved dependencies list
  - Dependency vetting documentation
  - SBOM (CycloneDX or SPDX)
  - Vulnerability scan results
  - Vendor risk assessments
  azure_services:
  - Azure Artifacts (private package registry)
  - Microsoft Defender for Cloud (dependency scanning)
  - Azure DevOps (SBOM generation)
tags:
- supply-chain
- dependencies
- sbom
- security-gap
related_ksis:
- KSI-PIY-07
- KSI-TPR-03
- KSI-TPR-04
evidence_artifacts:
- artifact_type: logs
  name: Authentication logs with MFA details
  source: Azure Monitor - SigninLogs
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: Conditional Access policies export
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: JSON
- artifact_type: report
  name: Authentication methods compliance report
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: CSV
automation:
  automation_1:
    description: Azure Policy for compliance enforcement
    implementation: "# Azure Policy for compliance enforcement\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.supply_chain.unvetted_dependencies \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.supply_chain.unvetted_dependencies\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.supply_chain.unvetted_dependencies\
      \ compliance\n      python validate.py --pattern piy.supply_chain.unvetted_dependencies"
    azure_services: &id001
    - Azure Blob Storage
    - Azure Confidential Computing
    - Azure Monitor
    - Azure Pipelines
    - Azure Private Link
    - Log Analytics
  automation_2:
    description: Azure Monitor for continuous monitoring
    implementation: "# Azure Monitor for continuous monitoring\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.supply_chain.unvetted_dependencies \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.supply_chain.unvetted_dependencies\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.supply_chain.unvetted_dependencies\
      \ compliance\n      python validate.py --pattern piy.supply_chain.unvetted_dependencies"
    azure_services: *id001
  automation_3:
    description: Log Analytics queries for compliance validation
    implementation: "# Log Analytics queries for compliance validation\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.supply_chain.unvetted_dependencies \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.supply_chain.unvetted_dependencies\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.supply_chain.unvetted_dependencies\
      \ compliance\n      python validate.py --pattern piy.supply_chain.unvetted_dependencies"
    azure_services: *id001
implementation:
  prerequisites:
  - Azure subscription with required permissions
  - Microsoft Entra ID tenant configured
  steps:
  - step: 1
    action: Review FedRAMP 20x requirement documentation
    azure_service: null
    validation: Manual verification required
  - step: 2
    action: Identify systems and resources in scope
    azure_service: null
    validation: Manual verification required
  - step: 3
    action: Create resource group for FedRAMP resources
    azure_service: null
    validation: Manual verification required
  - step: 4
    action: Set up Azure Key Vault for secrets management
    azure_service: null
    validation: Manual verification required
  - step: 5
    action: Configure Log Analytics workspace
    azure_service: null
    validation: Manual verification required
  - step: 6
    action: Create Standard Operating Procedures (SOPs)
    azure_service: null
    validation: Manual verification required
  - step: 7
    action: Get policy documentation approved by stakeholders
    azure_service: null
    validation: Manual verification required
  - step: 8
    action: Train staff on new procedures
    azure_service: null
    validation: Manual verification required
  - step: 9
    action: Set up periodic compliance reviews
    azure_service: null
    validation: Manual verification required
  - step: 10
    action: Document evidence collection process
    azure_service: null
    validation: Manual verification required
ssp_mapping:
  control_family: SA - System and Services Acquisition
  control_numbers:
  - SA-9
  - SA-12
  - SR-2
  - SR-3
  - SR-4
  - SR-5
  ssp_sections:
  - section: 'SA-9: Supply Chain Risk Management'
    description_template: The system implements Supply Chain Risk Management controls
      in accordance with FedRAMP 20x requirements. Document risk management decisions
      for software supply chain security.... Implementation leverages Azure native
      services combined with application-level controls and automated monitoring to
      ensure continuous compliance.
    implementation_details: Azure services including Azure Blob Storage, Azure Confidential
      Computing, Azure Monitor are configured to enforce compliance requirements.
      Infrastructure-as-code (Bicep/Terraform) templates ensure consistent deployment
      across environments. Automated compliance checking in CI/CD pipelines validates
      all changes against Supply Chain Risk Management requirements before deployment.
    evidence_references:
    - Configuration exports
    - Compliance reports
azure_guidance:
  recommended_services:
  - service: Azure Blob Storage
    tier: Standard
    purpose: Required for Azure Blob Storage functionality
    alternatives: []
  - service: Azure Confidential Computing
    tier: Standard
    purpose: Required for Azure Confidential Computing functionality
    alternatives: []
  - service: Azure Monitor
    tier: Standard
    purpose: Required for Azure Monitor functionality
    alternatives: []
  - service: Azure Pipelines
    tier: Standard
    purpose: Required for Azure Pipelines functionality
    alternatives: []
  - service: Azure Private Link
    tier: Standard
    purpose: Required for Azure Private Link functionality
    alternatives: []
  well_architected_framework:
    pillar: Security
    design_area: Identity and Access Management
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-07
    requirement_name: Supply Chain Risk Management
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant python implementation of piy.supply_chain.unvetted_dependencies
    code_sample: "# Python compliant code for piy.supply_chain.unvetted_dependencies\n\
      import logging\n\ndef compliant_function():\n    \"\"\"Implements piy.supply_chain.unvetted_dependencies\
      \ requirements.\"\"\"\n    logging.info(\"Compliant implementation\")\n    return\
      \ True"
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant python code violating piy.supply_chain.unvetted_dependencies
    code_sample: "# Python non-compliant code for piy.supply_chain.unvetted_dependencies\n\
      def non_compliant_function():\n    # Missing required implementation\n    pass"
    expected_severity: HIGH
    expected_finding: true
  validation_scripts: []
---
pattern_id: piy.executive.missing_governance
name: Missing Executive Security Governance
description: Detects absence of executive security oversight (KSI-PIY-08)
family: PIY
severity: MEDIUM
ksi_id: KSI-PIY-08
nist_controls:
- pm-1
- pm-2
- pm-9
category: governance
pattern_type: documentation_pattern
languages:
  markdown:
    regex_fallback: (?i)(executive|ciso|board|governance|oversight|charter)
    positive_indicators:
    - CISO
    - board
    - executive
    - governance
    - charter
    negative_indicators:
    - meeting schedule
    - reporting structure
    - escalation
finding:
  title_template: Missing executive security governance documentation
  description_template: Organization lacks documented executive security oversight.
    KSI-PIY-08 requires executive-level security governance.
  remediation_template: "Implement Executive Security Governance:\n\n**1. Security\
    \ Governance Structure:**\n\n```yaml\nsecurity_governance:\n  ciso:\n    title:\
    \ \"Chief Information Security Officer\"\n    reports_to: \"CEO\"  # Or CTO/CIO\n\
    \    direct_reports:\n      - \"Director of Security Operations\"\n      - \"\
    Director of Security Architecture\"\n      - \"Director of Compliance & Risk\"\
    \n      - \"Director of Identity & Access Management\"\n    responsibilities:\n\
    \      - \"Overall security strategy\"\n      - \"Risk management\"\n      - \"\
    Compliance oversight\"\n      - \"Incident response leadership\"\n      - \"Security\
    \ budget management\"\n      \n  security_steering_committee:\n    chair: \"CISO\"\
    \n    members:\n      - \"CEO\"\n      - \"CTO\"\n      - \"CFO\"\n      - \"\
    General Counsel\"\n      - \"VP Engineering\"\n      - \"VP Operations\"\n   \
    \ meeting_frequency: \"Monthly\"\n    responsibilities:\n      - \"Approve security\
    \ policies\"\n      - \"Review risk assessments\"\n      - \"Allocate security\
    \ budget\"\n      - \"Oversee major security initiatives\"\n      \n  board_security_committee:\n\
    \    chair: \"Board Member with Security Expertise\"\n    members:\n      - \"\
    3+ Board Members\"\n      - \"CISO (ex-officio)\"\n    meeting_frequency: \"Quarterly\"\
    \n    responsibilities:\n      - \"Review enterprise security posture\"\n    \
    \  - \"Approve security strategy\"\n      - \"Oversee cyber insurance\"\n    \
    \  - \"Review major incidents\"\n      - \"Ensure regulatory compliance\"\n```\n\
    \n**2. Executive Reporting Framework:**\n\nPowerPoint/Markdown - Executive Security\
    \ Dashboard:\n```markdown\n# Monthly Executive Security Report\n**Period:** December\
    \ 2024  \n**Prepared by:** CISO Office  \n**Classification:** Confidential  \n\
    \n## Executive Summary\n\n- **Overall Posture:** \U0001F7E2 GREEN\n- **Trend:**\
    \ ↗️ Improving\n- **Critical Risks:** 0\n- **Major Incidents:** 0\n\n## Key Metrics\n\
    \n| Metric | Target | Actual | Trend |\n|--------|--------|--------|-------|\n\
    | Mean Time To Detect | 1h | 45m | \U0001F7E2 ↗️ |\n| Mean Time To Respond | 4h\
    \ | 3.5h | \U0001F7E2 ↗️ |\n| Critical Vulns Patched | 100% in 14d | 100% | \U0001F7E2\
    \ → |\n| Security Training | 100% | 98% | \U0001F7E1 ↗️ |\n| MFA Adoption | 100%\
    \ | 95% | \U0001F7E1 ↗️ |\n\n## Risk Landscape\n\n### Top 3 Risks\n1. **Supply\
    \ Chain Attack** (Likelihood: Medium, Impact: High)\n   - Mitigation: Enhanced\
    \ vendor vetting, SBOM generation\n   - Target completion: Q1 2025\n\n2. **Ransomware**\
    \ (Likelihood: Medium, Impact: Critical)\n   - Mitigation: Immutable backups,\
    \ EDR deployment\n   - Status: 85% complete\n\n3. **Insider Threat** (Likelihood:\
    \ Low, Impact: High)\n   - Mitigation: DLP, privileged access management\n   -\
    \ Status: Ongoing monitoring\n\n## Security Initiatives\n\n### In Progress\n-\
    \ **Zero Trust Architecture** (60% complete)\n  - Budget: $500K\n  - Expected\
    \ completion: Q2 2025\n  - ROI: Reduce breach risk by 40%\n\n- **SIEM Upgrade**\
    \ (80% complete)\n  - Budget: $200K\n  - Expected completion: Q1 2025\n  - ROI:\
    \ Improve detection by 50%\n\n### Proposed\n- **Security Awareness Platform**\n\
    \  - Budget: $100K\n  - Expected start: Q1 2025\n  - ROI: Reduce phishing success\
    \ by 60%\n\n## Compliance Status\n\n| Framework | Status | Next Audit |\n|-----------|--------|------------|\n\
    | FedRAMP | \U0001F7E2 Authorized | June 2025 |\n| SOC 2 Type II | \U0001F7E2\
    \ Compliant | March 2025 |\n| ISO 27001 | \U0001F7E2 Certified | September 2025\
    \ |\n\n## Incidents & Threats\n\n- **Incidents This Month:** 3 (all resolved)\n\
    - **Phishing Attempts Blocked:** 1,247\n- **Malware Blocked:** 89 attempts\n-\
    \ **DDoS Attacks:** 2 (mitigated)\n\n## Budget Status\n\n- **Annual Budget:**\
    \ $2.5M\n- **Spent YTD:** $1.8M (72%)\n- **Forecast:** On track\n- **Proposed\
    \ Increases:** +$500K for Q1 2025 initiatives\n\n## Recommendations\n\n1. **Approve\
    \ Zero Trust acceleration** (+$100K budget)\n2. **Expand security team** (+2 FTEs\
    \ for SOC)\n3. **Enhance third-party risk program** (+$50K tools)\n\n---\n\n**Next\
    \ Report:** January 15, 2025  \n**Questions:** ciso@company.com  \n```\n\n**3.\
    \ Security Policy Framework:**\n\n```yaml\nsecurity_policies:\n  information_security_policy:\n\
    \    owner: \"CISO\"\n    approved_by: \"CEO\"\n    approved_date: \"2024-01-15\"\
    \n    review_frequency: \"Annual\"\n    scope: \"Enterprise-wide\"\n    status:\
    \ \"Active\"\n    \n  acceptable_use_policy:\n    owner: \"CISO\"\n    approved_by:\
    \ \"Security Steering Committee\"\n    approved_date: \"2024-01-15\"\n    review_frequency:\
    \ \"Annual\"\n    \n  incident_response_policy:\n    owner: \"Director of Security\
    \ Operations\"\n    approved_by: \"CISO\"\n    approved_date: \"2024-01-15\"\n\
    \    review_frequency: \"Semi-annual\"\n    \n  data_classification_policy:\n\
    \    owner: \"Director of Compliance\"\n    approved_by: \"CISO\"\n    approved_date:\
    \ \"2024-01-15\"\n    review_frequency: \"Annual\"\n```\n\n**4. Escalation Matrix:**\n\
    \n```yaml\nincident_escalation:\n  severity_1_critical:\n    initial_response:\
    \ \"Security Operations Center (24/7)\"\n    escalation_timeline:\n      - time:\
    \ \"Immediate\"\n        notify: [\"CISO\", \"Director of Security Operations\"\
    ]\n      - time: \"15 minutes\"\n        notify: [\"CTO\", \"CEO\"]\n      - time:\
    \ \"30 minutes\"\n        notify: [\"Board Security Committee Chair\"]\n    communication_channels:\n\
    \      - \"PagerDuty\"\n      - \"SMS/Phone\"\n      - \"Encrypted messaging (Signal)\"\
    \n      \n  severity_2_high:\n    initial_response: \"Security Operations Center\"\
    \n    escalation_timeline:\n      - time: \"Immediate\"\n        notify: [\"Director\
    \ of Security Operations\"]\n      - time: \"1 hour\"\n        notify: [\"CISO\"\
    ]\n      - time: \"4 hours\"\n        notify: [\"CTO\"]\n        \n  severity_3_medium:\n\
    \    initial_response: \"Security Operations Center\"\n    escalation_timeline:\n\
    \      - time: \"Immediate\"\n        notify: [\"Security Operations Manager\"\
    ]\n      - time: \"4 hours\"\n        notify: [\"Director of Security Operations\"\
    ]\n      - time: \"24 hours\"\n        notify: [\"CISO\"]\n```\n\n**5. FedRAMP\
    \ Executive Requirements:**\n\n- **Designated Senior Security Official:**\n  -\
    \ Executive-level (C-suite or direct report)\n  - Authority over security budget\n\
    \  - Direct access to CEO/board\n  \n- **Security Steering Committee:**\n  - Quarterly\
    \ meetings minimum\n  - Cross-functional representation\n  - Policy approval authority\n\
    \  \n- **Board Oversight:**\n  - Quarterly security briefings\n  - Annual strategy\
    \ review\n  - Risk appetite setting\n  - Cyber insurance review\n  \n- **Documented\
    \ Responsibilities:**\n  - Security governance charter\n  - Roles and responsibilities\
    \ matrix\n  - Escalation procedures\n  - Reporting structure\n  \n"
  evidence_collection:
  - Security governance charter
  - Executive reporting examples
  - Security Steering Committee meeting minutes
  - Board security briefing materials
  - Escalation matrix documentation
  azure_services:
  - Azure Boards (governance tracking)
  - Power BI (executive dashboards)
  - Microsoft Teams (executive communication)
tags:
- governance
- executive
- oversight
- security-gap
related_ksis:
- KSI-PIY-08
evidence_artifacts:
- artifact_type: logs
  name: Authentication logs with MFA details
  source: Azure Monitor - SigninLogs
  frequency: daily
  retention_months: 36
  format: JSON
- artifact_type: configuration
  name: Conditional Access policies export
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: JSON
- artifact_type: report
  name: Authentication methods compliance report
  source: Microsoft Graph API
  frequency: weekly
  retention_months: 36
  format: CSV
automation:
  automation_1:
    description: Azure Policy for compliance enforcement
    implementation: "# Azure Policy for compliance enforcement\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.executive.missing_governance \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.executive.missing_governance\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.executive.missing_governance\
      \ compliance\n      python validate.py --pattern piy.executive.missing_governance"
    azure_services: &id001
    - Azure Blob Storage
    - Azure Confidential Computing
    - Azure Monitor
    - Azure Pipelines
    - Azure Private Link
    - Log Analytics
  automation_2:
    description: Azure Monitor for continuous monitoring
    implementation: "# Azure Monitor for continuous monitoring\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.executive.missing_governance \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.executive.missing_governance\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.executive.missing_governance\
      \ compliance\n      python validate.py --pattern piy.executive.missing_governance"
    azure_services: *id001
  automation_3:
    description: Log Analytics queries for compliance validation
    implementation: "# Log Analytics queries for compliance validation\n# GitHub Actions\n\
      - name: PIY Compliance Check\n  run: |\n    python -m fedramp_20x_mcp.analyzers.generic_analyzer\
      \ \\\n      --pattern piy.executive.missing_governance \\\n      --code-path\
      \ ./src\n    \n# Azure Pipelines\n- task: PowerShell@2\n  displayName: 'piy.executive.missing_governance\
      \ Validation'\n  inputs:\n    script: |\n      # Validate piy.executive.missing_governance\
      \ compliance\n      python validate.py --pattern piy.executive.missing_governance"
    azure_services: *id001
implementation:
  prerequisites:
  - Azure subscription with required permissions
  - Microsoft Entra ID tenant configured
  steps:
  - step: 1
    action: Review FedRAMP 20x requirement documentation
    azure_service: null
    validation: Manual verification required
  - step: 2
    action: Identify systems and resources in scope
    azure_service: null
    validation: Manual verification required
  - step: 3
    action: Create resource group for FedRAMP resources
    azure_service: null
    validation: Manual verification required
  - step: 4
    action: Set up Azure Key Vault for secrets management
    azure_service: null
    validation: Manual verification required
  - step: 5
    action: Configure Log Analytics workspace
    azure_service: null
    validation: Manual verification required
  - step: 6
    action: Create Standard Operating Procedures (SOPs)
    azure_service: null
    validation: Manual verification required
  - step: 7
    action: Get policy documentation approved by stakeholders
    azure_service: null
    validation: Manual verification required
  - step: 8
    action: Train staff on new procedures
    azure_service: null
    validation: Manual verification required
  - step: 9
    action: Set up periodic compliance reviews
    azure_service: null
    validation: Manual verification required
  - step: 10
    action: Document evidence collection process
    azure_service: null
    validation: Manual verification required
ssp_mapping:
  control_family: PM - Program Management
  control_numbers:
  - PM-1
  - PM-2
  - PM-9
  ssp_sections:
  - section: 'PM-1: Executive Support'
    description_template: The system implements Executive Support controls in accordance
      with FedRAMP 20x requirements. Regularly measure executive support for achieving
      the organization's security objectives.... Implementation leverages Azure native
      services combined with application-level controls and automated monitoring to
      ensure continuous compliance.
    implementation_details: Azure services including Azure Blob Storage, Azure Confidential
      Computing, Azure Monitor are configured to enforce compliance requirements.
      Infrastructure-as-code (Bicep/Terraform) templates ensure consistent deployment
      across environments. Automated compliance checking in CI/CD pipelines validates
      all changes against Executive Support requirements before deployment.
    evidence_references:
    - Configuration exports
    - Compliance reports
azure_guidance:
  recommended_services:
  - service: Azure Blob Storage
    tier: Standard
    purpose: Required for Azure Blob Storage functionality
    alternatives: []
  - service: Azure Confidential Computing
    tier: Standard
    purpose: Required for Azure Confidential Computing functionality
    alternatives: []
  - service: Azure Monitor
    tier: Standard
    purpose: Required for Azure Monitor functionality
    alternatives: []
  - service: Azure Pipelines
    tier: Standard
    purpose: Required for Azure Pipelines functionality
    alternatives: []
  - service: Azure Private Link
    tier: Standard
    purpose: Required for Azure Private Link functionality
    alternatives: []
  well_architected_framework:
    pillar: Security
    design_area: Identity and Access Management
    reference_url: https://learn.microsoft.com/azure/well-architected/security/
compliance_frameworks:
  fedramp_20x:
    requirement_id: KSI-PIY-08
    requirement_name: Executive Support
    impact_levels:
    - Low
    - Moderate
testing:
  positive_test_cases:
  - description: Compliant markdown implementation of piy.executive.missing_governance
    code_sample: |
      # Security Governance Charter
      
      ## Executive Security Governance Structure
      
      ### Chief Information Security Officer (CISO)
      - **Reports To:** CEO
      - **Direct Reports:**
        - Director of Security Operations
        - Director of Security Architecture
        - Director of Compliance & Risk
        - Director of Identity & Access Management
      - **Responsibilities:**
        - Overall security strategy and vision
        - Enterprise risk management
        - Regulatory compliance oversight
        - Incident response leadership
        - Security budget management ($2.5M annually)
      
      ### Security Steering Committee
      - **Chair:** CISO
      - **Members:** CEO, CTO, CFO, General Counsel, VP Engineering
      - **Meeting Frequency:** Monthly
      - **Responsibilities:**
        - Approve security policies and standards
        - Review quarterly risk assessments
        - Allocate security budget and resources
        - Oversee major security initiatives
        - Review incident response effectiveness
      
      ### Board Security Committee
      - **Chair:** Board Member with Security Expertise
      - **Members:** 3+ Board Members, CISO (ex-officio)
      - **Meeting Frequency:** Quarterly
      - **Responsibilities:**
        - Review enterprise security posture
        - Approve annual security strategy
        - Oversee cyber insurance ($5M coverage)
        - Review major security incidents
        - Ensure FedRAMP/SOC 2/ISO 27001 compliance
      
      ## Executive Reporting
      - **Monthly:** Security metrics dashboard to CISO
      - **Quarterly:** Risk assessment to Board Committee
      - **Annual:** Security strategy review and budget planning
    expected_severity: INFO
    expected_finding: true
  negative_test_cases:
  - description: Non-compliant markdown code violating piy.executive.missing_governance
    code_sample: '# Non-compliant code missing piy.executive.missing_governance requirements'
    expected_severity: HIGH
    expected_finding: true
  validation_scripts: []
---
pattern_id: piy.disclosure.no_policy
name: Missing Vulnerability Disclosure
description: Detects absence of vulnerability disclosure policy
family: PIY
severity: HIGH
pattern_type: documentation
languages:
  python:
    regex_fallback: (no|missing|absence).*disclosure
    negative_indicators:
    - "No vulnerability disclosure"
    - "No reporting mechanism"
  csharp:
    regex_fallback: "(?i)((no|missing|absence).*disclosure)"
    negative_indicators:
    - "No vulnerability disclosure"
  java:
    regex_fallback: "(?i)((no|missing|absence).*disclosure)"
    negative_indicators:
    - "No vulnerability disclosure"
  typescript:
    regex_fallback: "(?i)((no|missing|absence).*disclosure)"
    negative_indicators:
    - "No vulnerability disclosure"
finding:
  title_template: Missing vulnerability disclosure policy
  description_template: No vulnerability disclosure mechanism detected. KSI-PIY-03 requires public vulnerability disclosure program.
  remediation_template: Create SECURITY.md with vulnerability reporting process and coordinated disclosure timeline.
tags:
- disclosure
- gap
nist_controls:
- ir-9
related_ksis:
- KSI-PIY-03
---
pattern_id: piy.sdlc.security_integration
name: Security in SDLC
description: Detects security integration in development lifecycle
family: PIY
severity: INFO
pattern_type: configuration
languages:
  yaml:
    regex_fallback: (SAST|security.*scan|threat.*model|dependency.*scan)
    positive_indicators:
    - SAST Scanning
    - Dependency Scanning
    - Threat Modeling
  bicep:
    regex_fallback: "(?i)(SAST|security.*scan|threat.*model|dependency.*scan)"
    positive_indicators:
    - SAST
    - Dependency
finding:
  title_template: Security integrated in SDLC
  description_template: Development workflow includes security checks, compliant with KSI-PIY-04.
  remediation_template: N/A - Positive finding
tags:
- sdlc
- positive
nist_controls:
- sa-3
- sa-8
- sa-11
related_ksis:
- KSI-PIY-04
---
pattern_id: piy.evaluation.methodology
name: Evaluation Methodology Documentation
description: Detects documented evaluation methodology
family: PIY
severity: INFO
pattern_type: documentation
languages:
  markdown:
    regex_fallback: (evaluation|assessment).*method
    positive_indicators:
    - Evaluation
    - methodology
finding:
  title_template: Evaluation methodology documented
  description_template: Evaluation methods are documented, compliant with KSI-PIY-05.
  remediation_template: N/A - Positive finding
tags:
- evaluation
- positive
nist_controls:
- ca-2
related_ksis:
- KSI-PIY-05
---
pattern_id: piy.investment.security_metrics
name: Security Investment Monitoring
description: Detects security investment effectiveness monitoring
family: PIY
severity: INFO
pattern_type: resource
languages:
  terraform:
    ast_queries:
    - resource_type: azurerm_application_insights
      conditions:
      - property_contains:tags.Purpose:Security
    - resource_type: azurerm_monitor_scheduled_query_rules_alert
      conditions:
      - property_contains:tags.Purpose:Security
    regex_fallback: security.*investment|security.*metrics
    positive_indicators:
    - Security Investment
    - security-investment-metrics
finding:
  title_template: Security investment monitoring detected
  description_template: Security investment effectiveness is monitored, compliant with KSI-PIY-06.
  remediation_template: N/A - Positive finding
tags:
- investment
- metrics
- positive
nist_controls:
- pm-14
related_ksis:
- KSI-PIY-06
---
pattern_id: piy.supply_chain.documentation
name: Supply Chain Risk Documentation
description: Detects supply chain security documentation
family: PIY
severity: INFO
pattern_type: documentation
languages:
  markdown:
    regex_fallback: supply.*chain|SBOM|provenance
    positive_indicators:
    - Supply Chain
    - SBOM
    - provenance
finding:
  title_template: Supply chain security documented
  description_template: Supply chain risk decisions are documented, compliant with KSI-PIY-07.
  remediation_template: N/A - Positive finding
tags:
- supply-chain
- positive
nist_controls:
- sr-3
- sr-6
related_ksis:
- KSI-PIY-07
---
pattern_id: piy.executive.support_metrics
name: Executive Security Support Measurement
description: Detects executive security support measurement
family: PIY
severity: INFO
pattern_type: resource
languages:
  terraform:
    regex_fallback: executive.*security|executive.*support
    positive_indicators:
    - Executive
    - ExecutiveSupport
finding:
  title_template: Executive security support measured
  description_template: Executive support for security is measured, compliant with KSI-PIY-08.
  remediation_template: N/A - Positive finding
tags:
- executive
- metrics
- positive
nist_controls:
- pm-1
- pm-2
related_ksis:
- KSI-PIY-08
---
pattern_id: piy.sdlc.no_security
name: No Security in SDLC
description: Detects absence of security integration in development
family: PIY
severity: HIGH
pattern_type: code_pattern
languages:
  python:
    regex_fallback: no.*security|ship.*without.*review
    negative_indicators:
    - "No security"
    - "No threat modeling"
  csharp:
    regex_fallback: "(?i)(no.*security|ship.*without.*review|no.*threat.*model)"
    negative_indicators:
    - "No security"
  java:
    regex_fallback: "(?i)(no.*security|ship.*without.*review|no.*threat.*model)"
    negative_indicators:
    - "No security"
  typescript:
    regex_fallback: "(?i)(no.*security|ship.*without.*review|no.*threat.*model)"
    negative_indicators:
    - "No security"
finding:
  title_template: Security not integrated in SDLC
  description_template: Development workflow lacks security integration. KSI-PIY-04 requires security in SDLC.
  remediation_template: Integrate SAST, dependency scanning, and threat modeling into CI/CD pipeline.
tags:
- sdlc
- gap
nist_controls:
- sa-3
related_ksis:
- KSI-PIY-04
---
pattern_id: piy.evaluation.no_methodology
name: No Evaluation Methodology
description: Detects absence of evaluation methodology
family: PIY
severity: HIGH
pattern_type: code_pattern
languages:
  python:
    regex_fallback: no.*evaluation|ad.?hoc
    negative_indicators:
    - "No evaluation"
    - "Ad-hoc"
  csharp:
    regex_fallback: "(?i)(no.*evaluation|ad.?hoc)"
    negative_indicators:
    - "No evaluation"
  java:
    regex_fallback: "(?i)(no.*evaluation|ad.?hoc)"
    negative_indicators:
    - "No evaluation"
  typescript:
    regex_fallback: "(?i)(no.*evaluation|ad.?hoc)"
    negative_indicators:
    - "No evaluation"
finding:
  title_template: No evaluation methodology
  description_template: No documented evaluation methodology. KSI-PIY-05 requires documented evaluation methods.
  remediation_template: Document evaluation methodology including scanning tools, testing frequency, and compliance validation.
tags:
- evaluation
- gap
nist_controls:
- ca-2
related_ksis:
- KSI-PIY-05
---
pattern_id: piy.supply_chain.no_documentation
name: No Supply Chain Documentation
description: Detects absence of supply chain security documentation
family: PIY
severity: HIGH
pattern_type: code_pattern
languages:
  python:
    regex_fallback: no.*SBOM|no.*provenance|undocumented.*dependency
    negative_indicators:
    - "No SBOM"
    - "No provenance"
    - "No risk assessment"
  csharp:
    regex_fallback: "(?i)(no.*SBOM|no.*provenance|undocumented.*dependency)"
    negative_indicators:
    - "No SBOM"
    - "No provenance"
  java:
    regex_fallback: "(?i)(no.*SBOM|no.*provenance|undocumented.*dependency)"
    negative_indicators:
    - "No SBOM"
    - "No provenance"
  typescript:
    regex_fallback: "(?i)(no.*SBOM|no.*provenance|undocumented.*dependency)"
    negative_indicators:
    - "No SBOM"
    - "No provenance"
finding:
  title_template: Supply chain risks undocumented
  description_template: Supply chain security decisions not documented. KSI-PIY-07 requires documented supply chain risk management.
  remediation_template: Document approved dependency sources, SBOM generation, provenance requirements, and risk decisions.
tags:
- supply-chain
- gap
nist_controls:
- sr-3
related_ksis:
- KSI-PIY-07
---
pattern_id: piy.executive.no_measurement
name: No Executive Support Measurement
description: Detects absence of executive security support measurement
family: PIY
severity: MEDIUM
pattern_type: code_pattern
languages:
  python:
    regex_fallback: no.*executive|no.*accountability|security.*IT.*issue
    negative_indicators:
    - "No executive"
    - "No accountability"
  csharp:
    regex_fallback: "(?i)(no.*executive|no.*accountability|security.*IT.*issue)"
    negative_indicators:
    - "No executive"
  java:
    regex_fallback: "(?i)(no.*executive|no.*accountability|security.*IT.*issue)"
    negative_indicators:
    - "No executive"
  typescript:
    regex_fallback: "(?i)(no.*executive|no.*accountability|security.*IT.*issue)"
    negative_indicators:
    - "No executive"
finding:
  title_template: Executive support not measured
  description_template: Executive security support not measured. KSI-PIY-08 requires measurement of executive engagement.
  remediation_template: Implement executive security metrics including budget allocation, training hours, and policy approvals.
tags:
- executive
- gap
nist_controls:
- pm-1
related_ksis:
- KSI-PIY-08
---
pattern_id: piy.investment.no_monitoring
name: No Security Investment Monitoring
description: Detects absence of security investment monitoring
family: PIY
severity: MEDIUM
pattern_type: code_pattern
languages:
  python:
    regex_fallback: no.*metrics|no.*ROI|no.*effectiveness
    negative_indicators:
    - "No metrics"
    - "No ROI"
  csharp:
    regex_fallback: "(?i)(no.*metrics|no.*ROI|no.*effectiveness)"
    negative_indicators:
    - "No metrics"
  java:
    regex_fallback: "(?i)(no.*metrics|no.*ROI|no.*effectiveness)"
    negative_indicators:
    - "No metrics"
  typescript:
    regex_fallback: "(?i)(no.*metrics|no.*ROI|no.*effectiveness)"
    negative_indicators:
    - "No metrics"
finding:
  title_template: Security investment not monitored
  description_template: Security investment effectiveness not measured. KSI-PIY-06 requires monitoring security investment ROI.
  remediation_template: Implement security metrics dashboards tracking vulnerability reduction, incident response times, and compliance rates.
tags:
- investment
- gap
nist_controls:
- pm-14
related_ksis:
- KSI-PIY-06
