import{i as t}from"./d3-transition-wdMCdjHs.js";import{d as n}from"./d3-dispatch-Q6TpkW-B.js";import{i as e}from"./d3-interpolate-DM7tdCV2.js";import{s as o,p as i}from"./d3-selection-DXmtSzok.js";import{a as r,y as u}from"./d3-drag-KJ-QNh_g.js";const s=t=>()=>t;function h(t,{sourceEvent:n,target:e,transform:o,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:o,enumerable:!0,configurable:!0},_:{value:i}})}function a(t,n,e){this.k=t,this.x=n,this.y=e}a.prototype={constructor:a,scale:function(t){return 1===t?this:new a(this.k*t,this.x,this.y)},translate:function(t,n){return 0===t&0===n?this:new a(this.k,this.x+this.k*t,this.y+this.k*n)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var c=new a(1,0,0);function l(t){for(;!t.__zoom;)if(!(t=t.parentNode))return c;return t.__zoom}function f(t){t.stopImmediatePropagation()}function m(t){t.preventDefault(),t.stopImmediatePropagation()}function p(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function v(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function y(){return this.__zoom||c}function d(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function z(){return navigator.maxTouchPoints||"ontouchstart"in this}function _(t,n,e){var o=t.invertX(n[0][0])-e[0][0],i=t.invertX(n[1][0])-e[1][0],r=t.invertY(n[0][1])-e[0][1],u=t.invertY(n[1][1])-e[1][1];return t.translate(i>o?(o+i)/2:Math.min(0,o)||Math.max(0,i),u>r?(r+u)/2:Math.min(0,r)||Math.max(0,u))}function g(){var l,g,k,w=p,x=v,b=_,T=d,M=z,E=[0,1/0],Y=[[-1/0,-1/0],[1/0,1/0]],X=250,j=e,V=n("start","zoom","end"),B=0,D=10;function P(t){t.property("__zoom",y).on("wheel.zoom",W,{passive:!1}).on("mousedown.zoom",A).on("dblclick.zoom",H).filter(M).on("touchstart.zoom",N).on("touchmove.zoom",C).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function K(t,n){return(n=Math.max(E[0],Math.min(E[1],n)))===t.k?t:new a(n,t.x,t.y)}function S(t,n,e){var o=n[0]-e[0]*t.k,i=n[1]-e[1]*t.k;return o===t.x&&i===t.y?t:new a(t.k,o,i)}function q(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function G(t,n,e,o){t.on("start.zoom",function(){I(this,arguments).event(o).start()}).on("interrupt.zoom end.zoom",function(){I(this,arguments).event(o).end()}).tween("zoom",function(){var t=this,i=arguments,r=I(t,i).event(o),u=x.apply(t,i),s=null==e?q(u):"function"==typeof e?e.apply(t,i):e,h=Math.max(u[1][0]-u[0][0],u[1][1]-u[0][1]),c=t.__zoom,l="function"==typeof n?n.apply(t,i):n,f=j(c.invert(s).concat(h/c.k),l.invert(s).concat(h/l.k));return function(t){if(1===t)t=l;else{var n=f(t),e=h/n[2];t=new a(e,s[0]-n[0]*e,s[1]-n[1]*e)}r.zoom(null,t)}})}function I(t,n,e){return!e&&t.__zooming||new O(t,n)}function O(t,n){this.that=t,this.args=n,this.active=0,this.sourceEvent=null,this.extent=x.apply(t,n),this.taps=0}function W(n,...e){if(w.apply(this,arguments)){var o=I(this,e).event(n),r=this.__zoom,u=Math.max(E[0],Math.min(E[1],r.k*Math.pow(2,T.apply(this,arguments)))),s=i(n);if(o.wheel)o.mouse[0][0]===s[0]&&o.mouse[0][1]===s[1]||(o.mouse[1]=r.invert(o.mouse[0]=s)),clearTimeout(o.wheel);else{if(r.k===u)return;o.mouse=[s,r.invert(s)],t(this),o.start()}m(n),o.wheel=setTimeout(function(){o.wheel=null,o.end()},150),o.zoom("mouse",b(S(K(r,u),o.mouse[0],o.mouse[1]),o.extent,Y))}}function A(n,...e){if(!k&&w.apply(this,arguments)){var s=n.currentTarget,h=I(this,e,!0).event(n),a=o(n.view).on("mousemove.zoom",function(t){if(m(t),!h.moved){var n=t.clientX-l,e=t.clientY-p;h.moved=n*n+e*e>B}h.event(t).zoom("mouse",b(S(h.that.__zoom,h.mouse[0]=i(t,s),h.mouse[1]),h.extent,Y))},!0).on("mouseup.zoom",function(t){a.on("mousemove.zoom mouseup.zoom",null),u(t.view,h.moved),m(t),h.event(t).end()},!0),c=i(n,s),l=n.clientX,p=n.clientY;r(n.view),f(n),h.mouse=[c,this.__zoom.invert(c)],t(this),h.start()}}function H(t,...n){if(w.apply(this,arguments)){var e=this.__zoom,r=i(t.changedTouches?t.changedTouches[0]:t,this),u=e.invert(r),s=e.k*(t.shiftKey?.5:2),h=b(S(K(e,s),r,u),x.apply(this,n),Y);m(t),X>0?o(this).transition().duration(X).call(G,h,r,t):o(this).call(P.transform,h,r,t)}}function N(n,...e){if(w.apply(this,arguments)){var o,r,u,s,h=n.touches,a=h.length,c=I(this,e,n.changedTouches.length===a).event(n);for(f(n),r=0;r<a;++r)u=h[r],s=[s=i(u,this),this.__zoom.invert(s),u.identifier],c.touch0?c.touch1||c.touch0[2]===s[2]||(c.touch1=s,c.taps=0):(c.touch0=s,o=!0,c.taps=1+!!l);l&&(l=clearTimeout(l)),o&&(c.taps<2&&(g=s[0],l=setTimeout(function(){l=null},500)),t(this),c.start())}}function C(t,...n){if(this.__zooming){var e,o,r,u,s=I(this,n).event(t),h=t.changedTouches,a=h.length;for(m(t),e=0;e<a;++e)o=h[e],r=i(o,this),s.touch0&&s.touch0[2]===o.identifier?s.touch0[0]=r:s.touch1&&s.touch1[2]===o.identifier&&(s.touch1[0]=r);if(o=s.that.__zoom,s.touch1){var c=s.touch0[0],l=s.touch0[1],f=s.touch1[0],p=s.touch1[1],v=(v=f[0]-c[0])*v+(v=f[1]-c[1])*v,y=(y=p[0]-l[0])*y+(y=p[1]-l[1])*y;o=K(o,Math.sqrt(v/y)),r=[(c[0]+f[0])/2,(c[1]+f[1])/2],u=[(l[0]+p[0])/2,(l[1]+p[1])/2]}else{if(!s.touch0)return;r=s.touch0[0],u=s.touch0[1]}s.zoom("touch",b(S(o,r,u),s.extent,Y))}}function F(t,...n){if(this.__zooming){var e,r,u=I(this,n).event(t),s=t.changedTouches,h=s.length;for(f(t),k&&clearTimeout(k),k=setTimeout(function(){k=null},500),e=0;e<h;++e)r=s[e],u.touch0&&u.touch0[2]===r.identifier?delete u.touch0:u.touch1&&u.touch1[2]===r.identifier&&delete u.touch1;if(u.touch1&&!u.touch0&&(u.touch0=u.touch1,delete u.touch1),u.touch0)u.touch0[1]=this.__zoom.invert(u.touch0[0]);else if(u.end(),2===u.taps&&(r=i(r,this),Math.hypot(g[0]-r[0],g[1]-r[1])<D)){var a=o(this).on("dblclick.zoom");a&&a.apply(this,arguments)}}}return P.transform=function(t,n,e,o){var i=t.selection?t.selection():t;i.property("__zoom",y),t!==i?G(t,n,e,o):i.interrupt().each(function(){I(this,arguments).event(o).start().zoom(null,"function"==typeof n?n.apply(this,arguments):n).end()})},P.scaleBy=function(t,n,e,o){P.scaleTo(t,function(){return this.__zoom.k*("function"==typeof n?n.apply(this,arguments):n)},e,o)},P.scaleTo=function(t,n,e,o){P.transform(t,function(){var t=x.apply(this,arguments),o=this.__zoom,i=null==e?q(t):"function"==typeof e?e.apply(this,arguments):e,r=o.invert(i),u="function"==typeof n?n.apply(this,arguments):n;return b(S(K(o,u),i,r),t,Y)},e,o)},P.translateBy=function(t,n,e,o){P.transform(t,function(){return b(this.__zoom.translate("function"==typeof n?n.apply(this,arguments):n,"function"==typeof e?e.apply(this,arguments):e),x.apply(this,arguments),Y)},null,o)},P.translateTo=function(t,n,e,o,i){P.transform(t,function(){var t=x.apply(this,arguments),i=this.__zoom,r=null==o?q(t):"function"==typeof o?o.apply(this,arguments):o;return b(c.translate(r[0],r[1]).scale(i.k).translate("function"==typeof n?-n.apply(this,arguments):-n,"function"==typeof e?-e.apply(this,arguments):-e),t,Y)},o,i)},O.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1===++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,n){return this.mouse&&"mouse"!==t&&(this.mouse[1]=n.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=n.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=n.invert(this.touch1[0])),this.that.__zoom=n,this.emit("zoom"),this},end:function(){return 0===--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var n=o(this.that).datum();V.call(t,this.that,new h(t,{sourceEvent:this.sourceEvent,target:P,transform:this.that.__zoom,dispatch:V}),n)}},P.wheelDelta=function(t){return arguments.length?(T="function"==typeof t?t:s(+t),P):T},P.filter=function(t){return arguments.length?(w="function"==typeof t?t:s(!!t),P):w},P.touchable=function(t){return arguments.length?(M="function"==typeof t?t:s(!!t),P):M},P.extent=function(t){return arguments.length?(x="function"==typeof t?t:s([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),P):x},P.scaleExtent=function(t){return arguments.length?(E[0]=+t[0],E[1]=+t[1],P):[E[0],E[1]]},P.translateExtent=function(t){return arguments.length?(Y[0][0]=+t[0][0],Y[1][0]=+t[1][0],Y[0][1]=+t[0][1],Y[1][1]=+t[1][1],P):[[Y[0][0],Y[0][1]],[Y[1][0],Y[1][1]]]},P.constrain=function(t){return arguments.length?(b=t,P):b},P.duration=function(t){return arguments.length?(X=+t,P):X},P.interpolate=function(t){return arguments.length?(j=t,P):j},P.on=function(){var t=V.on.apply(V,arguments);return t===V?P:t},P.clickDistance=function(t){return arguments.length?(B=(t=+t)*t,P):Math.sqrt(B)},P.tapDistance=function(t){return arguments.length?(D=+t,P):D},P}l.prototype=a.prototype;export{c as i,l as t,g as z};
