import{e,g as n,k as t,f as r,a as o,h as i,j as s,v as a,r as u,i as d,b as h,m as c,l as f,n as g,c as l,o as v,p,q as w,s as b,t as m,z as y,w as _,x as E,y as k,A as x,B as O,C as N,D as P,E as C,F as j,G as L}from"./lodash-es-CV6V-8Yz.js";var I="\0";class M{constructor(n={}){this._isDirected=!Object.prototype.hasOwnProperty.call(n,"directed")||n.directed,this._isMultigraph=!!Object.prototype.hasOwnProperty.call(n,"multigraph")&&n.multigraph,this._isCompound=!!Object.prototype.hasOwnProperty.call(n,"compound")&&n.compound,this._label=void 0,this._defaultNodeLabelFn=e(void 0),this._defaultEdgeLabelFn=e(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[I]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(e){return this._label=e,this}graph(){return this._label}setDefaultNodeLabel(t){return n(t)||(t=e(t)),this._defaultNodeLabelFn=t,this}nodeCount(){return this._nodeCount}nodes(){return t(this._nodes)}sources(){var e=this;return r(this.nodes(),function(n){return d(e._in[n])})}sinks(){var e=this;return r(this.nodes(),function(n){return d(e._out[n])})}setNodes(e,n){var t=arguments,r=this;return o(e,function(e){t.length>1?r.setNode(e,n):r.setNode(e)}),this}setNode(e,n){return Object.prototype.hasOwnProperty.call(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=n),this):(this._nodes[e]=arguments.length>1?n:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=I,this._children[e]={},this._children[I][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)}node(e){return this._nodes[e]}hasNode(e){return Object.prototype.hasOwnProperty.call(this._nodes,e)}removeNode(e){if(Object.prototype.hasOwnProperty.call(this._nodes,e)){var n=e=>this.removeEdge(this._edgeObjs[e]);delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],o(this.children(e),e=>{this.setParent(e)}),delete this._children[e]),o(t(this._in[e]),n),delete this._in[e],delete this._preds[e],o(t(this._out[e]),n),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this}setParent(e,n){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(i(n))n=I;else{for(var t=n+="";!i(t);t=this.parent(t))if(t===e)throw new Error("Setting "+n+" as parent of "+e+" would create a cycle");this.setNode(n)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=n,this._children[n][e]=!0,this}_removeFromParentsChildList(e){delete this._children[this._parent[e]][e]}parent(e){if(this._isCompound){var n=this._parent[e];if(n!==I)return n}}children(e){if(i(e)&&(e=I),this._isCompound){var n=this._children[e];if(n)return t(n)}else{if(e===I)return this.nodes();if(this.hasNode(e))return[]}}predecessors(e){var n=this._preds[e];if(n)return t(n)}successors(e){var n=this._sucs[e];if(n)return t(n)}neighbors(e){var n=this.predecessors(e);if(n)return s(n,this.successors(e))}isLeaf(e){return 0===(this.isDirected()?this.successors(e):this.neighbors(e)).length}filterNodes(e){var n=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});n.setGraph(this.graph());var t=this;o(this._nodes,function(t,r){e(r)&&n.setNode(r,t)}),o(this._edgeObjs,function(e){n.hasNode(e.v)&&n.hasNode(e.w)&&n.setEdge(e,t.edge(e))});var r={};function i(e){var o=t.parent(e);return void 0===o||n.hasNode(o)?(r[e]=o,o):o in r?r[o]:i(o)}return this._isCompound&&o(n.nodes(),function(e){n.setParent(e,i(e))}),n}setDefaultEdgeLabel(t){return n(t)||(t=e(t)),this._defaultEdgeLabelFn=t,this}edgeCount(){return this._edgeCount}edges(){return a(this._edgeObjs)}setPath(e,n){var t=this,r=arguments;return u(e,function(e,o){return r.length>1?t.setEdge(e,o,n):t.setEdge(e,o),o}),this}setEdge(){var e,n,t,r,o=!1,s=arguments[0];"object"==typeof s&&null!==s&&"v"in s?(e=s.v,n=s.w,t=s.name,2===arguments.length&&(r=arguments[1],o=!0)):(e=s,n=arguments[1],t=arguments[3],arguments.length>2&&(r=arguments[2],o=!0)),e=""+e,n=""+n,i(t)||(t=""+t);var a=F(this._isDirected,e,n,t);if(Object.prototype.hasOwnProperty.call(this._edgeLabels,a))return o&&(this._edgeLabels[a]=r),this;if(!i(t)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(n),this._edgeLabels[a]=o?r:this._defaultEdgeLabelFn(e,n,t);var u=function(e,n,t,r){var o=""+n,i=""+t;if(!e&&o>i){var s=o;o=i,i=s}var a={v:o,w:i};r&&(a.name=r);return a}(this._isDirected,e,n,t);return e=u.v,n=u.w,Object.freeze(u),this._edgeObjs[a]=u,R(this._preds[n],e),R(this._sucs[e],n),this._in[n][a]=u,this._out[e][a]=u,this._edgeCount++,this}edge(e,n,t){var r=1===arguments.length?D(this._isDirected,arguments[0]):F(this._isDirected,e,n,t);return this._edgeLabels[r]}hasEdge(e,n,t){var r=1===arguments.length?D(this._isDirected,arguments[0]):F(this._isDirected,e,n,t);return Object.prototype.hasOwnProperty.call(this._edgeLabels,r)}removeEdge(e,n,t){var r=1===arguments.length?D(this._isDirected,arguments[0]):F(this._isDirected,e,n,t),o=this._edgeObjs[r];return o&&(e=o.v,n=o.w,delete this._edgeLabels[r],delete this._edgeObjs[r],T(this._preds[n],e),T(this._sucs[e],n),delete this._in[n][r],delete this._out[e][r],this._edgeCount--),this}inEdges(e,n){var t=this._in[e];if(t){var o=a(t);return n?r(o,function(e){return e.v===n}):o}}outEdges(e,n){var t=this._out[e];if(t){var o=a(t);return n?r(o,function(e){return e.w===n}):o}}nodeEdges(e,n){var t=this.inEdges(e,n);if(t)return t.concat(this.outEdges(e,n))}}function R(e,n){e[n]?e[n]++:e[n]=1}function T(e,n){--e[n]||delete e[n]}function F(e,n,t,r){var o=""+n,s=""+t;if(!e&&o>s){var a=o;o=s,s=a}return o+""+s+""+(i(r)?"\0":r)}function D(e,n){return F(e,n.v,n.w,n.name)}M.prototype._nodeCount=0,M.prototype._edgeCount=0;class S{constructor(){var e={};e._next=e._prev=e,this._sentinel=e}dequeue(){var e=this._sentinel,n=e._prev;if(n!==e)return G(n),n}enqueue(e){var n=this._sentinel;e._prev&&e._next&&G(e),e._next=n._next,n._next._prev=e,n._next=e,e._prev=n}toString(){for(var e=[],n=this._sentinel,t=n._prev;t!==n;)e.push(JSON.stringify(t,V)),t=t._prev;return"["+e.join(", ")+"]"}}function G(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function V(e,n){if("_next"!==e&&"_prev"!==e)return n}var B=e(1);function q(e,n){if(e.nodeCount()<=1)return[];var t=function(e,n){var t=new M,r=0,i=0;o(e.nodes(),function(e){t.setNode(e,{v:e,in:0,out:0})}),o(e.edges(),function(e){var o=t.edge(e.v,e.w)||0,s=n(e),a=o+s;t.setEdge(e.v,e.w,a),i=Math.max(i,t.node(e.v).out+=s),r=Math.max(r,t.node(e.w).in+=s)});var s=f(i+r+3).map(function(){return new S}),a=r+1;return o(t.nodes(),function(e){z(s,a,t.node(e))}),{graph:t,buckets:s,zeroIdx:a}}(e,n||B),r=function(e,n,t){var r,o=[],i=n[n.length-1],s=n[0];for(;e.nodeCount();){for(;r=s.dequeue();)Y(e,n,t,r);for(;r=i.dequeue();)Y(e,n,t,r);if(e.nodeCount())for(var a=n.length-2;a>0;--a)if(r=n[a].dequeue()){o=o.concat(Y(e,n,t,r,!0));break}}return o}(t.graph,t.buckets,t.zeroIdx);return h(c(r,function(n){return e.outEdges(n.v,n.w)}))}function Y(e,n,t,r,i){var s=i?[]:void 0;return o(e.inEdges(r.v),function(r){var o=e.edge(r),a=e.node(r.v);i&&s.push({v:r.v,w:r.w}),a.out-=o,z(n,t,a)}),o(e.outEdges(r.v),function(r){var o=e.edge(r),i=r.w,s=e.node(i);s.in-=o,z(n,t,s)}),e.removeNode(r.v),s}function z(e,n,t){t.out?t.in?e[t.out-t.in+n].enqueue(t):e[e.length-1].enqueue(t):e[0].enqueue(t)}function A(e){var n="greedy"===e.graph().acyclicer?q(e,function(e){return function(n){return e.edge(n).weight}}(e)):function(e){var n=[],t={},r={};function i(s){Object.prototype.hasOwnProperty.call(r,s)||(r[s]=!0,t[s]=!0,o(e.outEdges(s),function(e){Object.prototype.hasOwnProperty.call(t,e.w)?n.push(e):i(e.w)}),delete t[s])}return o(e.nodes(),i),n}(e);o(n,function(n){var t=e.edge(n);e.removeEdge(n),t.forwardName=n.name,t.reversed=!0,e.setEdge(n.w,n.v,t,g("rev"))})}function J(e,n,t,r){var o;do{o=g(r)}while(e.hasNode(o));return t.dummy=n,e.setNode(o,t),o}function H(e){var n=new M({multigraph:e.isMultigraph()}).setGraph(e.graph());return o(e.nodes(),function(t){e.children(t).length||n.setNode(t,e.node(t))}),o(e.edges(),function(t){n.setEdge(t,e.edge(t))}),n}function K(e,n){var t,r,o=e.x,i=e.y,s=n.x-o,a=n.y-i,u=e.width/2,d=e.height/2;if(!s&&!a)throw new Error("Not possible to find intersection inside of the rectangle");return Math.abs(a)*u>Math.abs(s)*d?(a<0&&(d=-d),t=d*s/a,r=d):(s<0&&(u=-u),t=u,r=u*a/s),{x:o+t,y:i+r}}function Q(e){var n=c(f(W(e)+1),function(){return[]});return o(e.nodes(),function(t){var r=e.node(t),o=r.rank;i(o)||(n[o][r.order]=t)}),n}function U(e,n,t,r){var o={width:0,height:0};return arguments.length>=4&&(o.rank=t,o.order=r),J(e,"border",o,n)}function W(e){return p(c(e.nodes(),function(n){var t=e.node(n).rank;if(!i(t))return t}))}function X(e,n){return n()}function Z(e,n,t,r,o,i){var s={width:0,height:0,rank:i,borderType:n},a=o[n][i-1],u=J(e,"border",s,t);o[n][i]=u,e.setParent(u,r),a&&e.setEdge(a,u,{weight:1})}function $(e){var n=e.graph().rankdir.toLowerCase();"bt"!==n&&"rl"!==n||function(e){o(e.nodes(),function(n){te(e.node(n))}),o(e.edges(),function(n){var t=e.edge(n);o(t.points,te),Object.prototype.hasOwnProperty.call(t,"y")&&te(t)})}(e),"lr"!==n&&"rl"!==n||(!function(e){o(e.nodes(),function(n){re(e.node(n))}),o(e.edges(),function(n){var t=e.edge(n);o(t.points,re),Object.prototype.hasOwnProperty.call(t,"x")&&re(t)})}(e),ee(e))}function ee(e){o(e.nodes(),function(n){ne(e.node(n))}),o(e.edges(),function(n){ne(e.edge(n))})}function ne(e){var n=e.width;e.width=e.height,e.height=n}function te(e){e.y=-e.y}function re(e){var n=e.x;e.x=e.y,e.y=n}function oe(e){e.graph().dummyChains=[],o(e.edges(),function(n){!function(e,n){var t=n.v,r=e.node(t).rank,o=n.w,i=e.node(o).rank,s=n.name,a=e.edge(n),u=a.labelRank;if(i===r+1)return;e.removeEdge(n);var d,h,c=void 0;for(h=0,++r;r<i;++h,++r)a.points=[],d=J(e,"edge",c={width:0,height:0,edgeLabel:a,edgeObj:n,rank:r},"_d"),r===u&&(c.width=a.width,c.height=a.height,c.dummy="edge-label",c.labelpos=a.labelpos),e.setEdge(t,d,{weight:a.weight},s),0===h&&e.graph().dummyChains.push(d),t=d;e.setEdge(t,o,{weight:a.weight},s)}(e,n)})}function ie(e){var n={};o(e.sources(),function t(r){var o=e.node(r);if(Object.prototype.hasOwnProperty.call(n,r))return o.rank;n[r]=!0;var i=l(c(e.outEdges(r),function(n){return t(n.w)-e.edge(n).minlen}));return i!==Number.POSITIVE_INFINITY&&null!=i||(i=0),o.rank=i})}function se(e,n){return e.node(n.w).rank-e.node(n.v).rank-e.edge(n).minlen}function ae(e){var n,t,r=new M({directed:!1}),o=e.nodes()[0],i=e.nodeCount();for(r.setNode(o,{});ue(r,e)<i;)n=de(r,e),t=r.hasNode(n.v)?se(e,n):-se(e,n),he(r,e,t);return r}function ue(e,n){return o(e.nodes(),function t(r){o(n.nodeEdges(r),function(o){var i=o.v,s=r===i?o.w:i;e.hasNode(s)||se(n,o)||(e.setNode(s,{}),e.setEdge(r,s,{}),t(s))})}),e.nodeCount()}function de(e,n){return w(n.edges(),function(t){if(e.hasNode(t.v)!==e.hasNode(t.w))return se(n,t)})}function he(e,n,t){o(e.nodes(),function(e){n.node(e).rank+=t})}function ce(e,n,t){b(n)||(n=[n]);var r=(e.isDirected()?e.successors:e.neighbors).bind(e),i=[],s={};return o(n,function(n){if(!e.hasNode(n))throw new Error("Graph does not have node: "+n);fe(e,n,"post"===t,s,r,i)}),i}function fe(e,n,t,r,i,s){Object.prototype.hasOwnProperty.call(r,n)||(r[n]=!0,t||s.push(n),o(i(n),function(n){fe(e,n,t,r,i,s)}),t&&s.push(n))}function ge(e){e=function(e){var n=(new M).setGraph(e.graph());return o(e.nodes(),function(t){n.setNode(t,e.node(t))}),o(e.edges(),function(t){var r=n.edge(t.v,t.w)||{weight:0,minlen:1},o=e.edge(t);n.setEdge(t.v,t.w,{weight:r.weight+o.weight,minlen:Math.max(r.minlen,o.minlen)})}),n}(e),ie(e);var n,t=ae(e);for(pe(t),le(t,e);n=be(t);)ye(t,e,n,me(t,e,n))}function le(e,n){var t=function(e,n){return ce(e,n,"post")}(e,e.nodes());t=t.slice(0,t.length-1),o(t,function(t){!function(e,n,t){var r=e.node(t),o=r.parent;e.edge(t,o).cutvalue=ve(e,n,t)}(e,n,t)})}function ve(e,n,t){var r=e.node(t).parent,i=!0,s=n.edge(t,r),a=0;return s||(i=!1,s=n.edge(r,t)),a=s.weight,o(n.nodeEdges(t),function(o){var s,u,d=o.v===t,h=d?o.w:o.v;if(h!==r){var c=d===i,f=n.edge(o).weight;if(a+=c?f:-f,s=t,u=h,e.hasEdge(s,u)){var g=e.edge(t,h).cutvalue;a+=c?-g:g}}}),a}function pe(e,n){arguments.length<2&&(n=e.nodes()[0]),we(e,{},1,n)}function we(e,n,t,r,i){var s=t,a=e.node(r);return n[r]=!0,o(e.neighbors(r),function(o){Object.prototype.hasOwnProperty.call(n,o)||(t=we(e,n,t,o,r))}),a.low=s,a.lim=t++,i?a.parent=i:delete a.parent,t}function be(e){return m(e.edges(),function(n){return e.edge(n).cutvalue<0})}function me(e,n,t){var o=t.v,i=t.w;n.hasEdge(o,i)||(o=t.w,i=t.v);var s=e.node(o),a=e.node(i),u=s,d=!1;s.lim>a.lim&&(u=a,d=!0);var h=r(n.edges(),function(n){return d===_e(e,e.node(n.v),u)&&d!==_e(e,e.node(n.w),u)});return w(h,function(e){return se(n,e)})}function ye(e,n,t,r){var i=t.v,s=t.w;e.removeEdge(i,s),e.setEdge(r.v,r.w,{}),pe(e),le(e,n),function(e,n){var t=m(e.nodes(),function(e){return!n.node(e).parent}),r=function(e,n){return ce(e,n,"pre")}(e,t);r=r.slice(1),o(r,function(t){var r=e.node(t).parent,o=n.edge(t,r),i=!1;o||(o=n.edge(r,t),i=!0),n.node(t).rank=n.node(r).rank+(i?o.minlen:-o.minlen)})}(e,n)}function _e(e,n,t){return t.low<=n.lim&&n.lim<=t.lim}function Ee(e){switch(e.graph().ranker){case"network-simplex":default:xe(e);break;case"tight-tree":!function(e){ie(e),ae(e)}(e);break;case"longest-path":ke(e)}}new Error,ge.initLowLimValues=pe,ge.initCutValues=le,ge.calcCutValue=ve,ge.leaveEdge=be,ge.enterEdge=me,ge.exchangeEdges=ye;var ke=ie;function xe(e){ge(e)}function Oe(e){var n=J(e,"root",{},"_root"),t=function(e){var n={};function t(r,i){var s=e.children(r);s&&s.length&&o(s,function(e){t(e,i+1)}),n[r]=i}return o(e.children(),function(e){t(e,1)}),n}(e),r=p(a(t))-1,i=2*r+1;e.graph().nestingRoot=n,o(e.edges(),function(n){e.edge(n).minlen*=i});var s=function(e){return u(e.edges(),function(n,t){return n+e.edge(t).weight},0)}(e)+1;o(e.children(),function(o){Ne(e,n,i,s,r,t,o)}),e.graph().nodeRankFactor=i}function Ne(e,n,t,r,i,s,a){var u=e.children(a);if(u.length){var d=U(e,"_bt"),h=U(e,"_bb"),c=e.node(a);e.setParent(d,a),c.borderTop=d,e.setParent(h,a),c.borderBottom=h,o(u,function(o){Ne(e,n,t,r,i,s,o);var u=e.node(o),c=u.borderTop?u.borderTop:o,f=u.borderBottom?u.borderBottom:o,g=u.borderTop?r:2*r,l=c!==f?1:i-s[a]+1;e.setEdge(d,c,{weight:g,minlen:l,nestingEdge:!0}),e.setEdge(f,h,{weight:g,minlen:l,nestingEdge:!0})}),e.parent(a)||e.setEdge(n,d,{weight:0,minlen:i+s[a]})}else a!==n&&e.setEdge(n,a,{weight:0,minlen:t})}function Pe(e,n,t){var r=function(e){var n;for(;e.hasNode(n=g("_root")););return n}(e),s=new M({compound:!0}).setGraph({root:r}).setDefaultNodeLabel(function(n){return e.node(n)});return o(e.nodes(),function(a){var u=e.node(a),d=e.parent(a);(u.rank===n||u.minRank<=n&&n<=u.maxRank)&&(s.setNode(a),s.setParent(a,d||r),o(e[t](a),function(n){var t=n.v===a?n.w:n.v,r=s.edge(t,a),o=i(r)?0:r.weight;s.setEdge(t,a,{weight:e.edge(n).weight+o})}),Object.prototype.hasOwnProperty.call(u,"minRank")&&s.setNode(a,{borderLeft:u.borderLeft[n],borderRight:u.borderRight[n]}))}),s}function Ce(e,n){for(var t=0,r=1;r<n.length;++r)t+=je(e,n[r-1],n[r]);return t}function je(e,n,t){for(var r=y(t,c(t,function(e,n){return n})),i=h(c(n,function(n){return _(c(e.outEdges(n),function(n){return{pos:r[n.w],weight:e.edge(n).weight}}),"pos")})),s=1;s<t.length;)s<<=1;var a=2*s-1;s-=1;var u=c(new Array(a),function(){return 0}),d=0;return o(i.forEach(function(e){var n=e.pos+s;u[n]+=e.weight;for(var t=0;n>0;)n%2&&(t+=u[n+1]),u[n=n-1>>1]+=e.weight;d+=e.weight*t})),d}function Le(e,n){var t={};return o(e,function(e,n){var r=t[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:n};i(e.barycenter)||(r.barycenter=e.barycenter,r.weight=e.weight)}),o(n.edges(),function(e){var n=t[e.v],r=t[e.w];i(n)||i(r)||(r.indegree++,n.out.push(t[e.w]))}),function(e){var n=[];function t(e){return function(n){n.merged||(i(n.barycenter)||i(e.barycenter)||n.barycenter>=e.barycenter)&&function(e,n){var t=0,r=0;e.weight&&(t+=e.barycenter*e.weight,r+=e.weight);n.weight&&(t+=n.barycenter*n.weight,r+=n.weight);e.vs=n.vs.concat(e.vs),e.barycenter=t/r,e.weight=r,e.i=Math.min(n.i,e.i),n.merged=!0}(e,n)}}function s(n){return function(t){t.in.push(n),0===--t.indegree&&e.push(t)}}for(;e.length;){var a=e.pop();n.push(a),o(a.in.reverse(),t(a)),o(a.out,s(a))}return c(r(n,function(e){return!e.merged}),function(e){return E(e,["vs","i","barycenter","weight"])})}(r(t,function(e){return!e.indegree}))}function Ie(e,n){var t,r=function(e,n){var t={lhs:[],rhs:[]};return o(e,function(e){n(e)?t.lhs.push(e):t.rhs.push(e)}),t}(e,function(e){return Object.prototype.hasOwnProperty.call(e,"barycenter")}),i=r.lhs,s=_(r.rhs,function(e){return-e.i}),a=[],u=0,d=0,c=0;i.sort((t=!!n,function(e,n){return e.barycenter<n.barycenter?-1:e.barycenter>n.barycenter?1:t?n.i-e.i:e.i-n.i})),c=Me(a,s,c),o(i,function(e){c+=e.vs.length,a.push(e.vs),u+=e.barycenter*e.weight,d+=e.weight,c=Me(a,s,c)});var f={vs:h(a)};return d&&(f.barycenter=u/d,f.weight=d),f}function Me(e,n,t){for(var r;n.length&&(r=k(n)).i<=t;)n.pop(),e.push(r.vs),t++;return t}function Re(e,n,t,s){var a=e.children(n),d=e.node(n),f=d?d.borderLeft:void 0,g=d?d.borderRight:void 0,l={};f&&(a=r(a,function(e){return e!==f&&e!==g}));var v=function(e,n){return c(n,function(n){var t=e.inEdges(n);if(t.length){var r=u(t,function(n,t){var r=e.edge(t),o=e.node(t.v);return{sum:n.sum+r.weight*o.order,weight:n.weight+r.weight}},{sum:0,weight:0});return{v:n,barycenter:r.sum/r.weight,weight:r.weight}}return{v:n}})}(e,a);o(v,function(n){if(e.children(n.v).length){var r=Re(e,n.v,t,s);l[n.v]=r,Object.prototype.hasOwnProperty.call(r,"barycenter")&&(a=r,i((o=n).barycenter)?(o.barycenter=a.barycenter,o.weight=a.weight):(o.barycenter=(o.barycenter*o.weight+a.barycenter*a.weight)/(o.weight+a.weight),o.weight+=a.weight))}var o,a});var p=Le(v,t);!function(e,n){o(e,function(e){e.vs=h(e.vs.map(function(e){return n[e]?n[e].vs:e}))})}(p,l);var w=Ie(p,s);if(f&&(w.vs=h([f,w.vs,g]),e.predecessors(f).length)){var b=e.node(e.predecessors(f)[0]),m=e.node(e.predecessors(g)[0]);Object.prototype.hasOwnProperty.call(w,"barycenter")||(w.barycenter=0,w.weight=0),w.barycenter=(w.barycenter*w.weight+b.order+m.order)/(w.weight+2),w.weight+=2}return w}function Te(e){var n=W(e),t=Fe(e,f(1,n+1),"inEdges"),i=Fe(e,f(n-1,-1,-1),"outEdges"),s=function(e){var n={},t=r(e.nodes(),function(n){return!e.children(n).length}),i=p(c(t,function(n){return e.node(n).rank})),s=c(f(i+1),function(){return[]}),a=_(t,function(n){return e.node(n).rank});return o(a,function t(r){if(!v(n,r)){n[r]=!0;var i=e.node(r);s[i.rank].push(r),o(e.successors(r),t)}}),s}(e);Se(e,s);for(var a,u=Number.POSITIVE_INFINITY,d=0,h=0;h<4;++d,++h){De(d%2?t:i,d%4>=2);var g=Ce(e,s=Q(e));g<u&&(h=0,a=x(s),u=g)}Se(e,a)}function Fe(e,n,t){return c(n,function(n){return Pe(e,n,t)})}function De(e,n){var t=new M;o(e,function(e){var r=e.graph().root,i=Re(e,r,t,n);o(i.vs,function(n,t){e.node(n).order=t}),function(e,n,t){var r,i={};o(t,function(t){for(var o,s,a=e.parent(t);a;){if((o=e.parent(a))?(s=i[o],i[o]=a):(s=r,r=a),s&&s!==a)return void n.setEdge(s,a);a=o}})}(e,t,i.vs)})}function Se(e,n){o(n,function(n){o(n,function(n,t){e.node(n).order=t})})}function Ge(e){var n=function(e){var n={},t=0;function r(i){var s=t;o(e.children(i),r),n[i]={low:s,lim:t++}}return o(e.children(),r),n}(e);o(e.graph().dummyChains,function(t){for(var r=e.node(t),o=r.edgeObj,i=function(e,n,t,r){var o,i,s=[],a=[],u=Math.min(n[t].low,n[r].low),d=Math.max(n[t].lim,n[r].lim);o=t;do{o=e.parent(o),s.push(o)}while(o&&(n[o].low>u||d>n[o].lim));i=o,o=r;for(;(o=e.parent(o))!==i;)a.push(o);return{path:s.concat(a.reverse()),lca:i}}(e,n,o.v,o.w),s=i.path,a=i.lca,u=0,d=s[u],h=!0;t!==o.w;){if(r=e.node(t),h){for(;(d=s[u])!==a&&e.node(d).maxRank<r.rank;)u++;d===a&&(h=!1)}if(!h){for(;u<s.length-1&&e.node(d=s[u+1]).minRank<=r.rank;)u++;d=s[u]}e.setParent(t,d),t=e.successors(t)[0]}})}function Ve(e,n){var t={};return u(n,function(n,r){var i=0,s=0,a=n.length,u=k(r);return o(r,function(n,d){var h=function(e,n){if(e.node(n).dummy)return m(e.predecessors(n),function(n){return e.node(n).dummy})}(e,n),c=h?e.node(h).order:a;(h||n===u)&&(o(r.slice(s,d+1),function(n){o(e.predecessors(n),function(r){var o=e.node(r),s=o.order;!(s<i||c<s)||o.dummy&&e.node(n).dummy||Be(t,r,n)})}),s=d+1,i=c)}),r}),t}function Be(e,n,t){if(n>t){var r=n;n=t,t=r}Object.prototype.hasOwnProperty.call(e,n)||Object.defineProperty(e,n,{enumerable:!0,configurable:!0,value:{},writable:!0});var o=e[n];Object.defineProperty(o,t,{enumerable:!0,configurable:!0,value:!0,writable:!0})}function qe(e,n,t){if(n>t){var r=n;n=t,t=r}return!!e[n]&&Object.prototype.hasOwnProperty.call(e[n],t)}function Ye(e,n,t,r,i){var s={},a=function(e,n,t,r){var i=new M,s=e.graph(),a=function(e,n,t){return function(r,o,i){var s,a=r.node(o),u=r.node(i),d=0;if(d+=a.width/2,Object.prototype.hasOwnProperty.call(a,"labelpos"))switch(a.labelpos.toLowerCase()){case"l":s=-a.width/2;break;case"r":s=a.width/2}if(s&&(d+=t?s:-s),s=0,d+=(a.dummy?n:e)/2,d+=(u.dummy?n:e)/2,d+=u.width/2,Object.prototype.hasOwnProperty.call(u,"labelpos"))switch(u.labelpos.toLowerCase()){case"l":s=u.width/2;break;case"r":s=-u.width/2}return s&&(d+=t?s:-s),s=0,d}}(s.nodesep,s.edgesep,r);return o(n,function(n){var r;o(n,function(n){var o=t[n];if(i.setNode(o),r){var s=t[r],u=i.edge(s,o);i.setEdge(s,o,Math.max(a(e,n,r),u||0))}r=n})}),i}(e,n,t,i),u=i?"borderLeft":"borderRight";function d(e,n){for(var t=a.nodes(),r=t.pop(),o={};r;)o[r]?e(r):(o[r]=!0,t.push(r),t=t.concat(n(r))),r=t.pop()}return d(function(e){s[e]=a.inEdges(e).reduce(function(e,n){return Math.max(e,s[n.v]+a.edge(n))},0)},a.predecessors.bind(a)),d(function(n){var t=a.outEdges(n).reduce(function(e,n){return Math.min(e,s[n.w]-a.edge(n))},Number.POSITIVE_INFINITY),r=e.node(n);t!==Number.POSITIVE_INFINITY&&r.borderType!==u&&(s[n]=Math.max(s[n],t))},a.successors.bind(a)),o(r,function(e){s[e]=s[t[e]]}),s}function ze(e){var n,t=Q(e),r=O(Ve(e,t),function(e,n){var t={};function r(n,r,i,s,a){var u;o(f(r,i),function(r){u=n[r],e.node(u).dummy&&o(e.predecessors(u),function(n){var r=e.node(n);r.dummy&&(r.order<s||r.order>a)&&Be(t,n,u)})})}return u(n,function(n,t){var i,s=-1,a=0;return o(t,function(o,u){if("border"===e.node(o).dummy){var d=e.predecessors(o);d.length&&(i=e.node(d[0]).order,r(t,a,u,s,i),a=u,s=i)}r(t,a,t.length,i,n.length)}),t}),t}(e,t)),i={};o(["u","d"],function(s){n="u"===s?t:a(t).reverse(),o(["l","r"],function(t){"r"===t&&(n=c(n,function(e){return a(e).reverse()}));var u=("u"===s?e.predecessors:e.successors).bind(e),d=function(e,n,t,r){var i={},s={},a={};return o(n,function(e){o(e,function(e,n){i[e]=e,s[e]=e,a[e]=n})}),o(n,function(e){var n=-1;o(e,function(e){var o=r(e);if(o.length){o=_(o,function(e){return a[e]});for(var u=(o.length-1)/2,d=Math.floor(u),h=Math.ceil(u);d<=h;++d){var c=o[d];s[e]===e&&n<a[c]&&!qe(t,e,c)&&(s[c]=e,s[e]=i[e]=i[c],n=a[c])}}})}),{root:i,align:s}}(0,n,r,u),h=Ye(e,n,d.root,d.align,"r"===t);"r"===t&&(h=N(h,function(e){return-e})),i[s+t]=h})});var s=function(e,n){return w(a(n),function(n){var t=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;return P(n,function(n,o){var i=function(e,n){return e.node(n).width}(e,o)/2;t=Math.max(n+i,t),r=Math.min(n-i,r)}),t-r})}(e,i);return function(e,n){var t=a(n),r=l(t),i=p(t);o(["u","d"],function(t){o(["l","r"],function(o){var s,u=t+o,d=e[u];if(d!==n){var h=a(d);(s="l"===o?r-l(h):i-p(h))&&(e[u]=N(d,function(e){return e+s}))}})})}(i,s),function(e,n){return N(e.ul,function(t,r){if(n)return e[n.toLowerCase()][r];var o=_(c(e,r));return(o[1]+o[2])/2})}(i,e.graph().align)}function Ae(e){(function(e){var n=Q(e),t=e.graph().ranksep,r=0;o(n,function(n){var i=p(c(n,function(n){return e.node(n).height}));o(n,function(n){e.node(n).y=r+i/2}),r+=i+t})})(e=H(e)),C(ze(e),function(n,t){e.node(t).x=n})}function Je(e,n){var t=X;t("layout",()=>{var n=t("  buildLayoutGraph",()=>function(e){var n=new M({multigraph:!0,compound:!0}),t=nn(e.graph());return n.setGraph(O({},Ke,en(t,He),E(t,Qe))),o(e.nodes(),function(t){var r=nn(e.node(t));n.setNode(t,j(en(r,Ue),We)),n.setParent(t,e.parent(t))}),o(e.edges(),function(t){var r=nn(e.edge(t));n.setEdge(t,O({},Ze,en(r,Xe),E(r,$e)))}),n}(e));t("  runLayout",()=>function(e,n){n("    makeSpaceForEdgeLabels",()=>function(e){var n=e.graph();n.ranksep/=2,o(e.edges(),function(t){var r=e.edge(t);r.minlen*=2,"c"!==r.labelpos.toLowerCase()&&("TB"===n.rankdir||"BT"===n.rankdir?r.width+=r.labeloffset:r.height+=r.labeloffset)})}(e)),n("    removeSelfEdges",()=>function(e){o(e.edges(),function(n){if(n.v===n.w){var t=e.node(n.v);t.selfEdges||(t.selfEdges=[]),t.selfEdges.push({e:n,label:e.edge(n)}),e.removeEdge(n)}})}(e)),n("    acyclic",()=>A(e)),n("    nestingGraph.run",()=>Oe(e)),n("    rank",()=>Ee(H(e))),n("    injectEdgeLabelProxies",()=>function(e){o(e.edges(),function(n){var t=e.edge(n);if(t.width&&t.height){var r=e.node(n.v),o={rank:(e.node(n.w).rank-r.rank)/2+r.rank,e:n};J(e,"edge-proxy",o,"_ep")}})}(e)),n("    removeEmptyRanks",()=>function(e){var n=l(c(e.nodes(),function(n){return e.node(n).rank})),t=[];o(e.nodes(),function(r){var o=e.node(r).rank-n;t[o]||(t[o]=[]),t[o].push(r)});var r=0,s=e.graph().nodeRankFactor;o(t,function(n,t){i(n)&&t%s!==0?--r:r&&o(n,function(n){e.node(n).rank+=r})})}(e)),n("    nestingGraph.cleanup",()=>function(e){var n=e.graph();e.removeNode(n.nestingRoot),delete n.nestingRoot,o(e.edges(),function(n){e.edge(n).nestingEdge&&e.removeEdge(n)})}(e)),n("    normalizeRanks",()=>function(e){var n=l(c(e.nodes(),function(n){return e.node(n).rank}));o(e.nodes(),function(t){var r=e.node(t);v(r,"rank")&&(r.rank-=n)})}(e)),n("    assignRankMinMax",()=>function(e){var n=0;o(e.nodes(),function(t){var r=e.node(t);r.borderTop&&(r.minRank=e.node(r.borderTop).rank,r.maxRank=e.node(r.borderBottom).rank,n=p(n,r.maxRank))}),e.graph().maxRank=n}(e)),n("    removeEdgeLabelProxies",()=>function(e){o(e.nodes(),function(n){var t=e.node(n);"edge-proxy"===t.dummy&&(e.edge(t.e).labelRank=t.rank,e.removeNode(n))})}(e)),n("    normalize.run",()=>oe(e)),n("    parentDummyChains",()=>Ge(e)),n("    addBorderSegments",()=>function(e){o(e.children(),function n(t){var r=e.children(t),i=e.node(t);if(r.length&&o(r,n),Object.prototype.hasOwnProperty.call(i,"minRank")){i.borderLeft=[],i.borderRight=[];for(var s=i.minRank,a=i.maxRank+1;s<a;++s)Z(e,"borderLeft","_bl",t,i,s),Z(e,"borderRight","_br",t,i,s)}})}(e)),n("    order",()=>Te(e)),n("    insertSelfEdges",()=>function(e){var n=Q(e);o(n,function(n){var t=0;o(n,function(n,r){var i=e.node(n);i.order=r+t,o(i.selfEdges,function(n){J(e,"selfedge",{width:n.label.width,height:n.label.height,rank:i.rank,order:r+ ++t,e:n.e,label:n.label},"_se")}),delete i.selfEdges})})}(e)),n("    adjustCoordinateSystem",()=>function(e){var n=e.graph().rankdir.toLowerCase();"lr"!==n&&"rl"!==n||ee(e)}(e)),n("    position",()=>Ae(e)),n("    positionSelfEdges",()=>function(e){o(e.nodes(),function(n){var t=e.node(n);if("selfedge"===t.dummy){var r=e.node(t.e.v),o=r.x+r.width/2,i=r.y,s=t.x-o,a=r.height/2;e.setEdge(t.e,t.label),e.removeNode(n),t.label.points=[{x:o+2*s/3,y:i-a},{x:o+5*s/6,y:i-a},{x:o+s,y:i},{x:o+5*s/6,y:i+a},{x:o+2*s/3,y:i+a}],t.label.x=t.x,t.label.y=t.y}})}(e)),n("    removeBorderNodes",()=>function(e){o(e.nodes(),function(n){if(e.children(n).length){var t=e.node(n),r=e.node(t.borderTop),o=e.node(t.borderBottom),i=e.node(k(t.borderLeft)),s=e.node(k(t.borderRight));t.width=Math.abs(s.x-i.x),t.height=Math.abs(o.y-r.y),t.x=i.x+t.width/2,t.y=r.y+t.height/2}}),o(e.nodes(),function(n){"border"===e.node(n).dummy&&e.removeNode(n)})}(e)),n("    normalize.undo",()=>function(e){o(e.graph().dummyChains,function(n){var t,r=e.node(n),o=r.edgeLabel;for(e.setEdge(r.edgeObj,o);r.dummy;)t=e.successors(n)[0],e.removeNode(n),o.points.push({x:r.x,y:r.y}),"edge-label"===r.dummy&&(o.x=r.x,o.y=r.y,o.width=r.width,o.height=r.height),n=t,r=e.node(n)})}(e)),n("    fixupEdgeLabelCoords",()=>function(e){o(e.edges(),function(n){var t=e.edge(n);if(Object.prototype.hasOwnProperty.call(t,"x"))switch("l"!==t.labelpos&&"r"!==t.labelpos||(t.width-=t.labeloffset),t.labelpos){case"l":t.x-=t.width/2+t.labeloffset;break;case"r":t.x+=t.width/2+t.labeloffset}})}(e)),n("    undoCoordinateSystem",()=>$(e)),n("    translateGraph",()=>function(e){var n=Number.POSITIVE_INFINITY,t=0,r=Number.POSITIVE_INFINITY,i=0,s=e.graph(),a=s.marginx||0,u=s.marginy||0;function d(e){var o=e.x,s=e.y,a=e.width,u=e.height;n=Math.min(n,o-a/2),t=Math.max(t,o+a/2),r=Math.min(r,s-u/2),i=Math.max(i,s+u/2)}o(e.nodes(),function(n){d(e.node(n))}),o(e.edges(),function(n){var t=e.edge(n);Object.prototype.hasOwnProperty.call(t,"x")&&d(t)}),n-=a,r-=u,o(e.nodes(),function(t){var o=e.node(t);o.x-=n,o.y-=r}),o(e.edges(),function(t){var i=e.edge(t);o(i.points,function(e){e.x-=n,e.y-=r}),Object.prototype.hasOwnProperty.call(i,"x")&&(i.x-=n),Object.prototype.hasOwnProperty.call(i,"y")&&(i.y-=r)}),s.width=t-n+a,s.height=i-r+u}(e)),n("    assignNodeIntersects",()=>function(e){o(e.edges(),function(n){var t,r,o=e.edge(n),i=e.node(n.v),s=e.node(n.w);o.points?(t=o.points[0],r=o.points[o.points.length-1]):(o.points=[],t=s,r=i),o.points.unshift(K(i,t)),o.points.push(K(s,r))})}(e)),n("    reversePoints",()=>function(e){o(e.edges(),function(n){var t=e.edge(n);t.reversed&&t.points.reverse()})}(e)),n("    acyclic.undo",()=>function(e){o(e.edges(),function(n){var t=e.edge(n);if(t.reversed){e.removeEdge(n);var r=t.forwardName;delete t.reversed,delete t.forwardName,e.setEdge(n.w,n.v,t,r)}})}(e))}(n,t)),t("  updateInputGraph",()=>function(e,n){o(e.nodes(),function(t){var r=e.node(t),o=n.node(t);r&&(r.x=o.x,r.y=o.y,n.children(t).length&&(r.width=o.width,r.height=o.height))}),o(e.edges(),function(t){var r=e.edge(t),o=n.edge(t);r.points=o.points,Object.prototype.hasOwnProperty.call(o,"x")&&(r.x=o.x,r.y=o.y)}),e.graph().width=n.graph().width,e.graph().height=n.graph().height}(e,n))})}var He=["nodesep","edgesep","ranksep","marginx","marginy"],Ke={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Qe=["acyclicer","ranker","rankdir","align"],Ue=["width","height"],We={width:0,height:0},Xe=["minlen","weight","width","height","labeloffset"],Ze={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},$e=["labelpos"];function en(e,n){return N(E(e,n),Number)}function nn(e){var n={};return o(e,function(e,t){n[t.toLowerCase()]=e}),n}function tn(e){var n={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:rn(e),edges:on(e)};return i(e.graph())||(n.value=L(e.graph())),n}function rn(e){return c(e.nodes(),function(n){var t=e.node(n),r=e.parent(n),o={v:n};return i(t)||(o.value=t),i(r)||(o.parent=r),o})}function on(e){return c(e.edges(),function(n){var t=e.edge(n),r={v:n.v,w:n.w};return i(n.name)||(r.name=n.name),i(t)||(r.value=t),r})}export{M as G,Je as l,tn as w};
