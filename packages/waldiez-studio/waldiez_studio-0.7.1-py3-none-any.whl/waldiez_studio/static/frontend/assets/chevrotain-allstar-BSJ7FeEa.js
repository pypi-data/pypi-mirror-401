import{L as t,g as n,t as e,a as o}from"./chevrotain-D44ZBhk6.js";import{T as i,N as s,d as r,O as a,c,b as u,R as f,a as l}from"./@chevrotain-Co5Sw0Ld.js";import{f as p,m as d,r as h,a as g,b as y,i as v,c as S,d as m,u as k}from"./lodash-es-CV6V-8Yz.js";function T(t,n,e){return`${t.name}_${n}_${e}`}class A{constructor(t){this.target=t}isEpsilon(){return!1}}class x extends A{constructor(t,n){super(t),this.tokenType=n}}class b extends A{constructor(t){super(t)}isEpsilon(){return!0}}class E extends A{constructor(t,n,e){super(t),this.rule=n,this.followState=e}isEpsilon(){return!0}}function M(t){const n={decisionMap:{},decisionStates:[],ruleToStartState:new Map,ruleToStopState:new Map,states:[]};!function(t,n){const e=n.length;for(let o=0;o<e;o++){const e=n[o],i=P(t,e,void 0,{type:2}),s=P(t,e,void 0,{type:7});i.stop=s,t.ruleToStartState.set(e,i),t.ruleToStopState.set(e,s)}}(n,t);const e=t.length;for(let o=0;o<e;o++){const e=t[o],i=w(n,e,e);void 0!==i&&N(n,e,i)}return n}function O(t,n,e){return e instanceof i?_(t,n,e.terminalType,e):e instanceof s?function(t,n,e){const o=e.referencedRule,i=t.ruleToStartState.get(o),s=P(t,n,e,{type:1}),r=P(t,n,e,{type:1}),a=new E(i,o,r);return z(s,a),{left:s,right:r}}(t,n,e):e instanceof r?function(t,n,e){const o=P(t,n,e,{type:1});R(t,o);const i=d(e.definition,e=>O(t,n,e)),s=$(t,n,o,e,...i);return s}(t,n,e):e instanceof a?function(t,n,e){const o=P(t,n,e,{type:1});R(t,o);const i=$(t,n,o,e,w(t,n,e));return function(t,n,e,o){const i=o.left,s=o.right;return j(i,s),t.decisionMap[T(n,"Option",e.idx)]=i,o}(t,n,e,i)}(t,n,e):e instanceof c?function(t,n,e){const o=P(t,n,e,{type:5});R(t,o);const i=$(t,n,o,e,w(t,n,e));return I(t,n,e,i)}(t,n,e):e instanceof u?function(t,n,e){const o=P(t,n,e,{type:5});R(t,o);const i=$(t,n,o,e,w(t,n,e)),s=_(t,n,e.separator,e);return I(t,n,e,i,s)}(t,n,e):e instanceof f?function(t,n,e){const o=P(t,n,e,{type:4});R(t,o);const i=$(t,n,o,e,w(t,n,e));return L(t,n,e,i)}(t,n,e):e instanceof l?function(t,n,e){const o=P(t,n,e,{type:4});R(t,o);const i=$(t,n,o,e,w(t,n,e)),s=_(t,n,e.separator,e);return L(t,n,e,i,s)}(t,n,e):w(t,n,e)}function w(t,n,e){const o=p(d(e.definition,e=>O(t,n,e)),t=>void 0!==t);return 1===o.length?o[0]:0===o.length?void 0:function(t,n){const e=n.length;for(let s=0;s<e-1;s++){const e=n[s];let o;1===e.left.transitions.length&&(o=e.left.transitions[0]);const i=o instanceof E,r=o,a=n[s+1].left;1===e.left.type&&1===e.right.type&&void 0!==o&&(i&&r.followState===e.right||o.target===e.right)?(i?r.followState=a:o.target=a,U(t,e.right)):j(e.right,a)}const o=n[0],i=n[e-1];return{left:o.left,right:i.right}}(t,o)}function L(t,n,e,o,i){const s=o.left,r=o.right,a=P(t,n,e,{type:11});R(t,a);const c=P(t,n,e,{type:12});return s.loopback=a,c.loopback=a,t.decisionMap[T(n,i?"RepetitionMandatoryWithSeparator":"RepetitionMandatory",e.idx)]=a,j(r,a),void 0===i?(j(a,s),j(a,c)):(j(a,c),j(a,i.left),j(i.right,s)),{left:s,right:c}}function I(t,n,e,o,i){const s=o.left,r=o.right,a=P(t,n,e,{type:10});R(t,a);const c=P(t,n,e,{type:12}),u=P(t,n,e,{type:9});return a.loopback=u,c.loopback=u,j(a,s),j(a,c),j(r,u),void 0!==i?(j(u,c),j(u,i.left),j(i.right,s)):j(u,a),t.decisionMap[T(n,i?"RepetitionWithSeparator":"Repetition",e.idx)]=a,{left:a,right:c}}function R(t,n){return t.decisionStates.push(n),n.decision=t.decisionStates.length-1,n.decision}function $(t,n,e,o,...i){const s=P(t,n,o,{type:8,start:e});e.end=s;for(const r of i)void 0!==r?(j(e,r.left),j(r.right,s)):j(e,s);const p={left:e,right:s};return t.decisionMap[T(n,function(t){if(t instanceof r)return"Alternation";if(t instanceof a)return"Option";if(t instanceof c)return"Repetition";if(t instanceof u)return"RepetitionWithSeparator";if(t instanceof f)return"RepetitionMandatory";if(t instanceof l)return"RepetitionMandatoryWithSeparator";throw new Error("Invalid production type encountered")}(o),o.idx)]=e,p}function _(t,n,e,o){const i=P(t,n,o,{type:1}),s=P(t,n,o,{type:1});return z(i,new x(s,e)),{left:i,right:s}}function N(t,n,e){const o=t.ruleToStartState.get(n);j(o,e.left);const i=t.ruleToStopState.get(n);j(e.right,i);return{left:o,right:i}}function j(t,n){z(t,new b(n))}function P(t,n,e,o){const i=Object.assign({atn:t,production:e,epsilonOnlyTransitions:!1,rule:n,transitions:[],nextTokenWithinRule:[],stateNumber:t.states.length},o);return t.states.push(i),i}function z(t,n){0===t.transitions.length&&(t.epsilonOnlyTransitions=n.isEpsilon()),t.transitions.push(n)}function U(t,n){t.states.splice(t.states.indexOf(n),1)}const W={};class F{constructor(){this.map={},this.configs=[]}get size(){return this.configs.length}finalize(){this.map={}}add(t){const n=G(t);n in this.map||(this.map[n]=this.configs.length,this.configs.push(t))}get elements(){return this.configs}get alts(){return d(this.configs,t=>t.alt)}get key(){let t="";for(const n in this.map)t+=n+":";return t}}function G(t,n=!0){return`${n?`a${t.alt}`:""}s${t.state.stateNumber}:${t.stack.map(t=>t.stateNumber.toString()).join("_")}`}function q(t,n){const e={};return o=>{const i=o.toString();let s=e[i];return void 0!==s||(s={atnStartState:t,decision:n,states:{}},e[i]=s),s}}class B{constructor(){this.predicates=[]}is(t){return t>=this.predicates.length||this.predicates[t]}set(t,n){this.predicates[t]=n}toString(){let t="";const n=this.predicates.length;for(let e=0;e<n;e++)t+=!0===this.predicates[e]?"1":"0";return t}}const C=new B;class Y extends t{constructor(t){var n;super(),this.logging=null!==(n=null==t?void 0:t.logging)&&void 0!==n?n:t=>{}}initialize(t){this.atn=M(t.rules),this.dfas=function(t){const n=t.decisionStates.length,e=Array(n);for(let o=0;o<n;o++)e[o]=q(t.decisionStates[o],o);return e}(this.atn)}validateAmbiguousAlternationAlternatives(){return[]}validateEmptyOrAlternatives(){return[]}buildLookaheadForAlternation(t){const{prodOccurrence:e,rule:o,hasPredicates:i,dynamicTokensEnabled:s}=t,r=this.dfas,a=this.logging,c=T(o,"Alternation",e),u=this.atn.decisionMap[c].decision,f=d(n({maxLookahead:1,occurrence:e,prodType:"Alternation",rule:o}),t=>d(t,t=>t[0]));if(D(f,!1)&&!s){const t=h(f,(t,n,e)=>(g(n,n=>{n&&(t[n.tokenTypeIdx]=e,g(n.categoryMatches,n=>{t[n]=e}))}),t),{});return i?function(n){var e;const o=this.LA(1),i=t[o.tokenTypeIdx];if(void 0!==n&&void 0!==i){const t=null===(e=n[i])||void 0===e?void 0:e.GATE;if(void 0!==t&&!1===t.call(this))return}return i}:function(){const n=this.LA(1);return t[n.tokenTypeIdx]}}return i?function(t){const n=new B,e=void 0===t?0:t.length;for(let i=0;i<e;i++){const e=null==t?void 0:t[i].GATE;n.set(i,void 0===e||e.call(this))}const o=V.call(this,r,u,n,a);return"number"==typeof o?o:void 0}:function(){const t=V.call(this,r,u,C,a);return"number"==typeof t?t:void 0}}buildLookaheadForOptional(t){const{prodOccurrence:e,rule:o,prodType:i,dynamicTokensEnabled:s}=t,r=this.dfas,a=this.logging,c=T(o,i,e),u=this.atn.decisionMap[c].decision,f=d(n({maxLookahead:1,occurrence:e,prodType:i,rule:o}),t=>d(t,t=>t[0]));if(D(f)&&f[0][0]&&!s){const t=f[0],n=y(t);if(1===n.length&&v(n[0].categoryMatches)){const t=n[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===t}}{const t=h(n,(t,n)=>(void 0!==n&&(t[n.tokenTypeIdx]=!0,g(n.categoryMatches,n=>{t[n]=!0})),t),{});return function(){const n=this.LA(1);return!0===t[n.tokenTypeIdx]}}}return function(){const t=V.call(this,r,u,C,a);return"object"!=typeof t&&0===t}}}function D(t,n=!0){const e=new Set;for(const o of t){const t=new Set;for(const i of o){if(void 0===i){if(n)break;return!1}const o=[i.tokenTypeIdx].concat(i.categoryMatches);for(const n of o)if(e.has(n)){if(!t.has(n))return!1}else e.add(n),t.add(n)}}return!0}function V(t,n,e,o){const i=t[n](e);let s=i.start;if(void 0===s){s=et(i,tt(ot(i.atnStartState))),i.start=s}return H.apply(this,[i,s,e,o])}function H(t,n,e,o){let i=n,s=1;const r=[];let a=this.LA(s++);for(;;){let n=X(i,a);if(void 0===n&&(n=J.apply(this,[t,i,a,s,e,o])),n===W)return Q(r,i,a);if(!0===n.isAcceptState)return n.prediction;i=n,r.push(a),a=this.LA(s++)}}function J(t,n,e,o,i,s){const r=function(t,n,e){const o=new F,i=[];for(const r of t.elements){if(!1===e.is(r.alt))continue;if(7===r.state.type){i.push(r);continue}const t=r.state.transitions.length;for(let e=0;e<t;e++){const t=Z(r.state.transitions[e],n);void 0!==t&&o.add({state:t,alt:r.alt,stack:r.stack})}}let s;0===i.length&&1===o.size&&(s=o);if(void 0===s){s=new F;for(const t of o.elements)it(t,s)}if(i.length>0&&!function(t){for(const n of t.elements)if(7===n.state.type)return!0;return!1}(s))for(const r of i)s.add(r);return s}(n.configs,e,i);if(0===r.size)return nt(t,n,e,W),W;let a=tt(r);const c=function(t,n){let e;for(const o of t.elements)if(!0===n.is(o.alt))if(void 0===e)e=o.alt;else if(e!==o.alt)return;return e}(r,i);if(void 0!==c)a.isAcceptState=!0,a.prediction=c,a.configs.uniqueAlt=c;else if(function(t){if(function(t){for(const n of t.elements)if(7!==n.state.type)return!1;return!0}(t))return!0;const n=function(t){const n=new Map;for(const e of t){const t=G(e,!1);let o=n.get(t);void 0===o&&(o={},n.set(t,o)),o[e.alt]=!0}return n}(t.elements);return function(t){for(const n of Array.from(t.values()))if(Object.keys(n).length>1)return!0;return!1}(n)&&!function(t){for(const n of Array.from(t.values()))if(1===Object.keys(n).length)return!0;return!1}(n)}(r)){const n=S(r.alts);a.isAcceptState=!0,a.prediction=n,a.configs.uniqueAlt=n,K.apply(this,[t,o,r.alts,s])}return a=nt(t,n,e,a),a}function K(t,n,e,p){const h=[];for(let o=1;o<=n;o++)h.push(this.LA(o).tokenType);const g=t.atnStartState;p(function(t){const n=d(t.prefixPath,t=>o(t)).join(", "),e=0===t.production.idx?"":t.production.idx;let p=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(", ")}> in <${function(t){if(t instanceof s)return"SUBRULE";if(t instanceof a)return"OPTION";if(t instanceof r)return"OR";if(t instanceof f)return"AT_LEAST_ONE";if(t instanceof l)return"AT_LEAST_ONE_SEP";if(t instanceof u)return"MANY_SEP";if(t instanceof c)return"MANY";if(t instanceof i)return"CONSUME";throw Error("non exhaustive match")}(t.production)}${e}> inside <${t.topLevelRule.name}> Rule,\n<${n}> may appears as a prefix path in all these alternatives.\n`;return p+="See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details.",p}({topLevelRule:g.rule,ambiguityIndices:e,production:g.production,prefixPath:h}))}function Q(t,n,e){const o=m(n.configs.elements,t=>t.state.transitions);return{actualToken:e,possibleTokenTypes:k(o.filter(t=>t instanceof x).map(t=>t.tokenType),t=>t.tokenTypeIdx),tokenPath:t}}function X(t,n){return t.edges[n.tokenTypeIdx]}function Z(t,n){if(t instanceof x&&e(n,t.tokenType))return t.target}function tt(t){return{configs:t,edges:{},isAcceptState:!1,prediction:-1}}function nt(t,n,e,o){return o=et(t,o),n.edges[e.tokenTypeIdx]=o,o}function et(t,n){if(n===W)return n;const e=n.configs.key,o=t.states[e];return void 0!==o?o:(n.configs.finalize(),t.states[e]=n,n)}function ot(t){const n=new F,e=t.transitions.length;for(let o=0;o<e;o++){it({state:t.transitions[o].target,alt:o,stack:[]},n)}return n}function it(t,n){const e=t.state;if(7===e.type){if(t.stack.length>0){const e=[...t.stack];it({state:e.pop(),alt:t.alt,stack:e},n)}else n.add(t);return}e.epsilonOnlyTransitions||n.add(t);const o=e.transitions.length;for(let i=0;i<o;i++){const o=st(t,e.transitions[i]);void 0!==o&&it(o,n)}}function st(t,n){if(n instanceof b)return{state:n.target,alt:t.alt,stack:t.stack};if(n instanceof E){const e=[...t.stack,n.followState];return{state:n.target,alt:t.alt,stack:e}}}export{Y as L};
