# tox configuration for itential-mcp
# This configuration uses tox-uv for faster dependency resolution and installation

[tox]
# Define test environments for Python 3.10, 3.11, 3.12, and 3.13
envlist = py310,py311,py312,py313
min_version = 4.0
# Use uv for package installation (requires tox-uv plugin)
requires =
    tox>=4.0
    tox-uv>=1.0.0

[testenv]
# Use uv for package management
runner = uv-venv-runner

# Install the package in development mode
package = wheel

# Dependencies required for testing
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-asyncio>=0.21.0

# Commands to run tests
commands =
    pytest tests -v -s {posargs}

# Set environment variables
setenv =
    PYTHONPATH = {toxinidir}/src
    PYTHONDONTWRITEBYTECODE = 1

# Pass through these environment variables from the host
passenv =
    HOME
    USER
    PATH
    TERM

[testenv:py310]
basepython = python3.10
description = Run tests with Python 3.10

[testenv:py311]
basepython = python3.11
description = Run tests with Python 3.11

[testenv:py312]
basepython = python3.12
description = Run tests with Python 3.12

[testenv:py313]
basepython = python3.13
description = Run tests with Python 3.13

[testenv:coverage]
# Special environment for running tests with coverage
basepython = python3.12
description = Run tests with coverage report
commands =
    pytest --cov=itential_mcp --cov-report=term --cov-report=html tests/ {posargs}

[testenv:lint]
# Environment for running linting checks
basepython = python3.12
description = Run code quality checks (ruff)
skip_install = true
deps =
    ruff
commands =
    ruff check src
    ruff check tests

[testenv:format]
# Environment for formatting code
basepython = python3.12
description = Format code with ruff
skip_install = true
deps =
    ruff
commands =
    ruff format src tests

[testenv:security]
# Environment for security analysis
basepython = python3.12
description = Run security analysis with bandit
skip_install = true
deps =
    bandit[toml]>=1.7.0
commands =
    bandit -r src/ --configfile pyproject.toml

[testenv:premerge]
# Environment that runs all premerge checks
basepython = python3.12
description = Run all premerge checks (format, lint, security, test)
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-asyncio>=0.21.0
    ruff
    bandit[toml]>=1.7.0
commands =
    ruff format src tests
    ruff check src
    ruff check tests
    bandit -r src/ --configfile pyproject.toml
    pytest tests -v -s
