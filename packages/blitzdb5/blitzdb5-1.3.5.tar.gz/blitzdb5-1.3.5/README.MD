
### Blitzdb ported to newer Python3 with some minor changes (see diff)

Orignal source/license info and acknowelegement(s) at https://github.com/adewes/blitzdb and https://github.com/abilian/blitzdb3


# BlitzDB5

A modernized Python 3 port of **BlitzDB**, a lightweight documentâ€‘oriented database originally created by Andreas Dewes. BlitzDB5 preserves the original fileâ€‘based architecture, transactional indexing, and MongoDBâ€‘style query API while updating the codebase for modern Python and performance.

> This project is a continuation/port of:
>
> * [https://github.com/adewes/blitzdb](https://github.com/adewes/blitzdb)
> * [https://github.com/abilian/blitzdb3](https://github.com/abilian/blitzdb3)

---

## âœ¨ Key Features

* âœ… Pure Python document database
* âœ… Fileâ€‘based persistent storage
* âœ… Transactional writes with commit & rollback
* âœ… Automatic and manual indexing
* âœ… MongoDBâ€‘style query language
* âœ… JSON / Pickle serialization
* âœ… Optional CJSON support
* âœ… Automatic primaryâ€‘key indexing
* âœ… Ephemeral (inâ€‘memory) indexes for fast queries
* âœ… Configurable autocommit
* âœ… Optional inâ€‘memory caching

---

## ğŸ“¦ Installation

Install from source:

```bash
git clone https://gitlab.com/sunsolution/blitzdb5.git
cd blitzdb5
pip install .
```

Dependencies are managed via `pyproject.toml`:

* Python 3.9+
* `orjson`

---

## ğŸš€ Quick Start

```python
from blitzdb.backends.file.backend import Backend
from blitzdb.document import Document

class User(Document):
    pass

backend = Backend("./database")
backend.register(User)

user = User({"name": "Alice", "age": 30})
backend.save(user)

found = backend.get(User, {"name": "Alice"})
print(found)
```

---

## ğŸ—„ï¸ Supported Backends

BlitzDB5 supports multiple storage backends, allowing you to choose the right engine depending on your deployment needs:

### 1. File Backend (Default)

* âœ… Fully implemented and productionâ€‘ready
* âœ… Pure fileâ€‘based storage (no external services required)
* âœ… Transactional with persistent indexes
* âœ… JSON / Pickle / CJSON serialization
* âœ… Best choice for embedded and offline use

### 2. MongoDB Backend

* âœ… Uses MongoDB as the storage engine
* âœ… Supports native MongoDB querying and indexing
* âœ… Ideal for distributed and scalable deployments
* âš ï¸ Requires a running MongoDB instance

### 3. SQL Backend (SQLAlchemy)

* âœ… Enables SQL database support via SQLAlchemy
* âœ… Works with PostgreSQL, MySQL, SQLite, etc.
* âœ… Allows structured relational storage with document interface
* âš ï¸ Marked as experimental in some parts of the codebase

---

## âš™ï¸ Backend Setup & Example Commands

This section shows **exact setup patterns and usage examples** for each supported backend.

---

### âœ… File Backend (Default â€“ No External Dependencies)

#### Setup

```python
from blitzdb.backends.file.backend import Backend
from blitzdb.document import Document

class User(Document):
    pass

backend = Backend("./database", serialize="json")
backend.register(User)
```

#### Save Data

```python
user = User({"name": "Alice", "age": 30})
backend.save(user)
backend.commit()
```

#### Query

```python
users = backend.filter(User, {"age": {"$gt": 18}})
```

#### Folder Created on Disk

```
./database/
â”œâ”€â”€ config.json
â”œâ”€â”€ user/
â”‚   â”œâ”€â”€ objects/
â”‚   â””â”€â”€ indexes/
```

âœ… **Best for:** Embedded apps, offline storage, local services, desktop software

---

### âœ… MongoDB Backend

#### Requirements

```bash
pip install pymongo
```

MongoDB must be running:

```bash
mongod --dbpath /data/db
```

#### Setup

```python
from blitzdb.backends.mongo.backend import Backend
from blitzdb.document import Document

class User(Document):
    pass

backend = Backend(
    db="blitzdb",
    host="localhost",
    port=27017
)

backend.register(User)
```

#### Save

```python
user = User({"name": "Alice"})
backend.save(user)
```

âœ… **Best for:** Web apps, horizontal scaling, shared environments
âš ï¸ Requires external service

---

### âœ… SQL Backend (SQLAlchemy)

#### Requirements

```bash
pip install sqlalchemy psycopg2-binary
```

#### Setup (PostgreSQL Example)

```python
from blitzdb.backends.sql.backend import Backend
from blitzdb.document import Document

class User(Document):
    pass

backend = Backend(
    url="postgresql://user:password@localhost:5432/blitzdb"
)

backend.register(User)
```

#### Setup (SQLite Example)

```python
backend = Backend(url="sqlite:///blitzdb.sqlite")
```

âœ… **Best for:** Data analysis, reporting, ACIDâ€‘strict systems
âš ï¸ Slower than Mongo for document workloads
âš ï¸ Schema translation overhead

---

## ğŸ“Š Backend Comparison Table

| Feature          | File Backend   | MongoDB Backend | SQL Backend |
| ---------------- | -------------- | --------------- | ----------- |
| External Server  | âŒ No           | âœ… Yes           | âœ… Yes       |
| Setup Complexity | â­ Very Low     | â­â­ Medium       | â­â­ Medium   |
| Performance      | â­â­â­ Fast Local | â­â­â­â­ High       | â­â­ Moderate |
| Scalability      | â­ Lowâ€‘Medium   | â­â­â­â­ High       | â­â­â­ High    |
| Transactions     | âœ… Yes          | âœ… Yes           | âœ… Yes       |
| Index Support    | âœ… Native       | âœ… Native        | âœ… Native    |
| Offline Use      | âœ… Perfect      | âŒ No            | âŒ No        |
| Embedded Use     | âœ… Best         | âŒ No            | âš ï¸ Limited  |
| Cloudâ€‘Native     | âŒ No           | âœ… Yes           | âœ… Yes       |
| Operational Cost | âœ… None         | âŒ High          | âŒ Medium    |

---

## ğŸ§  Practical Opinions & Recommendations

### âœ… Choose **File Backend** when:

* You are building:

  * Desktop apps
  * Offlineâ€‘first systems
  * Embedded devices
  * CLI tools
* You want:

  * Zero dependencies
  * Maximum simplicity
  * Full control of disk layout

â¡ï¸ **This is the strongest and most "BlitzDBâ€‘native" backend.**

---

### âœ… Choose **MongoDB Backend** when:

* You are building:

  * Web APIs
  * SaaS platforms
  * Multiâ€‘instance deployments
* You need:

  * Horizontal scaling
  * Shared multiâ€‘process access
  * Native cloud compatibility

â¡ï¸ **Best production backend for highâ€‘traffic systems.**

---

### âœ… Choose **SQL Backend** when:

* You need:

  * Strong relational constraints
  * Heavy reporting
  * Existing SQL infrastructure
* You already depend on:

  * PostgreSQL / MySQL / SQLite

â¡ï¸ **Best for hybrid document + relational systems.**

âš ï¸ **Not ideal** for highâ€‘frequency document writes.

---

## ğŸ§  Architecture Overview

| Component      | Purpose                         |
| -------------- | ------------------------------- |
| `Backend`      | Core database engine            |
| `Store`        | Object blob storage             |
| `Index`        | Persistent & ephemeral indexing |
| `QuerySet`     | Lazy query execution            |
| `Serializer`   | JSON / Pickle encoding          |
| `CacheManager` | Optional inâ€‘memory caching      |

---

## ğŸ—„ Storage Layout

```
database/
â”œâ”€â”€ config.json
â”œâ”€â”€ users/
â”‚   â”œâ”€â”€ objects/
â”‚   â””â”€â”€ indexes/
â”‚       â”œâ”€â”€ email/
â”‚       â””â”€â”€ pk/
```

---

## ğŸ” Transactions

```python
backend.begin()
backend.save(user)
backend.commit()
```

Rollback:

```python
backend.rollback()
```

âš ï¸ Indexes created during a failed transaction are automatically rebuilt.

---

## ğŸ’¾ Saving & Updating Documents

### Save

```python
backend.save(obj)
```

### Update

```python
backend.update(obj, set_fields={"age": 31})
```

---

## âŒ Deleting Documents

```python
backend.delete(obj)
```

---

## ğŸ” Querying

```python
results = backend.filter(User, {"age": {"$gt": 18}})
```

Get exactly one:

```python
user = backend.get(User, {"name": "Alice"})
```

---

## ğŸ“Š Sorting

```python
backend.sort(User, keys, "age")
```

Supports multiâ€‘field sorting and ascending/descending order.

---

## ğŸ“‡ Indexing

### Create Index

```python
backend.create_index(User, "email", unique=True)
```

### Ephemeral Index

```python
backend.create_index(User, "last_login", ephemeral=True)
```

### Rebuild Index

```python
backend.rebuild_index("users", "email")
```

---

## âš™ï¸ Configuration (`config.json`)

Default configuration:

```json
{
  "indexes": {},
  "store_class": "transactional",
  "index_class": "transactional",
  "index_store_class": "basic",
  "serializer_class": "json",
  "autocommit": false
}
```

Set autocommit:

```python
backend.autocommit = True
```

âš ï¸ Autocommit forces a full index rebuild after every write.

---

## ğŸ§¬ Serialization

Supported formats:

* `json` (default)
* `pickle`
* `cjson` (if installed)

```python
backend = Backend("./db", serialize="pickle")
```

---

## ğŸ§  Caching

Enable caching:

```python
backend = Backend("./db", enable_caching=True)
```

FIFO cache with automatic eviction (default 1000 entries).

---

## âš ï¸ Error Handling

### `DatabaseIndexError`

Raised if an index becomes corrupted. Recover using:

```python
backend.rebuild_index("collection", "field")
```

---

## ğŸ“œ License

MIT License

Original copyright Â© 2014 Andreas Dewes

---

## âœ… Project Status

* âœ… Fully functional file backend
* âœ… Python 3 modernized port
* âš ï¸ Batch operations are partially implemented
* âš ï¸ SQLAlchemy engine support is experimental

---

## ğŸ§­ Summary

BlitzDB5 is ideal for:

* Embedded databases
* Local desktop apps
* Lightweight document storage
* Offlineâ€‘first systems

It provides a clean, Pythonic document store with strong indexing and transaction guarantees without requiring a server.
