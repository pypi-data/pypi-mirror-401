# Planning Results

## Phase 1: Project Setup and Core Architecture
- [x] Initialize Python project with `uv` for python 3.12.
- [x] Configure `pyproject.toml` with dependencies (`fastapi`, `uvicorn`, `python-dotenv`, `websockets`, `pytest`, `pytest-asyncio`).
- [x] Implement Configuration Loader.
    - [x] Create `Config` class to load environment variables from `.env` and `.env.example`.
    - [x] Ensure "Workspace" directory isolation logic is valid.
- [x] Implement `Worker` Base Class.
    - [x] Create `Worker` class with an internal `asyncio.Queue`.
    - [x] Implement the `run` loop to process messages from the queue.
    - [x] Add signal handling mechanism (asyncio Event) to start/stop processing.
- [x] Implement `Broker` Class (Basic).
    - [x] Create `Broker` class.
    - [x] Implement `register_worker` method.
    - [x] Implement basic dispatching logic (putting messages into Worker queues).
- [x] **Verification (Test 01)**: Create a test case for Basic Broker-Worker Lifecycle (Create, Register, Start, Stop).

## Phase 2: Advanced Dispatching and Example Implementation
- [x] Enhance `Broker` Dispatching.
    - [x] Implement `broadcast` strategy (send to all matching workers).
    - [x] Implement `round_robin` strategy (send to next worker in list).
    - [x] Implement `direct` strategy (send to specific worker ID).
- [x] Implement RPN Calculator Worker.
    - [x] Create `RPNWorker` subclassing `Worker`.
    - [x] Implement logic to handle arithmetic messages (`add`, `sub`, `mul`, `div`).
- [x] **Verification (Test 02)**: Create an integration test for the RPN Calculator.
    - [x] Broker registers RPNWorker.
    - [x] Send sequence of operations.
    - [x] Assert correct results.

## Phase 3: Server-Side Networking (FastAPI + WebSocket)
- [x] Setup FastAPI Application.
    - [x] Create entry point `app.py`.
    - [x] Integrate `Broker` instance within the FastAPI app lifespan.
- [x] Implement WebSocket Endpoint.
    - [x] Create `/ws` endpoint for client connections.
    - [x] Handle incoming messages from WebSocket and bridge them to the Broker.
    - [x] Bridge Broker events/results back to the WebSocket.
- [x] Implement Heartbeat Mechanism (Server).
    - [x] Background task sending "ping" every 5 seconds.
    - [x] Logic to disconnect client if no "pong" received within 10 seconds.

## Phase 4: Client-Side TUI/CLI
- [x] Create Client Application.
    - [x] Implement CLI entry point.
    - [x] Add `connect` command to establish WebSocket connection.
    - [x] Add `disconnect` command.
- [x] Implement Client Heartbeat.
    - [x] Task to send "pong" or "ping" every 5 seconds.
    - [x] Timeout logic to detect server disconnection (10 seconds).
- [x] Implement Basic TUI (optional but recommended for "Terminal User Interface").
    - [x] Simple loop to read user input and display server responses.

## Phase 5: Quality Assurance & Deployment
- [x] Code Coverage.
    - [x] Configure `pytest-cov`.
    - [x] Ensure >90% coverage on Core and Networking logic.
- [x] Fuzzing/Random Testing.
    - [x] Add property-based tests (e.g., using `hypothesis`) for the RPN calculator and Broker dispatching.
- [x] Dockerization.
    - [x] Create `Dockerfile` for the server.
    - [x] Create `docker-compose.yml` for the full stack.
