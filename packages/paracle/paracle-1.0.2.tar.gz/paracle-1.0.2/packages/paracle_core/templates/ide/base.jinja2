{# Base template for IDE configuration files #}
{# All IDE-specific templates should extend this #}

{% block header %}
# Paracle AI Instructions
# Auto-generated from .parac/ - DO NOT EDIT MANUALLY
# Regenerate with: paracle ide sync --copy
# Generated: {{ generated_at }}
#
# üìñ Complete Documentation:
# - .parac/UNIVERSAL_AI_INSTRUCTIONS.md - Works with ANY IDE (read this first!)
# - .parac/USING_PARAC.md - Complete 20+ section guide
# - .parac/CONFIG_FILES.md - project.yaml vs manifest.yaml explained
# - .parac/GOVERNANCE.md - Governance rules
# - .parac/STRUCTURE.md - Complete .parac/ structure
{% endblock %}

{% block core_principle %}

## Core Principle

> **`.parac/` is the single source of truth. Read it. Follow it. Log to it.**

## üö® MANDATORY: Pre-Flight Checklist

**Before ANY implementation task:**

üìã **Complete [.parac/PRE_FLIGHT_CHECKLIST.md](.parac/PRE_FLIGHT_CHECKLIST.md)** (~4 minutes)

This checklist ensures:
- You're working on the RIGHT task
- At the RIGHT phase
- With the RIGHT priority
- In the RIGHT sequence

**Quick version:**
1. Read `.parac/GOVERNANCE.md` - Governance rules
2. Check `.parac/memory/context/current_state.yaml` - Current state
3. Consult `.parac/roadmap/roadmap.yaml` - Phase & priorities
4. Verify `.parac/memory/context/open_questions.md` - Blockers
5. **VALIDATE**: Task in roadmap? Correct phase? Priority? Dependencies?
6. Adopt agent persona from `.parac/agents/specs/{agent}.md`
7. Check policies (CODE_STYLE, TESTING, SECURITY)

**Before ANY action**, you MUST:
1. `.parac/GOVERNANCE.md` - Governance rules and dogfooding context
2. `.parac/agents/manifest.yaml` - Available agents
3. `.parac/memory/context/current_state.yaml` - Current project state
4. `.parac/roadmap/roadmap.yaml` - Phases and priorities
5. `.parac/PRE_FLIGHT_CHECKLIST.md` - Mandatory task validation
6. Adopt agent persona from `.parac/agents/specs/{agent_id}.md`

{% endblock %}

{% block current_state %}
{% if current_state %}

## Current Project State

- **Project**: {{ current_state.project_name }} v{{ current_state.project_version }}
- **Phase**: {{ current_state.phase.id }} - {{ current_state.phase.name }} ({{ current_state.phase.progress }})
- **Status**: {{ current_state.phase.status }}
{% if current_state.phase.focus_areas %}
- **Focus**: {{ current_state.phase.focus_areas | join(", ") }}
{% endif %}
{% if current_state.blockers_count > 0 %}
- **Blockers**: {{ current_state.blockers_count }}
{% endif %}

{% endif %}
{% endblock %}

{% block agents %}
{% if agents %}

## Available Agents

{% for agent in agents %}
### {{ agent.name }} (`{{ agent.id }}`)

- **Role**: {{ agent.role }}
{% if agent.capabilities %}
- **Capabilities**: {{ agent.capabilities | join(", ") }}
{% endif %}
{% if agent.description %}
- **Description**: {{ agent.description }}
{% endif %}

{% endfor %}
{% endif %}
{% endblock %}

{% block governance %}
{% if governance_summary %}

## Governance Rules

{{ governance_summary }}

{% endif %}
{% endblock %}

{% block decisions %}
{% if recent_decisions %}

## Recent Decisions

{% for decision in recent_decisions %}
- **{{ decision.id }}**: {{ decision.summary }}
{% endfor %}

{% endif %}
{% endblock %}

{% block questions %}
{% if open_questions %}

## Open Questions

{% for question in open_questions %}
- {{ question.question }}
{% endfor %}

{% endif %}
{% endblock %}

{% block logging %}

## Logging Actions

**MANDATORY**: After EVERY significant action, log to `.parac/memory/logs/agent_actions.log`:

**Format**: `[TIMESTAMP] [AGENT] [ACTION] Description`

**Example**:
```
[2026-01-04 15:30:00] [CoderAgent] [IMPLEMENTATION] Implemented webhook system in packages/paracle_events/webhooks.py
[2026-01-04 15:45:00] [TesterAgent] [TEST] Added unit tests for webhook delivery
[2026-01-04 16:00:00] [ReviewerAgent] [REVIEW] Reviewed PR #42 - webhook implementation
```

**Action Types**:
- `IMPLEMENTATION` - Code implementation
- `TEST` - Test creation/modification
- `BUGFIX` - Bug correction
- `REFACTORING` - Code refactoring
- `REVIEW` - Code review
- `DOCUMENTATION` - Documentation update
- `DECISION` - Important decision (also log to `.parac/memory/logs/decisions.log`)
- `PLANNING` - Planning/roadmap updates
- `UPDATE` - .parac/ file updates

**Python Logging (optional)**:
```python
from paracle_core.governance import log_action, agent_context

with agent_context("CoderAgent"):
    log_action("IMPLEMENTATION", "Description of work done")
```

{% endblock %}

{% block workflow %}

## Standard Workflow

### Before ANY Action
1. **Read GOVERNANCE.md**: Understand dogfooding context (Paracle develops Paracle)
2. **Check current_state.yaml**: Get current phase, status, progress
3. **Read roadmap.yaml**: Understand current phase priorities
4. **Identify Agent**: Select agent for task type
   - New feature ‚Üí `coder` (+ `architect` if design needed)
   - Bug fix ‚Üí `coder` (+ `tester` for validation)
   - Documentation ‚Üí `documenter`
   - Architecture ‚Üí `architect`
   - Planning ‚Üí `pm`
   - Review ‚Üí `reviewer`
5. **Read Agent Spec**: Load full spec from `.parac/agents/specs/{agent_id}.md`
6. **Check Assigned Skills**: See `.parac/agents/SKILL_ASSIGNMENTS.md`

### During Work
1. **Follow Agent Standards**: Apply agent's responsibilities and guidelines
2. **Use Agent Skills**: Leverage assigned skills (see SKILL_ASSIGNMENTS.md)
3. **Check Policies**: Follow `.parac/policies/` (code style, testing, security)
4. **Update Memory Context**: Keep `.parac/memory/context/` current
5. **Track Progress**: Update task status in roadmap if applicable

### After Action (MANDATORY)
1. **Log Action**: Add entry to `.parac/memory/logs/agent_actions.log`
   - Format: `[TIMESTAMP] [AGENT] [ACTION] Description`
   - ALWAYS include file paths for code changes
2. **Update State**: Modify `.parac/memory/context/current_state.yaml` if needed
3. **Log Decisions**: Important decisions go to `.parac/memory/logs/decisions.log`
4. **Update Knowledge**: Add learnings to `.parac/memory/knowledge/*.md`
5. **Track Questions**: Unresolved issues go to `.parac/memory/context/open_questions.md`

### Configuration Files
- **project.yaml** (MANUAL): Project config - YOU can edit this
- **manifest.yaml** (AUTO-GENERATED): Workspace state - CLI generates, DON'T edit
- See `.parac/CONFIG_FILES.md` for complete explanation

{% endblock %}

{% block governance_tools %}

## Governance Tools & Commands

### Roadmap-State Synchronization

**Check alignment between roadmap and current state:**
```bash
paracle sync --roadmap
```

This detects:
- Phase name/status mismatches
- Completion % differences
- Missing/extra deliverables
- Metric inconsistencies

**See [content/docs/roadmap-state-sync.md](../content/docs/roadmap-state-sync.md) for details.**

### Governance Validation

**Validate all .parac/ files:**
```bash
paracle validate
```

Checks:
- YAML syntax
- Required files exist
- Roadmap-state alignment
- File permissions

### Session Management

**Start a session:**
```bash
paracle session start "Feature: Add X"
```

**End session and checkpoint:**
```bash
paracle session end
```

### API Keys Configuration

**Configure LLM provider API keys** for your project:

1. Copy example: `cp .env.example .env`
2. Add keys to `.env`: `OPENAI_API_KEY=sk-...`
3. Never commit `.env` to git!

**See [content/docs/api-keys.md](../content/docs/api-keys.md) for:**
- 12+ provider setup guides
- Security best practices
- Docker/production deployment
- Troubleshooting

{% endblock %}

{% block source_files %}

## Essential .parac/ Files

| File | Purpose | When to Read |
| --- | --- | --- |
| **`.parac/GOVERNANCE.md`** | Governance rules, dogfooding context | ALWAYS first |
| **`.parac/PRE_FLIGHT_CHECKLIST.md`** | **NEW: Mandatory task validation** | **Before ANY implementation** |
| **`.parac/UNIVERSAL_AI_INSTRUCTIONS.md`** | Universal instructions (any IDE) | Setup / reference |
| **`.parac/USING_PARAC.md`** | Complete 20+ section guide | Deep understanding |
| **`.parac/CONFIG_FILES.md`** | project.yaml vs manifest.yaml | When confused about config |
| **`.parac/STRUCTURE.md`** | Complete .parac/ structure | Understanding organization |
| **`.parac/agents/manifest.yaml`** | Agent registry | Before selecting agent |
| **`.parac/agents/specs/{agent}.md`** | Agent detailed specs | After selecting agent |
| **`.parac/agents/SKILL_ASSIGNMENTS.md`** | Skills per agent | Understanding capabilities |
| **`.parac/memory/context/current_state.yaml`** | Project state | ALWAYS (before action) |
| **`.parac/memory/context/open_questions.md`** | Open questions | When blocked |
| **`.parac/memory/knowledge/architecture.md`** | Architecture knowledge | Design decisions |
| **`.parac/memory/knowledge/glossary.md`** | Project glossary | Term clarification |
| **`.parac/memory/logs/agent_actions.log`** | Action history | Understanding changes |
| **`.parac/memory/logs/decisions.log`** | Important decisions | Context for choices |
| **`.parac/roadmap/roadmap.yaml`** | Roadmap and phases | Understanding priorities |
| **`.parac/roadmap/decisions.md`** | ADRs (Architecture Decision Records) | Design rationale |
| **`.parac/policies/CODE_STYLE.md`** | Code style guide | Before coding |
| **`.parac/policies/TESTING.md`** | Testing policy | Before writing tests |
| **`.parac/policies/SECURITY.md`** | Security policy | Security-sensitive code |
| **`content/docs/api-keys.md`** | **NEW: API key management guide** | **Setting up LLM providers** |
| **`content/docs/roadmap-state-sync.md`** | **NEW: Roadmap sync guide** | **Understanding governance automation** |

{% endblock %}

{% block rules %}

## Rules

**DO:**

‚úÖ **ALWAYS read `.parac/GOVERNANCE.md` first** - Understand dogfooding context
‚úÖ **Check `.parac/memory/context/current_state.yaml`** - Know current state
‚úÖ **Read agent spec** before adopting persona (`.parac/agents/specs/{agent}.md`)
‚úÖ **Log EVERY significant action** to `.parac/memory/logs/agent_actions.log`
‚úÖ **Include file paths** in log entries for code changes
‚úÖ **Follow agent's assigned skills** (see `.parac/agents/SKILL_ASSIGNMENTS.md`)
‚úÖ **Respect policies** in `.parac/policies/` (code style, testing, security)
‚úÖ **Update current_state.yaml** after significant progress
‚úÖ **Log decisions** to `.parac/memory/logs/decisions.log` for important choices
‚úÖ **Track questions** in `.parac/memory/context/open_questions.md` when blocked
‚úÖ **Edit project.yaml** for manual configuration changes
‚úÖ **Use `paracle sync`** to regenerate manifest.yaml (never edit directly)

**DON'T:**

‚ùå **Never skip reading GOVERNANCE.md** - It's the foundation
‚ùå **Never edit manifest.yaml manually** - Use `paracle sync` instead
‚ùå **Never duplicate agent definitions** - Agents are defined in `.parac/agents/`
‚ùå **Never ignore current_state.yaml** - It's the source of truth for project status
‚ùå **Never skip logging actions** - Traceability is mandatory
‚ùå **Never create custom governance rules** - Follow existing governance
‚ùå **Never assume context** - Always read .parac/ files first
‚ùå **Never work on wrong phase** - Check roadmap.yaml for current priorities
‚ùå **Never mix agent personas** - One agent per task, clear boundaries

{% endblock %}

{% block ide_specific %}
{# Override this block in IDE-specific templates #}
{% endblock %}

{% block footer %}

---

## Quick Start Checklist

Before your first action:
- [ ] Read `.parac/GOVERNANCE.md`
- [ ] Read `.parac/UNIVERSAL_AI_INSTRUCTIONS.md` (works with ANY IDE)
- [ ] Check `.parac/memory/context/current_state.yaml`
- [ ] Review `.parac/roadmap/roadmap.yaml` (current phase)
- [ ] Identify agent for task type
- [ ] Read agent spec from `.parac/agents/specs/{agent_id}.md`

During work:
- [ ] Follow agent standards and assigned skills
- [ ] Check `.parac/policies/` for guidelines
- [ ] Update memory context as needed

After action (MANDATORY):
- [ ] Log action to `.parac/memory/logs/agent_actions.log`
- [ ] Update `.parac/memory/context/current_state.yaml` if progress made
- [ ] Log decisions to `.parac/memory/logs/decisions.log` if applicable

---

## Common Errors to Avoid

1. **Not reading GOVERNANCE.md first** ‚Üí You miss the dogfooding context
2. **Skipping current_state.yaml** ‚Üí You work on wrong phase/outdated info
3. **Not logging actions** ‚Üí No traceability, breaks governance
4. **Editing manifest.yaml manually** ‚Üí It's auto-generated! Use `paracle sync`
5. **Mixing agent personas** ‚Üí Stick to one agent per task
6. **Ignoring roadmap.yaml** ‚Üí You work on wrong priorities
7. **Not checking open_questions.md** ‚Üí You duplicate questions or miss blockers

---

## Related Documentation

- **[.parac/UNIVERSAL_AI_INSTRUCTIONS.md](../.parac/UNIVERSAL_AI_INSTRUCTIONS.md)** - Works with ANY IDE
- **[.parac/USING_PARAC.md](../.parac/USING_PARAC.md)** - Complete 20+ section guide
- **[.parac/CONFIG_FILES.md](../.parac/CONFIG_FILES.md)** - Configuration files explained
- **[.parac/GOVERNANCE.md](../.parac/GOVERNANCE.md)** - Governance rules
- **[.parac/STRUCTURE.md](../.parac/STRUCTURE.md)** - Complete structure
- **[.parac/agents/SKILL_ASSIGNMENTS.md](../.parac/agents/SKILL_ASSIGNMENTS.md)** - Skills per agent
- **[content/docs/architecture.md](../content/docs/architecture.md)** - Technical architecture

---

**Remember**: `.parac/` is your single source of truth. Always read it first. üéØ
{% endblock %}
