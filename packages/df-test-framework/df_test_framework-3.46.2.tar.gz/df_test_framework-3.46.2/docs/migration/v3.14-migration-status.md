# v3.14.0 è¿ç§»çŠ¶æ€è¿½è¸ª

> **åˆ›å»ºæ—¥æœŸ**: 2025-12-04
> **æœ€åæ›´æ–°**: 2025-12-04
> **çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­

---

## æ¦‚è¿°

v3.14.0 æ¶æ„é‡æ„çš„è¿ç§»çŠ¶æ€è¿½è¸ªæ–‡æ¡£ã€‚è®°å½•æ–°æ¶æ„å®ç°è¿›åº¦å’Œæ—§ä»£ç è¿ç§»çŠ¶æ€ã€‚

---

## è¿ç§»çŠ¶æ€æ€»è§ˆ

| æ¨¡å— | çŠ¶æ€ | å®Œæˆåº¦ | å¤‡æ³¨ |
|------|------|--------|------|
| core/ å±‚æ ¸å¿ƒæŠ½è±¡ | âœ… å®Œæˆ | 100% | Middlewareã€Contextã€Eventsã€Protocols |
| infrastructure/plugins/ | âœ… å®Œæˆ | 100% | PluggyPluginManager + HookSpecs |
| infrastructure/telemetry/ | âœ… å®Œæˆ | 100% | Telemetry é—¨é¢ |
| infrastructure/events/ | âœ… å®Œæˆ | 100% | EventBus å‘å¸ƒ/è®¢é˜… |
| infrastructure/context/ | âœ… å®Œæˆ | 100% | ContextCarrier å®ç° |
| plugins/builtin/ | âœ… å®Œæˆ | 100% | MonitoringPlugin, AllurePlugin |
| capabilities/clients/http/middleware/ | âœ… å®Œæˆ | 100% | æ–°ä¸­é—´ä»¶å®ç° |
| **HttpClient é›†æˆ** | âœ… å®Œæˆ | 100% | å·²é›†æˆ MiddlewareChain |
| **AsyncHttpClient é›†æˆ** | âœ… å®Œæˆ | 100% | å·²é›†æˆ MiddlewareChain |
| **Database é›†æˆ** | âœ… å®Œæˆ | 100% | å·²é›†æˆ EventBus + Telemetry |
| **UnitOfWork é›†æˆ** | âœ… å®Œæˆ | 100% | å·²é›†æˆ EventBus + Telemetry |
| **Messengers é›†æˆ** | âœ… å®Œæˆ | 100% | Kafka/RabbitMQ/RocketMQ å·²é›†æˆ |
| åºŸå¼ƒæ¨¡å—æ ‡è®° | âœ… å®Œæˆ | 100% | common/, extensions/, interceptors/ |
| ä¸»å…¥å£æ¸…ç† | âœ… å®Œæˆ | 100% | ç»Ÿä¸€ä» core å¯¼å…¥ |

---

## Phase 1: æ ¸å¿ƒè¿ç§»

### 1.1 HttpClient é›†æˆ MiddlewareChain âœ…

**çŠ¶æ€**: å·²å®Œæˆ

**å˜æ›´å†…å®¹**:
- HttpClient æ”¯æŒ `middlewares=[]` æ„é€ å‚æ•°
- æ”¯æŒ `.use(middleware)` é“¾å¼è°ƒç”¨
- å†…éƒ¨ä½¿ç”¨ `MiddlewareChain` æ‰§è¡Œä¸­é—´ä»¶
- ä¿æŒå‘åå…¼å®¹ï¼šåŒæ—¶æ”¯æŒæ—§çš„ `interceptors` å‚æ•°ï¼ˆå·²åºŸå¼ƒï¼‰

**æ–‡ä»¶å˜æ›´**:
- `capabilities/clients/http/rest/httpx/client.py`
- `capabilities/clients/http/rest/httpx/async_client.py`

### 1.2 æ¸…ç†ä¸»å…¥å£å¯¼å…¥ âœ…

**çŠ¶æ€**: å·²å®Œæˆ

**å˜æ›´å†…å®¹**:
- å¼‚å¸¸ä» `core.exceptions` å¯¼å…¥ï¼ˆè€Œé `common.exceptions`ï¼‰
- ç»Ÿä¸€ä½¿ç”¨ `hookimpl`ï¼ˆç§»é™¤ `new_hookimpl` åˆ«åï¼‰
- æ¸…ç†é‡å¤å¯¼å…¥

**æ–‡ä»¶å˜æ›´**:
- `__init__.py`

### 1.3 æ ‡è®°æ—§ Interceptor ç³»ç»ŸåºŸå¼ƒ âœ…

**çŠ¶æ€**: å·²å®Œæˆ

**å˜æ›´å†…å®¹**:
- `capabilities/clients/http/interceptors/` æ·»åŠ åºŸå¼ƒè­¦å‘Š
- `capabilities/clients/http/core/chain.py` æ·»åŠ åºŸå¼ƒè­¦å‘Š
- `capabilities/clients/http/core/interceptor.py` æ·»åŠ åºŸå¼ƒè­¦å‘Š

---

## Phase 2: èƒ½åŠ›å±‚é›†æˆ

### 2.1 Database é›†æˆäº‹ä»¶ç³»ç»Ÿ âœ…

**çŠ¶æ€**: å·²å®Œæˆ

**å˜æ›´å†…å®¹**:
- `Database.execute()` å‘å¸ƒ `DatabaseQueryStartEvent`/`DatabaseQueryEndEvent`
- æ”¯æŒå¯é€‰çš„ `telemetry` å’Œ `event_bus` å‚æ•°
- è‡ªåŠ¨è®°å½•æŸ¥è¯¢è€—æ—¶å’Œè¡Œæ•°

**æ–‡ä»¶å˜æ›´**:
- `capabilities/databases/database.py`

### 2.2 UnitOfWork é›†æˆ âœ…

**çŠ¶æ€**: å·²å®Œæˆ

**å˜æ›´å†…å®¹**:
- æ”¯æŒ `telemetry` å‚æ•°
- æ”¯æŒ `event_bus` å‚æ•°
- äº‹åŠ¡æ“ä½œè‡ªåŠ¨è¿½è¸ª

**æ–‡ä»¶å˜æ›´**:
- `capabilities/databases/uow.py`

### 2.3 Messengers é›†æˆ âœ…

**çŠ¶æ€**: å·²å®Œæˆ

**å˜æ›´å†…å®¹**:
- KafkaProducer/Consumer é›†æˆ EventBus
- RabbitMQ Publisher/Consumer é›†æˆ EventBus
- RocketMQ Producer/Consumer é›†æˆ EventBus
- å‘å¸ƒ `MessagePublishEvent`/`MessageConsumeEvent`

**æ–‡ä»¶å˜æ›´**:
- `capabilities/messengers/queue/kafka/producer.py`
- `capabilities/messengers/queue/kafka/consumer.py`
- `capabilities/messengers/queue/rabbitmq/publisher.py`
- `capabilities/messengers/queue/rabbitmq/consumer.py`
- `capabilities/messengers/queue/rocketmq/producer.py`
- `capabilities/messengers/queue/rocketmq/consumer.py`

---

## Phase 3: æ¸…ç†è®¡åˆ’

### å¾…ç§»é™¤æ¨¡å—ï¼ˆv3.16.0ï¼‰

| æ¨¡å— | å½“å‰çŠ¶æ€ | è®¡åˆ’ç§»é™¤ç‰ˆæœ¬ |
|------|----------|--------------|
| `common/` | å·²åºŸå¼ƒï¼Œé‡å¯¼å‡ºåˆ° core | v3.16.0 |
| `extensions/` | å·²åºŸå¼ƒï¼Œé‡å¯¼å‡ºåˆ° infrastructure.plugins | v3.16.0 |
| `capabilities/clients/http/interceptors/` | å·²åºŸå¼ƒ | v3.16.0 |
| `capabilities/clients/http/core/chain.py` | å·²åºŸå¼ƒ | v3.16.0 |
| `capabilities/clients/http/core/interceptor.py` | å·²åºŸå¼ƒ | v3.16.0 |

---

## æµ‹è¯•è¦†ç›–

### æ–°å¢æµ‹è¯•

- `tests/core/test_middleware.py` - ä¸­é—´ä»¶ç³»ç»Ÿæµ‹è¯•
- `tests/core/test_context.py` - ä¸Šä¸‹æ–‡ä¼ æ’­æµ‹è¯•
- `tests/core/test_events.py` - äº‹ä»¶ç³»ç»Ÿæµ‹è¯•
- `tests/capabilities/clients/http/test_middleware_integration.py` - HTTP ä¸­é—´ä»¶é›†æˆæµ‹è¯•

### æ›´æ–°æµ‹è¯•

- `tests/test_core/test_http_client.py` - æ›´æ–°ä»¥æµ‹è¯•æ–°ä¸­é—´ä»¶
- `tests/capabilities/databases/test_database_events.py` - æ•°æ®åº“äº‹ä»¶æµ‹è¯•

---

## è¿ç§»æŒ‡å—

ç”¨æˆ·è¿ç§»è¯·å‚è€ƒ: [v3.13-to-v3.14.md](./v3.13-to-v3.14.md)

---

## å˜æ›´æ—¥å¿—

### 2025-12-04

- åˆ›å»ºè¿ç§»çŠ¶æ€è¿½è¸ªæ–‡æ¡£
- å®Œæˆ HttpClient ä¸­é—´ä»¶é›†æˆ
- å®Œæˆ AsyncHttpClient ä¸­é—´ä»¶é›†æˆ
- å®Œæˆ Database äº‹ä»¶ç³»ç»Ÿé›†æˆ
- å®Œæˆ UnitOfWork é›†æˆ
- å®Œæˆ Messengers é›†æˆ
- æ ‡è®°æ—§æ¨¡å—åºŸå¼ƒ
- æ¸…ç†ä¸»å…¥å£å¯¼å…¥
