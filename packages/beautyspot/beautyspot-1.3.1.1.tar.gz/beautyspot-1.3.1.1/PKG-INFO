Metadata-Version: 2.4
Name: beautyspot
Version: 1.3.1.1
Summary: Make your functions beautiful with beauty spots.
Author: Neel Bauman
Author-email: Neel Bauman <neel.bauman@example.com>
License-Expression: MIT
Requires-Dist: msgpack>=1.1.2
Requires-Dist: pandas>=2.3.3 ; extra == 'all'
Requires-Dist: streamlit>=1.51.0 ; extra == 'all'
Requires-Dist: watchdog>=6.0.0 ; extra == 'all'
Requires-Dist: boto3>=1.34.0 ; extra == 'all'
Requires-Dist: graphviz>=0.20.1 ; extra == 'all'
Requires-Dist: pandas>=2.3.3 ; extra == 'dashboard'
Requires-Dist: streamlit>=1.51.0 ; extra == 'dashboard'
Requires-Dist: watchdog>=6.0.0 ; extra == 'dashboard'
Requires-Dist: graphviz>=0.20.1 ; extra == 'dashboard'
Requires-Dist: boto3>=1.34.0 ; extra == 's3'
Requires-Python: >=3.10
Provides-Extra: all
Provides-Extra: dashboard
Provides-Extra: s3
Description-Content-Type: text/markdown

# ğŸŒ‘ beautyspot

[https://pypi.org/project/beautyspot/](https://pypi.org/project/beautyspot/)
[https://opensource.org/licenses/MIT](https://opensource.org/licenses/MIT)

## Concept

**"You focus on the logic. We handle the rest."**

ç”ŸæˆAIã®ãƒãƒƒãƒå‡¦ç†ã‚„ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã€é‡ã„è¨ˆç®—å‡¦ç†ã‚’è¡Œã†éš›ã€æœ¬è³ªçš„ãªãƒ­ã‚¸ãƒƒã‚¯ä»¥å¤–ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ

  * APIåˆ¶é™ã‚’å®ˆã‚‹ãŸã‚ã® `time.sleep()` ã‚„ãƒˆãƒ¼ã‚¯ãƒ³è¨ˆç®—
  * é€”ä¸­åœæ­¢ã—ãŸéš›ã®ãƒªã‚«ãƒãƒªå‡¦ç†ï¼ˆ `try-except` ã¨ `continue` ï¼‰
  * çµæœã‚’ä¿å­˜ãƒ»ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«I/O
  * é‡è¤‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é˜²ããŸã‚ã®IDç®¡ç†

`beautyspot` ã¯ã€ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã«ã€Œé»’å­/ã»ãã‚ï¼ˆãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿ï¼‰ã€ã‚’ä¸€ã¤ä»˜ã‘ã‚‹ã ã‘ã§ã€
ã“ã‚Œã‚‰ã®é¢å€’ãªã‚¤ãƒ³ãƒ•ãƒ©åˆ¶å¾¡ã‚’ã™ã¹ã¦å¼•ãå—ã‘ã‚‹ã€Œé»’å­/ãã‚ã“ã€ã§ã™ã€‚

v1.0.0 ã§ã¯ã€**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã®å®‰å…¨æ€§ï¼ˆSecure by Defaultï¼‰** ã¨ **é«˜åº¦ãªæ‹¡å¼µæ€§ï¼ˆDependency Injectionï¼‰** ã‚’å¼·åŒ–ã—ã¾ã—ãŸã€‚

-----

## âš¡ Installation

```bash
pip install beautyspot
```

  * **Standard:** `msgpack` ãŒåŒæ¢±ã•ã‚Œã€é«˜é€Ÿã‹ã¤å®‰å…¨ã«å‹•ä½œã—ã¾ã™ã€‚
  * **Options:**
      * `pip install "beautyspot[s3]"`: S3ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ
      * `pip install "beautyspot[dashboard]"`: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ

-----

## ğŸš€ Quick Start

é–¢æ•°ã« `@project.task` ã‚’ä»˜ã‘ã‚‹ã ã‘ã§ã€ãã®é–¢æ•°ã¯ã€Œæ°¸ç¶šåŒ–ã€ã•ã‚Œã€äºŒåº¦ã¨åŒã˜è¨ˆç®—ã‚’è¡Œã‚ãªããªã‚Šã¾ã™ã€‚

```python
import time
import beautyspot as bs

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®šç¾©ï¼ˆDBã‚„ä¿å­˜å…ˆã‚’è‡ªå‹•ç®¡ç†ï¼‰
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ "./my_experiment.db" (SQLite) ãŒä½œæˆã•ã‚Œã¾ã™
project = bs.Project("my_experiment")

@project.task
def heavy_process(text):
    # å®Ÿè¡Œã«æ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†ã‚„ã€èª²é‡‘ã•ã‚Œã‚‹APIã‚³ãƒ¼ãƒ«
    time.sleep(2)
    return f"Processed: {text}"

# ãƒãƒƒãƒå‡¦ç†
inputs = ["A", "B", "C", "A"]

for i in inputs:
    # 1. åˆå›ã® "A", "B", "C" ã¯å®Ÿè¡Œã•ã‚Œã‚‹
    # 2. æœ€å¾Œã® "A" ã¯ã€DBã‹ã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå³åº§ã«è¿”ã‚‹ï¼ˆå®Ÿè¡Œæ™‚é–“0ç§’ï¼‰
    # 3. ã‚‚ã—é€”ä¸­ã§ã‚¨ãƒ©ãƒ¼ã§æ­¢ã¾ã£ã¦ã‚‚ã€å†å®Ÿè¡Œæ™‚ã¯å®Œäº†æ¸ˆã¿ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
    print(heavy_process(i))
```

-----

## ğŸ’¡ Key Features

### 1\. Handle Any Data Size (and Securely)

**"No more Pickle risks."**

v1.0.0 ã‹ã‚‰ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ã« **Msgpack** ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚
Pythonæ¨™æº–ã® `pickle` ã¨ç•°ãªã‚Šã€ä¿¡é ¼ã§ããªã„ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã‚‚ä»»æ„ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ˆRCEï¼‰ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

é–¢æ•°ã®æˆ»ã‚Šå€¤ãŒå·¨å¤§ã«ãªã‚‹å ´åˆï¼ˆç”»åƒã€éŸ³å£°ã€å¤§è¦æ¨¡ãªHTMLãªã©ï¼‰ã€`save_blob=True` ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
`beautyspot` ãŒè‡ªå‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’å¤–éƒ¨ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆLocal/S3ï¼‰ã¸é€ƒãŒã—ã€DBã«ã¯è»½é‡ãªå‚ç…§ã®ã¿ã‚’æ®‹ã—ã¾ã™ã€‚

```python
# Large Data -> Blobã«é€€é¿ (Msgpackã§ä¿å­˜)
@project.task(save_blob=True)
def download_image(url):
    return requests.get(url).content
```

### 2\. Custom Type Registration

Numpyé…åˆ—ã‚„è‡ªä½œã‚¯ãƒ©ã‚¹ãªã©ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å¯¾å¿œã—ã¦ã„ãªã„å‹ã‚‚ã€å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç™»éŒ²ã™ã‚‹ã“ã¨ã§å®‰å…¨ã«æ‰±ãˆã¾ã™ã€‚

```python
import numpy as np

# ã‚«ã‚¹ã‚¿ãƒ å‹ã®å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯ã‚’ç™»éŒ²
# code: 0-127 ã®ä¸€æ„ãªID
project.register_type(
    type_=np.ndarray,
    code=10,
    encoder=lambda x: x.tobytes(),
    decoder=lambda b: np.frombuffer(b)
)

@project.task(save_blob=True)
def create_array():
    return np.array([1, 2, 3])
```

### 3\. Flexible Backend with Dependency Injection

**"Start simple, scale later."**

é€šå¸¸ã¯ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§ SQLite ãŒä½¿ãˆã¾ã™ãŒã€å¤§è¦æ¨¡ãªä¸¦åˆ—å‡¦ç†ã‚„ãƒ†ã‚¹ãƒˆã®ãŸã‚ã«ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’è‡ªç”±ã«å·®ã—æ›¿ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ˆDependency Injectionï¼‰ã€‚

```python
from beautyspot.db import SQLiteTaskDB

# A. Standard Usage (Path string)
# å†…éƒ¨ã§ SQLiteTaskDB("./data.db") ãŒç”Ÿæˆã•ã‚Œã‚‹
project = bs.Project("app", db="./data.db")

# B. Advanced Usage (Injection)
# ç‹¬è‡ªã®è¨­å®šã‚’è¡Œã£ãŸDBã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚„ã€ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªDBã€
# ã‚ã‚‹ã„ã¯è‡ªä½œã® PostgresTaskDB ãªã©ã‚’æ³¨å…¥å¯èƒ½
db_instance = SQLiteTaskDB("./data.db")
project = bs.Project("app", db=db_instance)
```

> ğŸ“– **Guide:** PostgreSQL ã‚„ MySQL ã‚’ä½¿ç”¨ã™ã‚‹ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ€ãƒ—ã‚¿ã®ä½œæˆæ–¹æ³•ã¯ [docs/advanced/custom\_backend.md](https://www.google.com/search?q=docs/advanced/custom_backend.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### 4\. Declarative Rate Limiting

APIã®åˆ¶é™ï¼ˆä¾‹ï¼š1åˆ†é–“ã«1ä¸‡ãƒˆãƒ¼ã‚¯ãƒ³ï¼‰ã‚’å®ˆã‚‹ãŸã‚ã«ã€è¤‡é›‘ãªã‚¹ãƒªãƒ¼ãƒ—å‡¦ç†ã‚’æ›¸ãå¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
**GCRA (Generic Cell Rate Algorithm)** ãƒ™ãƒ¼ã‚¹ã®é«˜æ€§èƒ½ãªãƒªãƒŸãƒƒã‚¿ãƒ¼ãŒã€ãƒãƒ¼ã‚¹ãƒˆï¼ˆé›†ä¸­ã‚¢ã‚¯ã‚»ã‚¹ï¼‰ã‚’é˜²ããªãŒã‚‰ã‚¹ãƒ ãƒ¼ã‚ºã«å®Ÿè¡Œã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚

```python
# 1åˆ†é–“ã« 50,000 ãƒˆãƒ¼ã‚¯ãƒ³ã¾ã§ã«åˆ¶é™
project = bs.Project("openai_batch", tpm=50000)

def calc_cost(text):
    return len(text)

@project.task
@project.limiter(cost=calc_cost)  # ãƒªãƒˆãƒ©ã‚¤æ™‚ã‚‚å«ã‚ã¦è‡ªå‹•åˆ¶å¾¡
def call_api(text):
    return api.generate(text)
```

> âš ï¸ **Warning on Multi-processing:**
> `beautyspot` ã®ãƒ¬ãƒ¼ãƒˆãƒªãƒŸãƒƒã‚¿ãƒ¼ã¯ã€ãƒ—ãƒ­ã‚»ã‚¹é–“ã§çŠ¶æ…‹ã‚’å…±æœ‰ã—ã¾ã›ã‚“ã€‚
> `multiprocessing` ã‚„è¤‡æ•°ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§åŒæ™‚ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã€ãã‚Œãã‚Œã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç‹¬ç«‹ã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¶ˆè²»ã™ã‚‹ãŸã‚ã€åˆè¨ˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒ API åˆ¶é™ã‚’è¶…ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
> ä¸¦åˆ—å®Ÿè¡Œã‚’è¡Œã†å ´åˆã¯ã€ãƒ—ãƒ­ã‚»ã‚¹æ•°ã«å¿œã˜ã¦ `tpm` è¨­å®šå€¤ã‚’å‰²ã‚‹ï¼ˆä¾‹: åˆ¶é™ãŒ1000TPMã§4ãƒ—ãƒ­ã‚»ã‚¹ãªã‚‰ã€å„250TPMã«è¨­å®šã™ã‚‹ï¼‰ãªã©ã®èª¿æ•´ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

-----

## âš ï¸ Migration Guide (v0.x -\> v1.0.0)

v1.0.0 ã§ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãŒ `pickle` ã‹ã‚‰ `msgpack` ã«å¤‰æ›´ã•ã‚ŒãŸãŸã‚ã€**v0.x ã§ä½œæˆã•ã‚ŒãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆç‰¹ã« `save_blob=True` ã®ãƒ‡ãƒ¼ã‚¿ï¼‰ã¨ã¯äº’æ›æ€§ãŒã‚ã‚Šã¾ã›ã‚“ã€‚**

ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆæ™‚ã¯ã€å¤ã„ `.db` ãƒ•ã‚¡ã‚¤ãƒ«ãŠã‚ˆã³ `blobs/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã—ã€ã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹ã§é–‹å§‹ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

-----

## ğŸ“Š Dashboard (Result Viewer)

**"Minimal viewer, not a full tracer."**

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯ã€ã‚ãã¾ã§\*\*ã€Œå®Ÿè¡ŒçŠ¶æ³ï¼ˆæˆ»ã‚Šå€¤ï¼‰ã®ç¢ºèªã€**ã¨**ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥DBãŒç ´ç¶»ã—ã¦ã„ãªã„ã‹ã®ç¢ºèªã€\*\*ã«ç‰¹åŒ–ã—ã¦ã„ã¾ã™ã€‚
Blobã¨ã—ã¦é€€é¿ã•ã‚ŒãŸå·¨å¤§ãªæˆ»ã‚Šå€¤ã‚‚ã€ã“ã“ã‹ã‚‰è‡ªå‹•çš„ã«å¾©å…ƒã—ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯èƒ½ã§ã™ï¼ˆMermaid, Graphviz, Image, JSONç­‰ï¼‰ã€‚

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®DBãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦èµ·å‹•
$ beautyspot ui ./my_experiment.db
```

> **Note:**
> ä»˜å±ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® **SQLite ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å°‚ç”¨** ã§ã™ã€‚
> ã‚«ã‚¹ã‚¿ãƒ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆPostgreSQLç­‰ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹å ´åˆã€ã“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ãã®å ´åˆã¯ Metabase ã‚„ SQL ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç­‰ã®åˆ©ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

-----

## ğŸ¤ License

MIT License

