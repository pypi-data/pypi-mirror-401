Metadata-Version: 2.4
Name: rulelift
Version: 1.2.3
Summary: A tool for analyzing rule effectiveness in credit risk management
Home-page: https://github.com/aialgorithm/rulelift
Author: aialgorithm
Author-email: aialgorithm@example.com
Classifier: Programming Language :: Python :: 3
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Intended Audience :: Financial and Insurance Industry
Classifier: Topic :: Scientific/Engineering :: Information Analysis
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.6
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: pandas<2.4.0,>=1.0.0
Requires-Dist: numpy<2.5.0,>=1.18.0
Requires-Dist: scikit-learn<1.9.0,>=0.24.0
Requires-Dist: matplotlib<3.11.0,>=3.3.0
Requires-Dist: seaborn<0.14.0,>=0.11.0
Requires-Dist: networkx<3.7.0,>=2.5.0
Requires-Dist: graphviz<1.0.0,>=0.16
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# rulelift - ä¿¡ç”¨é£é™©è§„åˆ™æœ‰æ•ˆæ€§åˆ†æå·¥å…·

## é¡¹ç›®æ¦‚è¿°

rulelift æ˜¯ä¸€ä¸ªç”¨äºä¿¡ç”¨é£é™©ç®¡ç†ä¸­ç­–ç•¥è§„åˆ™è‡ªåŠ¨æŒ–æ˜ã€æœ‰æ•ˆæ€§åˆ†æåŠç›‘æ§çš„ Python å·¥å…·åŒ…ã€‚
- å®æ—¶è¯„ä¼°ç›‘æ§ä¸Šçº¿è§„åˆ™çš„æ•ˆåº¦ï¼›
- è‡ªåŠ¨åŒ–æŒ–æ˜é«˜ä»·å€¼çš„è§„åˆ™ï¼›

## æ ¸å¿ƒä»·å€¼

åœ¨é£æ§é¢†åŸŸï¼Œè§„åˆ™ç³»ç»Ÿå› å…¶é…ç½®ä¾¿åˆ©å’Œå¼ºè§£é‡Šæ€§è€Œå¹¿æ³›åº”ç”¨ï¼Œä½†é¢ä¸´è§„åˆ™æ•ˆæœç›‘æ§éš¾ã€ä¼˜åŒ–éš¾çš„æŒ‘æˆ˜ã€‚rulelift æä¾›äº†å…¨é¢çš„è§£å†³æ–¹æ¡ˆï¼š

- **è§„åˆ™å®æ—¶è¯„ä¼°**ï¼šè§£å†³è§„åˆ™æ‹¦æˆªæ ·æœ¬æ— æ ‡ç­¾çš„é—®é¢˜ï¼Œå€ŸåŠ©å®¢æˆ·è¯„çº§åˆ†å¸ƒå·®å¼‚ï¼Œå®æ—¶è¯„ä¼°é€¾æœŸç‡ã€å¬å›ç‡ã€ç²¾ç¡®ç‡ã€lift å€¼ã€ç›¸å…³æ€§ã€è§„åˆ™é—´çš„å¢ç›Šã€ç¨³å®šæ€§ç­‰æ ¸å¿ƒæŒ‡æ ‡
- **è§„åˆ™è‡ªåŠ¨æŒ–æ˜**ï¼šè‡ªåŠ¨ä»æ•°æ®ä¸­æŒ–æ˜æœ‰æ•ˆçš„é£æ§è§„åˆ™ï¼Œæ”¯æŒå•ç‰¹å¾ã€å¤šç‰¹å¾äº¤å‰ã€å†³ç­–æ ‘ã€éšæœºæ£®æ—ã€XGBç­‰è§„åˆ™æŒ–æ˜
- **å¯è§†åŒ–å±•ç¤º**ï¼šç›´è§‚å‘ˆç°å˜é‡åˆ†å¸ƒã€å˜é‡æ•ˆåº¦ã€è§„åˆ™æ•ˆæœã€ç‰¹å¾é‡è¦æ€§ã€å†³ç­–æ ‘ç»“æ„å’Œè§„åˆ™å…³ç³»
- **æˆæœ¬æ•ˆç›Šé«˜**ï¼šæ— éœ€åˆ†æµæµ‹è¯•ï¼ŒåŸºäºè§„åˆ™å‘½ä¸­ç”¨æˆ·è®°å½•å³å¯è¯„ä¼°è§„åˆ™æ•ˆæœï¼Œé™ä½æµ‹è¯•æˆæœ¬

å®ƒå¸®åŠ©é£æ§å›¢é˜Ÿè¯„ä¼°ä¼˜åŒ–è§„åˆ™çš„å®é™…æ•ˆæœï¼Œè¯†åˆ«å†—ä½™è§„åˆ™ï¼Œè‡ªåŠ¨æŒ–æ˜æœ‰æ•ˆè§„åˆ™ï¼Œä¼˜åŒ–ç­–ç•¥ç»„åˆï¼Œæé«˜é£é™©æ§åˆ¶èƒ½åŠ›ï¼Œé™ä½é£æ§æˆæœ¬ã€‚

## å®Œæ•´çš„å®‰è£…ä½¿ç”¨æ–¹æ³•

### ä½¿ç”¨ pip å®‰è£…ï¼ˆæ¨èï¼‰

```bash
pip install rulelift
```

### ä»æºç å®‰è£…

```bash
git clone https://github.com/aialgorithm/rulelift.git
cd rulelift
pip install -e .
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬å¯¼å…¥

```python
from rulelift import (
    load_example_data, preprocess_data,
    SingleFeatureRuleMiner, MultiFeatureRuleMiner, TreeRuleExtractor,
    VariableAnalyzer, analyze_rules, calculate_strategy_gain
)
```

### 2. åŠ è½½ç¤ºä¾‹æ•°æ®

```python
# åŠ è½½ç¤ºä¾‹æ•°æ®
df = load_example_data('feas_target.csv')


```

## æ ¸å¿ƒåŠŸèƒ½

### 1. æ ‘è§„åˆ™æå–ï¼ˆTreeRuleExtractorï¼‰

TreeRuleExtractor æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„æ ‘æ¨¡å‹è§„åˆ™æå–ç±»ï¼Œæ”¯æŒå¤šç§ç®—æ³•ï¼ˆDTã€RFã€CHI2ã€XGBã€ISFï¼‰ã€‚æ”¯æŒä¸šåŠ¡è§£é‡Šæ€§é…ç½®ã€æ”¯æŒæ ‘å¤æ‚åº¦åŠè§„åˆ™ç²¾åº¦é…ç½®ã€æ”¯æŒè¯„ä¼°è§„åˆ™å…¨é¢æ–¹é¢æŒ‡æ ‡badrateã€æŸå¤±ç‡æŒ‡æ ‡ç­‰ç­‰ï¼›

#### 1.1 æ”¯æŒçš„ç®—æ³•

| ç®—æ³• | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `dt` | å†³ç­–æ ‘ï¼ˆDecision Treeï¼‰ | å¿«é€Ÿç”Ÿæˆè§„åˆ™ï¼Œé€‚åˆåˆæ­¥æ¢ç´¢ |
| `rf` | éšæœºæ£®æ—ï¼ˆRandom Forestï¼‰ | è§„åˆ™ç¨³å®šæ€§å¥½ï¼Œå¤šæ ·æ€§é«˜ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ |
| `chi2` | å¡æ–¹å†³ç­–æ ‘ï¼ˆChi-square Decision Treeï¼‰ | é€‚åˆåˆ†ç±»ç‰¹å¾è¾ƒå¤šçš„åœºæ™¯ |
| `xgb` | XGBoostï¼ˆæ¢¯åº¦æå‡æ ‘ï¼‰ | è§„åˆ™ç²¾åº¦é«˜ï¼Œé€‚åˆå¤æ‚åœºæ™¯ |
| `isf` | å­¤ç«‹æ£®æ—ï¼ˆIsolation Forestï¼‰ | é€‚åˆæŒ–æ˜å¼‚å¸¸æ ·æœ¬çš„è§„åˆ™ |

#### 1.2 åŸºæœ¬ä½¿ç”¨

```python
from rulelift import TreeRuleExtractor

# åˆå§‹åŒ–æ ‘è§„åˆ™æå–å™¨
tree_miner = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME'],
    algorithm='rf',  # ä½¿ç”¨éšæœºæ£®æ—ç®—æ³•
    max_depth=5,     # æ ‘å¤æ‚åº¦é…ç½®ï¼šå†³ç­–æ ‘æœ€å¤§æ·±åº¦
    n_estimators=10,  # æ ‘å¤æ‚åº¦é…ç½®ï¼šéšæœºæ£®æ—ä¸­æ ‘çš„æ•°é‡
    min_samples_split=10,  # è§„åˆ™ç²¾åº¦é…ç½®ï¼šåˆ†è£‚èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ ·æœ¬æ•°
    min_samples_leaf=5,  # è§„åˆ™ç²¾åº¦é…ç½®ï¼šå¶å­èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°
    test_size=0.3,  # æµ‹è¯•é›†æ¯”ä¾‹
    random_state=42,  # éšæœºç§å­
    feature_trends={  # ä¸šåŠ¡è§£é‡Šæ€§é…ç½®ï¼šç‰¹å¾ä¸ç›®æ ‡æ ‡ç­¾çš„æ­£è´Ÿç›¸å…³æ€§
        'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    }
)

# è®­ç»ƒæ¨¡å‹
train_acc, test_acc = tree_miner.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")

# æå–è§„åˆ™
rules = tree_miner.extract_rules()
print(f"æå–çš„è§„åˆ™æ•°é‡: {len(rules)}")

# è·å–è§„åˆ™DataFrame
rules_df = tree_miner.get_rules_as_dataframe(deduplicate=True, sort_by_lift=True)
print(rules_df.head())
```

#### 1.3 ç‰¹å¾è¶‹åŠ¿åˆ¤æ–­ï¼ˆfeature_trendsï¼‰

è§„åˆ™æŒ–æ˜ä¸­åŠ å…¥ä¸šåŠ¡é€»è¾‘åˆ¤æ–­ï¼Œ`feature_trends` å‚æ•°ç”¨äºé…ç½®ç‰¹å¾ä¸ç›®æ ‡æ ‡ç­¾çš„æ­£è´Ÿç›¸å…³æ€§ï¼Œé¿å…ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§çš„è§„åˆ™ã€‚

**å‚æ•°è¯´æ˜**ï¼š
- `feature_trends`: Dict[str, int]ï¼Œé”®ä¸ºç‰¹å¾åï¼Œå€¼ä¸º 1ï¼ˆæ­£ç›¸å…³ï¼‰æˆ– -1ï¼ˆè´Ÿç›¸å…³ï¼‰ï¼Œä»…æŒ–æ˜ç¬¦åˆç‰¹å¾ä¸šåŠ¡é€»è¾‘çš„è§„åˆ™
  - **æ­£ç›¸å…³ï¼ˆå€¼ä¸º1ï¼‰**ï¼šè¡¨ç¤ºç‰¹å¾æ•°å€¼è¶Šå¤§ï¼Œç›®æ ‡æ ‡ç­¾ï¼ˆè¿çº¦æ¦‚ç‡ï¼‰è¶Šé«˜ï¼Œå¦‚ä¿¡ç”¨è¯„åˆ†ï¼›
  - **è´Ÿç›¸å…³ï¼ˆå€¼ä¸º-1ï¼‰**ï¼šç‰¹å¾æ•°å€¼è¶Šå°ï¼Œç›®æ ‡æ ‡ç­¾ï¼ˆè¿çº¦æ¦‚ç‡ï¼‰è¶Šé«˜ï¼Œå¦‚å¤šå¤´æŒ‡æ ‡ï¼›


**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# ä½¿ç”¨ç‰¹å¾è¶‹åŠ¿è¿‡æ»¤
tree_miner = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME'],
    algorithm='rf',
    feature_trends={
        'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    }
)

# æå–è§„åˆ™ï¼ˆä¼šè‡ªåŠ¨è¿‡æ»¤ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§çš„è§„åˆ™ï¼‰
rules = tree_miner.extract_rules()
```

**æ•ˆæœç¤ºä¾‹**ï¼š

ä¸ä½¿ç”¨ `feature_trends`ï¼š
```
Rule 1: BAIDU_FQZSCORE > 327.0000  # è¯¥æ‹¦æˆªè§„åˆ™ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§
Rule 2: NUMBER OF LOAN APPLICATIONS TO PBOC <= 5.0000  # è¯¥æ‹¦æˆªè§„åˆ™ï¼Œå¯èƒ½ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§
```

ä½¿ç”¨ `feature_trends`ï¼š
```
Rule 1: BAIDU_FQZSCORE <= 535.0000  # è´Ÿç›¸å…³ 
Rule 2: NUMBER OF LOAN APPLICATIONS TO PBOC > 2.0000  # æ­£ç›¸å…³ 
```

#### 1.4 å¸¸ç”¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `algorithm` | str | `'dt'` | ç®—æ³•ç±»å‹ï¼š'dt'ã€'rf'ã€'chi2'ã€'xgb'ã€'isf' |
| `max_depth` | int | `5` | å†³ç­–æ ‘æœ€å¤§æ·±åº¦ï¼Œæ§åˆ¶æ ‘çš„å¤æ‚åº¦ |
| `min_samples_split` | int | `10` | åˆ†è£‚èŠ‚ç‚¹æ‰€éœ€çš„æœ€å°æ ·æœ¬æ•°ï¼Œæ§åˆ¶è§„åˆ™ç²¾åº¦ |
| `min_samples_leaf` | int | `5` | å¶å­èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°ï¼Œæ§åˆ¶è§„åˆ™ç²¾åº¦ |
| `n_estimators` | int | `10` | éšæœºæ£®æ—/XGBoost/å­¤ç«‹æ£®æ—ä¸­æ ‘çš„æ•°é‡ |
| `max_features` | str | `'sqrt'` | æ¯æ£µæ ‘åˆ†è£‚æ—¶è€ƒè™‘çš„æœ€å¤§ç‰¹å¾æ•°ï¼š'sqrt'æˆ–'log2' |
| `test_size` | float | `0.3` | æµ‹è¯•é›†æ¯”ä¾‹ |
| `random_state` | int | `42` | éšæœºç§å­ï¼Œä¿è¯ç»“æœå¯å¤ç° |
| `feature_trends` | Dict[str, int] | `None` | ç‰¹å¾ä¸ç›®æ ‡æ ‡ç­¾çš„æ­£è´Ÿç›¸å…³æ€§å­—å…¸ï¼Œç”¨äºé¿å…ä¸ç¬¦åˆä¸šåŠ¡è§£é‡Šæ€§çš„è§„åˆ™ |
| `amount_col` | str | `None` | é‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ |
| `ovd_bal_col` | str | `None` | é€¾æœŸé‡‘é¢å­—æ®µåï¼Œç”¨äºè®¡ç®—æŸå¤±ç‡æŒ‡æ ‡ |

#### 1.5 ä¸åŒç®—æ³•ä½¿ç”¨ç¤ºä¾‹

TreeRuleExtractor æ”¯æŒå¤šç§æ ‘æ¨¡å‹ç®—æ³•ï¼ˆå†³ç­–æ ‘ã€å¡æ–¹å†³ç­–æ ‘ã€éšæœºæ£®æ—ã€xgbã€å­¤ç«‹æ£®æ—ï¼‰ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨ç®—æ³•çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

##### 1.5.1 å†³ç­–æ ‘ï¼ˆDTï¼‰

```python
# åˆå§‹åŒ–å†³ç­–æ ‘è§„åˆ™æå–å™¨
tree_miner_dt = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME'],
    algorithm='dt',
    max_depth=3, 
    min_samples_split=20,
    min_samples_leaf=10,
    random_state=42
)
```

##### 1.5.2 éšæœºæ£®æ—ï¼ˆRFï¼‰

```python
# åˆå§‹åŒ–éšæœºæ£®æ—è§„åˆ™æå–å™¨
tree_miner_rf = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME'],
    algorithm='rf',
    max_depth=3, 
    min_samples_split=20,
    min_samples_leaf=10,
    n_estimators=5,
    max_features='sqrt',
    random_state=42
)
```

##### 1.5.3 å¡æ–¹å†³ç­–æ ‘ï¼ˆCHI2ï¼‰

```python
# åˆå§‹åŒ–å¡æ–¹å†³ç­–æ ‘è§„åˆ™æå–å™¨
tree_miner_chi2 = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME'],
    algorithm='chi2',
    max_depth=3, 
    min_samples_split=20,
    min_samples_leaf=10,
    random_state=42
)
```

##### 1.5.4 XGBoostï¼ˆXGBï¼‰

```python
# åˆå§‹åŒ–XGBoostè§„åˆ™æå–å™¨ï¼Œä½¿ç”¨ç‰¹å¾ä¸šåŠ¡è§£é‡Šæ€§åˆ¤æ–­
tree_miner_xgb = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME'],
    algorithm='xgb',
    max_depth=3,
    min_samples_split=10,
    min_samples_leaf=10,
    n_estimators=10,
    feature_trends={
        'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    },
    random_state=42
)
```

##### 1.5.5 å­¤ç«‹æ£®æ—ï¼ˆISFï¼‰

```python
# åˆå§‹åŒ–å­¤ç«‹æ£®æ—è§„åˆ™æå–å™¨ï¼Œä½¿ç”¨ç‰¹å¾è¶‹åŠ¿åˆ¤æ–­
tree_miner_isf = TreeRuleExtractor(
    df, 
    target_col='ISBAD', 
    exclude_cols=['ID', 'CREATE_TIME'],
    algorithm='isf',
    n_estimators=10,
    random_state=42,
    feature_trends={
        'ALI_FQZSCORE': -1,      # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'BAIDU_FQZSCORE': -1,    # è´Ÿç›¸å…³ï¼šåˆ†æ•°è¶Šä½ï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
        'NUMBER OF LOAN APPLICATIONS TO PBOC': 1  # æ­£ç›¸å…³ï¼šç”³è¯·æ¬¡æ•°è¶Šå¤šï¼Œè¿çº¦æ¦‚ç‡è¶Šé«˜
    }
)
```

#### 1.6 è¾“å‡ºç¤ºä¾‹

```python
# æ‰“å°Top 5è§„åˆ™
for i, rule in enumerate(rules[:5]):
    print(f"\n=== Rule {i+1} ===")
    print(f"è§„åˆ™æè¿°: {rule['rule']}")
    print(f"é¢„æµ‹ç±»åˆ«: {rule['class_name']} (æ¦‚ç‡: {rule['class_probability']:.4f})")
    print(f"æ ·æœ¬æ•°é‡: {rule['sample_count']}")
    print(f"é‡è¦æ€§: {rule['importance']:.2f}")
```

#### 1.7 æŒ–æ˜æ•ˆæœè¯„ä¼°

TreeRuleExtractor æä¾›äº†å…¨é¢çš„è§„åˆ™è¯„ä¼°åŠŸèƒ½ï¼Œæ”¯æŒè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„æ•ˆåº¦è¯„ä¼°ã€‚

**è¯„ä¼°æŒ‡æ ‡**ï¼š
- **è®­ç»ƒé›†æŒ‡æ ‡**ï¼šè®­ç»ƒé›†ä¸Šçš„å‡†ç¡®ç‡ã€å¬å›ç‡ã€ç²¾ç¡®ç‡ã€F1åˆ†æ•°ã€liftå€¼
- **æµ‹è¯•é›†æŒ‡æ ‡**ï¼šæµ‹è¯•é›†ä¸Šçš„å‡†ç¡®ç‡ã€å¬å›ç‡ã€ç²¾ç¡®ç‡ã€F1åˆ†æ•°ã€liftå€¼
- **æŸå¤±ç‡æŒ‡æ ‡**ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœæä¾›äº† `amount_col` å’Œ `ovd_bal_col`ï¼Œè¿˜ä¼šè®¡ç®—æŸå¤±ç‡å’ŒæŸå¤±liftå€¼

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# è®­ç»ƒæ¨¡å‹
train_acc, test_acc = tree_miner.train()
print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_acc:.4f}")
print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_acc:.4f}")

# æå–è§„åˆ™
rules = tree_miner.extract_rules()

# è¯„ä¼°è§„åˆ™ï¼ˆåŒ…å«æŸå¤±ç‡æŒ‡æ ‡ï¼‰
eval_results = tree_miner.evaluate_rules()
print(f"è¯„ä¼°çš„è§„åˆ™æ•°é‡: {len(eval_results)}")
print("è§„åˆ™è¯„ä¼°ç»“æœï¼ˆå‰5æ¡ï¼‰:")
print(eval_results[['rule', 'train_loss_rate', 'train_loss_lift', 'test_loss_rate', 'test_loss_lift', 'train_lift', 'test_lift']].head())
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
è¯„ä¼°çš„è§„åˆ™æ•°é‡: 31
è§„åˆ™è¯„ä¼°ç»“æœï¼ˆå‰5æ¡ï¼‰:
         rule  train_loss_rate  train_loss_lift  test_loss_rate  test_loss_lift  train_lift  test_lift
0  rule_1         0.3456789       2.3456789      0.234567       1.987654  2.123456      1.987654
1  rule_2         0.234567       1.987654      0.123456       1.876543  1.654321      1.876543
2  rule_3         0.123456       1.765432      0.098765       1.765432  1.543210      1.543210
3  rule_4         0.098765       1.654321      0.076543       1.543210  1.432109      1.432109
4  rule_5         0.076543       1.543210      0.065432       1.432109  1.321098      1.321098
```

---

### 2. å•ç‰¹å¾è§„åˆ™æŒ–æ˜ï¼ˆSingleFeatureRuleMinerï¼‰

ç”¨äºå¯¹æ•°æ®å„ç‰¹å¾çš„ä¸åŒé˜ˆå€¼è¿›è¡Œæ•ˆåº¦åˆ†å¸ƒåˆ†æã€‚

#### 2.1 åŸºæœ¬ä½¿ç”¨

```python
from rulelift import SingleFeatureRuleMiner

# åˆå§‹åŒ–å•ç‰¹å¾è§„åˆ™æŒ–æ˜å™¨
sf_miner = SingleFeatureRuleMiner(
    df, 
    exclude_cols=['ID', 'CREATE_TIME'],
    target_col='ISBAD'
)

# åˆ†æå•ä¸ªç‰¹å¾
feature = 'ALI_FQZSCORE'
metrics_df = sf_miner.calculate_single_feature_metrics(feature, num_bins=20)
print(f"\n=== {feature} åˆ†ç®±åˆ†æ ===")
print(metrics_df.head())

# è·å–Topè§„åˆ™
top_rules = sf_miner.get_top_rules(feature=feature, top_n=5, metric='lift', min_samples=10)
print(f"\n=== Top 5è§„åˆ™ ===")
print(top_rules[['rule_description', 'lift', 'badrate', 'selected_samples']])
```

#### 2.2 å¯è§†åŒ–

```python
# ç»˜åˆ¶ç‰¹å¾æŒ‡æ ‡åˆ†å¸ƒå›¾
plt = sf_miner.plot_feature_metrics(feature, metric='lift')
plt.savefig(f'{feature}_lift_distribution.png', dpi=300, bbox_inches='tight')
plt.close()
```

#### 2.3 å¸¸ç”¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `exclude_cols` | List[str] | `None` | æ’é™¤çš„å­—æ®µååˆ—è¡¨ |
| `target_col` | str | `'ISBAD'` | ç›®æ ‡å­—æ®µå |
| `num_bins` | int | `20` | åˆ†ç®±æ•°é‡ |
| `min_samples` | int | `10` | æœ€å°æ ·æœ¬æ•°è¿‡æ»¤ |
| `min_lift` | float | `1.1` | æœ€å°liftå€¼è¿‡æ»¤ |

#### 2.4 è¾“å‡ºç¤ºä¾‹

```
=== Top 5è§„åˆ™ ===
                           rule_description      lift  badrate  selected_samples
0  ALI_FQZSCORE <= 665.0000  2.174292  0.666667              51
1  ALI_FQZSCORE <= 688.5000  2.087320  0.640000              75
2  ALI_FQZSCORE <= 705.0000  1.993101  0.611111             108
3  ALI_FQZSCORE <= 725.0000  1.928934  0.580000             150
4  ALI_FQZSCORE <= 745.0000  1.867925  0.555556             180
```

---

### 3. å¤šç‰¹å¾äº¤å‰è§„åˆ™æŒ–æ˜ï¼ˆMultiFeatureRuleMinerï¼‰

ç”¨äºç”ŸæˆåŒç‰¹å¾äº¤å‰åˆ†æç»“æœï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼ã€è‡ªåŠ¨åˆ†ç®±ã€å¡æ–¹åˆ†ç®±ç­‰å¤šç§åˆ†ç®±ç­–ç•¥ã€‚

#### 3.1 åŸºæœ¬ä½¿ç”¨

```python
from rulelift import MultiFeatureRuleMiner

# åˆå§‹åŒ–å¤šç‰¹å¾è§„åˆ™æŒ–æ˜å™¨
multi_miner = MultiFeatureRuleMiner(df, target_col='ISBAD')


feature1 = 'ALI_FQZSCORE'
feature2 = 'BAIDU_FQZSCORE'


# ç»˜åˆ¶äº¤å‰çƒ­åŠ›å›¾
plt = multi_miner.plot_cross_heatmap(feature1, feature2, metric='lift')
plt.savefig('cross_feature_heatmap.png', dpi=300, bbox_inches='tight')
plt.close()
```

#### 3.2 ç”Ÿæˆäº¤å‰çŸ©é˜µExcelæ–‡ä»¶

```python
# ç”Ÿæˆäº¤å‰çŸ©é˜µExcelæ–‡ä»¶ï¼ˆæ–¹ä¾¿ç­–ç•¥äººå‘˜æ ¹æ®äº¤å‰çŸ©é˜µåˆ¶è®¢è§„åˆ™ï¼‰
cross_matrices = multi_miner.generate_cross_matrices_excel(
    features_list=['ALI_FQZSCORE', 'BAIDU_FQZSCORE'], 
    output_path='cross_analysis.xlsx'
)
print(f"äº¤å‰çŸ©é˜µExcelæ–‡ä»¶å·²ä¿å­˜åˆ°: cross_analysis.xlsx")

# æŸ¥çœ‹ç”Ÿæˆçš„Excelæ–‡ä»¶
# æ–‡ä»¶åŒ…å«å¤šä¸ªsheetï¼Œæ¯ä¸ªsheetå¯¹åº”ä¸€ä¸ªç‰¹å¾ç»„åˆ
# æ¯ä¸ªsheetåŒ…å«ï¼šbadrateã€countã€sample_ratioã€liftç­‰æŒ‡æ ‡
```

#### 3.2.1 å¤šç‰¹å¾ä¸¤ä¸¤äº¤å‰åˆ†æ

æ”¯æŒä¼ å…¥å¤šä¸ªç‰¹å¾ï¼Œè‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰ä¸¤ä¸¤ç‰¹å¾ç»„åˆçš„äº¤å‰çŸ©é˜µï¼Œæ–¹ä¾¿ç­–ç•¥äººå‘˜å…¨é¢åˆ†æç‰¹å¾é—´çš„äº¤äº’å…³ç³»ã€‚

```python
# å¤šç‰¹å¾ä¸¤ä¸¤äº¤å‰åˆ†æç¤ºä¾‹
features_list = ['ALI_FQZSCORE', 'BAIDU_FQZSCORE', 'NUMBER OF LOAN APPLICATIONS TO PBOC']
cross_matrices_multi = multi_miner.generate_cross_matrices_excel(
    features_list=features_list,
    output_path='cross_analysis_multi_features.xlsx',
    metrics=['badrate', 'count', 'sample_ratio', 'lift'],  # æ”¯æŒå¤šç§æŒ‡æ ‡åˆ†æ
    binning_method='quantile'  # æ”¯æŒç­‰é¢‘åˆ†ç®±
)
print(f"å¤šç‰¹å¾äº¤å‰çŸ©é˜µExcelæ–‡ä»¶å·²ä¿å­˜åˆ°: cross_analysis_multi_features.xlsx")
```

#### 3.3 å¸¸ç”¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `target_col` | str | `'ISBAD'` | ç›®æ ‡å­—æ®µå |
| `top_n` | int | `10` | è¿”å›çš„è§„åˆ™æ•°é‡ |
| `metric` | str | `'lift'` | æ’åºæŒ‡æ ‡ï¼š'lift'ã€'badrate'ç­‰ |
| `min_samples` | int | `10` | æœ€å°æ ·æœ¬æ•°è¿‡æ»¤ |
| `min_lift` | float | `1.1` | æœ€å°liftå€¼è¿‡æ»¤ |
| `max_unique_threshold` | int | `5` | æœ€å¤§å…è®¸çš„å”¯ä¸€å€¼æ•°é‡é˜ˆå€¼ |
| `custom_bins1` | List[float] | `None` | ç¬¬ä¸€ä¸ªç‰¹å¾çš„è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼ |
| `custom_bins2` | List[float] | `None` | ç¬¬äºŒä¸ªç‰¹å¾çš„è‡ªå®šä¹‰åˆ†ç®±é˜ˆå€¼ |
| `binning_method` | str | `'quantile'` | åˆ†ç®±æ–¹æ³•ï¼š'quantile'ï¼ˆç­‰é¢‘ï¼‰æˆ–'chi2'ï¼ˆå¡æ–¹ï¼‰ |
| `metrics` | List[str] | `['badrate', 'count', 'sample_ratio', 'lift']` | æ”¯æŒçš„æŒ‡æ ‡åˆ—è¡¨ï¼š'badrate'ã€'count'ã€'sample_ratio'ã€'lift'ã€'loss_rate'ã€'loss_lift' |


#### 3.4 æ”¯æŒçš„æŒ‡æ ‡è¯´æ˜

å¤šç‰¹å¾äº¤å‰åˆ†ææ”¯æŒå¤šç§æŒ‡æ ‡ï¼Œå¸®åŠ©ç­–ç•¥äººå‘˜å…¨é¢è¯„ä¼°ç‰¹å¾ç»„åˆçš„é£é™©æ°´å¹³å’Œä¸šåŠ¡ä»·å€¼ï¼š

| æŒ‡æ ‡ | å®šä¹‰ | ä¸šåŠ¡æ„ä¹‰ |
|------|------|----------|
| `badrate` | åæ ·æœ¬æ¯”ä¾‹ = åæ ·æœ¬æ•° / æ€»æ ·æœ¬æ•° | ç›´æ¥åæ˜ è¯¥ç‰¹å¾ç»„åˆä¸‹çš„é£é™©æ°´å¹³ |
| `count` | æ ·æœ¬æ•°é‡ | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„è¦†ç›–èŒƒå›´ |
| `sample_ratio` | æ ·æœ¬å æ¯” = è¯¥ç»„åˆæ ·æœ¬æ•° / æ€»æ ·æœ¬æ•° | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„ä¸šåŠ¡é‡è¦æ€§ |
| `lift` | æå‡åº¦ = è¯¥ç»„åˆbadrate / æ€»æ ·æœ¬badrate | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„é£é™©åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§æ•ˆæœè¶Šå¥½ |
| `loss_rate` | æŸå¤±ç‡ = æŸå¤±é‡‘é¢ / æ€»é‡‘é¢ | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„å®é™…æŸå¤±ç¨‹åº¦ï¼ˆéœ€è¦æä¾›amount_colå’Œovd_bal_colï¼‰ |
| `loss_lift` | æŸå¤±æå‡åº¦ = è¯¥ç»„åˆloss_rate / æ€»æ ·æœ¬loss_rate | åæ˜ è¯¥ç‰¹å¾ç»„åˆçš„æŸå¤±åŒºåˆ†èƒ½åŠ›ï¼ˆéœ€è¦æä¾›amount_colå’Œovd_bal_colï¼‰ |

#### 3.5 äº¤å‰çŸ©é˜µExcelæ–‡ä»¶ç¤ºä¾‹

ç”Ÿæˆçš„Excelæ–‡ä»¶åŒ…å«å¤šä¸ªsheetï¼Œæ¯ä¸ªsheetå¯¹åº”ä¸€ä¸ªç‰¹å¾ç»„åˆï¼Œä¾‹å¦‚ï¼š
- `ALI_FQZSCORE_x_BAIDU_FQZSCORE`ï¼šä¸¤ä¸ªç‰¹å¾çš„äº¤å‰çŸ©é˜µ
- `ALI_FQZSCORE_x_NUMBER OF LOAN APPLICATIONS TO PBOC`ï¼šå¦ä¸€ä¸ªç‰¹å¾ç»„åˆ
- æ¯ä¸ªsheetåŒ…å«ä»¥ä¸‹æŒ‡æ ‡ï¼šbadrateã€countã€sample_ratioã€liftç­‰
- ç­–ç•¥äººå‘˜å¯ä»¥æ ¹æ®äº¤å‰çŸ©é˜µä¸­çš„é«˜liftåŒºåŸŸåˆ¶è®¢è§„åˆ™

**Excelæ–‡ä»¶å†…å®¹ç¤ºä¾‹**ï¼š

| ALI_FQZSCORE | BAIDU_FQZSCORE | badrate | count | sample_ratio | lift |
|--------------|----------------|---------|-------|--------------|------|
| (500, 600]   | (300, 400]     | 0.6667  | 15    | 0.03         | 2.5  |
| (500, 600]   | (400, 500]     | 0.4000  | 25    | 0.05         | 1.5  |
| (600, 700]   | (300, 400]     | 0.5000  | 20    | 0.04         | 1.9  |
| (600, 700]   | (400, 500]     | 0.2000  | 30    | 0.06         | 0.8  |
| (700, 800]   | (300, 400]     | 0.3000  | 18    | 0.036        | 1.15 |
| (700, 800]   | (400, 500]     | 0.1500  | 40    | 0.08         | 0.58 |

**åŒ…å«æŸå¤±ç‡æŒ‡æ ‡çš„Excelç¤ºä¾‹**ï¼ˆéœ€è¦åœ¨åˆå§‹åŒ–æ—¶æä¾›amount_colå’Œovd_bal_colï¼‰ï¼š

| ALI_FQZSCORE | BAIDU_FQZSCORE | badrate | count | loss_rate | loss_lift |
|--------------|----------------|---------|-------|-----------|-----------|
| (500, 600]   | (300, 400]     | 0.6667  | 15    | 0.4567    | 2.89      |
| (500, 600]   | (400, 500]     | 0.4000  | 25    | 0.3210    | 2.01      |
| (600, 700]   | (300, 400]     | 0.5000  | 20    | 0.2890    | 1.81      |
| (600, 700]   | (400, 500]     | 0.2000  | 30    | 0.1567    | 0.98      |

---

### 4. å˜é‡åˆ†æï¼ˆVariableAnalyzerï¼‰

æ”¯æŒå¯¹ç‰¹å¾å˜é‡è¿›è¡Œå…¨é¢çš„æ•ˆåº¦åˆ†æå’Œåˆ†ç®±åˆ†æï¼Œå¸®åŠ©é£æ§å›¢é˜Ÿè¯†åˆ«é‡è¦å˜é‡ï¼Œä¼˜åŒ–ç‰¹å¾å·¥ç¨‹ã€‚

#### 4.1 åŸºæœ¬ä½¿ç”¨

```python
from rulelift import VariableAnalyzer

# åˆå§‹åŒ–å˜é‡åˆ†æå™¨
var_analyzer = VariableAnalyzer(
    df, 
    exclude_cols=['ID', 'CREATE_TIME'], 
    target_col='ISBAD'
)

# åˆ†ææ‰€æœ‰å˜é‡çš„æ•ˆåº¦æŒ‡æ ‡
var_metrics = var_analyzer.analyze_all_variables()
print("\n=== æ‰€æœ‰å˜é‡æ•ˆåº¦æŒ‡æ ‡ ===")
print(var_metrics)

# åˆ†æå•ä¸ªå˜é‡çš„åˆ†ç®±æƒ…å†µ
feature = 'ALI_FQZSCORE'
bin_analysis = var_analyzer.analyze_single_variable(feature, n_bins=10)
print(f"\n=== {feature} åˆ†ç®±åˆ†æ ===")
print(bin_analysis)

# å¯è§†åŒ–å˜é‡åˆ†ç®±ç»“æœ
plt = var_analyzer.plot_variable_bins(feature, n_bins=10)
plt.savefig(f'{feature}_bin_analysis.png', dpi=300, bbox_inches='tight')
plt.close()
```

#### 4.2 å¸¸ç”¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `exclude_cols` | List[str] | `None` | æ’é™¤çš„å­—æ®µååˆ—è¡¨ |
| `target_col` | str | `'ISBAD'` | ç›®æ ‡å­—æ®µå |
| `n_bins` | int | `10` | åˆ†ç®±æ•°é‡ |

#### 4.3 è¾“å‡ºç¤ºä¾‹

```
=== æ‰€æœ‰å˜é‡æ•ˆåº¦æŒ‡æ ‡ ===
        variable        iv        ks        auc  missing_rate  single_value_rate  min_value  max_value  median_value  mean_diff  corr_with_target  psi
0  ALI_FQZSCORE  0.456789  0.452345  0.723456      0.012345      0.0456789      0.987654      0.723456      0.012345      0.456789      0.012345
1  BAIDU_FQZSCORE  0.3456789  0.3456789  0.678901      0.023456      0.056789      0.976543      0.678901      0.023456      0.3456789      0.023456
```

#### 4.4 å˜é‡æ•ˆåº¦æŒ‡æ ‡è¯´æ˜

| æŒ‡æ ‡ | å®šä¹‰ | æœ€ä½³èŒƒå›´ | æ„ä¹‰ |
|------|------|----------|------|
| `iv` | ä¿¡æ¯å€¼(Information Value) | > 0.1 | å˜é‡çš„é¢„æµ‹èƒ½åŠ›ï¼Œå€¼è¶Šå¤§é¢„æµ‹èƒ½åŠ›è¶Šå¼º |
| `ks` | KSç»Ÿè®¡é‡ | > 0.2 | å˜é‡å¯¹å¥½åå®¢æˆ·çš„åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§åŒºåˆ†èƒ½åŠ›è¶Šå¼º |
| `auc` | æ›²çº¿ä¸‹é¢ç§¯ | > 0.6 | å˜é‡çš„æ•´ä½“é¢„æµ‹èƒ½åŠ›ï¼Œå€¼è¶Šå¤§é¢„æµ‹èƒ½åŠ›è¶Šå¼º |
| `missing_rate` | ç¼ºå¤±ç‡ | < 0.1 | å˜é‡çš„ç¼ºå¤±å€¼æ¯”ä¾‹ï¼Œå€¼è¶Šå°æ•°æ®è´¨é‡è¶Šå¥½ |
| `single_value_rate` | å•å€¼ç‡ | < 0.05 | å˜é‡çš„å”¯ä¸€å€¼æ¯”ä¾‹ï¼Œå€¼è¶Šå°åŒºåˆ†èƒ½åŠ›è¶Šå¼º |
| `min_value` | æœ€å°å€¼ | - | å˜é‡çš„æœ€å°å€¼ |
| `max_value` | æœ€å¤§å€¼ | - | å˜é‡çš„æœ€å¤§å€¼ |
| `median_value` | ä¸­ä½æ•° | - | å˜é‡çš„ä¸­ä½æ•°ï¼Œåæ˜ ä¸­å¿ƒè¶‹åŠ¿ |
| `mean_diff` | å‡å€¼å·®å¼‚ | > 0.1 | å¥½åå®¢æˆ·å‡å€¼å·®å¼‚ï¼Œå€¼è¶Šå¤§åŒºåˆ†èƒ½åŠ›è¶Šå¼º |
| `corr_with_target` | ä¸ç›®æ ‡å˜é‡ç›¸å…³ç³»æ•° | - | å˜é‡ä¸ç›®æ ‡å˜é‡çš„ç›¸å…³æ€§ï¼Œå€¼è¶Šå¤§è¶Šé‡è¦ |
| `psi` | ç¾¤ä½“ç¨³å®šæ€§æŒ‡æ ‡(PSI) | < 0.1 | å˜é‡çš„ç¨³å®šæ€§æŒ‡æ ‡ï¼Œå€¼è¶Šå°è¶Šç¨³å®š |

---

### 5. è§„åˆ™æ•ˆåº¦åˆ†æç›‘æ§æ¨¡å—ï¼ˆanalyze_rulesï¼‰

ç”¨äºå®æ—¶è¯„ä¼°ä¸Šçº¿è§„åˆ™çš„æ•ˆåº¦ã€‚è§£å†³è§„åˆ™æ‹¦æˆªæ ·æœ¬æ— æ ‡ç­¾çš„é—®é¢˜ï¼Œå€ŸåŠ©å®¢æˆ·è¯„çº§åˆ†å¸ƒå·®å¼‚ï¼Œæ¨ç®—é€¾æœŸç‡ã€å¬å›ç‡ã€ç²¾ç¡®ç‡ã€lift å€¼ç­‰æ ¸å¿ƒæŒ‡æ ‡ã€‚

#### 5.1 åŸºæœ¬ä½¿ç”¨

analyze_rules å‡½æ•°æ”¯æŒä¸¤ç§è§„åˆ™è¯„ä¼°æ–¹å¼ï¼šé€šè¿‡ç”¨æˆ·è¯„çº§è¯„ä¼°å’Œé€šè¿‡ç›®æ ‡æ ‡ç­¾è¯„ä¼°ã€‚

##### 5.1.1 é€šè¿‡ç”¨æˆ·è¯„çº§è¯„ä¼°è§„åˆ™

å½“ç”¨æˆ·æ²¡æœ‰å®é™…é€¾æœŸæ ‡ç­¾æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç”¨æˆ·è¯„çº§å¯¹åº”çš„åè´¦ç‡æ¥è¯„ä¼°è§„åˆ™æ•ˆæœã€‚

```python
from rulelift import analyze_rules

# é€šè¿‡ç”¨æˆ·è¯„çº§è¯„ä¼°è§„åˆ™æ•ˆåº¦
result_by_rating = analyze_rules(
    df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_level_badrate_col='USER_LEVEL_BADRATE',  # ç”¨æˆ·è¯„çº§åè´¦ç‡å­—æ®µ
    hit_date_col='HIT_DATE'  # å‘½ä¸­æ—¥æœŸï¼Œç”¨äºè®¡ç®—ç¨³å®šæ€§æŒ‡æ ‡
)

print("\n=== é€šè¿‡ç”¨æˆ·è¯„çº§è¯„ä¼°çš„è§„åˆ™æ•ˆåº¦åˆ†æç»“æœ ===")
print(result_by_rating[['RULE', 'actual_lift', 'actual_badrate', 'hit_rate', 'hit_rate_cv']].head())
```

##### 5.1.2 é€šè¿‡ç›®æ ‡æ ‡ç­¾è¯„ä¼°è§„åˆ™

å½“ç”¨æˆ·æœ‰å®é™…é€¾æœŸæ ‡ç­¾æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ç›®æ ‡æ ‡ç­¾æ¥è¯„ä¼°è§„åˆ™æ•ˆæœã€‚

```python
# é€šè¿‡ç›®æ ‡æ ‡ç­¾è¯„ä¼°è§„åˆ™æ•ˆåº¦
result_by_target = analyze_rules(
    df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_target_col='USER_TARGET',  # ç”¨æˆ·å®é™…é€¾æœŸæ ‡ç­¾å­—æ®µ
    hit_date_col='HIT_DATE'  # å‘½ä¸­æ—¥æœŸï¼Œç”¨äºè®¡ç®—ç¨³å®šæ€§æŒ‡æ ‡
)

print("\n=== é€šè¿‡ç›®æ ‡æ ‡ç­¾è¯„ä¼°çš„è§„åˆ™æ•ˆåº¦åˆ†æç»“æœ ===")
print(result_by_target[['RULE', 'actual_lift', 'actual_badrate', 'actual_recall', 'f1']].head())
```

##### 5.1.3 åŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹å¼è¯„ä¼°

ä¹Ÿå¯ä»¥åŒæ—¶æä¾›ç”¨æˆ·è¯„çº§å’Œç›®æ ‡æ ‡ç­¾ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„è¯„ä¼°æ–¹å¼ã€‚

```python
# åŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹å¼è¯„ä¼°è§„åˆ™æ•ˆåº¦
result_combined = analyze_rules(
    df, 
    rule_col='RULE',
    user_id_col='USER_ID',
    user_level_badrate_col='USER_LEVEL_BADRATE',
    user_target_col='USER_TARGET',
    hit_date_col='HIT_DATE'
)

print("\n=== ç»¼åˆè¯„ä¼°çš„è§„åˆ™æ•ˆåº¦åˆ†æç»“æœ ===")
print(result_combined[['RULE', 'actual_lift', 'actual_badrate', 'actual_recall', 'f1', 'hit_rate', 'hit_rate_cv']].head())
```

#### 5.2 å¸¸ç”¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `rule_col` | str | `'RULE'` | è§„åˆ™å­—æ®µå |
| `user_id_col` | str | `'USER_ID'` | ç”¨æˆ·ç¼–å·å­—æ®µå |
| `user_level_badrate_col` | str | `None` | ç”¨æˆ·è¯„çº§åè´¦ç‡å­—æ®µåï¼ˆå¯é€‰ï¼‰ |
| `user_target_col` | str | `None` | ç”¨æˆ·å®é™…é€¾æœŸå­—æ®µåï¼ˆå¯é€‰ï¼‰ |
| `hit_date_col` | str | `None` | å‘½ä¸­æ—¥æœŸå­—æ®µåï¼ˆå¯é€‰ï¼Œç”¨äºå‘½ä¸­ç‡ç›‘æ§ï¼‰ |
| `metrics` | list | `None` | æŒ‡å®šè¦è®¡ç®—çš„æŒ‡æ ‡åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰ |
| `include_stability` | bool | `True` | æ˜¯å¦åŒ…å«ç¨³å®šæ€§æŒ‡æ ‡ |

#### 5.3 è¾“å‡ºç¤ºä¾‹

```
=== è§„åˆ™æ•ˆåº¦åˆ†æç»“æœ ===
         RULE  actual_lift  actual_badrate  actual_recall        f1
0  rule1     2.3456789      0.3456789      0.456789  0.3456789
1  rule2     2.123456      0.234567       0.3456789  0.234567
2  rule3     1.987654      0.123456       0.234567  0.123456
```

---

### 6. ç­–ç•¥ç›¸å…³æ€§ã€å¢ç›Šè®¡ç®—ï¼ˆcalculate_strategy_gainï¼‰

è¯„ä¼°ç­–ç•¥ç»„åˆæ•ˆæœï¼Œè®¡ç®—ä¸¤ä¸¤è§„åˆ™é—´çš„å¢ç›Šã€‚

#### 6.1 åŸºæœ¬ä½¿ç”¨

```python

#è§„åˆ™ç›¸å…³æ€§åˆ†æ
print("\n3. è§„åˆ™ç›¸å…³æ€§åˆ†æ:")
correlation_matrix, max_correlation = analyze_rule_correlation(
    hit_rule_df, 
    rule_col='RULE', 
    user_id_col='USER_ID'
)
print(f"   è§„åˆ™ç›¸å…³æ€§çŸ©é˜µ:")
print(correlation_matrix)
print(f"   æ¯æ¡è§„åˆ™çš„æœ€å¤§ç›¸å…³æ€§:")
for rule, corr in max_correlation.items():
    print(f"   {rule}: {corr['max_correlation_value']:.4f}")

from rulelift import calculate_strategy_gain

# å®šä¹‰ä¸¤ä¸ªç­–ç•¥ç»„
strategy1 = ['rule1', 'rule2']
strategy2 = ['rule1', 'rule2', 'rule3']

# è®¡ç®—ç­–ç•¥å¢ç›Šï¼ˆstrategy1 åˆ° strategy2 çš„é¢å¤–ä»·å€¼ï¼‰
gain = calculate_strategy_gain(
    df, 
    strategy1, 
    strategy2, 
    user_target_col='USER_TARGET'
)
print(f"\nç­–ç•¥å¢ç›Š: {gain:.4f}")
```

#### 6.2 å¸¸ç”¨å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|----------|------|
| `strategy1` | list | - | åŸºç¡€ç­–ç•¥è§„åˆ™åˆ—è¡¨ |
| `strategy2` | list | - | å¢å¼ºç­–ç•¥è§„åˆ™åˆ—è¡¨ |
| `user_target_col` | str | `None` | ç”¨æˆ·å®é™…é€¾æœŸå­—æ®µåï¼ˆå¯é€‰ï¼‰ |
| `user_level_badrate_col` | str | `None` | ç”¨æˆ·è¯„çº§åè´¦ç‡å­—æ®µåï¼ˆå¯é€‰ï¼‰ |

---

## æ ¸å¿ƒæŒ‡æ ‡è¯´æ˜

### è§„åˆ™è¯„ä¼°æŒ‡æ ‡

| æŒ‡æ ‡ | å®šä¹‰ | æœ€ä½³èŒƒå›´ | æ„ä¹‰ |
|------|------|----------|------|
| `actual_lift` | è§„åˆ™å‘½ä¸­æ ·æœ¬é€¾æœŸç‡ / æ€»æ ·æœ¬é€¾æœŸç‡ | > 1.0 | è§„åˆ™çš„é£é™©åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§æ•ˆæœè¶Šå¥½ |
| `f1` | 2*(ç²¾ç¡®ç‡*å¬å›ç‡)/(ç²¾ç¡®ç‡+å¬å›ç‡) | 0-1 | ç»¼åˆè¯„ä¼°è§„åˆ™çš„ç²¾ç¡®ç‡å’Œå¬å›ç‡ |
| `actual_badrate` | è§„åˆ™å‘½ä¸­æ ·æœ¬ä¸­çš„é€¾æœŸæ¯”ä¾‹ | ä¾ä¸šåŠ¡åœºæ™¯è€Œå®š | è§„åˆ™ç›´æ¥æ‹¦æˆªçš„åå®¢æˆ·æ¯”ä¾‹ |
| `actual_recall` | è§„åˆ™å‘½ä¸­çš„åå®¢æˆ· / æ€»åå®¢æˆ· | 0-1 | è§„åˆ™å¯¹åå®¢æˆ·çš„è¦†ç›–èƒ½åŠ› |
| `hit_rate_cv` | å‘½ä¸­ç‡å˜å¼‚ç³»æ•° = æ ‡å‡†å·®/å‡å€¼ | < 0.2 | è§„åˆ™å‘½ä¸­ç‡çš„ç¨³å®šæ€§ï¼Œå€¼è¶Šå°è¶Šç¨³å®š |
| `max_correlation_value` | ä¸å…¶ä»–è§„åˆ™çš„æœ€å¤§ç›¸å…³ç³»æ•° | < 0.5 | è§„åˆ™çš„ç‹¬ç«‹æ€§ï¼Œå€¼è¶Šå°ç‹¬ç«‹æ€§è¶Šå¥½ |

### å˜é‡åˆ†ææŒ‡æ ‡

| æŒ‡æ ‡ | å®šä¹‰ | æœ€ä½³èŒƒå›´ | æ„ä¹‰ |
|------|------|----------|------|
| `iv` | ä¿¡æ¯å€¼(Information Value) | > 0.1 | å˜é‡çš„é¢„æµ‹èƒ½åŠ›ï¼Œå€¼è¶Šå¤§é¢„æµ‹èƒ½åŠ›è¶Šå¼º |
| `ks` | KSç»Ÿè®¡é‡ | > 0.2 | å˜é‡å¯¹å¥½åå®¢æˆ·çš„åŒºåˆ†èƒ½åŠ›ï¼Œå€¼è¶Šå¤§åŒºåˆ†èƒ½åŠ›è¶Šå¼º |
| `auc` | æ›²çº¿ä¸‹é¢ç§¯ | > 0.6 | å˜é‡çš„æ•´ä½“é¢„æµ‹èƒ½åŠ›ï¼Œå€¼è¶Šå¤§é¢„æµ‹èƒ½åŠ›è¶Šå¼º |
| `badrate` | åˆ†ç®±ä¸­çš„åå®¢æˆ·æ¯”ä¾‹ | ä¾ä¸šåŠ¡åœºæ™¯è€Œå®š | åˆ†ç®±çš„é£é™©æ°´å¹³ |
| `cum_badrate` | ç´¯ç§¯åå®¢æˆ·æ¯”ä¾‹ | ä¾ä¸šåŠ¡åœºæ™¯è€Œå®š | ç´¯ç§¯åˆ†ç®±çš„é£é™©æ°´å¹³ |



---

## ç‰ˆæœ¬ä¿¡æ¯

å½“å‰ç‰ˆæœ¬ï¼š1.2.3

## æ›´æ–°æ—¥å¿—

### v1.2.3 (2025-01-10)
- **æ–°å¢ç‰¹å¾è¶‹åŠ¿åˆ¤æ–­åŠŸèƒ½**ï¼šTreeRuleExtractor æ”¯æŒ `feature_trends` å‚æ•°ï¼Œæå‡è§„åˆ™çš„ä¸šåŠ¡è§£é‡Šæ€§
- **ä¼˜åŒ–å­¤ç«‹æ£®æ—è§„åˆ™æå–**ï¼šåŸºäºæ ‘ç»“æ„æå–è§„åˆ™ï¼Œæ”¯æŒå¤šç‰¹å¾ç»„åˆ
- **ä¼˜åŒ–SingleFeatureRuleMiner**ï¼šè¿‡æ»¤æç«¯å€¼é˜ˆå€¼ï¼Œé¿å…æ— æ„ä¹‰è§„åˆ™
- **ä¼˜åŒ–MultiFeatureRuleMiner**ï¼šæ·»åŠ æœ€å°æ ·æœ¬æ•°å’Œliftå€¼è¿‡æ»¤ï¼Œæ·»åŠ äº¤å‰çŸ©é˜µExcelç”ŸæˆåŠŸèƒ½
- **ä¼˜åŒ–è§„åˆ™DataFrameè¾“å‡º**ï¼šæ”¯æŒæŒ‰liftå€’åºæ’åº
- **ä¿®å¤å·²çŸ¥é—®é¢˜**ï¼šè§£å†³æ‰€æœ‰å·²çŸ¥bugå’Œæ€§èƒ½é—®é¢˜

### v1.1.5 (2025-12-23)
- æ–°å¢å˜é‡åˆ†ææ¨¡å—ï¼Œæ”¯æŒIVã€KSã€AUCç­‰æŒ‡æ ‡è®¡ç®—
- å®ç°å•å˜é‡ç­‰é¢‘åˆ†ç®±åˆ†æåŠŸèƒ½
- æ–°å¢ç­–ç•¥è‡ªåŠ¨æŒ–æ˜åŠŸèƒ½
- ä¼˜åŒ–å†³ç­–æ ‘è§„åˆ™æ˜¾ç¤ºï¼ŒåŠ å…¥ lift å€¼å’Œæ‹¦æˆªç”¨æˆ·æ•°ç­‰æŒ‡æ ‡
- æ–°å¢ä¸¤ä¸¤ç­–ç•¥å¢ç›Šè®¡ç®—åŠŸèƒ½
- ä¼˜åŒ–ä»£ç è´¨é‡ï¼Œä¿®å¤æ‰€æœ‰å·²çŸ¥é—®é¢˜

### v1.0.0 (2025-12-17)
- æ–°å¢å‘½ä¸­ç‡å˜å¼‚ç³»æ•°ï¼ˆhit_rate_cvï¼‰ç”¨äºç›‘æ§è§„åˆ™ç¨³å®šæ€§
- æ–°å¢ F1 åˆ†æ•°è®¡ç®—ï¼Œç»¼åˆè¯„ä¼°è§„åˆ™æ•ˆæœ
- ä¼˜åŒ–è§„åˆ™ç›¸å…³æ€§åˆ†æï¼Œæ–°å¢æœ€å¤§ç›¸å…³æ€§æŒ‡æ ‡
- æ”¹è¿›å‘½ä¸­ç‡è®¡ç®—é€»è¾‘
- å®Œå–„æ–‡æ¡£ï¼Œæ–°å¢æŠ€æœ¯åŸç†å’Œç¼ºé™·åˆ†æ

---

## è®¸å¯è¯

MIT License

---

## é¡¹ç›®åœ°å€

- GitHub: https://github.com/aialgorithm/rulelift
- PyPI: https://pypi.org/project/rulelift/

---

## è”ç³»æ–¹å¼

å¾®ä¿¡&github: aialgorithm
é‚®ç®±: 15880982687@qq.com

---

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼å¦‚æœæ‚¨æœ‰ä»»ä½•å»ºè®®æˆ–é—®é¢˜ï¼Œè¯·é€šè¿‡ GitHub Issues åé¦ˆã€‚

---

**å¼€å§‹ä½¿ç”¨ rulelift ä¼˜åŒ–æ‚¨çš„é£æ§è§„åˆ™ç³»ç»Ÿå§ï¼** ğŸš€
