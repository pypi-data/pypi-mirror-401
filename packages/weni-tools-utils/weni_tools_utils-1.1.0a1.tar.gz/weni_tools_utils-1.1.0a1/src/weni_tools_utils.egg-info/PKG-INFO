Metadata-Version: 2.4
Name: weni-tools-utils
Version: 1.1.0a1
Summary: Shared utilities and tools library for AI agents on the Weni platform
Author-email: Weni AI <dev@weni.ai>
Maintainer-email: Weni AI <dev@weni.ai>
License: MIT
Project-URL: Homepage, https://github.com/weni-ai/tools-utils
Project-URL: Documentation, https://github.com/weni-ai/tools-utils#readme
Project-URL: Repository, https://github.com/weni-ai/tools-utils.git
Project-URL: Issues, https://github.com/weni-ai/tools-utils/issues
Project-URL: Changelog, https://github.com/weni-ai/tools-utils/blob/main/CHANGELOG.md
Keywords: weni,vtex,concierge,ecommerce,ai-agent,chatbot,whatsapp,product-search,intelligent-search
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: Internet :: WWW/HTTP
Classifier: Topic :: Communications :: Chat
Classifier: Typing :: Typed
Requires-Python: >=3.9
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: requests<3.0.0,>=2.28.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: pytest-mock>=3.10.0; extra == "dev"
Requires-Dist: responses>=0.23.0; extra == "dev"
Requires-Dist: black>=23.0.0; extra == "dev"
Requires-Dist: isort>=5.12.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Requires-Dist: types-requests>=2.28.0; extra == "dev"
Requires-Dist: ruff>=0.1.0; extra == "dev"
Provides-Extra: docs
Requires-Dist: sphinx>=6.0.0; extra == "docs"
Requires-Dist: sphinx-rtd-theme>=1.2.0; extra == "docs"
Requires-Dist: myst-parser>=1.0.0; extra == "docs"
Dynamic: license-file

# Weni Tools Utils

Biblioteca compartilhada de utilitÃ¡rios e ferramentas para agentes de IA na plataforma Weni.

## ðŸŽ¯ Problema que Resolve

Antes desta biblioteca, cada cliente tinha uma cÃ³pia completa do cÃ³digo do agente, resultando em:
- âŒ CÃ³digo duplicado (70%+ idÃªntico entre clientes)
- âŒ Bug fix = N deploys manuais
- âŒ ManutenÃ§Ã£o exponencial
- âŒ DifÃ­cil onboarding de novos clientes

## âœ… SoluÃ§Ã£o

Uma biblioteca centralizada com sistema de plugins:
- âœ… Core compartilhado (busca, simulaÃ§Ã£o, estoque)
- âœ… Plugins opcionais (regionalizaÃ§Ã£o, atacado, carousel)
- âœ… Bug fix = 1 deploy, todos atualizados
- âœ… Novo cliente = importar e configurar plugins

## ðŸ“¦ InstalaÃ§Ã£o

```bash
pip install weni-tools-utils
```

Ou adicione ao `requirements.txt`:
```
weni-tools-utils>=1.0.0
```

## ðŸš€ Uso BÃ¡sico

```python
from weni_vtex import ProductConcierge

concierge = ProductConcierge(
    base_url="https://loja.vtexcommercestable.com.br",
    store_url="https://loja.com.br"
)

result = concierge.search(product_name="furadeira")
```

## ðŸ”Œ Plugins DisponÃ­veis

### Regionalization
Para clientes com regionalizaÃ§Ã£o por CEP.

```python
from weni_vtex import ProductConcierge
from weni_vtex.plugins import Regionalization

concierge = ProductConcierge(
    base_url="...",
    store_url="...",
    plugins=[
        Regionalization(
            seller_rules={
                "mooca_sellers": ["loja1000", "loja1003"],
                "retirada_sellers": ["loja1000"],
                "entrega_sellers": ["loja1003"],
            }
        )
    ]
)

result = concierge.search(
    product_name="cimento",
    postal_code="01310-100"
)
```

### Wholesale
Para clientes com preÃ§os de atacado.

```python
from weni_vtex.plugins import Wholesale

concierge = ProductConcierge(
    plugins=[
        Wholesale(fixed_price_url="https://loja.com.br/fixedprices")
    ]
)
```

### Carousel
Para enviar produtos via WhatsApp carousel.

```python
from weni_vtex.plugins import Carousel

concierge = ProductConcierge(
    plugins=[
        Carousel(
            weni_token="seu-token",
            max_items=10,
            auto_send=True
        )
    ]
)

result = concierge.search(
    product_name="camiseta",
    contact_info={"urn": "whatsapp:5511999999999"}
)
```

### CAPI (Meta Conversions API)
Para enviar eventos de conversÃ£o para Meta.

```python
from weni_vtex.plugins import CAPI

concierge = ProductConcierge(
    plugins=[
        CAPI(event_type="lead", auto_send=True)
    ]
)
```

### WeniFlowTrigger
Para disparar fluxos Weni.

```python
from weni_vtex.plugins import WeniFlowTrigger

concierge = ProductConcierge(
    plugins=[
        WeniFlowTrigger(
            flow_uuid="uuid-do-fluxo",
            trigger_once=True
        )
    ]
)
```

## ðŸ“‹ Exemplo Completo: Obramax

```python
from weni import Tool
from weni.context import Context
from weni.responses import TextResponse
from weni_vtex import ProductConcierge
from weni_vtex.plugins import Regionalization, Wholesale, WeniFlowTrigger


class SearchProduct(Tool):
    def execute(self, context: Context) -> TextResponse:
        concierge = ProductConcierge(
            base_url=context.credentials.get("BASE_URL"),
            store_url=context.credentials.get("STORE_URL"),
            plugins=[
                Regionalization(
                    seller_rules={
                        "mooca_sellers": ["lojaobramax1000", "lojaobramax1003", "lojaobramax1500"],
                        "retirada_sellers": ["lojaobramax1000", "lojaobramax1003"],
                        "entrega_sellers": ["lojaobramax1000", "lojaobramax1500"],
                    },
                    priority_categories=[
                        "/Pisos e Revestimentos/Pisos CerÃ¢micos/",
                        "/Pisos e Revestimentos/Porcelanatos/",
                    ]
                ),
                Wholesale(fixed_price_url="https://www.obramax.com.br/fixedprices"),
                WeniFlowTrigger(trigger_once=True),
            ]
        )
        
        result = concierge.search(
            product_name=context.parameters.get("product_name"),
            postal_code=context.parameters.get("postal_code"),
            quantity=int(context.parameters.get("quantity", 1)),
            credentials={
                "API_TOKEN_WENI": context.credentials.get("API_TOKEN_WENI"),
                "EVENT_ID_CONCIERGE": context.credentials.get("EVENT_ID_CONCIERGE"),
            },
            contact_info={"urn": context.contact.get("urn")}
        )
        
        return TextResponse(data=result)
```

## ðŸ—ï¸ Arquitetura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ProductConcierge                              â”‚
â”‚                     (Orquestra todo o fluxo)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                    â”‚                    â”‚
            â–¼                    â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VTEXClient    â”‚  â”‚  StockManager   â”‚  â”‚    Plugins      â”‚
â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
â”‚ â€¢ search()      â”‚  â”‚ â€¢ check()       â”‚  â”‚ â€¢ before_search â”‚
â”‚ â€¢ simulate()    â”‚  â”‚ â€¢ filter()      â”‚  â”‚ â€¢ after_search  â”‚
â”‚ â€¢ get_region()  â”‚  â”‚ â€¢ limit_size()  â”‚  â”‚ â€¢ enrich()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ Fluxo de ExecuÃ§Ã£o

1. **before_search** - Plugins modificam contexto (ex: obtÃ©m region_id)
2. **intelligent_search** - Busca produtos na VTEX
3. **after_search** - Plugins filtram/modificam produtos
4. **check_availability** - Verifica estoque
5. **after_stock_check** - Plugins enriquecem (ex: preÃ§os atacado)
6. **filter_products** - Filtra apenas produtos com estoque
7. **enrich_products** - Plugins adicionam dados extras
8. **finalize_result** - Plugins fazem aÃ§Ãµes finais (ex: enviar eventos)

## ðŸ§ª Desenvolvimento

```bash
# Clone o repositÃ³rio
git clone https://github.com/weni-ai/tools-utils.git
cd tools-utils

# Crie um ambiente virtual
python -m venv venv
source venv/bin/activate  # Linux/Mac
# ou: venv\Scripts\activate  # Windows

# Instale dependÃªncias de desenvolvimento
pip install -e ".[dev]"

# Execute testes
pytest

# Formate cÃ³digo
black src/
isort src/

# Verifique tipos
mypy src/
```

## ðŸ“¦ Publicando no PyPI

### Primeira vez (configuraÃ§Ã£o)

1. Crie uma conta em [pypi.org](https://pypi.org/account/register/)
2. Gere um token de API em [Account Settings > API tokens](https://pypi.org/manage/account/token/)
3. Configure o token localmente:

```bash
# Crie o arquivo de configuraÃ§Ã£o
cat > ~/.pypirc << EOF
[pypi]
username = __token__
password = pypi-YOUR-TOKEN-HERE
EOF

chmod 600 ~/.pypirc
```

### Publicando uma nova versÃ£o

```bash
# 1. Atualize a versÃ£o no pyproject.toml
# version = "1.0.1"

# 2. Atualize o CHANGELOG.md

# 3. Instale ferramentas de build
pip install build twine

# 4. Limpe builds anteriores
rm -rf dist/ build/ *.egg-info

# 5. Construa o pacote
python -m build

# 6. Verifique o pacote (opcional mas recomendado)
twine check dist/*

# 7. Publique no PyPI (produÃ§Ã£o)
twine upload dist/*

# OU publique no TestPyPI primeiro (para testar)
twine upload --repository testpypi dist/*
```

### Testando a instalaÃ§Ã£o

```bash
# Do PyPI
pip install weni-tools-utils

# Do TestPyPI
pip install --index-url https://test.pypi.org/simple/ weni-tools-utils
```

### CI/CD com GitHub Actions

Crie `.github/workflows/publish.yml`:

```yaml
name: Publish to PyPI

on:
  release:
    types: [published]

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install build twine
      
      - name: Build package
        run: python -m build
      
      - name: Publish to PyPI
        env:
          TWINE_USERNAME: __token__
          TWINE_PASSWORD: ${{ secrets.PYPI_API_TOKEN }}
        run: twine upload dist/*
```

## ðŸ“Š ComparaÃ§Ã£o: Antes vs Depois

| MÃ©trica | Antes | Depois |
|---------|-------|--------|
| Linhas de cÃ³digo (Obramax) | 938 | ~50 |
| Linhas de cÃ³digo (Reserva) | 770 | ~130 |
| Arquivos duplicados | 2+ | 0 |
| Deploy para bug fix | N clientes | 1 (lib) |
| Tempo onboarding novo cliente | Horas | Minutos |

## ðŸ¤ Criando um Novo Plugin

```python
from weni_vtex.plugins import PluginBase

class MeuPlugin(PluginBase):
    name = "meu_plugin"
    
    def before_search(self, context, client):
        # Modifica contexto antes da busca
        return context
    
    def after_search(self, products, context, client):
        # Modifica produtos apÃ³s busca
        return products
    
    def after_stock_check(self, products_with_stock, context, client):
        # Enriquece produtos apÃ³s verificaÃ§Ã£o de estoque
        return products_with_stock
    
    def finalize_result(self, result, context):
        # Ãšltima modificaÃ§Ã£o antes de retornar
        return result
```

## ðŸ“ LicenÃ§a

MIT License - Weni AI
