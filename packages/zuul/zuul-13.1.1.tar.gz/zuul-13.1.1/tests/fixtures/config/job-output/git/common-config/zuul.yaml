- pipeline:
    name: check
    manager: independent
    post-review: true
    trigger:
      gerrit:
        - event: patchset-created
    success:
      gerrit:
        Verified: 1
    failure:
      gerrit:
        Verified: -1

- job:
    name: base
    parent: null
    nodeset:
      nodes:
        - name: test_node
          label: test_label

- job:
    parent: base
    name: job-output
    run: playbooks/job-output.yaml

- job:
    parent: job-output
    name: job-output-split-streams
    ansible-split-streams: true

- job:
    name: job-output-failure
    run: playbooks/job-output.yaml
    post-run: playbooks/job-output-failure-post.yaml

- job:
    name: job-output-failure-split-streams
    parent: job-output-failure
    ansible-split-streams: true

- job:
    name: job-output-missing-role
    run: playbooks/job-output-missing-role.yaml

- job:
    name: job-output-missing-role-include
    run: playbooks/job-output-missing-role-include.yaml

- job:
    name: pre-timeout
    pre-run: playbooks/timeout.yaml
    run: playbooks/job-output.yaml
    attempts: 1
    pre-timeout: 5
    files:
      - pretimeout

- job:
    name: run-timeout
    run: playbooks/timeout.yaml
    # Give the job enough time to reach the run phase but less than 60s
    # which is the time the run playbook waits to trigger a job timeout.
    # It needs to reach the run phase since timeouting in the pre-run phase
    # will lead to a job retry.
    timeout: 20
    files:
      - runtimeout

- job:
    name: post-timeout
    run: playbooks/job-output.yaml
    post-run: playbooks/timeout.yaml
    post-timeout: 5
    files:
      - posttimeout

- job:
    name: pre-syntax
    pre-run: playbooks/syntax.yaml
    run: playbooks/job-output.yaml
    attempts: 1
    files:
      - presyntax

- job:
    name: run-syntax
    run: playbooks/syntax.yaml
    files:
      - runsyntax

- job:
    name: post-syntax
    run: playbooks/job-output.yaml
    post-run: playbooks/syntax.yaml
    files:
      - postsyntax

- project:
    name: org/project
    check:
      jobs:
        - job-output

- project:
    name: org/project2
    check:
      jobs:
        - job-output-failure

- project:
    name: org/project3
    check:
      jobs:
        - job-output-missing-role
        - job-output-missing-role-include

- project:
    name: org/project4
    check:
      jobs:
        - job-output-split-streams

- project:
    name: org/project5
    check:
      jobs:
        - job-output-failure-split-streams

- project:
    name: org/project6
    check:
      jobs:
        - pre-timeout
        - run-timeout
        - post-timeout
        - pre-syntax
        - run-syntax
        - post-syntax
