import vedo 
from vedo import Mesh


def combine_and_export(mesh_collection, filename):
    objct = mesh_collection
    with open(filename, "w") as file:
        _write_vertices(objct, file)
        _write_cells(objct, file)
        _write_lines(objct, file)

def _write_vertices(mesh_collection, opened_file_object):
    outF = opened_file_object
    outF.write("# OBJ file format with ext .obj\n")
    outF.write("# File generated by vedo\n")
    count = 0
    for mesh in mesh_collection:
        for p in mesh.vertices:
            count=count+1
            outF.write("v {:.8g} {:.8g} {:.8g}\n".format(*p))

def _write_cells(mesh_collection, opened_file_object):
    outF = opened_file_object
    
    carryover = 0
    for mesh in mesh_collection:
        for i, f in enumerate(mesh.cells):
            fs = ""
            for fi in f:
                    fi = int(fi)+carryover    
                    fs += f" {fi+1}"    
            outF.write(f"f{fs}\n")
        carryover += max(mesh.cells[0])
        carryover += 1

def _write_lines(mesh_collection, opened_file_object):
    outF = opened_file_object

    for mesh in mesh_collection:
        for l in mesh.lines:
            ls = ""
            for li in l:
                ls += str(li + 1) + " "
            outF.write(f"l {ls}\n")  
        
    
if __name__ == "__main__":
    
    mesh1 = vedo.Cone()
    mesh2 = vedo.Cylinder(pos=(1,1,0), r=.1, height = 10)
    meshes = [mesh1, mesh2]
    combine_and_export(meshes, "OutputFileTest.obj")
    conefile = mesh1.write("ConeStandard.obj")
    cylfile = mesh2.write("CylinderStandard.obj")
