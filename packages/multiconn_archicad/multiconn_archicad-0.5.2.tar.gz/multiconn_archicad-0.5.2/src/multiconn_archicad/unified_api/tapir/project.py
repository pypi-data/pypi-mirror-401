# This file is automatically generated by the build system.
# Do not edit this file directly.

from __future__ import annotations
from typing import TYPE_CHECKING
from pydantic import TypeAdapter

from multiconn_archicad.models.tapir.commands import (
    GetGeoLocationResult,
    GetHotlinksResult,
    GetProjectInfoFieldsResult,
    GetProjectInfoResult,
    GetStoriesResult,
    IFCFileOperationParameters,
    IFCFileOperationResult,
    OpenProjectParameters,
    OpenProjectResult,
    SetProjectInfoFieldParameters,
    SetStoriesParameters,
    SetStoriesResult,
)
from multiconn_archicad.models.tapir.types import (
    FailedExecutionResult,
    FieldModel,
    FileType,
    Hotlink,
    Method,
    StorySettings,
    SuccessfulExecutionResult,
)

if TYPE_CHECKING:
    from multiconn_archicad.core.core_commands import CoreCommands


class ProjectCommands:
    def __init__(self, core: CoreCommands):
        self._core = core

    def get_geo_location(self) -> GetGeoLocationResult:
        """
        Gets the project location details.

        Returns:
            GetGeoLocationResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        response_dict = self._core.post_tapir_command("GetGeoLocation")
        validated_response = GetGeoLocationResult.model_validate(response_dict)
        return validated_response

    def get_hotlinks(self) -> list[Hotlink]:
        """
        Gets the file system locations (path) of the hotlink modules. The hotlinks can have tree
        hierarchy in the project.

        Returns:
            list[Hotlink]: A list of hotlink nodes.

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        response_dict = self._core.post_tapir_command("GetHotlinks")
        validated_response = GetHotlinksResult.model_validate(response_dict)
        return validated_response.hotlinks

    def get_project_info(self) -> GetProjectInfoResult:
        """
        Retrieves information about the currently loaded project.

        Returns:
            GetProjectInfoResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        response_dict = self._core.post_tapir_command("GetProjectInfo")
        validated_response = GetProjectInfoResult.model_validate(response_dict)
        return validated_response

    def get_project_info_fields(self) -> list[FieldModel]:
        """
        Retrieves the names and values of all project info fields.

        Returns:
            list[FieldModel]: A list of project info fields.

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        response_dict = self._core.post_tapir_command("GetProjectInfoFields")
        validated_response = GetProjectInfoFieldsResult.model_validate(response_dict)
        return validated_response.fields

    def get_stories(self) -> GetStoriesResult:
        """
        Retrieves information about the story sructure of the currently loaded project.

        Returns:
            GetStoriesResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        response_dict = self._core.post_tapir_command("GetStories")
        validated_response = GetStoriesResult.model_validate(response_dict)
        return validated_response

    def ifc_file_operation(
        self, method: Method, ifc_file_path: str, file_type: FileType | None = None
    ) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Executes an IFC file operation.

        Args:
            method (Method): The file operation method to use.
            ifc_file_path (str): The target IFC file to use.
            file_type (FileType | None): The type of the IFC file. The default is 'ifc'.

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "method": method,
            "ifcFilePath": ifc_file_path,
            "fileType": file_type,
        }
        validated_params = IFCFileOperationParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "IFCFileOperation", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(IFCFileOperationResult).validate_python(response_dict)
        return validated_response

    def open_project(self, project_file_path: str) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Opens the given project.

        Args:
            project_file_path (str): The target project file to open.

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "projectFilePath": project_file_path,
        }
        validated_params = OpenProjectParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "OpenProject", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(OpenProjectResult).validate_python(response_dict)
        return validated_response

    def set_project_info_field(self, project_info_id: str, project_info_value: str) -> None:
        """
        Sets the value of a project info field.

        Args:
            project_info_id (str): The id of the project info field.
            project_info_value (str): The new value of the project info field.

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "projectInfoId": project_info_id,
            "projectInfoValue": project_info_value,
        }
        validated_params = SetProjectInfoFieldParameters(**params_dict)
        self._core.post_tapir_command(
            "SetProjectInfoField", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        return None

    def set_stories(self, stories: list[StorySettings]) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Sets the story sructure of the currently loaded project.

        Args:
            stories (list[StorySettings]): A list of story settings, used as input for creating
                or modifying multiple stories.

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "stories": stories,
        }
        validated_params = SetStoriesParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "SetStories", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(SetStoriesResult).validate_python(response_dict)
        return validated_response
