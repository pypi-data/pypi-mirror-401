# This file is automatically generated by the build system.
# Do not edit this file directly.

from __future__ import annotations
from typing import TYPE_CHECKING
from pydantic import TypeAdapter

from multiconn_archicad.models.tapir.commands import (
    AddCommentToIssueParameters,
    AddCommentToIssueResult,
    AttachElementsToIssueParameters,
    AttachElementsToIssueResult,
    CreateIssueParameters,
    CreateIssueResult,
    DeleteIssueParameters,
    DeleteIssueResult,
    DetachElementsFromIssueParameters,
    DetachElementsFromIssueResult,
    ExportIssuesToBCFParameters,
    ExportIssuesToBCFResult,
    GetCommentsFromIssueParameters,
    GetCommentsFromIssueResult,
    GetElementsAttachedToIssueParameters,
    GetElementsAttachedToIssueResult,
    GetIssuesResult,
    ImportIssuesFromBCFParameters,
    ImportIssuesFromBCFResult,
)
from multiconn_archicad.models.tapir.types import (
    Comment,
    ElementIdArrayItem,
    FailedExecutionResult,
    Issue,
    IssueCommentStatus,
    IssueElementType,
    IssueId,
    IssueIdArrayItem,
    SuccessfulExecutionResult,
)

if TYPE_CHECKING:
    from multiconn_archicad.core.core_commands import CoreCommands


class IssueManagementCommands:
    def __init__(self, core: CoreCommands):
        self._core = core

    def add_comment_to_issue(
        self, issue_id: IssueId, text: str, author: None | str = None, status: IssueCommentStatus | None = None
    ) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Adds a new comment to the specified issue.

        Args:
            issue_id (IssueId)
            text (str): Comment text to add.
            author (None | str): The author of the new comment.
            status (IssueCommentStatus | None)

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "issueId": issue_id,
            "author": author,
            "status": status,
            "text": text,
        }
        validated_params = AddCommentToIssueParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "AddCommentToIssue", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(AddCommentToIssueResult).validate_python(response_dict)
        return validated_response

    def attach_elements_to_issue(
        self, issue_id: IssueId, elements: list[ElementIdArrayItem], type: IssueElementType
    ) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Attaches elements to the specified issue.

        Args:
            issue_id (IssueId)
            elements (list[ElementIdArrayItem]): A list of elements.
            type (IssueElementType)

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "issueId": issue_id,
            "elements": elements,
            "type": type,
        }
        validated_params = AttachElementsToIssueParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "AttachElementsToIssue", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(AttachElementsToIssueResult).validate_python(response_dict)
        return validated_response

    def create_issue(self, name: str, parent_issue_id: IssueId | None = None, tag_text: None | str = None) -> IssueId:
        """
        Creates a new issue.

        Args:
            name (str): The name of the issue.
            parent_issue_id (IssueId | None)
            tag_text (None | str): Tag text of the issue, optional.

        Returns:
            IssueId

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "name": name,
            "parentIssueId": parent_issue_id,
            "tagText": tag_text,
        }
        validated_params = CreateIssueParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "CreateIssue", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = CreateIssueResult.model_validate(response_dict)
        return validated_response.issueId

    def delete_issue(
        self, issue_id: IssueId, accept_all_elements: None | bool = None
    ) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Deletes the specified issue.

        Args:
            issue_id (IssueId)
            accept_all_elements (None | bool): Accept all creation/deletion/modification of the
                deleted issue. By default false.

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "issueId": issue_id,
            "acceptAllElements": accept_all_elements,
        }
        validated_params = DeleteIssueParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "DeleteIssue", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(DeleteIssueResult).validate_python(response_dict)
        return validated_response

    def detach_elements_from_issue(
        self, issue_id: IssueId, elements: list[ElementIdArrayItem]
    ) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Detaches elements from the specified issue.

        Args:
            issue_id (IssueId)
            elements (list[ElementIdArrayItem]): A list of elements.

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "issueId": issue_id,
            "elements": elements,
        }
        validated_params = DetachElementsFromIssueParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "DetachElementsFromIssue", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(DetachElementsFromIssueResult).validate_python(response_dict)
        return validated_response

    def export_issues_to_bcf(
        self,
        export_path: str,
        use_external_id: bool,
        align_by_survey_point: bool,
        issues: None | list[IssueIdArrayItem] = None,
    ) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Exports specified issues to a BCF file.

        Args:
            export_path (str): The os path to the bcf file, including it's name.
            use_external_id (bool): Use external IFC ID or Archicad IFC ID as referenced in BCF
                topics.
            align_by_survey_point (bool): Align BCF views by Archicad Survey Point or Archicad
                Project Origin.
            issues (None | list[IssueIdArrayItem]): Leave it empty to export all issues.

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "issues": issues,
            "exportPath": export_path,
            "useExternalId": use_external_id,
            "alignBySurveyPoint": align_by_survey_point,
        }
        validated_params = ExportIssuesToBCFParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "ExportIssuesToBCF", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(ExportIssuesToBCFResult).validate_python(response_dict)
        return validated_response

    def get_comments_from_issue(self, issue_id: IssueId) -> list[Comment]:
        """
        Retrieves comments information from the specified issue.

        Args:
            issue_id (IssueId)

        Returns:
            list[Comment]: A list of existing comments.

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "issueId": issue_id,
        }
        validated_params = GetCommentsFromIssueParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "GetCommentsFromIssue", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = GetCommentsFromIssueResult.model_validate(response_dict)
        return validated_response.comments

    def get_elements_attached_to_issue(self, issue_id: IssueId, type: IssueElementType) -> list[ElementIdArrayItem]:
        """
        Retrieves attached elements of the specified issue, filtered by attachment type.

        Args:
            issue_id (IssueId)
            type (IssueElementType)

        Returns:
            list[ElementIdArrayItem]: A list of elements.

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "issueId": issue_id,
            "type": type,
        }
        validated_params = GetElementsAttachedToIssueParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "GetElementsAttachedToIssue", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = GetElementsAttachedToIssueResult.model_validate(response_dict)
        return validated_response.elements

    def get_issues(self) -> list[Issue]:
        """
        Retrieves information about existing issues.

        Returns:
            list[Issue]: A list of existing issues.

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        response_dict = self._core.post_tapir_command("GetIssues")
        validated_response = GetIssuesResult.model_validate(response_dict)
        return validated_response.issues

    def import_issues_from_bcf(
        self, import_path: str, align_by_survey_point: bool
    ) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Imports issues from the specified BCF file.

        Args:
            import_path (str): The os path to the bcf file, including it's name.
            align_by_survey_point (bool): Align BCF views by Archicad Survey Point or Archicad
                Project Origin.

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "importPath": import_path,
            "alignBySurveyPoint": align_by_survey_point,
        }
        validated_params = ImportIssuesFromBCFParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "ImportIssuesFromBCF", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = TypeAdapter(ImportIssuesFromBCFResult).validate_python(response_dict)
        return validated_response
