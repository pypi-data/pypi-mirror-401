# This file is automatically generated by the build system.
# Do not edit this file directly.

from __future__ import annotations
from typing import TYPE_CHECKING
from pydantic import TypeAdapter

from multiconn_archicad.models.tapir.commands import (
    AddFilesToEmbeddedLibraryParameters,
    AddFilesToEmbeddedLibraryResult,
    GetLibrariesResult,
    ReloadLibrariesResult,
)
from multiconn_archicad.models.tapir.types import FailedExecutionResult, File, Library, SuccessfulExecutionResult

if TYPE_CHECKING:
    from multiconn_archicad.core.core_commands import CoreCommands


class LibraryCommands:
    def __init__(self, core: CoreCommands):
        self._core = core

    def add_files_to_embedded_library(
        self, files: list[File]
    ) -> list[FailedExecutionResult | SuccessfulExecutionResult]:
        """
        Adds the given files into the embedded library.

        Args:
            files (list[File]): A list of files

        Returns:
            list[FailedExecutionResult | SuccessfulExecutionResult]: A list of execution
                results.

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        params_dict = {
            "files": files,
        }
        validated_params = AddFilesToEmbeddedLibraryParameters(**params_dict)
        response_dict = self._core.post_tapir_command(
            "AddFilesToEmbeddedLibrary", validated_params.model_dump(mode="json", by_alias=True, exclude_none=True)
        )
        validated_response = AddFilesToEmbeddedLibraryResult.model_validate(response_dict)
        return validated_response.executionResults

    def get_libraries(self) -> list[Library]:
        """
        Gets the list of loaded libraries.

        Returns:
            list[Library]: A list of project libraries.

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        response_dict = self._core.post_tapir_command("GetLibraries")
        validated_response = GetLibrariesResult.model_validate(response_dict)
        return validated_response.libraries

    def reload_libraries(self) -> FailedExecutionResult | SuccessfulExecutionResult:
        """
        Executes the reload libraries command.

        Returns:
            FailedExecutionResult | SuccessfulExecutionResult

        Raises:
            ArchicadAPIError: If the API returns an error response.
            RequestError: If there is a network or connection error.
            pydantic.ValidationError: If the parameters, or the API Response fail validation.
        """
        response_dict = self._core.post_tapir_command("ReloadLibraries")
        validated_response = TypeAdapter(ReloadLibrariesResult).validate_python(response_dict)
        return validated_response
