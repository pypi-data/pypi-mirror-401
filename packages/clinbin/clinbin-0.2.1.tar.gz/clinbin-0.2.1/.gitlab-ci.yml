.run tests:
  stage: test
  image: python:3.13
  before_script:
    - pip3 install --upgrade pip
    - pip3 install coverage
    - pip3 install mypy
    - pip3 install .
  script:
    - cd src
    - mypy --install-types --non-interactive clinbin
    - coverage run --source clinbin -m unittest discover test
    - coverage report
    - coverage xml
  coverage: '/TOTAL.*\s([.\d]+)%/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: src/coverage.xml


run tests 3.13:
  stage: test
  extends: ".run tests"
  needs: []
  image: python:3.13

run tests 3.12:
  stage: test
  extends: ".run tests"
  needs: []
  image: python:3.12

pages:
  image: python:3.13
  stage: deploy
  script:
  - pip3 install pdoc3
  - pip3 install .
  - mkdir public
  - pdoc --config latex_math=True --html --output-dir public src/clinbin
  - mv public/clinbin/* public/ && rmdir public/clinbin/
  artifacts:
    paths:
    - public
  only:
  - main
