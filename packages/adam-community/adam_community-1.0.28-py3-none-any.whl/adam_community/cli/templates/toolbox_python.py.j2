from adam_community.tool import Tool
from adam_community.util import runCmd

class {{ name.replace("-", "_") }}_tool(Tool):
    """
    {{ description }}
    
    :param str input_text: è¾“å…¥çš„æ–‡æœ¬å†…å®¹
    :param str? mode: å¤„ç†æ¨¡å¼ï¼Œå¯é€‰å€¼ï¼šbasicã€advanced
    """
    
    DISPLAY_NAME = "{{ display_name }}å·¥å…·"
    NETWORK = False  # æ ¹æ®éœ€è¦è®¾ç½®æ˜¯å¦éœ€è¦ç½‘ç»œè®¿é—®
    CPU = 1  # éœ€è¦çš„CPUæ•°é‡
    GPU = 0  # éœ€è¦çš„GPUæ•°é‡
    SIF = "adam-base:1.0.0"  # æŒ‡å®šå®¹å™¨é•œåƒï¼ˆå¿…å¡«ï¼‰
    
    def call(self, kwargs):
        """
        å·¥å…·çš„ä¸»è¦å®ç°å‡½æ•°
        
        Args:
            kwargs: åŒ…å«argsã€messageã€filesã€userã€task_idç­‰å‚æ•°çš„å­—å…¸
        
        Returns:
            æ‰§è¡Œç»“æœå­—ç¬¦ä¸²ï¼ˆbashå‘½ä»¤ï¼‰æˆ–ç›´æ¥æ‰§è¡Œç»“æœ
        """
        # è·å–ç”¨æˆ·è¾“å…¥çš„å‚æ•°
        input_text = kwargs['args']['input_text']
        mode = kwargs['args'].get('mode', 'basic')
        
        # TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„ä¸»è¦é€»è¾‘
        if mode == 'advanced':
            result = f"é«˜çº§æ¨¡å¼å¤„ç†: {input_text}"
        else:
            result = f"åŸºç¡€æ¨¡å¼å¤„ç†: {input_text}"
        
        # ç”Ÿæˆbashå‘½ä»¤
        bash_script = f'''
# {{ display_name }} å¤„ç†è„šæœ¬
echo "å¼€å§‹å¤„ç†: {input_text}"
echo "å¤„ç†æ¨¡å¼: {mode}"

# TODO: åœ¨è¿™é‡Œæ·»åŠ å®é™…çš„å¤„ç†å‘½ä»¤
echo "{result}"

# ç”Ÿæˆè¾“å‡ºæ–‡ä»¶
echo "å¤„ç†å®Œæˆ" > output.txt
echo "ç»“æœ: {result}" >> output.txt

echo "å¤„ç†å®Œæˆï¼Œç»“æœå·²ä¿å­˜åˆ° output.txt"
'''
        
        return runCmd(bash_script)
    
    def outputShow(self, kwargs):
        """
        è‡ªå®šä¹‰è¾“å‡ºæ˜¾ç¤ºæ ¼å¼ï¼ˆå¯é€‰ï¼‰
        """
        stdout = kwargs.get('stdout', '')
        stderr = kwargs.get('stderr', '')
        
        display_text = f"""## ğŸ‰ {{ display_name }} å¤„ç†å®Œæˆ

### ğŸ“‹ å¤„ç†ç»“æœ
```
{stdout}
```
"""
        
        if stderr:
            display_text += f"""
### âš ï¸ è­¦å‘Šä¿¡æ¯
```
{stderr}
```
"""
        
        # è¿”å›å¯èƒ½ç”Ÿæˆçš„æ–‡ä»¶
        file_list = ['output.txt'] if 'output.txt' in stdout else []
        
        return display_text, file_list
    
    def summary(self, kwargs):
        """
        ä¸ºAIç”Ÿæˆç®€çŸ­çš„æ‰§è¡Œæ‘˜è¦
        """
        stdout = kwargs.get('stdout', '')
        stderr = kwargs.get('stderr', '')
        
        if stderr:
            return f"{{ display_name }}å·¥å…·æ‰§è¡Œå®Œæˆä½†æœ‰è­¦å‘Š: {stdout[:200]}...ã€‚è­¦å‘Š: {stderr[:100]}"
        else:
            return f"{{ display_name }}å·¥å…·æ‰§è¡ŒæˆåŠŸ: {stdout[:200]}..."


class {{ name.replace("-", "_") }}_advanced_tool(Tool, calltype="python"):
    """
    {{ description }} - é«˜çº§åŠŸèƒ½
    
    :param str input_file: è¾“å…¥æ–‡ä»¶è·¯å¾„
    :param str output_format: è¾“å‡ºæ ¼å¼ï¼Œå¯é€‰å€¼ï¼šjsonã€csvã€txt
    """
    
    DISPLAY_NAME = "{{ display_name }}é«˜çº§å·¥å…·"
    NETWORK = False  # æ ¹æ®éœ€è¦è®¾ç½®æ˜¯å¦éœ€è¦ç½‘ç»œè®¿é—®
    CPU = 1  # éœ€è¦çš„CPUæ•°é‡
    GPU = 0  # éœ€è¦çš„GPUæ•°é‡
    SIF = "adam-base:1.0.0"  # æŒ‡å®šå®¹å™¨é•œåƒï¼ˆå¿…å¡«ï¼‰
    CONDA_ENV = "base"  # æŒ‡å®šcondaç¯å¢ƒ
    
    def call(self, kwargs):
        """
        Pythonç±»å‹å·¥å…·çš„å®ç°
        """
        import json
        import datetime
        
        input_file = kwargs['args']['input_file']
        output_format = kwargs['args'].get('output_format', 'json')
        
        # TODO: åœ¨è¿™é‡Œå®ç°ä½ çš„Pythoné€»è¾‘
        result = {
            'input_file': input_file,
            'output_format': output_format,
            'processed_at': datetime.datetime.now().isoformat(),
            'result': 'Pythonå·¥å…·å¤„ç†å®Œæˆ'
        }
        
        # å¯¹äºPythonå·¥å…·ï¼Œå¿…é¡»ä½¿ç”¨printè¾“å‡ºç»“æœ
        print(f"Pythonå·¥å…·å¤„ç†å®Œæˆï¼Œè¾“å…¥æ–‡ä»¶: {input_file}")
        print(f"è¾“å‡ºæ ¼å¼: {output_format}")
        print(f"å¤„ç†ç»“æœ: {result}")
        
        # ç”Ÿæˆè¾“å‡ºæ–‡ä»¶
        if output_format == 'json':
            with open('result.json', 'w', encoding='utf-8') as f:
                json.dump(result, f, indent=2, ensure_ascii=False)
            print("ç»“æœå·²ä¿å­˜åˆ° result.json")