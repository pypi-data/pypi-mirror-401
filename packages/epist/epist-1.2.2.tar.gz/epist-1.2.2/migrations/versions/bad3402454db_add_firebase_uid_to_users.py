"""add firebase_uid to users

Revision ID: bad3402454db
Revises: 46f41c459437
Create Date: 2025-11-27 20:56:00.315037+00:00

"""

from collections.abc import Sequence

import sqlalchemy as sa
import sqlmodel
from alembic import op

# revision identifiers, used by Alembic.
revision: str = "bad3402454db"
down_revision: str | None = "46f41c459437"
branch_labels: str | Sequence[str] | None = None
depends_on: str | Sequence[str] | None = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    # op.create_table('transcript_segments',
    # sa.Column('start', sa.Float(), nullable=False),
    # sa.Column('end', sa.Float(), nullable=False),
    # sa.Column('text', sqlmodel.sql.sqltypes.AutoString(), nullable=False),
    # sa.Column('speaker', sqlmodel.sql.sqltypes.AutoString(), nullable=True),
    # sa.Column('confidence', sa.Float(), nullable=True),
    # sa.Column('embedding', pgvector.sqlalchemy.vector.VECTOR(dim=1536), nullable=True),
    # sa.Column('content_vector', postgresql.TSVECTOR(), nullable=True),
    # sa.Column('id', sa.Uuid(), nullable=False),
    # sa.Column('transcript_id', sa.Uuid(), nullable=False),
    # sa.ForeignKeyConstraint(['transcript_id'], ['transcripts.id'], ),
    # sa.PrimaryKeyConstraint('id')
    # )
    # op.drop_index(op.f('ix_apikey_key_hash'), table_name='api_keys')
    # op.create_index(op.f('ix_api_keys_key_hash'), 'api_keys', ['key_hash'], unique=False)
    op.add_column("users", sa.Column("firebase_uid", sqlmodel.sql.sqltypes.AutoString(), nullable=True))
    op.add_column("users", sa.Column("avatar_url", sqlmodel.sql.sqltypes.AutoString(), nullable=True))
    op.drop_index(op.f("ix_user_email"), table_name="users")
    op.create_index(op.f("ix_users_email"), "users", ["email"], unique=True)
    op.create_index(op.f("ix_users_firebase_uid"), "users", ["firebase_uid"], unique=True)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f("ix_users_firebase_uid"), table_name="users")
    op.drop_index(op.f("ix_users_email"), table_name="users")
    op.create_index(op.f("ix_user_email"), "users", ["email"], unique=True)
    op.drop_column("users", "avatar_url")
    op.drop_column("users", "firebase_uid")
    op.drop_index(op.f("ix_api_keys_key_hash"), table_name="api_keys")
    op.create_index(op.f("ix_apikey_key_hash"), "api_keys", ["key_hash"], unique=False)
    op.drop_table("transcript_segments")
    # ### end Alembic commands ###
