# Contributing to devqubit

Thanks for your interest in contributing to **devqubit**! This guide keeps contributions easy, safe, and predictable.

- Please follow our community rules in **CODE_OF_CONDUCT.md**.
- For security issues, **do not** open a public issue (see [Security](#security)).
- Questions / support: prefer **GitHub Discussions** (Issues are for actionable bugs/requests).

## Project tooling

This repository uses:

- **uv** for dependency management and **workspaces** (monorepo)
- **pre-commit** for formatting/linting and repository hygiene checks
- **pytest** for tests
- **towncrier** for changelog fragments (only for user-facing changes)

CI runs:
- `pre-commit` (lint/format)
- `pytest` on multiple Python versions (matrix)

## Quickstart

```bash
git clone https://github.com/devqubit-labs/devqubit.git
cd devqubit

# Create/update .venv and install the workspace environment from uv.lock.
# --all-packages installs all workspace members.
# dev dependencies are synced by default (unless you opt out
uv sync --locked --all-packages

# OPTIONAL: install all extras (optional dependencies) as well
uv sync --locked --all-packages --all-extras

# Install git hooks (required)
uv run pre-commit install

# Run checks + tests (this should match CI)
uv run pre-commit run --all-files
uv run pytest
```

### Faster local setup (optional)

If you only want the core packages and want to avoid heavy adapter/UI dependencies:

```bash
uv sync --locked --all-packages
uv run pytest
```

## Prerequisites

- Git
- A supported Python version (see `requires-python` in `pyproject.toml`)
- uv (installation docs): https://docs.astral.sh/uv/getting-started/installation/

## Workspace (monorepo) notes

This repo is a **uv workspace** (multiple packages managed together). By default:

- `uv sync --all-packages` installs the workspace root and all workspace members.
- `uv run <cmd>` runs a command inside the workspace virtual environment.

Run commands against a specific workspace member (optional):

```bash
uv run --package <PACKAGE_NAME> <command>
```

Examples:

```bash
uv run --package devqubit-engine pytest
uv run --package devqubit-engine python -m devqubit --help
```

## Pre-commit (required)

Install the git hook (runs on every commit):

```bash
uv run pre-commit install
```

Run all hooks manually (this should match CI):

```bash
uv run pre-commit run --all-files
```

Run a single hook or file:

```bash
uv run pre-commit run <hook_id> --files path/to/file.py
```

## Changelog (towncrier) — only for user-facing changes

We keep `CHANGELOG.md` generated by **towncrier** from fragments in `changelog.d/`.

### When to add a fragment

Add a fragment **only** if the change is user-facing, for example:

- New API/CLI features or options
- Behavior changes (including breaking changes)
- Bug fixes that users would notice
- Deprecations / removals
- Security fixes

Do **not** add a fragment for internal refactors, tests, CI, formatting-only changes, etc.

### Where to put it

Fragments go in `changelog.d/` with the type in the filename:

- `changelog.d/<PR_NUMBER>.<type>.md` (e.g. `changelog.d/123.fixed.md`)
- For orphan fragments: `changelog.d/+<description>.<type>.md` (e.g. `changelog.d/+workspace-selector.added.md`)

Available types: `added`, `changed`, `fixed`, `deprecated`, `removed`, `security`

Keep fragments short (1–3 lines) and user-facing (what changed for the user, not how it was implemented).

### Validating fragments (optional)

If you added fragments, you can validate them locally:

```bash
uv run towncrier build --draft
```

## Running tests

Run the full test suite:

```bash
uv run pytest
```

Useful variants:

```bash
# stop on first failure
uv run pytest -x

# run a single file or test
uv run pytest path/to/test_file.py
uv run pytest -k test_name_substring
```

## Making changes

### Branching

Create a branch from `main`:

- `feat/<short-description>` for features
- `fix/<short-description>` for bug fixes
- `docs/<short-description>` for documentation changes

### Pull requests

Keep PRs focused and small when possible. If a change is large, split it into incremental PRs.

**Before requesting review, ensure:**

- `uv run pre-commit run --all-files` passes
- `uv run pytest` passes
- New/changed behavior is covered by tests
- User-facing changes include a towncrier fragment in `changelog.d/`
- User-facing changes are documented (README/docs/examples) when applicable

### Style and compatibility

- Prefer clear, readable code over clever code.
- Avoid breaking public APIs without discussion.
- Keep changes compatible with the supported Python versions in `pyproject.toml`.

## Adding or updating dependencies

If you change dependencies:

1. Update the relevant `pyproject.toml` (or use `uv add` / `uv remove`)
2. Update the lockfile and re-sync:

```bash
uv lock
uv sync --locked --all-packages
```

If you want to upgrade locked versions:

```bash
uv lock --upgrade
uv sync --locked --all-packages
```

Tip: If `uv sync --locked` fails, it usually means uv.lock is out of date - run `uv lock` and commit the updated lockfile.

## Documentation

- If your change affects the CLI, update help text, docs, or examples.
- If your change affects the output format (bundles/artifacts), document it clearly and add tests.

## Reporting bugs

When filing a bug report, please include:

- What you expected vs what happened
- Your OS and Python version
- devqubit version / git commit
- A minimal reproduction (ideally a small snippet or command)

## Security

Please do **not** report security vulnerabilities via public GitHub issues.

Use GitHub “Report a vulnerability” (Private Vulnerability Reporting).

## License

By contributing, you agree that your contributions are licensed under the project’s license (Apache-2.0), unless explicitly stated otherwise.
