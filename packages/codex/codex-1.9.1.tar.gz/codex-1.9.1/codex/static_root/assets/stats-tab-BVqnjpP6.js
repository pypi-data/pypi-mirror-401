import{cl as j,_ as C,af as I,v as l,b as n,a as c,C as b,x as g,y as u,a7 as K,F as f,B as p,d as w,D as B,G as h,I as L,w as _,q as y,cm as P,cn as D,co as E,aO as v,bh as x,bi as G,E as N,A as R}from"./main-DOt-U49O.js";import{V}from"./VTable-CQLmm9Oa.js";import{C as U}from"./confirm-dialog-CbtCKI6V.js";import{c as z}from"./copy-to-clipboard-DoUvDJVx.js";import{useAdminStore as T}from"./admin-DDL6PW82.js";import"./forwardRefs-DU5TZuO6.js";import"./VDialog-C3BkCs2z.js";function F(e,t={}){return e?j(e,{delimiter:".",...t}):""}function $(e,t={}){return F(e,{delimiter:"_",...t})}const q={name:"StatsTable",props:{title:{type:String,required:!0},items:{type:Object,required:!0}},data(){return{}},methods:{valueTable(e){return e&&typeof e=="object"?e:{}},tdClasses(e){return{indent:e[0]==="+"}},tdLabel(e){return e.replace(/^\+/,"")},nf(e){return typeof e=="number"?I.format(e):e}}},H={class:"statBlock"},M={key:0},X={colspan:"2",class:"subtitleRow"},Y={key:1},J={class:"indent"};function Q(e,t,a,s,i,o){return u(),l("div",H,[n("h3",null,b(a.title),1),c(V,{class:"highlight-table"},{default:g(()=>[(u(!0),l(f,null,p(Object.entries(a.items),([r,d])=>(u(),l("tbody",{key:r},[typeof d=="object"?(u(),l("tr",M,[n("th",X,b(r),1)])):(u(),l("tr",Y,[n("td",{class:w(o.tdClasses(r))},b(o.tdLabel(r)),3),n("td",null,b(o.nf(d)),1)])),(u(!0),l(f,null,p(Object.entries(o.valueTable(d)),([m,A])=>(u(),l("tr",{key:m},[n("td",J,b(m),1),n("td",null,b(o.nf(A)),1)]))),128))]))),128)),K(e.$slots,"default",{},void 0,!0)]),_:3})])}const W=C(q,[["render",Q],["__scopeId","data-v-4bb3ecd9"]]),O={topGroup:v,orderBy:E,fitTo:D,readingDirection:P},S={authGroupCount:"Authorization Groups",libraryCount:"Libraries",userAnonymousCount:"Anonymous Users",userRegisteredCount:"Registered Users"};Object.freeze(S);Object.freeze(O);const k=new Set(["creditPersonsCount","creditRolesCount","identifierSourcesCount","storyArcNumbersCount"]);Object.freeze(k);const Z={name:"AdminTasksTab",components:{ConfirmDialog:U,StatsTable:W},data(){return{showTooltip:{show:!1},schemaHref:globalThis.CODEX.API_V3_PATH+"#/api/api_v3_admin_stats_retrieve"}},computed:{...h(N,{}),...h(T,{stats:e=>e.stats}),clipBoardEnabled(){return location.prototcal=="https:"},apiTooltip(){return this.clipBoardEnabled},clipBoardIcon(){return this.showTooltip?x:G},platformTable(){const e={};for(const[t,a]of Object.entries(this.stats?.platform)){const s=this.keyToLabel(t),i=t==="system"?`${a.name} ${a.release}`:a;e[s]=i}return e},configTable(){const e={};let t="";for(const[a,s]of Object.entries(this.stats?.config)){let i;if(a=="apiKey"){t=s;continue}else i=S[a];e[i]=s}return e["API Key"]=t,e},userSettingsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.sessions)){const s={},i=O[t];for(const[r,d]of Object.entries(a)){let m;m=i?i[$(r)]:r,s[m]=d}const o=this.keyToLabel(t);e[o]=s}return e},browserGroupsTable(){const e={};for(const[t,a]of Object.entries(this.stats?.groups)){let s=this.keyToLabel(t);s!=="Series"&&(s+="s"),e[s]=a}return e},fileTypesTable(){const e={};for(const[t,a]of Object.entries(this.stats?.fileTypes)){const s=t==="unknown"?y(t):this.keyToLabel(t).toUpperCase();e[s]=a}return e},metadataTable(){const e={};for(const[t,a]of Object.entries(this.stats?.metadata)){let s=t==="countryCount"?"Countries":this.keyToLabel(t)+"s";k.has(t)&&(s=s.replace(/^\w+ /,"+")),e[s]=a}return e}},created(){this.loadStats()},methods:{...B(T,["loadStats","updateAPIKey"]),regenAPIKey(){this.updateAPIKey().then(this.loadStats).catch(console.warn)},onClickAPIKey(){this.clipBoardEnabled&&z(this.stats.config.apiKey,this.showTooltip)},keyToLabel(e){return e=e.replace(/Count$/,""),y(e)}}},ee={key:0,id:"stats"},te={id:"schemaDoc"},se={colspan:"2"},ae=["href"],oe={colspan:"2"};function re(e,t,a,s,i,o){const r=_("StatsTable"),d=_("ConfirmDialog");return e.stats?(u(),l("div",ee,[c(r,{title:"Platform",items:o.platformTable},null,8,["items"]),c(r,{title:"Config",items:o.configTable},{default:g(()=>[n("tbody",null,[n("tr",te,[n("td",se,[t[0]||(t[0]=R(" The only endpoint accessible by API Key is ",-1)),n("a",{href:i.schemaHref,target:"_blank"},"/admin/stats",8,ae)])]),n("tr",null,[n("td",oe,[c(d,{"button-text":"Regenerate API Key","title-text":"Regenerate",text:"API Key","confirm-text":"Regenerate",onConfirm:o.regenAPIKey},null,8,["onConfirm"])])])])]),_:1},8,["items"]),c(r,{title:"User Settings",items:o.userSettingsTable},null,8,["items"]),c(r,{title:"Browser Groups",items:o.browserGroupsTable},null,8,["items"]),c(r,{title:"File Types",items:o.fileTypesTable},null,8,["items"]),c(r,{title:"Metadata",items:o.metadataTable},null,8,["items"])])):L("",!0)}const me=C(Z,[["render",re],["__scopeId","data-v-1a3ceb11"]]);export{me as default};
