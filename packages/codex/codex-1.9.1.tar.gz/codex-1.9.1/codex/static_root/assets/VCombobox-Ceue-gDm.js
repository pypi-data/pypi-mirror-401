import{q as Ae,u as Me,r as Te,c as Q}from"./VSelectionControl-D3iAHJ8o.js";import{u as Ee,t as M,e as _e,f as Le,m as Be,a as Ne,V as Ke,b as Oe,g as ze,d as X}from"./VSelect-VrRTxmWq.js";import{u as Ue,f as $e,G as ee,n as le,o as je}from"./forwardRefs-DU5TZuO6.js";import{u as qe,m as He,h as We}from"./filter-kOVcPvT2.js";import{g as Ge,p as Je,aD as Ye,r as O,aV as D,e as ae,bH as Ze,t as Qe,c as p,aZ as T,aW as E,u as Xe,o as el,bI as ll,a as d,m as k,bJ as al,bK as te,aY as tl,b as S,bL as ul,F as H,bM as nl,n as ol,d as il,A as sl}from"./main-DOt-U49O.js";import{a as ue,j as rl}from"./VDialog-C3BkCs2z.js";import{a as cl}from"./VDivider-BbelFalt.js";import{V as vl}from"./VCheckboxBtn-BeVK_46v.js";const dl=Je({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...He({filterKeys:["title"]}),...Be({hideNoData:!0,returnObject:!0}),...el(Te({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VCombobox"),Vl=Ge()({name:"VCombobox",props:dl(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,ne){let{emit:oe,slots:s}=ne;const{t:ie}=Ye(),m=O(),y=D(!1),x=D(!0),z=D(!1),W=O(),_=O(),i=D(-1);let L=!1;const{items:G,transformIn:se,transformOut:re}=Ee(l),{textColorClasses:ce,textColorStyles:ve}=Ue(()=>m.value?.color),{InputIcon:de}=Ae(l),u=ae(l,"modelValue",[],e=>se(Ze(e)),e=>{const a=re(e);return l.multiple?a:a[0]??null}),I=Me(l),J=Qe(()=>l.closableChips&&!I.isReadonly.value&&!I.isDisabled.value),B=p(()=>!!(l.chips||s.chip)),V=p(()=>B.value||!!s.selection),h=D(!l.multiple&&!V.value?u.value[0]?.title??"":""),F=D(null),c=p({get:()=>h.value,set:async e=>{if(h.value=e??"",e===null||e===""&&!l.multiple&&!V.value?u.value=[]:!l.multiple&&!V.value&&(u.value=[M(l,e)],T(()=>_.value?.scrollToIndex(0))),e&&l.multiple&&l.delimiters?.length){const a=Y(e);a.length>1&&(Z(a),h.value="")}e||(i.value=-1),x.value=!e}}),fe=p(()=>typeof l.counterValue=="function"?l.counterValue(u.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?u.value.length:c.value.length),{filteredItems:U,getMatches:me}=qe(l,G,()=>F.value??(l.alwaysFilter||!x.value?c.value:"")),w=p(()=>l.hideSelected&&F.value===null?U.value.filter(e=>!u.value.some(a=>a.value===e.value)):U.value),N=p(()=>l.hideNoData&&!w.value.length||I.isReadonly.value||I.isDisabled.value),$=ae(l,"menu"),r=p({get:()=>$.value,set:e=>{$.value&&!e&&W.value?.Î¨openChildren.size||e&&N.value||($.value=e)}}),{menuId:he,ariaExpanded:be,ariaControls:ge}=_e(l,r);E(h,e=>{L?T(()=>L=!1):y.value&&!r.value&&(r.value=!0),oe("update:search",e)}),E(u,e=>{!l.multiple&&!V.value&&(h.value=e[0]?.title??"")});const pe=p(()=>u.value.map(e=>e.value)),P=p(()=>w.value.find(e=>e.type==="item"&&!e.props.disabled)),j=p(()=>(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&c.value===P.value?.title)&&w.value.length>0&&!x.value&&!z.value),q=O(),ye=Le(q,m);function xe(e){L=!0,T(()=>L=!1),l.openOnClear&&(r.value=!0)}function Ve(){N.value||(r.value=!0)}function Ce(e){N.value||(y.value&&(e.preventDefault(),e.stopPropagation()),r.value=!r.value)}function ke(e){(te(e)||e.key==="Backspace")&&m.value?.focus()}function we(e){if(al(e)||I.isReadonly.value)return;const a=m.value?.selectionStart,v=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(r.value=!0),["Escape"].includes(e.key)&&(r.value=!1),j.value&&["Enter","Tab"].includes(e.key)&&P.value&&!u.value.some(t=>{let{value:g}=t;return g===P.value.value})&&b(P.value),e.key==="ArrowDown"&&j.value&&q.value?.focus("next"),e.key==="Enter"&&c.value&&(b(M(l,c.value),!0,!0),V.value&&(h.value="")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&V.value&&u.value.length>0&&!c.value)return b(u.value[0],!1);if(~i.value){e.preventDefault();const t=i.value;b(u.value[i.value],!1),i.value=t>=v-1?v-2:t}else e.key==="Backspace"&&!c.value&&(i.value=v-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(i.value<0&&a&&a>0)return;const t=i.value>-1?i.value-1:v-1;u.value[t]?i.value=t:(i.value=-1,m.value?.setSelectionRange(c.value.length,c.value.length))}else if(e.key==="ArrowRight"){if(i.value<0)return;const t=i.value+1;u.value[t]?i.value=t:(i.value=-1,m.value?.setSelectionRange(0,0))}else~i.value&&te(e)&&(i.value=-1)}function Ie(e){const a=e?.clipboardData?.getData("Text")??"",v=Y(a);v.length>1&&l.multiple&&(e.preventDefault(),Z(v))}function De(){l.eager&&_.value?.calculateVisibleItems()}function Se(){y.value&&m.value?.focus(),x.value=!0,F.value=null}function b(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!e||e.props.disabled))if(l.multiple){const t=u.value.findIndex(n=>(l.valueComparator||ee)(n.value,e.value)),g=a??!~t;if(~t){const n=g?[...u.value,e]:[...u.value];n.splice(t,1),u.value=n}else g&&(u.value=[...u.value,e]);l.clearOnSelect&&(c.value="")}else{const t=a!==!1;u.value=t?[e]:[],(!x.value||l.alwaysFilter)&&h.value&&(F.value=h.value),h.value=t&&!V.value?e.title:"",T(()=>{r.value=v,x.value=!0})}}function Y(e){const v=[`
`,...l.delimiters??[]].map(ll).join("|");return e.split(new RegExp(`(?:${v})+`))}async function Z(e){for(let a of e)a=a.trim(),a&&(b(M(l,a)),await T())}function Fe(e){y.value=!0,setTimeout(()=>{z.value=!0})}function Pe(e){z.value=!1}return E(y,(e,a)=>{if(!(e||e===a)&&(i.value=-1,r.value=!1,c.value)){if(l.multiple){b(M(l,c.value));return}if(!V.value)return;u.value.some(v=>{let{title:t}=v;return t===c.value})?h.value="":b(M(l,c.value))}}),E(r,e=>{if(!l.hideSelected&&e&&u.value.length&&x.value){const a=w.value.findIndex(v=>u.value.some(t=>(l.valueComparator||ee)(t.value,v.value)));tl&&window.requestAnimationFrame(()=>{a>=0&&_.value?.scrollToIndex(a)})}e&&(F.value=null)}),E(G,(e,a)=>{r.value||y.value&&!a.length&&e.length&&(r.value=!0)}),Xe(()=>{const e=!!(!l.hideNoData||w.value.length||s["prepend-item"]||s["append-item"]||s["no-data"]),a=u.value.length>0,v=Q.filterProps(l);return d(Q,k({ref:m},v,{modelValue:c.value,"onUpdate:modelValue":t=>c.value=t,focused:y.value,"onUpdate:focused":t=>y.value=t,validationValue:u.externalValue,counterValue:fe.value,dirty:a,class:["v-combobox",{"v-combobox--active-menu":r.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!V.value,"v-combobox--selecting-index":i.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:I.isReadonly.value,placeholder:a?void 0:l.placeholder,"onClick:clear":xe,"onMousedown:control":Ve,onKeydown:we,onPaste:Ie,"aria-expanded":be.value,"aria-controls":ge.value}),{...s,default:t=>{let{id:g}=t;return S(H,null,[d(Ne,k({id:he.value,ref:W,modelValue:r.value,"onUpdate:modelValue":n=>r.value=n,activator:"parent",contentClass:"v-combobox__content",disabled:N.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:De,onAfterLeave:Se},l.menuProps),{default:()=>[e&&d(Ke,k({ref:q,filterable:!0,selected:pe.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:n=>n.preventDefault(),selectable:!0,onKeydown:ke,onFocusin:Fe,onFocusout:Pe,tabindex:"-1","aria-live":"polite","aria-labelledby":`${g.value}-label`,"aria-multiselectable":l.multiple,color:l.itemColor??l.color},ye,l.listProps),{default:()=>[s["prepend-item"]?.(),!w.value.length&&!l.hideNoData&&(s["no-data"]?.()??d(ue,{key:"no-data",title:ie(l.noDataText)},null)),d(Oe,{ref:_,renderless:!0,items:w.value,itemKey:"value"},{default:n=>{let{item:o,index:C,itemRef:K}=n;const R=k(o.props,{ref:K,key:o.value,active:j.value&&o===P.value?!0:void 0,onClick:()=>b(o,null),"aria-posinset":C+1,"aria-setsize":w.value.length});return o.type==="divider"?s.divider?.({props:o.raw,index:C})??d(cl,k(o.props,{key:`divider-${C}`}),null):o.type==="subheader"?s.subheader?.({props:o.raw,index:C})??d(ze,k(o.props,{key:`subheader-${C}`}),null):s.item?.({item:o,index:C,props:R})??d(ue,k(R,{role:"option"}),{prepend:A=>{let{isSelected:f}=A;return S(H,null,[l.multiple&&!l.hideSelected?d(vl,{key:o.value,modelValue:f,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Re=>Re.preventDefault()},null):void 0,o.props.prependAvatar&&d(rl,{image:o.props.prependAvatar},null),o.props.prependIcon&&d(le,{icon:o.props.prependIcon},null)])},title:()=>x.value?o.title:We("v-combobox",o.title,me(o)?.title)})}}),s["append-item"]?.()]})]}),u.value.map((n,o)=>{function C(f){f.stopPropagation(),f.preventDefault(),b(n,!1)}const K=k(X.filterProps(n.props),{"onClick:close":C,onKeydown(f){f.key!=="Enter"&&f.key!==" "||(f.preventDefault(),f.stopPropagation(),C(f))},onMousedown(f){f.preventDefault(),f.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),R=B.value?!!s.chip:!!s.selection,A=R?nl(B.value?s.chip({item:n,index:o,props:K}):s.selection({item:n,index:o})):void 0;if(!(R&&!A))return S("div",{key:n.value,class:il(["v-combobox__selection",o===i.value&&["v-combobox__selection--selected",ce.value]]),style:ol(o===i.value?ve.value:{})},[B.value?s.chip?d(je,{key:"chip-defaults",defaults:{VChip:{closable:J.value,size:"small",text:n.title}}},{default:()=>[A]}):d(X,k({key:"chip",closable:J.value,size:"small",text:n.title,disabled:n.props.disabled},K),null):A??S("span",{class:"v-combobox__selection-text"},[n.title,l.multiple&&o<u.value.length-1&&S("span",{class:"v-combobox__selection-comma"},[sl(",")])])])})])},"append-inner":function(){for(var t=arguments.length,g=new Array(t),n=0;n<t;n++)g[n]=arguments[n];return S(H,null,[s["append-inner"]?.(...g),(!l.hideNoData||l.items.length)&&l.menuIcon?d(le,{class:"v-combobox__menu-icon",color:m.value?.fieldIconColor,icon:l.menuIcon,onMousedown:Ce,onClick:ul,"aria-hidden":!0,tabindex:"-1"},null):void 0,l.appendInnerIcon&&d(de,{key:"append-icon",name:"appendInner",color:g[0].iconColor.value},null)])}})}),$e({isFocused:y,isPristine:x,menu:r,search:c,selectionIndex:i,filteredItems:U,select:b},m)}});export{Vl as V};
