(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[719],{12745:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>U});var s=a(88629),n=a(5329),r=a(41021),i=a.n(r);class o{constructor(e){this.id=e.id,this.iconURL=e.iconURL,this.name=e.name,this.description=e.description,this.adapter=e.adapter,this.adapterConfig=e.adapterConfig,this.adapterLabel=e.adapterLabel,this.usePipelineName=e.usePipelineName,this.enable=e.enable}}var l=a(38449),c=a.n(l),d=a(52959),u=a(68342),p=a(47925),h=a(44001);function m(e){let{botCardVO:t,setBotEnableCallback:a}=e,{t:n}=(0,p.Bd)();return(0,s.jsx)("div",{className:"".concat(c().cardContainer),children:(0,s.jsxs)("div",{className:"".concat(c().iconBasicInfoContainer),children:[(0,s.jsx)("img",{className:"".concat(c().iconImage),src:t.iconURL,alt:"icon"}),(0,s.jsxs)("div",{className:"".concat(c().basicInfoContainer),children:[(0,s.jsxs)("div",{className:"".concat(c().basicInfoNameContainer),children:[(0,s.jsx)("div",{className:"".concat(c().basicInfoName),children:t.name}),(0,s.jsx)("div",{className:"".concat(c().basicInfoDescription),children:t.description})]}),(0,s.jsxs)("div",{className:"".concat(c().basicInfoAdapterContainer),children:[(0,s.jsx)("svg",{className:"".concat(c().basicInfoAdapterIcon),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M2 8.99374C2 5.68349 4.67654 3 8.00066 3H15.9993C19.3134 3 22 5.69478 22 8.99374V21H8.00066C4.68659 21 2 18.3052 2 15.0063V8.99374ZM20 19V8.99374C20 6.79539 18.2049 5 15.9993 5H8.00066C5.78458 5 4 6.78458 4 8.99374V15.0063C4 17.2046 5.79512 19 8.00066 19H20ZM14 11H16V13H14V11ZM8 11H10V13H8V11Z"})}),(0,s.jsx)("span",{className:"".concat(c().basicInfoAdapterLabel),children:t.adapterLabel})]}),(0,s.jsxs)("div",{className:"".concat(c().basicInfoPipelineContainer),children:[(0,s.jsx)("svg",{className:"".concat(c().basicInfoPipelineIcon),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M6 21.5C4.067 21.5 2.5 19.933 2.5 18C2.5 16.067 4.067 14.5 6 14.5C7.5852 14.5 8.92427 15.5539 9.35481 16.9992L15 16.9994V15L17 14.9994V9.24339L14.757 6.99938H9V9.00003H3V3.00003H9V4.99939H14.757L18 1.75739L22.2426 6.00003L19 9.24139V14.9994L21 15V21H15V18.9994L9.35499 19.0003C8.92464 20.4459 7.58543 21.5 6 21.5ZM6 16.5C5.17157 16.5 4.5 17.1716 4.5 18C4.5 18.8285 5.17157 19.5 6 19.5C6.82843 19.5 7.5 18.8285 7.5 18C7.5 17.1716 6.82843 16.5 6 16.5ZM19 17H17V19H19V17ZM18 4.58581L16.5858 6.00003L18 7.41424L19.4142 6.00003L18 4.58581ZM7 5.00003H5V7.00003H7V5.00003Z"})}),(0,s.jsx)("span",{className:"".concat(c().basicInfoPipelineLabel),children:t.usePipelineName})]})]}),(0,s.jsx)("div",{className:"".concat(c().botOperationContainer),children:(0,s.jsx)(u.d,{checked:t.enable,onCheckedChange:e=>{d.ok.updateBot(t.id,{name:t.name,description:t.description,adapter:t.adapter,adapter_config:t.adapterConfig,enable:e}).then(()=>{a(t.id,e)}).catch(e=>{console.error(e),h.oR.error(n("bots.setBotEnableError"))})},onClick:e=>{e.stopPropagation()}})})]})})}var x=a(4187),b=a(2262),g=a(38642),f=a(42670),j=a(85702),v=a(49318),C=a(63179),_=a(12472),N=a(41680),w=a(15659),k=a(22985),L=a(47444),y=a(42973),I=a(44996),V=a(19854),S=a(24586);function B(e){var t;let{initBotId:a,onFormSubmit:r,onBotDeleted:i,onNewBotCreated:o}=e,{t:l}=(0,p.Bd)(),c=k.Ik({name:k.Yj().min(1,{message:l("bots.botNameRequired")}),description:k.Yj().min(1,{message:l("bots.botDescriptionRequired")}),adapter:k.Yj().min(1,{message:l("bots.adapterRequired")}),adapter_config:k.g1(k.Yj(),k.bz()),enable:k.zM().optional(),use_pipeline_uuid:k.Yj().optional()}),m=(0,w.mN)({resolver:(0,N.u)(c),defaultValues:{name:"",description:l("bots.defaultDescription"),adapter:"",adapter_config:{},enable:!0,use_pipeline_uuid:""}}),[x,f]=(0,n.useState)(!1),[B,H]=(0,n.useState)(new Map),[M,R]=(0,n.useState)(!1),[P,A]=(0,n.useState)([]),[E,Z]=(0,n.useState)({}),[D,O]=(0,n.useState)({}),[z,T]=(0,n.useState)([]),[F,U]=(0,n.useState)([]),[q,G]=(0,n.useState)([]),[,Y]=(0,n.useState)(!1),[$,J]=(0,n.useState)(""),W=n.useRef(null),[Q,X]=(0,n.useState)(!1),K=m.watch("adapter"),ee=m.watch("adapter_config");function et(){ea().then(()=>{a?es(a).then(e=>{m.setValue("name",e.name),m.setValue("description",e.description),m.setValue("adapter",e.adapter),m.setValue("adapter_config",e.adapter_config),m.setValue("enable",e.enable),m.setValue("use_pipeline_uuid",e.use_pipeline_uuid||""),en(e.adapter),e.webhook_full_url?J(e.webhook_full_url):J("")}).catch(e=>{h.oR.error(l("bots.getBotConfigError")+e.msg)}):(m.reset(),J(""))})}async function ea(){T((await d.ok.getPipelines()).pipelines.map(e=>{var t;return{label:e.name,value:null!=(t=e.uuid)?t:""}}));let e=await d.ok.getAdapters();A(e.adapters.map(e=>({label:(0,b.Z)(e.label),value:e.name}))),Z(e.adapters.reduce((e,t)=>(e[t.name]=d.ok.getAdapterIconURL(t.name),e),{})),O(e.adapters.reduce((e,t)=>(e[t.name]=(0,b.Z)(t.description),e),{})),e.adapters.forEach(e=>{B.set(e.name,e.spec.config.map(e=>new v.HL({default:e.default,id:C.k.generate(),label:e.label,description:e.description,name:e.name,required:e.required,type:(0,v.GG)(e.type),options:e.options})))}),H(B)}async function es(e){return new Promise((t,a)=>{d.ok.getBot(e).then(e=>{var a,s;let n=e.bot;t({adapter:n.adapter,description:n.description,name:n.name,adapter_config:n.adapter_config,enable:null==(a=n.enable)||a,use_pipeline_uuid:null!=(s=n.use_pipeline_uuid)?s:"",webhook_full_url:n.adapter_runtime_values?n.adapter_runtime_values.webhook_full_url:void 0})}).catch(e=>{a(e)})})}function en(e){if(e){let t=B.get(e);t&&(U(t),a||m.setValue("adapter_config",(0,v.wY)(t))),R(!0)}else R(!1)}return(0,n.useEffect)(()=>{et()},[]),(0,n.useEffect)(()=>{"lark"===K&&!1===(null==ee?void 0:ee["enable-webhook"])?G(F.filter(e=>"encrypt-key"!==e.name)):G(F)},[K,ee,F]),(0,s.jsxs)("div",{children:[(0,s.jsx)(g.lG,{open:x,onOpenChange:f,children:(0,s.jsxs)(g.Cf,{children:[(0,s.jsx)(g.c7,{children:(0,s.jsx)(g.L3,{children:l("common.confirmDelete")})}),(0,s.jsx)(g.rr,{children:l("bots.deleteConfirmation")}),(0,s.jsxs)(g.Es,{children:[(0,s.jsx)(j.$,{variant:"outline",onClick:()=>f(!1),children:"取消"}),(0,s.jsx)(j.$,{variant:"destructive",onClick:()=>{a&&d.ok.deleteBot(a).then(()=>{i(),h.oR.success(l("bots.deleteSuccess"))}).catch(e=>{h.oR.error(l("bots.deleteError")+e.msg)}),f(!1)},children:l("common.confirmDelete")})]})]})}),(0,s.jsx)(I.lV,{...m,children:(0,s.jsx)("form",{id:"bot-form",onSubmit:m.handleSubmit(function(){if(Y(!0),a){let e={uuid:a,name:m.getValues().name,description:m.getValues().description,adapter:m.getValues().adapter,adapter_config:m.getValues().adapter_config,enable:m.getValues().enable,use_pipeline_uuid:m.getValues().use_pipeline_uuid};d.ok.updateBot(a,e).then(()=>{r(m.getValues()),h.oR.success(l("bots.saveSuccess"))}).catch(e=>{h.oR.error(l("bots.saveError")+e.msg)}).finally(()=>{Y(!1)})}else{let e={name:m.getValues().name,description:m.getValues().description,adapter:m.getValues().adapter,adapter_config:m.getValues().adapter_config};d.ok.createBot(e).then(e=>{h.oR.success(l("bots.createSuccess")),a=e.uuid,et(),o(e.uuid)}).catch(e=>{h.oR.error(l("bots.createError")+e.msg)}).finally(()=>{Y(!1),m.reset()})}}),className:"space-y-8",children:(0,s.jsxs)("div",{className:"space-y-4",children:[a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-6",children:[(0,s.jsx)(I.zB,{control:m.control,name:"enable",render:e=>{let{field:t}=e;return(0,s.jsxs)(I.eI,{className:"flex flex-col justify-start gap-[0.8rem] h-[3.8rem]",children:[(0,s.jsx)(I.lR,{children:l("common.enable")}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)(u.d,{checked:t.value,onCheckedChange:t.onChange})})]})}}),(0,s.jsx)(I.zB,{control:m.control,name:"use_pipeline_uuid",render:e=>{let{field:t}=e;return(0,s.jsxs)(I.eI,{className:"flex flex-col justify-start gap-[0.8rem] h-[3.8rem]",children:[(0,s.jsx)(I.lR,{children:l("bots.bindPipeline")}),(0,s.jsx)(I.MJ,{children:(0,s.jsxs)(S.l6,{onValueChange:t.onChange,...t,children:[(0,s.jsx)(S.bq,{className:"bg-[#ffffff] dark:bg-[#2a2a2e]",children:(0,s.jsx)(S.yv,{placeholder:l("bots.selectPipeline")})}),(0,s.jsx)(S.gC,{className:"fixed z-[1000]",children:(0,s.jsx)(S.s3,{children:z.map(e=>(0,s.jsx)(S.eb,{value:e.value,children:e.label},e.value))})})]})})]})}})]}),$&&("lark"!==K||(null==ee?void 0:ee["enable-webhook"])!==!1)&&(0,s.jsxs)(I.eI,{children:[(0,s.jsx)(I.lR,{children:l("bots.webhookUrl")}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(V.p,{ref:W,value:$,readOnly:!0,className:"flex-1 bg-gray-50 dark:bg-gray-900",onClick:e=>{e.target.select()}}),(0,s.jsxs)(j.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{console.log("[Copy] Attempting to copy from input element");let e=W.current;if(!e)return void console.error("[Copy] Input element not found");try{if(e.disabled=!1,e.readOnly=!1,e.focus(),e.select(),navigator.clipboard&&navigator.clipboard.writeText)console.log("[Copy] Using Clipboard API with input value:",e.value),navigator.clipboard.writeText(e.value).then(()=>{console.log("[Copy] Clipboard API success"),e.blur(),e.readOnly=!0,X(!0),setTimeout(()=>X(!1),2e3)}).catch(t=>{console.error("[Copy] Clipboard API failed, trying execCommand:",t);let a=document.execCommand("copy");console.log("[Copy] execCommand result:",a),e.blur(),e.readOnly=!0,a&&(X(!0),setTimeout(()=>X(!1),2e3))});else{console.log("[Copy] Using execCommand with input value:",e.value);let t=document.execCommand("copy");console.log("[Copy] execCommand result:",t),e.blur(),e.readOnly=!0,t&&(X(!0),setTimeout(()=>X(!1),2e3))}}catch(t){console.error("[Copy] Copy failed:",t),e.readOnly=!0}},children:[Q?(0,s.jsx)(L.A,{className:"h-4 w-4 text-green-600 mr-2"}):(0,s.jsx)(y.A,{className:"h-4 w-4 mr-2"}),l("common.copy")]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:l("bots.webhookUrlHint")})]})]}),(0,s.jsx)(I.zB,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,s.jsxs)(I.eI,{children:[(0,s.jsxs)(I.lR,{children:[l("bots.botName"),(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)(V.p,{...t})}),(0,s.jsx)(I.C5,{})]})}}),(0,s.jsx)(I.zB,{control:m.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(I.eI,{children:[(0,s.jsxs)(I.lR,{children:[l("bots.botDescription"),(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)(V.p,{...t})}),(0,s.jsx)(I.C5,{})]})}}),(0,s.jsx)(I.zB,{control:m.control,name:"adapter",render:e=>{let{field:t}=e;return(0,s.jsxs)(I.eI,{children:[(0,s.jsxs)(I.lR,{children:[l("bots.platformAdapter"),(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(I.MJ,{children:(0,s.jsx)("div",{className:"relative",children:(0,s.jsxs)(S.l6,{onValueChange:e=>{t.onChange(e),en(e)},value:t.value,children:[(0,s.jsx)(S.bq,{className:"w-[180px] bg-[#ffffff] dark:bg-[#2a2a2e]",children:(0,s.jsx)(S.yv,{placeholder:l("bots.selectAdapter")})}),(0,s.jsx)(S.gC,{className:"fixed z-[1000]",children:(0,s.jsx)(S.s3,{children:P.map(e=>(0,s.jsx)(S.eb,{value:e.value,children:e.label},e.value))})})]})})}),(0,s.jsx)(I.C5,{})]})}}),m.watch("adapter")&&(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 rounded-lg border",children:[(0,s.jsx)("img",{src:E[m.watch("adapter")],alt:"adapter icon",className:"w-12 h-12 rounded-[8%]"}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("div",{className:"font-medium",children:null==(t=P.find(e=>e.value===m.watch("adapter")))?void 0:t.label}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:D[m.watch("adapter")]})]})]}),M&&q.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"text-lg font-medium",children:l("bots.adapterConfig")}),(0,s.jsx)(_.A,{itemConfigList:q,initialValues:m.watch("adapter_config"),onSubmit:e=>{m.setValue("adapter_config",e)}})]})]})})})]})}class H{startListenServerPush(){let e=setInterval(()=>{this.getLogList(-1,50).then(e=>{this.callbacks.forEach(t=>t(this.parseResponse(e)))})},3e3);this.intervalIds.push(Number(e))}stopServerPush(){this.intervalIds.forEach(e=>clearInterval(e)),this.intervalIds=[]}subscribeLogPush(e){this.callbacks.includes(e)||this.callbacks.push(e)}dispose(){this.callbacks=[]}getLogList(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return d.ok.getBotLogs(this.botId,{from_index:e,max_count:t})}async loadFirstPage(){return this.parseResponse(await this.getLogList(-1,10))}async loadMore(e,t){return this.parseResponse(await this.getLogList(e,t))}parseResponse(e){return e.logs}constructor(e){this.callbacks=[],this.intervalIds=[],this.botId=e}}var M=a(24959),R=a.n(M),P=a(5437);function A(e){let{botLog:t}=e,{t:a}=(0,p.Bd)(),r=d.ok.getBaseUrl(),[i,o]=(0,n.useState)(!1);return(0,s.jsxs)("div",{className:"".concat(R().botLogCardContainer),children:[(0,s.jsxs)("div",{className:"".concat(R().cardTitleContainer),children:[(0,s.jsxs)("div",{className:"flex flex-row gap-2 items-center",children:[(0,s.jsx)("div",{className:"px-2 py-1 rounded text-xs font-medium uppercase ".concat(function(e){switch(e.toLowerCase()){case"error":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"warning":return"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"}}(t.level)),children:t.level}),t.message_session_id&&(0,s.jsxs)("div",{className:"".concat(R().tag," ").concat(R().chatTag," relative"),onClick:()=>{navigator.clipboard.writeText(t.message_session_id).then(()=>{o(!0),setTimeout(()=>o(!1),2e3)})},title:a("common.clickToCopy"),children:[i?(0,s.jsx)(L.A,{className:"w-4 h-4 text-green-600"}):(0,s.jsxs)("svg",{className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1664",width:"16",height:"16",fill:"currentColor",children:[(0,s.jsx)("path",{d:"M96.1 575.7a32.2 32.1 0 1 0 64.4 0 32.2 32.1 0 1 0-64.4 0Z","p-id":"1665",fill:"currentColor"}),(0,s.jsx)("path",{d:"M742.1 450.7l-269.5-2.1c-14.3-0.1-26 13.8-26 31s11.7 31.3 26 31.4l269.5 2.1c14.3 0.1 26-13.8 26-31s-11.7-31.3-26-31.4zM742.1 577.7l-269.5-2.1c-14.3-0.1-26 13.8-26 31s11.7 31.3 26 31.4l269.5 2.1c14.3 0.2 26-13.8 26-31s-11.7-31.3-26-31.4z","p-id":"1666",fill:"currentColor"}),(0,s.jsx)("path",{d:"M736.1 63.9H417c-70.4 0-128 57.6-128 128h-64.9c-70.4 0-128 57.6-128 128v128c-0.1 17.7 14.4 32 32.2 32 17.8 0 32.2-14.4 32.2-32.1V320c0-35.2 28.8-64 64-64H289v447.8c0 70.4 57.6 128 128 128h255.1c-0.1 35.2-28.8 63.8-64 63.8H224.5c-35.2 0-64-28.8-64-64V703.5c0-17.7-14.4-32.1-32.2-32.1-17.8 0-32.3 14.4-32.3 32.1v128.3c0 70.4 57.6 128 128 128h384.1c70.4 0 128-57.6 128-128h65c70.4 0 128-57.6 128-128V255.9l-193-192z m0.1 63.4l127.7 128.3H800c-35.2 0-64-28.8-64-64v-64.3h0.2z m64 641H416.1c-35.2 0-64-28.8-64-64v-513c0-35.2 28.8-64 64-64H671V191c0 70.4 57.6 128 128 128h65.2v385.3c0 35.2-28.8 64-64 64z","p-id":"1667",fill:"currentColor"})]}),(0,s.jsx)("span",{className:"".concat(R().chatId),children:t.message_session_id.split("")})]})]}),(0,s.jsx)("div",{className:"".concat(R().timestamp),children:function(e){let t=new Date,s=new Date(1e3*e),n=s.getFullYear(),r=s.getMonth()+1,i=s.getDate(),o=s.getHours().toString().padStart(2,"0"),l=s.getMinutes().toString().padStart(2,"0"),c=t.toDateString()===s.toDateString(),d=new Date(t.setDate(t.getDate()-1)).toDateString()===s.toDateString(),u=t.getFullYear()===n;return c?"".concat(o,":").concat(l):d?"".concat(a("bots.yesterday")," ").concat(o,":").concat(l):u?a("bots.dateFormat",{month:r,day:i}):a("bots.earlier")}(t.timestamp)})]}),(0,s.jsx)("div",{className:"".concat(R().cardText),children:t.text}),t.images.length>0&&(0,s.jsx)(P.wy,{children:(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-3",children:t.images.map(e=>(0,s.jsx)("img",{src:"".concat(r,"/api/v1/files/image/").concat(e),alt:"",className:"max-w-xs rounded cursor-pointer hover:opacity-90 transition-opacity"},e))})})]})}var E=a(70133),Z=a(26009),D=a(39490),O=a(96873),z=a.n(O);function T(e){let{botId:t}=e,{t:a}=(0,p.Bd)(),r=(0,n.useRef)(new H(t)).current,[i,o]=(0,n.useState)([]),[l,c]=(0,n.useState)(!0),[d,h]=(0,n.useState)(["info","warning","error"]),m=(0,n.useRef)(null),x=(0,n.useRef)(i),b=[{value:"error",label:"ERROR"},{value:"warning",label:"WARNING"},{value:"info",label:"INFO"},{value:"debug",label:"DEBUG"}];(0,n.useEffect)(()=>(r.subscribeLogPush(f),r.loadFirstPage().then(e=>{o(e.reverse())}),m.current&&m.current.addEventListener("scroll",v),()=>{r.dispose(),m.current&&m.current.removeEventListener("scroll",v)}),[]),(0,n.useEffect)(()=>{x.current=i},[i]);let g=(0,n.useMemo)(()=>0===d.length?i:i.filter(e=>d.includes(e.level)),[i,d]);function f(e){o(e.reverse())}(0,n.useEffect)(()=>(l?r.startListenServerPush():r.stopServerPush(),()=>{r.stopServerPush()}),[l]);let v=(0,n.useCallback)(z()(()=>{if(!m.current)return;let{scrollTop:e,scrollHeight:t,clientHeight:a}=m.current,s=e+a>=t-5,n=0===e;if(s){c(!1);let e=x.current,t=e[e.length-1].seq_id;0!==t&&r.loadMore(t-1,10).then(t=>{o([...e,...t.reverse()])})}n&&c(!0),n||s||c(!1)},300),[i]);return(0,s.jsxs)("div",{className:"".concat(R().botLogListContainer),ref:m,children:[(0,s.jsxs)("div",{className:"".concat(R().listHeader),children:[(0,s.jsx)("div",{className:"mr-2",children:a("bots.enableAutoRefresh")}),(0,s.jsx)(u.d,{checked:l,onCheckedChange:e=>c(e)}),(0,s.jsx)("div",{className:"ml-4 mr-2",children:a("bots.logLevel")}),(0,s.jsxs)(E.AM,{children:[(0,s.jsx)(E.Wv,{asChild:!0,children:(0,s.jsxs)(j.$,{variant:"outline",size:"sm",className:"w-[180px] flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm truncate flex-1 text-left",children:0===d.length?a("bots.selectLevel"):d.length===b.length?a("bots.allLevels"):d.length>=3?"".concat(d.length," ").concat(a("bots.levelsSelected")):b.filter(e=>d.includes(e.value)).map(e=>e.label).join(", ")}),(0,s.jsx)(D.A,{className:"ml-2 h-4 w-4 flex-shrink-0"})]})}),(0,s.jsx)(E.hl,{className:"w-[180px] p-2",children:(0,s.jsx)("div",{className:"flex flex-col gap-2",children:b.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(Z.S,{id:e.value,checked:d.includes(e.value),onCheckedChange:()=>{var t;return t=e.value,void h(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}}),(0,s.jsx)("label",{htmlFor:e.value,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer",children:e.label})]},e.value))})})]})]}),g.map(e=>(0,s.jsx)(A,{botLog:e},e.seq_id))]})}function F(e){let{open:t,onOpenChange:a,botId:r,onFormSubmit:i,onFormCancel:o,onBotDeleted:l,onNewBotCreated:c}=e,{t:u}=(0,p.Bd)(),[h,m]=(0,n.useState)(r),[x,b]=(0,n.useState)("config"),[v,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{m(r),b("config")},[r,t]);let _=[{key:"config",label:u("bots.configuration"),icon:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M5 7C5 6.17157 5.67157 5.5 6.5 5.5C7.32843 5.5 8 6.17157 8 7C8 7.82843 7.32843 8.5 6.5 8.5C5.67157 8.5 5 7.82843 5 7ZM6.5 3.5C4.567 3.5 3 5.067 3 7C3 8.933 4.567 10.5 6.5 10.5C8.433 10.5 10 8.933 10 7C10 5.067 8.433 3.5 6.5 3.5ZM12 8H20V6H12V8ZM16 17C16 16.1716 16.6716 15.5 17.5 15.5C18.3284 15.5 19 16.1716 19 17C19 17.8284 18.3284 18.5 17.5 18.5C16.6716 18.5 16 17.8284 16 17ZM17.5 13.5C15.567 13.5 14 15.067 14 17C14 18.933 15.567 20.5 17.5 20.5C19.433 20.5 21 18.933 21 17C21 15.067 19.433 13.5 17.5 13.5ZM4 16V18H12V16H4Z"})})},{key:"logs",label:u("bots.logs"),icon:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M21 8V20.9932C21 21.5501 20.5552 22 20.0066 22H3.9934C3.44495 22 3 21.556 3 21.0082V2.9918C3 2.45531 3.4487 2 4.00221 2H14.9968L21 8ZM19 9H14V4H5V20H19V9ZM8 7H11V9H8V7ZM8 11H16V13H8V11ZM8 15H16V17H8V15Z"})})}],N=e=>{i(e)},w=()=>{o()},k=()=>{d.ok.deleteBot(null!=h?h:"").then(()=>{l()})},L=e=>{m(e),b("config"),c(e)};return h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.lG,{open:t,onOpenChange:a,children:(0,s.jsx)(g.Cf,{className:"overflow-hidden p-0 !max-w-[50rem] max-h-[75vh] flex",children:(0,s.jsxs)(f.GB,{className:"items-start w-full flex",children:[(0,s.jsx)(f.Bx,{collapsible:"none",className:"hidden md:flex h-[80vh] w-40 min-w-[120px] border-r bg-white dark:bg-black",children:(0,s.jsx)(f.Yv,{children:(0,s.jsx)(f.Cn,{children:(0,s.jsx)(f.rQ,{children:(0,s.jsx)(f.wZ,{children:_.map(e=>(0,s.jsx)(f.FX,{children:(0,s.jsx)(f.Uj,{asChild:!0,isActive:x===e.key,onClick:()=>b(e.key),children:(0,s.jsxs)("a",{href:"#",children:[e.icon,(0,s.jsx)("span",{children:e.label})]})})},e.key))})})})})}),(0,s.jsxs)("main",{className:"flex flex-1 flex-col h-[75vh]",children:[(0,s.jsx)(g.c7,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,s.jsx)(g.L3,{children:u("config"===x?"bots.editBot":"bots.botLogTitle")})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:["config"===x&&(0,s.jsx)(B,{initBotId:h,onFormSubmit:N,onBotDeleted:k,onNewBotCreated:L}),"logs"===x&&h&&(0,s.jsx)(T,{botId:h})]}),"config"===x&&(0,s.jsx)(g.Es,{className:"px-6 py-4 border-t shrink-0",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(j.$,{type:"button",variant:"destructive",onClick:()=>{C(!0)},children:u("common.delete")}),(0,s.jsx)(j.$,{type:"submit",form:"bot-form",children:u("common.save")}),(0,s.jsx)(j.$,{type:"button",variant:"outline",onClick:w,children:u("common.cancel")})]})})]})]})})}),(0,s.jsx)(g.lG,{open:v,onOpenChange:C,children:(0,s.jsxs)(g.Cf,{children:[(0,s.jsx)(g.c7,{children:(0,s.jsx)(g.L3,{children:u("common.confirmDelete")})}),(0,s.jsx)("div",{className:"py-4",children:u("bots.deleteConfirmation")}),(0,s.jsxs)(g.Es,{children:[(0,s.jsx)(j.$,{variant:"outline",onClick:()=>C(!1),children:u("common.cancel")}),(0,s.jsx)(j.$,{variant:"destructive",onClick:()=>{k(),C(!1)},children:u("common.confirmDelete")})]})]})})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(g.lG,{open:t,onOpenChange:a,children:(0,s.jsx)(g.Cf,{className:"overflow-hidden p-0 !max-w-[40vw] max-h-[70vh] flex",children:(0,s.jsxs)("main",{className:"flex flex-1 flex-col h-[70vh]",children:[(0,s.jsx)(g.c7,{className:"px-6 pt-6 pb-4 shrink-0",children:(0,s.jsx)(g.L3,{children:u("bots.createBot")})}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:(0,s.jsx)(B,{initBotId:void 0,onFormSubmit:N,onBotDeleted:k,onNewBotCreated:L})}),(0,s.jsx)(g.Es,{className:"px-6 py-4 border-t shrink-0",children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(j.$,{type:"submit",form:"bot-form",children:u("common.submit")}),(0,s.jsx)(j.$,{type:"button",variant:"outline",onClick:w,children:u("common.cancel")})]})})]})})})})}function U(){let{t:e}=(0,p.Bd)(),[t,a]=(0,n.useState)(!1),[r,l]=(0,n.useState)([]),[c,u]=(0,n.useState)("");async function g(){let t=(await d.ok.getAdapters()).adapters.map(e=>({label:(0,b.Z)(e.label),value:e.name}));d.ok.getBots().then(e=>{l(e.bots.map(e=>{var a;return new o({id:e.uuid||"",iconURL:d.ok.getAdapterIconURL(e.adapter),name:e.name,description:e.description,adapter:e.adapter,adapterConfig:e.adapter_config,adapterLabel:(null==(a=t.find(t=>t.value===e.adapter))?void 0:a.label)||e.adapter.substring(0,10),usePipelineName:e.use_pipeline_name||"",enable:e.enable||!1})}))}).catch(t=>{console.error("get bot list error",t),h.oR.error(e("bots.getBotListError")+t.msg)})}return(0,n.useEffect)(()=>{g()},[]),(0,s.jsxs)("div",{children:[(0,s.jsx)(F,{open:t,onOpenChange:a,botId:c||void 0,onFormSubmit:function(){g()},onFormCancel:function(){a(!1)},onBotDeleted:function(){g(),a(!1)},onNewBotCreated:function(e){g(),u(e)}}),(0,s.jsxs)("div",{className:"".concat(i().botListContainer),children:[(0,s.jsx)(x.A,{width:"100%",height:"10rem",plusSize:"90px",onClick:function(){u(""),a(!0)}}),r.map(e=>(0,s.jsx)("div",{onClick:()=>{u(e.id),a(!0)},children:(0,s.jsx)(m,{botCardVO:e,setBotEnableCallback:(e,t)=>{l(r.map(a=>a.id===e?{...a,enable:t}:a))}})},e.id))]})]})}},24959:e=>{e.exports={botLogListContainer:"botLog_botLogListContainer__M_RAw",botLogCardContainer:"botLog_botLogCardContainer__jPxQh",listHeader:"botLog_listHeader__P1B5c",tag:"botLog_tag__evYY1",chatTag:"botLog_chatTag__0FbI3",chatId:"botLog_chatId__gdFg7",cardTitleContainer:"botLog_cardTitleContainer__s9VnW",cardText:"botLog_cardText__97tJL",timestamp:"botLog_timestamp__FLSU6"}},38449:e=>{e.exports={cardContainer:"botCard_cardContainer__4SfCX",iconBasicInfoContainer:"botCard_iconBasicInfoContainer__Q0J6Z",iconImage:"botCard_iconImage__gNQ8J",basicInfoContainer:"botCard_basicInfoContainer__aCgVJ",basicInfoNameContainer:"botCard_basicInfoNameContainer__yOqEd",basicInfoName:"botCard_basicInfoName__OghZA",basicInfoDescription:"botCard_basicInfoDescription__44Rw5",basicInfoAdapterContainer:"botCard_basicInfoAdapterContainer__7T2go",basicInfoAdapterIcon:"botCard_basicInfoAdapterIcon__27SBz",basicInfoAdapterLabel:"botCard_basicInfoAdapterLabel__UgoPr",basicInfoPipelineContainer:"botCard_basicInfoPipelineContainer__GSo5Y",basicInfoPipelineIcon:"botCard_basicInfoPipelineIcon__7GePd",basicInfoPipelineLabel:"botCard_basicInfoPipelineLabel__twgII",bigText:"botCard_bigText__b2p_W",botOperationContainer:"botCard_botOperationContainer__Erox_"}},41021:e=>{e.exports={botListContainer:"botConfig_botListContainer__9q0La"}},49318:(e,t,a)=>{"use strict";a.d(t,{GG:()=>r,HL:()=>n,wY:()=>i});var s=a(95557);class n{constructor(e){this.id=e.id,this.name=e.name,this.default=e.default,this.label=e.label,this.required=e.required,this.type=e.type,this.description=e.description,this.options=e.options}}function r(e){return Object.values(s.P).includes(e)?e:s.P.UNKNOWN}function i(e){return e.reduce((e,t)=>(e[t.name]=t.default,e),{})}},70133:(e,t,a)=>{"use strict";a.d(t,{AM:()=>i,Wv:()=>o,hl:()=>l});var s=a(88629);a(5329);var n=a(31407),r=a(91573);function i(e){let{...t}=e;return(0,s.jsx)(n.bL,{"data-slot":"popover",...t})}function o(e){let{...t}=e;return(0,s.jsx)(n.l9,{"data-slot":"popover-trigger",...t})}function l(e){let{className:t,align:a="center",sideOffset:i=4,...o}=e;return(0,s.jsx)(n.ZL,{children:(0,s.jsx)(n.UC,{"data-slot":"popover-content",align:a,sideOffset:i,className:(0,r.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...o})})}},77191:(e,t,a)=>{Promise.resolve().then(a.bind(a,12745))}},e=>{e.O(0,[381,5,987,116,606,785,283,204,441,409,48,905,472,139,422,247,358],()=>e(e.s=77191)),_N_E=e.O()}]);