(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[706],{13253:(e,s,c)=>{"use strict";c.d(s,{A:()=>a});let a={src:"/_next/static/media/langbot-logo.d39c63cb.webp",height:548,width:548,blurDataURL:"data:image/webp;base64,UklGRo4AAABXRUJQVlA4WAoAAAAQAAAABwAABwAAQUxQSCEAAAABFyCQTfwBjtvSiIg4UNC2DdOzDVchlvQ4RPQ/rwwecwUAVlA4IEYAAAAwAgCdASoIAAgAAkA4JagCdLoB+AARBZAOAAD9/MCN7aAgcMp825f73rnMdYpgESQZf/jepb3yns/Oz/8K62cm2o9qEAAA",blurWidth:8,blurHeight:8}},52438:(e,s,c)=>{"use strict";var a=c(96202);c.o(a,"usePathname")&&c.d(s,{usePathname:function(){return a.usePathname}}),c.o(a,"useRouter")&&c.d(s,{useRouter:function(){return a.useRouter}}),c.o(a,"useSearchParams")&&c.d(s,{useSearchParams:function(){return a.useSearchParams}})},80106:(e,s,c)=>{Promise.resolve().then(c.bind(c,93232))},80170:(e,s,c)=>{"use strict";c.d(s,{A:()=>a});let a=(0,c(22668).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},93232:(e,s,c)=>{"use strict";c.r(s),c.d(s,{default:()=>S});var a=c(88629),t=c(5329),r=c(52438),n=c(52959),o=c(44001),l=c(47925),i=c(80170),m=c(22668);let u=(0,m.A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),d=(0,m.A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var h=c(96947),g=c(16076),p=c(85702),x=c(13253);function A(){let e=(0,r.useRouter)(),s=(0,r.useSearchParams)(),{t:c}=(0,l.Bd)(),[m,A]=(0,t.useState)("loading"),[f,S]=(0,t.useState)(""),[k,w]=(0,t.useState)(!1),[b,y]=(0,t.useState)(null),[j,N]=(0,t.useState)(!1),[C,E]=(0,t.useState)(""),L=(0,t.useCallback)(async s=>{try{let a=await n.ok.exchangeSpaceOAuthCode(s);localStorage.setItem("token",a.token),a.user&&localStorage.setItem("userEmail",a.user),A("success"),o.oR.success(c("common.spaceLoginSuccess")),setTimeout(()=>{e.push("/home")},1e3)}catch(e){A("error"),((null==e?void 0:e.msg)||"").toLowerCase().includes("account email mismatch")?S(c("account.spaceEmailMismatch")):S(c("common.spaceLoginFailed"))}},[e,c]),[v,R]=(0,t.useState)(null),B=(0,t.useCallback)(async(s,a)=>{N(!0);try{let t=await n.ok.bindSpaceAccount(s,a);localStorage.setItem("token",t.token),t.user&&localStorage.setItem("userEmail",t.user),A("success"),o.oR.success(c("account.bindSpaceSuccess")),setTimeout(()=>{e.push("/home")},1e3)}catch(e){A("error"),((null==e?void 0:e.msg)||"").toLowerCase().includes("account email mismatch")?S(c("account.spaceEmailMismatch")):S(c("account.bindSpaceFailed"))}finally{N(!1)}},[e,c]);return(0,t.useEffect)(()=>{let e=s.get("code"),a=s.get("error"),t=s.get("error_description"),r=s.get("mode"),n=s.get("state");if(a){A("error"),S(t||a||c("common.spaceLoginFailed"));return}if(!e){A("error"),S(c("common.spaceLoginNoCode"));return}if(y(e),"bind"===r){if(!n){A("error"),S(c("account.bindSpaceInvalidState"));return}R(n),w(!0),E(localStorage.getItem("userEmail")||""),A("confirm")}else L(e)},[s,L,c]),(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-neutral-900",children:(0,a.jsxs)(g.Zp,{className:"w-[400px] shadow-lg dark:shadow-white/10",children:[(0,a.jsxs)(g.aR,{className:"text-center",children:[(0,a.jsx)("img",{src:x.A.src,alt:"LangBot",className:"w-16 h-16 mb-4 mx-auto"}),(0,a.jsxs)(g.ZB,{className:"text-xl",children:["loading"===m&&c("common.spaceLoginProcessing"),"confirm"===m&&c("account.bindSpaceConfirmTitle"),"success"===m&&(k?c("account.bindSpaceSuccess"):c("common.spaceLoginSuccess")),"error"===m&&(k?c("account.bindSpaceFailed"):c("common.spaceLoginError"))]}),(0,a.jsxs)(g.BT,{children:["loading"===m&&c("common.spaceLoginProcessingDescription"),"confirm"===m&&c("account.bindSpaceConfirmDescription"),"success"===m&&c("common.spaceLoginSuccessDescription"),"error"===m&&f]})]}),(0,a.jsxs)(g.Wu,{className:"flex flex-col items-center space-y-4",children:["loading"===m&&(0,a.jsx)(i.A,{className:"h-12 w-12 animate-spin text-primary"}),"confirm"===m&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{className:"h-12 w-12 text-yellow-500"}),(0,a.jsx)("p",{className:"text-sm text-center text-muted-foreground px-4",children:c("account.bindSpaceWarning",{localEmail:C||"-"})}),(0,a.jsxs)("div",{className:"flex gap-3 w-full",children:[(0,a.jsx)(p.$,{variant:"outline",className:"flex-1",onClick:()=>{e.push("/home")},disabled:j,children:c("common.cancel")}),(0,a.jsxs)(p.$,{className:"flex-1",onClick:()=>{b&&v&&B(b,v)},disabled:j,children:[j?(0,a.jsx)(i.A,{className:"mr-2 h-4 w-4 animate-spin"}):null,c("common.confirm")]})]})]}),"success"===m&&(0,a.jsx)(d,{className:"h-12 w-12 text-green-500"}),"error"===m&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.A,{className:"h-12 w-12 text-red-500"}),(0,a.jsx)(p.$,{onClick:()=>e.push(k?"/home":"/login"),className:"w-full mt-4",children:k?c("common.backToHome"):c("common.backToLogin")})]})]})]})})}function f(){return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-neutral-900",children:(0,a.jsx)(g.Zp,{className:"w-[400px] shadow-lg dark:shadow-white/10",children:(0,a.jsx)(g.Wu,{className:"flex flex-col items-center py-12",children:(0,a.jsx)(i.A,{className:"h-12 w-12 animate-spin text-primary"})})})})}function S(){return(0,a.jsx)(t.Suspense,{fallback:(0,a.jsx)(f,{}),children:(0,a.jsx)(A,{})})}},96947:(e,s,c)=>{"use strict";c.d(s,{A:()=>a});let a=(0,c(22668).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])}},e=>{e.O(0,[5,987,409,422,247,358],()=>e(e.s=80106)),_N_E=e.O()}]);