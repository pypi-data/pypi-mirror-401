[build-system]
requires = [
  "hatchling>=1.9",
  "hatch-vcs>=0.5",
  ]
build-backend = "hatchling.build"

[project]
name = "geoPFA"
dynamic = ["version"]
description = "Geothermal Play Fairway Analysis"
readme = "README.md"
authors = [
  {name = "Nicole Taverna", email = "Nicole.Taverna@nrel.gov"},
  {name = "Scott Mello", email = "Scott.Mello@nrel.gov"},
  {name = "Guilherme Castelao", email = "gpimenta@nrel.gov"},
  {name = "Dylan Hettinger", email = "Dylan.Hettinger@nrel.gov"},
  {name = "Karthik Menon", email = "Karthik.Menon@nrel.gov"},
  {name = "Emily Holt", email = "Emily.Holt@nrel.gov"}
  ]
maintainers = [
  {name = "Nicole Taverna", email = "Nicole.Taverna@nrel.gov"}
  ]
license = "BSD-3-Clause"
keywords=["geothermal", "PFA"]
requires-python = ">= 3.11"
classifiers=[
        "Development Status :: 3 - Alpha",
        "Intended Audience :: Science/Research",
        "Natural Language :: English",
        "Programming Language :: Python :: 3.11",
        "Programming Language :: Python :: 3.12",
        "Programming Language :: Python :: 3.13",
        "Programming Language :: Python :: 3.14",
    ]
dependencies = [
  "iapws>=1.5.4",
  "matplotlib>=3.0",
  "notebook",
  "numpy>=1.21.6",
  "pandas>=2.0",
  "psutil>=6.1.0",
  "pyarrow>=20.0",
  "pooch>=1.8",
  "geopandas>=0.14.4",
  "rasterio>=1.4.2",
  "shapely>=2.0.6",
  "scipy>=1.11",
  "contextily>=1.6.2",
  "pathos>=0.3.3",
  "pykrige>=1.7",
  "gpy>=1.13.2",
  "statsmodels>=0.14",
  "tqdm>=4.67",
]
[project.optional-dependencies]
dev = [
  "ipython>=8.29.0",
  "twine>=5.1",
  "pre-commit>=4.0",
]
doc = [
  "ghp-import>=2.1",
  "numpydoc>=1.6",
  "make>=0.1",
  "myst-parser>=3.0.1",
  "pandoc>=2.3",
  "pydata-sphinx-theme>=0.15",
  "sphinx>=8.1.3,<9",
  "sphinx-click>=5.1",
  "sphinx-copybutton>=0.5",
  "sphinx-tabs>=3.4",
]
test = [
  "pytest>=7.0",
  "pytest-cases>=3.8.6,<4",
  "pytest-cov>=3.0",
  "pytest-profiling>=1.7.0,<2",
  "pytest-xdist>=3.0",
  "tox>=4.0",
  "hypothesis>=6.0",
]

[project.urls]
homepage = "https://github.com/NREL/geoPFA"
documentation = "https://github.com/NREL/geoPFA"
repository = "https://github.com/NREL/geoPFA"

[tool.hatch.build.hooks.vcs]
version-file = "geopfa/_version.py"

[tool.hatch.build.targets.wheel]
packages = ["geopfa"]

[tool.hatch.version]
source = "vcs"
tag-pattern = "v(?P<version>\\d+\\.\\d+\\.\\d+)"
fallback-version = "0.0.0"

[tool.pixi.workspace]
channels = ["conda-forge"]
platforms = ["osx-arm64", "linux-64", "win-64"]

[tool.pixi.feature.doc.tasks]
python-docs = { cmd = "make html", cwd = "docs"}

[tool.pixi.feature.build.tasks]
build-wheels = { cmd = "uv build --sdist --wheel --out-dir dist/ ." }
publish-pypi = { cmd = "uv publish", depends-on = ["build-wheels"] }

[tool.pixi.feature.test.tasks]
python-tests = "pytest --durations=20 -rapP -vv --cov=geopfa --cov-report=html --cov-branch --cov-report=xml:coverage.xml --cov-fail-under=8 tests"

[tool.pixi.environments]
default = { solve-group = "default" }
build = { features = ["build"], solve-group = "default" }
dev = { features = ["build", "dev", "doc", "test"], solve-group = "default" }
doc = { features = ["doc"], solve-group = "default" }
test = { features = ["test"], solve-group = "default" }

[tool.pixi.pypi-dependencies]
geoPFA = { path = ".", editable = true }

[tool.pixi.dependencies]
contextily = "==1.6.2"
gdal = ">=3.10.2,<4"
geopandas = ">=0.14.4,<2"
jupyterlab = ">=4.3.4,<5"
iapws = "==1.5.4"
matplotlib = ">=3.10.7,<4"
numpy = ">=1.21.6,<2"
pandas = ">=2.3.3,<3"
pathos = "==0.3.3"
pyarrow = ">=21.0.0,<22"
pykrige = ">=1.7.1,<2"
pooch = ">=1.8.2,<2"
psutil = "==6.1.0"
rasterio = "==1.4.2"
scipy = ">=1.11,<=1.12.0"
shapely = ">=2.1.0,<3"
statsmodels = ">=0.14.6,<0.15"
tqdm = ">=4.67.1,<5"

[tool.pixi.feature.build.dependencies]
uv = ">=0.7.22,<0.8"

[tool.pixi.feature.doc.dependencies]
sphinx = ">=8.2.3,<9"
myst-parser = ">=4.0.1,<5"
make = ">=4.4.1,<5"

[tool.pixi.feature.test.dependencies]
pylint = ">=3.3.3,<4"
pytest = ">=8.3.4,<9"
pytest-cov = ">=7.0.0,<8"
hypothesis = ">=6.129.3,<7"

[tool.pixi.feature.dev.dependencies]
ipython = "==8.29.0"
pre-commit = ">=4.0.1,<5"
ruff = ">=0.9.2,<0.10"
uv = ">=0.7.6,<0.8"

[tool.ruff]
line-length = 79

[tool.ruff.format]
quote-style = "double"
indent-style = "space"
exclude = ["geopfa/geopfa2d/*", "geopfa/geopfa3d/*"]

[tool.ruff.lint]
preview = true
select = [
  "A", # flake8-builtins
  "B", # flake8-bugbear
  "ARG", # flake8-unused-arguments
  "BLE", # flake8-blind-except
  "C4", # flake8-comprehensions
  "C90", # mccabe
  "COM", # flake8-commas
  "D", # pydocstyle
  "E", # pycodestyle
  "EM", # flake8-errmsg
  "F", # Pyflakes
  "FURB", # refurb
  "FLY", #  flynt
  "G", # flake8-logging-format
  "I", # isort
  "INP", # flake8-no-pep420
  "ISC", # flake8-implicit-str-concat
  "LOG", # flake8-logging
  "N", # pep8-naming
  "NPY", # numpy-specific
  "PD", # pandas-vet
  "PERF", # Perflint
  "PIE", # flake8-pie
  "PL", # Pylint
  "PTH", # flake8-use-pathlib
  "PYI", # flake8-pyi
  "Q", # flake8-quotes
  "RET", # flake8-return
  "RSE", # flake8-raise
  "RUF", # Ruff-specific rules
  "S", # flake8-bandit
  "SLF", # flake8-self
  "SIM", # flake8-simplify
  "TID", # flake8-tidy-imports (absolute imports)
  "TRY", # tryceratops
  "UP", # pyupgrade
  "W", # Warning
  ]
ignore = [
  "A001", # Shadowing built-in
  "ARG004",  # Unused argument
  "B904",  # Use of assert
  "B905",  # Use of assert
  "BLE001",  # Using bare except
  "C901",  # McCabe complexity
  "COM812",  # Missing trailing comma
  "D200",  # One-line docstring should fit on one line with quotes
  "D205",  # 1 blank line required between summary line and description
  "D400",  # First line should end with a period
  "D401",  # First line should be in imperative mood
  "D406",  # Section name should end with a newline
  "D407",
  "D202",
  "D209",
  "D210",
  "D409",  # Section underline should match the length of its name
  "D410",  # Missing blank line after section
  "D411",  # Missing blank line before section
  "E226",  # Missing whitespace around arithmetic operator
  "E231",  # Missing whitespace after ','
  "E402",  # Module level import not at top of file
  "E501",  # Line too long
  "E702",  # Multiple statements on one line
  "EM101", # Exception must not use a string literal
  "EM102", # Exception must not use an f-string literal, assign to variable firs
  "F401",  # Unused import
  "F811",  # Redefinition of unused
  "F841",  # Unused variable
  "I001",  # isort found an import in the wrong position
  "N803",
  "N806",
  "N805",
  "N999",
  "PTH103",
  "PTH110",
  "PTH120",
  "RET504",
  "Q000",  # Single quote
  "S101", # Use of assert
  "TRY003",
  "UP038", # Use `X | Y` in `isinstance` call instead of `(X, Y)`
  "W505",  # Doc line too long
]

[tool.ruff.lint.extend-per-file-ignores]
"geopfa/geopfa3d/*" = ["D", "E", "FURB", "N", "Q", "PD", "PERF", "PL", "PTH", "RET", "RUF", "SIM", "TRY", "UP009", "W"]
"geopfa/geopfa2d/*" = ["D", "E", "FURB", "N", "Q", "PD", "PERF", "PL", "PTH", "RET", "RUF", "SIM", "TRY", "UP009", "W"]
"geopfa/processing.py" = [
  "E722", # bare except
  "PD008", # Use `.loc` instead of `.at`.
  "PERF203", # `try`-`except` within a loop incurs performance overhead
  "PERF401", # Use `list.extend` to create a transformed list
  "PLR0912", # too-many-branches
  "PLR0913", # too-many-arguments
  "PLR0914", # too-many-locals
  "PLR0917", # too-many-positional-arguments
  "PLR1702", # too-many-nested-blocks
  "PLR0915", # too-many-statements
  "PLW2901", # `for` loop variable `group` overwritten by assignment target
  "PLR6201", # Use a set literal when testing for membership
  "FURB118", # Use `operator.itemgetter(0, 1)` instead of defining a function
  "PLR2004", # Magic value used in comparison, consider using a constant variable
  "RUF059", # Unpacked variable `dists` is never used
  "PLR0904",
  ]
"geopfa/geopfa3d/plotters.py" = [
  "F821", # Undefined name `MultiLineString`
  "S110", # `try`-`except`-`pass` detected, consider logging the exception
  ]
"geopfa/data_readers.py" = [
  "PLR2004", # Magic value used in comparison, consider using a constant variable
  "PD901", # Avoid using the generic variable name `df` for DataFrames
  "PLR0912", # Too many branches (15 > 12)
  "RUF100",
  "PLR0913", # Too many arguments in function definition (15 > 5)
  ]
"tests/*py" = ["D"]

[tool.ruff.lint.pycodestyle]
max-doc-length = 72

[tool.ruff.lint.pydocstyle]
convention = "numpy"

[tool.coverage.run]
branch = true

[tool.coverage.report]
# Regexes for lines to exclude from consideration
exclude_also = [
]

omit = [
    # omit test files
    "tests/*",
    # omit init files
    "__init__.py",
    # omit version file
    "_version.py",
    # omit pixi files
    ".pixi/*",
]

[tool.pytest.ini_options]
addopts = "--cov=geopfa --cov-report=html --cov-report=xml:coverage.xml --disable-warnings --cov-fail-under=8.0"
testpaths = [
    "tests",
]
