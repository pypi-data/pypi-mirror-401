(()=>{var E=(n,e)=>()=>(n&&(e=n(n=0)),e);var Ee=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);function u(n,e="info"){let t="showStatusMessage";console.log(`${t}: Displaying message (Type: ${e}): "${n}"`);let o=document.getElementById("status-message-area");if(!o){console.warn(`${t}: Element '#status-message-area' not found. Falling back to standard alert.`),alert(`${e.toUpperCase()}: ${n}`);return}o.className=`message-box message-${e}`,o.textContent=n,o.style.transition="",o.style.opacity="1";let r=Date.now()+Math.random();o.dataset.currentMessageId=r,console.debug(`${t}: Set message content and visibility for messageId ${r}.`),setTimeout(()=>{o.dataset.currentMessageId===String(r)?(console.debug(`${t}: Initiating fade-out for messageId ${r} ("${n}").`),o.style.transition="opacity 0.5s ease-out",o.style.opacity="0",setTimeout(()=>{o.dataset.currentMessageId===String(r)&&o.style.opacity==="0"?(console.debug(`${t}: Clearing content for messageId ${r} after fade.`),o.textContent="",o.className="message-box",o.style.transition="",delete o.dataset.currentMessageId):console.debug(`${t}: Aborting final clear for messageId ${r} - message changed or fade interrupted.`)},500)):console.debug(`${t}: Aborting fade-out for messageId ${r} - a newer message was displayed.`)},5e3)}async function h(n,e,t="POST",o=null,r=null,i=!1){let s="sendServerActionRequest";console.debug(`${s}: Initiating request - Server: '${n||"N/A"}', Path: '${e}', Method: ${t}, SuppressSuccess: ${i}`),o&&console.debug(`${s}: Request Body:`,o),r&&console.debug(`${s}: Associated Button:`,r);let d;if(/^(?:[a-z]+:)?\/\//i.test(e))d=e,console.debug(`${s}: Using absolute URL: ${d}`);else if(e.startsWith("/"))d=e,console.debug(`${s}: Using absolute URL: ${d}`);else if(n&&n.trim())d=`/api/server/${n}/${e}`,console.debug(`${s}: Using relative URL for server '${n}': ${d}`);else{let l="Invalid arguments: 'serverName' is required for relative action paths.";return console.error(`${s}: ${l}`),u(l,"error"),r&&(r.disabled=!1),!1}console.debug(`${s}: Preparing fetch request to ${d} (Method: ${t})`),r&&(console.debug(`${s}: Disabling button.`),r.disabled=!0),i||u(`Processing action at ${d}...`,"info");let v={method:t.toUpperCase(),headers:{Accept:"application/json"}},g=localStorage.getItem("jwt_token");g?(v.headers.Authorization=`Bearer ${g}`,console.debug(`${s}: Added JWT to Authorization header.`)):console.debug(`${s}: No JWT found in localStorage.`);let y=["POST","PUT","PATCH","DELETE"].includes(v.method);if(o&&y)try{v.body=JSON.stringify(o),v.headers["Content-Type"]="application/json",console.debug(`${s}: Added JSON body and Content-Type header.`)}catch(l){let m=`Failed to stringify request body: ${l.message}`;return console.error(`${s}: ${m}`,o),u(m,"error"),r&&(r.disabled=!1),!1}else o&&!y?console.warn(`${s}: Body provided for HTTP method '${v.method}' which typically does not support it. Body ignored.`):console.debug(`${s}: No request body provided or method does not support it.`);let a=null,c=!1;try{console.debug(`${s}: Executing fetch(${d}, ...)`);let l=await fetch(d,v);if(console.log(`${s}: Response received - Status: ${l.status}, OK: ${l.ok}`),c=l.ok,l.status===204)console.log(`${s}: Received 204 No Content. Treating as success.`),a={status:"success",message:`Action at ${d} successful (No Content).`};else{let m=l.headers.get("content-type");if(console.debug(`${s}: Response Content-Type: ${m}`),m&&m.includes("application/json"))console.debug(`${s}: Parsing JSON response body...`),a=await l.json(),console.debug(`${s}: Parsed JSON response:`,a);else{console.debug(`${s}: Response not JSON. Reading as text...`);let b=await l.text();if(console.warn(`${s}: Received non-JSON response (Status: ${l.status}). Body (truncated): ${b.substring(0,500)}`),!c)a={status:"error",message:`Request failed (Status ${l.status}): ${b.substring(0,200)}${b.length>200?"...":""}`},console.debug(`${s}: Created error object from text response.`);else{let p=`Request to ${d} succeeded (Status ${l.status}) but returned unexpected content type: ${m}. Check server logs.`;return console.warn(`${s}: ${p}`),u(p,"warning"),!1}}}if(c){if(console.debug(`${s}: HTTP request successful (Status: ${l.status}). Checking application status in response...`),a&&a.status==="success"){let m=a.message||`Action at ${d} completed successfully.`;console.info(`${s}: Application success. Message: "${m}"`),i||u(m,"success")}else if(a&&a.status==="confirm_needed")console.info(`${s}: Application status 'confirm_needed'. Returning data for confirmation handling.`);else if(e!=="/api/account"&&e!=="/api/themes"){let m=a?.status||"unknown",b=a?.message||`Action at ${d} reported status: ${m}.`;console.warn(`${s}: HTTP success but application status is '${m}'. Message: ${b}`),u(b,"warning")}}else{let m=a?.message||`Request failed with status ${l.status}`;if(console.error(`${s}: HTTP Error - Status: ${l.status}, Message: "${m}"`),l.status===400&&a?.errors&&typeof a.errors=="object"){u(m||"Validation failed. Please check fields.","error");let b=document.getElementById("validation-error-area"),p=[];Object.entries(a.errors).forEach(([w,S])=>{let $=document.querySelector(`.validation-error[data-field="${w}"]`);$?$.textContent=S:p.push(`<strong>${w}:</strong> ${S}`)}),b&&p.length>0&&(b.innerHTML=p.join("<br>"))}else if(l.status===400&&m.toLowerCase().includes("csrf token")){let b="Security token error. Please refresh the page and try again.";console.error(`${s}: CSRF Token Error detected.`),u(b,"error")}else u(m,"error");return!1}}catch(l){let m=`Network or processing error during action at ${d}: ${l.message}`;return console.error(`${s}: Fetch failed - ${m}`,l),u(m,"error"),r&&(r.disabled=!1),!1}finally{console.debug(`${s}: Finally block executing. httpSuccess=${c}, responseData.status=${a?.status}`),r&&(a?.status!=="confirm_needed"?r.disabled?(console.debug(`${s}: Re-enabling button in finally block.`),r.disabled=!1):console.debug(`${s}: Button was already enabled in finally block.`):console.debug(`${s}: Button remains disabled due to 'confirm_needed' status.`))}return console.debug(`${s}: Returning response data object (or false if HTTP error occurred):`,a),c?a:!1}var k=E(()=>{});function T(){let n="getSelectedServer";console.debug(`${n}: Attempting to get selected server from #server-select dropdown.`);let e=document.getElementById("server-select");if(!e){let o="Internal page error: Server selection dropdown element ('#server-select') not found.";return console.error(`${n}: ${o}`),u(o,"error"),null}let t=e.value;if(console.debug(`${n}: Value from dropdown: "${t}"`),!t||t===""){let o="Please select a server from the dropdown list first.";return console.warn(`${n}: ${o}`),u(o,"warning"),null}return console.debug(`${n}: Returning selected server name: '${t}'`),t}function _(n){let e="startServer";console.log(`${e}: Action triggered.`),console.debug(`${e}: Button Element:`,n);let t=T();if(t){let o="start",r="POST";console.log(`${e}: Attempting to start server '${t}' via API call to ${o}...`),h(t,o,r,null,n),console.log(`${e}: API request initiated for '${t}' (asynchronous).`)}else console.warn(`${e}: Action aborted because no server was selected.`)}function R(n){let e="stopServer";console.log(`${e}: Action triggered.`),console.debug(`${e}: Button Element:`,n);let t=T();if(t){let o="stop",r="POST";console.log(`${e}: Attempting to stop server '${t}' via API call to ${o}...`),h(t,o,r,null,n),console.log(`${e}: API request initiated for '${t}' (asynchronous).`)}else console.warn(`${e}: Action aborted because no server was selected.`)}function q(n){let e="restartServer";console.log(`${e}: Action triggered.`),console.debug(`${e}: Button Element:`,n);let t=T();if(t){let o="restart",r="POST";console.log(`${e}: Attempting to restart server '${t}' via API call to ${o}...`),h(t,o,r,null,n),console.log(`${e}: API request initiated for '${t}' (asynchronous).`)}else console.warn(`${e}: Action aborted because no server was selected.`)}function U(n){let e="promptCommand";console.log(`${e}: Action triggered.`),console.debug(`${e}: Button Element:`,n);let t=T();if(!t){console.warn(`${e}: Action aborted because no server was selected.`);return}console.debug(`${e}: Prompting user for command input for server '${t}'.`);let o=prompt(`Enter command to send to server '${t}':`);if(o===null){console.log(`${e}: Command input cancelled by user.`),u("Command input cancelled.","info");return}let r=o.trim();if(console.debug(`${e}: User entered command: "${o}", Trimmed: "${r}"`),r===""){console.warn(`${e}: Command is empty after trimming.`),u("Command cannot be empty.","warning");return}let i="send_command",s="POST",d={command:r};console.debug(`${e}: Constructed request body:`,d),console.log(`${e}: Attempting to send command '${r}' to server '${t}' via API call to ${i}...`),h(t,i,s,d,n),console.log(`${e}: API request initiated for '${t}' (asynchronous).`)}function O(n,e){let t="deleteServer";if(console.log(`${t}: Action triggered for server: '${e}'`),console.debug(`${t}: Button Element:`,n),!e||typeof e!="string"||!e.trim()){let i="Internal error: Server name is missing or invalid for delete action.";console.error(`${t}: ${i}`),u(i,"error");return}let o=e.trim();console.debug(`${t}: Prompting user for delete confirmation for server '${o}'.`);let r=`Are you absolutely sure you want to delete ALL data for server '${o}'?

This includes installation, configuration, and backups and cannot be undone!`;confirm(r)?(console.log(`${t}: Deletion confirmed by user for '${o}'. Sending API request...`),h(o,"delete","DELETE",null,n),console.log(`${t}: API request initiated for '${o}' (asynchronous).`)):(console.log(`${t}: Deletion cancelled by user for '${o}'.`),u("Deletion cancelled.","info"))}function F(n,e){let t="triggerServerUpdate";if(console.log(`${t}: Action triggered for server: '${e}'`),console.debug(`${t}: Button Element:`,n),!e||typeof e!="string"||!e.trim()){let s="Internal error: Server name is missing or invalid for update action.";console.error(`${t}: ${s}`),u(s,"error");return}let o=e.trim(),r="update",i="POST";console.log(`${t}: Attempting to update server '${o}' via API call to ${r}...`),h(o,r,i,null,n),console.log(`${t}: API request initiated for '${o}' (asynchronous).`)}var B=E(()=>{k()});var x,ke,I,A=E(()=>{x=class{constructor(){this.socket=null,this.connectionState="disconnected",this.useFallback=!1,this.pendingSubscriptions=[]}async connect(){if(this.socket||this.connectionState==="connecting"){console.log("WebSocketClient.connect(): Connection attempt already in progress or established.");return}if(this.useFallback){console.log("WebSocketClient.connect(): Fallback is active, not attempting to connect.");return}console.log("WebSocketClient.connect(): Attempting to establish connection..."),this.connectionState="connecting";let e=window.location.protocol==="https:"?"wss":"ws",t=localStorage.getItem("jwt_token");if(!t){console.warn("WebSocketClient.connect(): JWT token not found in localStorage. Attempting to refresh token...");try{let r=await fetch("/auth/refresh-token");if(r.ok){let i=await r.json();i.access_token&&(t=i.access_token,localStorage.setItem("jwt_token",t),console.log("WebSocketClient.connect(): Token refreshed successfully."))}else console.warn(`WebSocketClient.connect(): Failed to refresh token. Status: ${r.status}`)}catch(r){console.error("WebSocketClient.connect(): Error refreshing token:",r)}}if(!t){console.error("WebSocketClient.connect(): JWT token not found or recoverable. Cannot authenticate."),this.handleConnectionFailure();return}let o=`${e}://${window.location.host}/ws?token=${encodeURIComponent(t)}`;console.log(`WebSocketClient.connect(): Connecting to ${o}`);try{this.socket=new WebSocket(o)}catch(r){console.error("WebSocketClient.connect(): WebSocket initialization failed:",r),this.handleConnectionFailure();return}this.socket.onopen=()=>{console.log("WebSocketClient.onopen: Connection established successfully."),this.connectionState="connected",this.pendingSubscriptions.forEach(r=>this.subscribe(r)),this.pendingSubscriptions=[]},this.socket.onclose=r=>{console.log(`WebSocketClient.onclose: Connection closed. Code: ${r.code}, Reason: "${r.reason}", Clean: ${r.wasClean}`),this.connectionState="disconnected",this.socket=null,r.wasClean?this.useFallback=!0:this.handleConnectionFailure()},this.socket.onerror=r=>{console.error("WebSocketClient.onerror: An error occurred with the WebSocket.",r),this.handleConnectionFailure()},this.socket.onmessage=r=>{try{let i=JSON.parse(r.data),s=new CustomEvent("websocket-message",{detail:i});document.dispatchEvent(s)}catch(i){console.error("Failed to parse WebSocket message:",i)}}}handleConnectionFailure(){this.useFallback||(console.warn("WebSocketClient.handleConnectionFailure(): WebSocket connection failed. Activating fallback."),this.connectionState="disconnected",this.useFallback=!0,this.socket=null,document.dispatchEvent(new CustomEvent("websocket-fallback")))}sendMessage(e){this.connectionState!=="connected"||!this.socket||this.socket.send(JSON.stringify(e))}subscribe(e){if(this.connectionState!=="connected"){this.pendingSubscriptions.includes(e)||this.pendingSubscriptions.push(e);return}this.sendMessage({action:"subscribe",topic:e})}unsubscribe(e){this.sendMessage({action:"unsubscribe",topic:e})}shouldUseFallback(){return this.useFallback}isConnected(){return this.connectionState==="connected"}isConnecting(){return this.connectionState==="connecting"}},ke=new x,I=ke});function D(){let n="DashboardManager";console.log(`${n}: Initializing all dashboard interactivity.`);let e=6e4,t=document.getElementById("server-select"),o=document.querySelectorAll(".server-selection-section .action-buttons-group button"),r=document.querySelectorAll(".server-dependent-actions"),i=document.getElementById("server-card-list"),s=document.getElementById("no-servers-message"),d=null;if(!t||!i||!s){if(console.error(`${n}: A critical element for the dashboard is missing. Functionality may be impaired.`),typeof u=="function")u("Dashboard Error: Critical page elements missing.","error");else{let c=document.querySelector("body");c&&c.insertAdjacentHTML("afterbegin",'<p style="color:red; text-align:center; padding:10px; background:lightyellow; border:1px solid red;">Critical Dashboard Error: Page elements missing.</p>')}return}function f(c){let l=c&&c!=="",m=l?encodeURIComponent(c):"";o.forEach(b=>b.disabled=!l),r.forEach(b=>{let p=b.querySelector('span[id^="selected-server-"]'),w=b.querySelectorAll(".action-button, .action-link");p&&(p.textContent=l?c:"(No server selected)",p.style.fontStyle=l?"normal":"italic"),w.forEach(S=>{if(S.disabled=!l,S.tagName==="A"&&S.id&&l){let $="#";switch(S.id){case"config-link-properties":$=`/server/${m}/configure_properties`;break;case"config-link-allowlist":$=`/server/${m}/configure_allowlist`;break;case"config-link-permissions":$=`/server/${m}/configure_permissions`;break;case"config-link-monitor":$=`/server/${m}/monitor`;break;case"config-link-service":$=`/server/${m}/configure_service`;break;case"task-scheduler-menu":$=`/server/${m}/scheduler`;break;case"content-link-world":$=`/server/${m}/install_world`;break;case"content-link-addon":$=`/server/${m}/install_addon`;break;case"backup-link-menu":$=`/server/${m}/backup`;break;case"restore-link-menu":$=`/server/${m}/restore`;break;default:console.warn(`${n}: No URL map for link ID '${S.id}'.`),$="#";break}S.href=$}else S.tagName==="A"&&!l&&(S.href="#")})})}function v(c){let l=document.createElement("div");l.className="server-card",l.dataset.serverName=c.name;let m=encodeURIComponent(c.name),b=c.status||"UNKNOWN",p=c.version||"N/A";return l.innerHTML=`
        <div class="server-card-thumbnail">
            <img src="/api/server/${m}/world/icon" alt="${c.name} World Icon" class="world-icon-img">
        </div>
        <div class="server-card-info">
            <h3>${c.name}</h3>
            <p><span class="info-label">Status:</span> <span class="status-text status-${b.toLowerCase()}">${b.toUpperCase()}</span></p>
            <p><span class="info-label">Version:</span> <span class="version-text">${p}</span></p>
            <p><span class="info-label">Players:</span> <span class="player-count-text">${c.player_count}</span></p>
        </div>
        <div class="server-card-actions">
            <a href="/servers/${m}/settings" class="action-link" title="Server Settings">Settings</a>
        </div>`,l}function g(c){let l=t.value;if(t.innerHTML="",c.length===0){let m=new Option("-- No Servers Installed --","");m.disabled=!0,t.add(m),t.disabled=!0,t.title="No servers available"}else t.add(new Option("-- Select a Server --","")),c.forEach(m=>t.add(new Option(m.name,m.name))),t.disabled=!1,t.title="Select a server";t.value=l,t.value!==l&&t.dispatchEvent(new Event("change"))}async function y(){try{let c=await h(null,"/api/servers","GET",null,null,!0);if(!c||c.status!=="success"||!Array.isArray(c.servers)){console.warn(`${n}: API call to /api/servers did not return success or valid server data. Message:`,c?.message),typeof u=="function"&&!(c&&c.message&&c.status==="error")&&u("Failed to update dashboard: Could not retrieve server list.","warning");return}let l=c.servers,m=new Map(l.map(w=>[w.name,w])),b=i.querySelectorAll(".server-card"),p=new Set(Array.from(b).map(w=>w.dataset.serverName));b.forEach(w=>{let S=w.dataset.serverName;if(m.has(S)){let $=m.get(S),C=encodeURIComponent($.name),N=$.status||"UNKNOWN",Se=$.version||"N/A";w.innerHTML=`
                    <div class="server-card-thumbnail">
                        <img src="/api/server/${C}/world/icon" alt="${$.name} World Icon" class="world-icon-img">
                    </div>
                    <div class="server-card-info">
                        <h3>${$.name}</h3>
                        <p><span class="info-label">Status:</span> <span class="status-text status-${N.toLowerCase()}">${N.toUpperCase()}</span></p>
                        <p><span class="info-label">Version:</span> <span class="version-text">${Se}</span></p>
                        <p><span class="info-label">Players:</span> <span class="player-count-text">${$.player_count}</span></p>
                    </div>
                    <div class="server-card-actions">
                        <a href="/servers/${C}/settings" class="action-link" title="Server Settings">Settings</a>
                    </div>`}else w.remove()}),l.forEach(w=>{p.has(w.name)||i.appendChild(v(w))}),g(l),s.style.display=l.length===0?"block":"none"}catch(c){console.error(`${n}: Client-side error during dashboard update:`,c),typeof u=="function"&&u(`Dashboard update error: ${c.message}`,"error")}}function a(){let c=["event:after_server_statuses_updated","event:after_server_start","event:after_server_stop","event:after_delete_server_data","event:after_server_updated"];document.addEventListener("websocket-message",m=>{let b=m.detail;b&&b.topic&&c.includes(b.topic)&&(console.log(`${n}: Received relevant WebSocket event on topic '${b.topic}'. Refreshing dashboard.`),y())});let l=()=>{d||(console.warn(`${n}: Starting polling (fallback).`),d=setInterval(y,e),console.log(`${n}: Polling started as a fallback.`))};I.shouldUseFallback()?l():(document.addEventListener("websocket-fallback",()=>{l()}),c.forEach(m=>I.subscribe(m)))}t.addEventListener("change",c=>{f(c.target.value)}),document.getElementById("start-server-btn")?.addEventListener("click",c=>_(c.currentTarget)),document.getElementById("stop-server-btn")?.addEventListener("click",c=>R(c.currentTarget)),document.getElementById("restart-server-btn")?.addEventListener("click",c=>q(c.currentTarget)),document.getElementById("prompt-command-btn")?.addEventListener("click",c=>U(c.currentTarget)),document.getElementById("update-server-btn")?.addEventListener("click",c=>F(c.currentTarget,t.value)),document.getElementById("delete-server-btn")?.addEventListener("click",c=>O(c.currentTarget,t.value)),y(),a(),console.log(`${n}: Initialization complete.`)}var z=E(()=>{k();B();A()});function Ie(){h(null,"/api/account","GET",null,null,!0).then(n=>{n&&(document.getElementById("full_name").value=n.full_name||"",document.getElementById("email").value=n.email||"")})}function Ce(){let n=document.getElementById("change-password-form"),e=n.elements.current_password.value,t=n.elements.new_password.value,o=n.elements.confirm_new_password.value;if(t!==o){u("New passwords do not match.","error");return}h(null,"/api/account/change-password","POST",{current_password:e,new_password:t}).then(i=>{i&&i.status==="success"&&n.reset()})}function Ae(){let n=document.getElementById("profile-form"),e=n.elements.full_name.value,t=n.elements.email.value;h(null,"/api/account/profile","POST",{full_name:e,email:t})}function W(){Ie();let n=document.getElementById("theme-select");n&&(h(null,"/api/themes","GET",null,null,!0).then(i=>{i&&Object.keys(i).forEach(d=>{let f=document.createElement("option");f.value=d,f.textContent=d.charAt(0).toUpperCase()+d.slice(1),n.appendChild(f)});let s=n.dataset.currentTheme;s&&(n.value=s)}),n.addEventListener("change",async i=>{let s=i.target.value,d=document.getElementById("theme-stylesheet");if(d){let f=await h(null,"/api/themes","GET",null,null,!0);f&&(d.href=f[s])}await h(null,"/api/account/theme","POST",{theme:s},null)}));let e=document.querySelectorAll(".sidebar-nav .nav-link"),t=document.querySelectorAll(".main-content .content-section");e.forEach(i=>{i.addEventListener("click",s=>{if(!i.getAttribute("data-target"))return;s.preventDefault();let d=i.getAttribute("data-target");e.forEach(v=>v.classList.remove("active")),t.forEach(v=>v.classList.remove("active")),i.classList.add("active");let f=document.getElementById(d);f&&f.classList.add("active")})});let o=document.getElementById("change-password-form");o&&o.addEventListener("submit",i=>{i.preventDefault(),Ce()});let r=document.getElementById("profile-form");r&&r.addEventListener("submit",i=>{i.preventDefault(),Ae()})}var H=E(()=>{k()});function j(){let n="AllowlistManager";console.log(`${n}: Initializing allowlist page.`);let e=document.querySelector("p[data-server-name]"),t=null;if(e&&e.dataset.serverName)t=e.dataset.serverName,console.log(`${n}: Found server name: '${t}'`);else{console.error(`${n}: Could not find server name.`),u("Critical page error: Could not determine server context.","error");return}async function o(f){let v="addAllowlistPlayers";console.log(`${v}: Initiated. Server: ${t}`),console.debug(`${v}: Button Element:`,f);let g=document.getElementById("player-names-add"),y=document.getElementById("ignore-limit-add");if(!g||!y){let p="Required 'add player' form elements not found.";console.error(`${v}: ${p}`),u(`Internal page error: ${p}`,"error");return}let c=g.value.split(`
`).map(p=>p.trim()).filter(p=>p.length>0);if(c.length===0){let p="No player names entered.";console.warn(`${v}: ${p}`),u(p,"warning");return}let l=y.checked,b=await h(t,"allowlist/add","POST",{players:c,ignoresPlayerLimit:l},f);if(b&&b.status==="success"){let p=b.message||"Players processed.";u(p,"success"),g.value="",await r()}}async function r(){let f="fetchAndUpdateAllowlistDisplay";console.log(`${f}: Initiating for server: ${t}`);let v=document.getElementById("current-allowlist-display");if(!v){console.error(`${f}: Target display element not found.`),u("Internal page error: Allowlist display area not found.","error");return}v.innerHTML="<li><i>Loading allowlist...</i></li>";try{let g=await h(t,"allowlist/get","GET",null,null,!0);if(v.innerHTML="",g&&g.status==="success"&&Array.isArray(g.players)){let y=g.players;y.length>0?y.forEach(a=>{let c=document.createElement("li");c.className="allowlist-player-item",c.innerHTML=`
                            <span class="player-name">${a.name||"Unnamed Player"}</span>
                            <span class="player-meta"> (Ignores Limit: ${a.ignoresPlayerLimit?"Yes":"No"})</span>
                        `;let l=document.createElement("button");l.type="button",l.textContent="Remove",l.className="action-button remove-button danger-button",l.title=`Remove ${a.name||"this player"}`,a.name?l.dataset.playerName=a.name:l.disabled=!0,c.appendChild(l),v.appendChild(c)}):v.innerHTML="<li><i>No players currently in allowlist.</i></li>"}else{let y=`Could not refresh allowlist: ${g.message||"API returned an error."}`;u(y,"error")}}catch(g){console.error(`${f}: Unexpected error:`,g),u(`Client-side error updating allowlist: ${g.message}`,"error"),v.innerHTML='<li><i style="color: red;">Error updating display.</i></li>'}}async function i(f,v){if(!confirm(`Are you sure you want to remove '${v}' from the allowlist?`)){u("Player removal cancelled.","info");return}let y=await h(t,"allowlist/remove","DELETE",{players:[v]},f);y&&y.status==="success"&&(await r(),u(y.message||`Player ${v} processed.`,"success"))}let s=document.getElementById("add-allowlist-players-btn");s&&s.addEventListener("click",()=>o(s));let d=document.getElementById("current-allowlist-display");d&&d.addEventListener("click",f=>{let v=f.target;v.classList.contains("remove-button")&&v.dataset.playerName&&i(v,v.dataset.playerName)}),r()}var G=E(()=>{k()});function V(){let n=document.getElementById("login-form");n&&n.addEventListener("submit",e=>{e.preventDefault();let t=n.querySelector('button[type="submit"]');Te(t)})}async function Te(n){let e="handleLoginAttempt";console.log(`${e}: Initiated.`);let t=document.getElementById("username"),o=document.getElementById("password");if(!t||!o){console.error(`${e}: Login form elements not found.`),u("Internal page error: Login form elements missing.","error");return}let r=t.value.trim(),i=o.value;if(!r){u("Username is required.","warning"),t.focus();return}if(!i){u("Password is required.","warning"),o.focus();return}n&&(n.disabled=!0),u("Attempting login...","info");let s=new FormData;s.append("username",r),s.append("password",i);try{let d=await fetch("/auth/token",{method:"POST",body:s,headers:{Accept:"application/json"}}),f=await d.json();if(d.ok&&f.access_token){f.access_token&&localStorage.setItem("jwt_token",f.access_token),u(f.message||"Login successful! Redirecting...","success");let v=new URLSearchParams(window.location.search).get("next");setTimeout(()=>{window.location.href=v||"/"},500)}else{let v=f.detail||f.message||"Login failed.";u(v,"error"),o&&(o.value=""),n&&(n.disabled=!1)}}catch(d){let f=`Network or processing error during login: ${d.message}`;u(f,"error"),o&&(o.value=""),n&&(n.disabled=!1)}}var J=E(()=>{k()});function Q(n,e,t){if(console.log(`triggerBackup: Initiated. Server: '${e}', Type: '${t}'`),t==="all"){let s=`Perform a full backup (world + config) for server '${e}'?`;if(!confirm(s)){u("Full backup cancelled.","info");return}}let r={backup_type:t},i=`/api/server/${e}/backup/action`;h(null,i,"POST",r,n)}function M(n,e,t){if(console.log(`triggerSpecificConfigBackup: Initiated. Server: '${e}', File: '${t}'`),!t||!t.trim()){u("Internal error: No filename provided.","error");return}let r={backup_type:"config",file_to_backup:t.trim()},i=`/api/server/${e}/backup/action`;h(null,i,"POST",r,n)}function Pe(n,e,t,o){if(console.log(`triggerRestore: Initiated. Server: '${e}', Type: '${t}', File: '${o}'`),!o||!o.trim()){u("Internal error: No backup file path provided.","error");return}let s=`Are you sure you want to restore backup '${o.trim().split(/[\\/]/).pop()}' for server '${e}'? This will OVERWRITE current data!`;if(!confirm(s)){u("Restore operation cancelled.","info");return}let d={restore_type:t.toLowerCase(),backup_file:o.trim()},f=`/api/server/${e}/restore/action`;h(null,f,"POST",d,n)}function Le(n,e){console.log(`triggerRestoreAll: Initiated for server: '${e}'`);let o=`Are you sure you want to restore ALL latest backups for server '${e}'? This will OVERWRITE current world and configuration files!`;if(!confirm(o)){u("Restore All operation cancelled.","info");return}let r={restore_type:"all",backup_file:null},i=`/api/server/${e}/restore/action`;h(null,i,"POST",r,n)}async function P(n,e,t){let o="handleSelectBackupType";console.log(`${o}: Initiated for server '${e}', type '${t}'.`);let r={restore_type:t},i=`/api/server/${e}/restore/select_backup_type`;try{let s=await h(null,i,"POST",r,n);s&&s.status==="success"&&s.redirect_url?window.location.href=s.redirect_url:s&&s.message&&u(s.message,s.status==="success"?"success":"error")}catch(s){console.error(`${o}: Unexpected error: ${s.message}`,s),u("An unexpected error occurred.","error"),n&&(n.disabled=!1)}}function Z(){console.log("Backup/Restore page script loaded.");let e=document.getElementById("backup-restore-page")?.dataset.serverName;document.getElementById("backup-world-btn")?.addEventListener("click",t=>Q(t.currentTarget,e,"world")),document.getElementById("backup-all-btn")?.addEventListener("click",t=>Q(t.currentTarget,e,"all")),document.getElementById("select-world-backup-btn")?.addEventListener("click",t=>P(t.currentTarget,e,"world")),document.getElementById("select-properties-backup-btn")?.addEventListener("click",t=>P(t.currentTarget,e,"properties")),document.getElementById("select-allowlist-backup-btn")?.addEventListener("click",t=>P(t.currentTarget,e,"allowlist")),document.getElementById("select-permissions-backup-btn")?.addEventListener("click",t=>P(t.currentTarget,e,"permissions")),document.getElementById("restore-all-btn")?.addEventListener("click",t=>Le(t.currentTarget,e)),document.getElementById("backup-allowlist-btn")?.addEventListener("click",t=>M(t.currentTarget,e,"allowlist.json")),document.getElementById("backup-permissions-btn")?.addEventListener("click",t=>M(t.currentTarget,e,"permissions.json")),document.getElementById("backup-properties-btn")?.addEventListener("click",t=>M(t.currentTarget,e,"server.properties")),document.querySelectorAll(".restore-backup-btn").forEach(t=>{t.addEventListener("click",o=>{let r=o.currentTarget,i=r.dataset.restoreType,s=r.dataset.backupPath;Pe(r,e,i,s)})})}var Y=E(()=>{k()});function xe(n,e,t){let r=`Install world '${t.split(/[\\/]/).pop()||t}' for server '${e}'?

WARNING: This will permanently REPLACE the current world data!`;if(!confirm(r)){u("World installation cancelled.","info");return}let i={filename:t},s=`/api/server/${e}/world/install`;h(null,s,"POST",i,n)}async function Me(n,e){let t=`/api/server/${e}/world/export`,o=await h(null,t,"POST",null,n);o&&o.status==="success"&&(u(o.message+" Refreshing list...","success"),setTimeout(()=>{window.location.reload()},2e3))}async function Ne(n,e){if(!confirm(`WARNING: Reset the current world for server '${e}'?`)){u("World reset cancelled.","info");return}let t=`/api/server/${e}/world/reset`;await h(null,t,"DELETE",null,n)}function _e(n,e,t){let r=`Install addon '${t.split(/[\\/]/).pop()||t}' for server '${e}'?`;if(!confirm(r)){u("Addon installation cancelled.","info");return}let i={filename:t},s=`/api/server/${e}/addon/install`;h(null,s,"POST",i,n)}function X(){console.log("Content management page script loaded.");let e=document.getElementById("content-management-page")?.dataset.serverName;document.getElementById("export-world-btn")?.addEventListener("click",t=>Me(t.currentTarget,e)),document.getElementById("reset-world-btn")?.addEventListener("click",t=>Ne(t.currentTarget,e)),document.querySelectorAll(".install-addon-btn").forEach(t=>{t.addEventListener("click",o=>{let r=o.currentTarget,i=r.dataset.addonPath;_e(r,e,i)})}),document.querySelectorAll(".import-world-btn").forEach(t=>{t.addEventListener("click",o=>{let r=o.currentTarget,i=r.dataset.worldPath;xe(r,e,i)})})}var K=E(()=>{k()});function L(){let n=document.getElementById("validation-error-area");n&&(n.innerHTML="",n.style.display="none"),document.querySelectorAll(".validation-error").forEach(e=>e.textContent="")}function ee(n){let e=n?.next_step_url,t=n?.message||"Server installed successfully!";e?(u(`${t} Proceeding to configuration...`,"success"),setTimeout(()=>window.location.href=e,1500)):u("Server installed, but next step URL is missing.","warning")}function qe(n,e){let t=setInterval(async()=>{try{let o=await fetch(`/api/tasks/status/${n}`);if(!o.ok){clearInterval(t),u(`Error checking task status: ${o.statusText}`,"error");return}let r=await o.json();r.status==="success"?(clearInterval(t),e?e(r.result):u(r.message||"Task completed successfully.","success")):r.status==="error"&&(clearInterval(t),u(`Task failed: ${r.message}`,"error"))}catch(o){clearInterval(t),u(`Error polling task status: ${o.message}`,"error")}},2e3)}function Ue(n,e){let t=`task:${n}`;console.log(`Monitoring task ${n} via WebSocket on topic ${t}`),I.subscribe(t);let o=i=>{let s=i.detail;if(!s||s.topic!==t)return;let d=s.data;d.status==="success"?(u(d.message||"Task completed successfully.","success"),e&&e(d.result),r()):d.status==="error"?(u(`Task failed: ${d.message}`,"error"),r()):d.message&&u(`Task in progress: ${d.message}`,"info")},r=()=>{console.log(`Cleaning up listener for task ${n}`),I.unsubscribe(t),document.removeEventListener("websocket-message",o)};document.addEventListener("websocket-message",o)}async function Oe(n){let e=document.getElementById("install-server-name"),t=document.getElementById("install-server-version"),o=e.value.trim(),r=t.value.trim()||"LATEST";if(!o)return u("Server name cannot be empty.","warning");if(!/^[a-zA-Z0-9_-]+$/.test(o))return u("Server name has invalid characters.","error");L();let i={server_name:o,server_version:r,overwrite:!1};r.toUpperCase()==="CUSTOM"&&(i.server_zip_path=document.getElementById("custom-zip-path").value);let s=f=>{I.shouldUseFallback()?(console.warn("WebSocket not available, falling back to polling for task monitoring."),qe(f.task_id,ee)):Ue(f.task_id,ee)},d=await h(null,"/api/server/install","POST",i,n);if(d)if(d.status==="confirm_needed")if(confirm(d.message)){let f=await h(null,"/api/server/install","POST",{...i,overwrite:!0},n);f&&f.status==="pending"&&s(f)}else u("Installation cancelled.","info"),n&&(n.disabled=!1);else d.status==="pending"&&s(d)}async function Fe(n,e,t){let o={};document.querySelectorAll('.properties-config-section .form-input, .properties-config-section .toggle-input, .properties-config-section input[type="hidden"]').forEach(s=>{s.name&&(s.type==="checkbox"&&s.classList.contains("toggle-input")?s.checked&&(o[s.name.replace("-cb","")]="true"):s.type==="hidden"?s.disabled||(o[s.name]=s.value):s.classList.contains("toggle-input")||(o[s.name]=s.value))}),L();let i=await h(null,`/api/server/${e}/properties/set`,"POST",{properties:o},n);if(i&&i.status==="success"){let s=i.message||"Properties saved.";t?(u(`${s} Proceeding to Allowlist...`,"success"),setTimeout(()=>window.location.href=`/server/${encodeURIComponent(e)}/configure_allowlist?new_install=True`,1500)):u(s,"success")}}async function De(){let n=document.getElementById("permissions-loader"),e=document.getElementById("permissions-table-body"),t=document.getElementById("install-config-page"),o=t?.dataset.serverName;if(!e||!o){console.error("Required elements for loading permissions not found.");return}try{let r=await h(o,"permissions/get","GET",null,null,!0);if(e.innerHTML="",r&&r.status==="success"&&r.data&&r.data.permissions&&Array.isArray(r.data.permissions)){let i=document.getElementById("player-row-template"),s=document.getElementById("no-players-row-template");if(r.data.permissions.length>0)r.data.permissions.forEach(d=>{let f=i.content.cloneNode(!0);f.querySelector(".player-name").textContent=d.name,f.querySelector(".player-xuid").textContent=d.xuid;let v=f.querySelector(".permission-select");v.dataset.xuid=d.xuid,v.value=d.permission_level,e.appendChild(f)});else{let d=s.content.cloneNode(!0);e.appendChild(d)}t&&(t.style.display="block")}else u(r?.message||"Failed to load permissions.","error")}catch(r){u(`Client-side error loading permissions: ${r.message}`,"error")}finally{n&&(n.style.display="none")}}async function ze(n,e,t){let o=Array.from(document.querySelectorAll("select.permission-select")).map(i=>({xuid:i.dataset.xuid,name:i.closest("tr").querySelector(".player-name").textContent.trim(),permission_level:i.value}));L();let r=await h(null,`/api/server/${e}/permissions/set`,"PUT",{permissions:o},n);if(r&&r.status==="success"){let i=r.message||"Permissions saved.";t?(u(`${i} Proceeding to Service Config...`,"success"),setTimeout(()=>window.location.href=`/server/${encodeURIComponent(e)}/configure_service?new_install=True`,1500)):u(i,"success")}}async function We(n,e,t,o){let r={autoupdate:document.getElementById("service-autoupdate-cb").checked,autostart:document.getElementById("service-autostart-cb").checked},i=o&&document.getElementById("service-start-server").checked;L();let s=await h(null,`/api/server/${e}/service/update`,"POST",r,n);if(s&&["success","success_with_warning"].includes(s.status)){let d=s.message||"Service settings saved.";if(i){u(`${d} Starting server...`,"info");let f=await h(e,"start","POST",null,n);f&&f.status==="success"?(u("Server started! Installation complete. Redirecting...","success"),setTimeout(()=>window.location.href="/",2e3)):u(`Settings saved, but server failed to start: ${f?.message||"Unknown error"}`,"warning")}else o?(u(`${d} Installation complete! Redirecting...`,"success"),setTimeout(()=>window.location.href="/",1500)):u(d,"success")}}async function te(n){let e=document.getElementById("custom-zip-selector-group"),t=document.getElementById("custom-zip-list"),o=document.getElementById("custom-zip-path");if(n.toUpperCase()==="CUSTOM"){e.style.display="block";let r=await h(null,"/api/downloads/list","GET",null,null,!0);t.innerHTML="",o.value="",r&&r.custom_zips&&r.custom_zips.length>0?r.custom_zips.forEach((i,s)=>{let d=`custom-zip-${s}`,f=document.createElement("div");f.classList.add("radio-item");let v=document.createElement("input");v.type="radio",v.id=d,v.name="custom-zip-selection",v.value=i,v.addEventListener("change",()=>{o.value=i});let g=document.createElement("label");g.htmlFor=d,g.textContent=i,f.appendChild(v),f.appendChild(g),t.appendChild(f),s===0&&(v.checked=!0,o.value=i)}):t.innerHTML="<p>No custom zips found in the downloads/custom directory.</p>"}else e.style.display="none",o.value=""}function ne(){console.log("Install/config page script loaded.");let n=document.getElementById("install-config-page"),e=n?.dataset.serverName,t=n?.dataset.isNewInstall==="true",o=n?.dataset.os,r=document.getElementById("install-server-version");if(r&&(r.addEventListener("input",g=>te(g.target.value)),te(r.value)),document.getElementById("install-server-btn")?.addEventListener("click",g=>Oe(g.currentTarget)),document.getElementById("save-permissions-btn")?.addEventListener("click",g=>ze(g.currentTarget,e,t)),document.getElementById("submit-properties-btn")?.addEventListener("click",g=>Fe(g.currentTarget,e,t)),document.getElementById("save-service-settings-btn")?.addEventListener("click",g=>We(g.currentTarget,e,o,t)),new URLSearchParams(window.location.search).has("in_setup")){let g=document.getElementById("setup-banner-container");g&&(g.innerHTML=`
            <div class="setup-banner">
                <h3>Step 3: Install a Server</h3>
                <p>
                    Install and configure your first Bedrock Server. This will include setting server.properties, allowlist, and other files.
                </p>
                <a href="/" class="action-button">Skip</a>
            </div>
        `)}document.querySelectorAll(".segmented-control").forEach(g=>{let y=document.getElementById(g.dataset.inputId);y&&g.querySelectorAll(".segment").forEach(a=>{a.addEventListener("click",c=>{c.preventDefault(),y.value=a.dataset.value,g.querySelectorAll(".segment").forEach(l=>l.classList.remove("active")),a.classList.add("active")})})}),document.querySelectorAll(".toggle-input").forEach(g=>{let y=g.closest(".form-group-toggle-container")?.querySelector(`.toggle-hidden-false[name="${g.name.replace("-cb","")}"]`);if(y){let a=()=>y.disabled=g.checked;g.addEventListener("change",a),a()}});let i=(g,y)=>{let a=document.getElementById(g);a&&(a.value=y)},s=(g,y)=>{let a=document.getElementById(g);a&&(a.checked=String(y).toLowerCase()==="true",a.dispatchEvent(new Event("change")))},d=(g,y)=>{let a=document.getElementById(g),c=document.querySelector(`[data-input-id="${g}"]`);if(a&&c){a.value=y,c.querySelectorAll(".segment").forEach(m=>m.classList.remove("active"));let l=c.querySelector(`.segment[data-value="${y}"]`);l&&l.classList.add("active")}};function f(g){let y={"server-name":{id:"server-name",type:"input"},"level-name":{id:"level-name",type:"input"},gamemode:{id:"gamemode-hidden",type:"segment"},difficulty:{id:"difficulty-hidden",type:"segment"},"allow-cheats":{id:"allow-cheats-cb",type:"toggle"},"max-players":{id:"max-players",type:"input"},"level-seed":{id:"level-seed",type:"input"},"server-port":{id:"server-port",type:"input"},"server-portv6":{id:"server-portv6",type:"input"},"enable-lan-visibility":{id:"enable-lan-visibility-cb",type:"toggle"},"allow-list":{id:"allow-list-cb",type:"toggle"},"default-player-permission-level":{id:"default-player-permission-level-hidden",type:"segment"},"view-distance":{id:"view-distance",type:"input"},"tick-distance":{id:"tick-distance",type:"input"},"online-mode":{id:"online-mode-cb",type:"toggle"},"texturepack-required":{id:"texturepack-required-cb",type:"toggle"}};for(let a in g)if(Object.prototype.hasOwnProperty.call(g,a)&&y[a]){let c=y[a],l=g[a];if(l===void 0)continue;switch(c.type){case"input":i(c.id,l);break;case"toggle":s(c.id,l);break;case"segment":d(c.id,l);break}}}async function v(){let g=document.getElementById("properties-loader"),y=document.getElementById("properties-form-container");try{let a=await h(e,"properties/get","GET",null,null);a&&a.status==="success"&&a.properties?(f(a.properties),y&&(y.style.display="block")):u(a?.message||"Failed to load server properties.","error")}catch(a){u(`Client-side error loading properties: ${a.message}`,"error")}finally{g&&(g.style.display="none")}}document.getElementById("properties-form-container")&&v(),document.getElementById("permissions-table-body")&&De()}var se=E(()=>{k();A()});function oe(){let n="PluginManagerUI",e=document.getElementById("plugin-list"),t=document.getElementById("plugin-item-template"),o=document.getElementById("no-plugins-template"),r=document.getElementById("load-error-template"),i=document.getElementById("plugin-loader"),s=document.getElementById("reload-plugins-btn");if(!e||!t||!o||!r||!i||!s){console.error(`${n}: Critical page elements missing.`),e&&(e.innerHTML="<li>Page setup error.</li>");return}if(new URLSearchParams(window.location.search).has("in_setup")){let y=document.getElementById("setup-banner-container");y&&(y.innerHTML=`
        <div class="setup-banner">
            <h3>Step 2: Plugin Management</h3>
            <p>
                Here you can manage plugins. Reload plugins to apply any changes.<br>
                <strong>Note:</strong> Any plugins that add new FastAPI routes (such as the content_uploader_plugin) will require a server restart to take effect.
            </p>
            <a href="/install?in_setup=true" class="action-button">Continue to Server Installation</a>
        </div>
      `)}s.addEventListener("click",f);async function f(){s.disabled=!0;let y=s.innerHTML;s.innerHTML='<div class="spinner-small"></div> Reloading...';try{let a=await h(null,"/api/plugins/reload","PUT",null,s);a&&a.status==="success"&&await v()}finally{s.innerHTML=y,s.disabled&&(s.disabled=!1)}}async function v(){i.style.display="flex",e.querySelectorAll("li:not(#plugin-loader)").forEach(y=>y.remove());try{let y=await h(null,"/api/plugins","GET",null,null,!0);if(i.style.display="none",y&&y.status==="success"){let a=y.data;a&&Object.keys(a).length>0?Object.keys(a).sort((c,l)=>c.toLowerCase().localeCompare(l.toLowerCase())).forEach(c=>{let l=a[c],m=t.content.cloneNode(!0);m.querySelector(".plugin-name").textContent=c,m.querySelector(".plugin-version").textContent=`v${l.version||"N/A"}`;let b=m.querySelector(".plugin-toggle-switch");b.checked=l.enabled,b.dataset.pluginName=c,b.addEventListener("change",g),e.appendChild(m)}):e.appendChild(o.content.cloneNode(!0))}else e.appendChild(r.content.cloneNode(!0))}catch(y){i.style.display="none",e.appendChild(r.content.cloneNode(!0)),u(`Unexpected error fetching plugin data: ${y.message}`,"error")}}async function g(y){let a=y.target,c=a.dataset.pluginName,l=a.checked,m=await h(null,`/api/plugins/${c}`,"POST",{enabled:l},a);(!m||m.status!=="success")&&(a.checked=!l)}v(),console.log(`${n}: Plugin management page initialized.`)}var re=E(()=>{k()});function ae(){let n=document.getElementById("settings-form-container"),e=document.getElementById("settings-sidebar"),t=document.getElementById("reload-settings-btn"),o=document.getElementById("settings-loader"),r=document.getElementById("settings-form-section");if(!r||!n||!e||!t||!o){console.error("manage_settings.js: Critical elements not found.");return}if(new URLSearchParams(window.location.search).has("in_setup")){let a=document.getElementById("setup-banner-container");a&&(a.innerHTML=`
        <div class="setup-banner">
            <h3>Step 1: Global Settings</h3>
            <p>
                Modify the global settings for your Bedrock Server Manager instance. Reload the settings after making changes to apply them.<br>
                <strong>Note:</strong> Some settings may require a server restart to take effect.
            </p>
            <a href="/plugins?in_setup=true" class="action-button">Continue to Plugin Setup</a>
        </div>
      `)}let s=a=>{o.style.display=a?"block":"none",r.style.display=a?"none":"block",a&&(n.innerHTML="",e.innerHTML="")},d=a=>{s(!1),r.style.display="none",u(a,"error")},f=a=>{n.innerHTML="",e.innerHTML="";let c=0;Object.keys(a).sort().forEach(l=>{if(typeof a[l]!="object"||a[l]===null)return;let m=document.createElement("fieldset");m.id=`category-${l}`;let b=document.createElement("legend");b.textContent=l.charAt(0).toUpperCase()+l.slice(1),m.appendChild(b);let p=document.createElement("a");p.href=`#category-${l}`,p.className="nav-link",p.textContent=b.textContent,p.addEventListener("click",S=>{S.preventDefault(),document.querySelectorAll(".settings-nav .nav-link").forEach($=>$.classList.remove("active")),p.classList.add("active"),m.scrollIntoView({behavior:"smooth"})}),e.appendChild(p);let w=0;Object.keys(a[l]).sort().forEach(S=>{let $=v(`${l}.${S}`,S,a[l][S]);$&&(m.appendChild($),w++)}),w>0&&(n.appendChild(m),c+=w)}),c===0&&d("No configurable settings.")},v=(a,c,l)=>{let m=document.createElement("div");m.className="form-group";let b=document.createElement("label");b.htmlFor=a,b.textContent=(c.charAt(0).toUpperCase()+c.slice(1)).replace(/_/g," ");let p;if(typeof l=="boolean"){m.classList.add("form-group-toggle-container"),p=document.createElement("input"),p.type="checkbox",p.checked=l,p.className="toggle-input";let w=document.createElement("label");w.htmlFor=a,w.className="toggle-switch",m.append(b,p,w)}else m.appendChild(b),p=document.createElement("input"),p.className="form-input",Array.isArray(l)?(p.type="text",p.value=l.join(", "),p.placeholder="comma, separated, list"):(p.type=typeof l=="number"?"number":"text",p.value=l),m.appendChild(p);return p.id=a,p.name=a,p.addEventListener("change",g),m};async function g(a){let c=a.target,l=c.type==="checkbox"?c.checked:c.type==="number"?parseFloat(c.value):c.value;c.placeholder==="comma, separated, list"&&(l=l.split(",").map(m=>m.trim()).filter(Boolean)),await h(null,"/api/settings","POST",{key:c.name,value:l},null)}t.addEventListener("click",async()=>{if(confirm("Discard unsaved changes and reload from file?")){let a=await h(null,"/api/settings/reload","POST",null,t);a&&a.status==="success"&&await y()}});let y=async()=>{s(!0);try{let a=await h(null,"/api/settings","GET",null,null,!0);a&&a.status==="success"&&a.settings?f(a.settings):d(a?.message||"Error loading settings.")}catch(a){d(`Client-side error: ${a.message}`)}finally{s(!1)}};y()}var ie=E(()=>{k()});function ce(){let n=document.getElementById("settings-form-container"),e=document.getElementById("settings-sidebar"),t=document.getElementById("settings-loader"),o=document.getElementById("settings-form-section");if(!o||!n||!e||!t){console.error("server_settings.js: Critical elements not found.");return}let i=(()=>{let a=window.location.pathname.split("/"),c=a.indexOf("servers")+1;return a.length>c?a[c]:null})();if(!i){d("Could not determine server name from URL.");return}let s=a=>{t.style.display=a?"block":"none",o.style.display=a?"none":"block",a&&(n.innerHTML="",e.innerHTML="")},d=a=>{s(!1),o.style.display="none",u(a,"error")},f=a=>{n.innerHTML="",e.innerHTML="";let c=0;["server_info","settings","custom"].forEach(m=>{if(!a.hasOwnProperty(m)||typeof a[m]!="object"||a[m]===null)return;let b=document.createElement("fieldset");b.id=`category-${m}`;let p=document.createElement("legend");p.textContent=m.charAt(0).toUpperCase()+m.slice(1),b.appendChild(p);let w=document.createElement("a");w.href=`#category-${m}`,w.className="nav-link",w.textContent=p.textContent,w.addEventListener("click",$=>{$.preventDefault(),document.querySelectorAll(".sidebar-nav .nav-link").forEach(C=>C.classList.remove("active")),w.classList.add("active"),b.scrollIntoView({behavior:"smooth"})}),e.appendChild(w);let S=0;Object.keys(a[m]).sort().forEach($=>{let C=v(`${m}.${$}`,$,a[m][$]);C&&(b.appendChild(C),S++)}),S>0&&(n.appendChild(b),c+=S)}),c===0&&d("No configurable settings found for this server.")},v=(a,c,l)=>{let m=document.createElement("div");m.className="form-group";let b=document.createElement("label");b.htmlFor=a,b.textContent=(c.charAt(0).toUpperCase()+c.slice(1)).replace(/_/g," ");let p;if(typeof l=="boolean"){m.classList.add("form-group-toggle-container"),p=document.createElement("input"),p.type="checkbox",p.checked=l,p.className="toggle-input";let w=document.createElement("label");w.htmlFor=a,w.className="toggle-switch",m.append(b,p,w)}else m.appendChild(b),p=document.createElement("input"),p.className="form-input",Array.isArray(l)?(p.type="text",p.value=l.join(", "),p.placeholder="comma, separated, list"):(p.type=typeof l=="number"?"number":"text",p.value=l),m.appendChild(p);return p.id=a,p.name=a,p.addEventListener("change",g),m};async function g(a){let c=a.target,l=c.type==="checkbox"?c.checked:c.type==="number"?parseFloat(c.value):c.value;c.placeholder==="comma, separated, list"&&(l=l.split(",").map(m=>m.trim()).filter(Boolean)),await h(null,`/api/servers/${i}/settings`,"POST",{key:c.name,value:l},null)}(async()=>{s(!0);try{let a=await h(null,`/api/servers/${i}/settings`,"GET",null,null,!0);a&&a.status==="success"&&a.settings?f(a.settings):d(a?.message||"Error loading server settings.")}catch(a){d(`Client-side error: ${a.message}`)}finally{s(!1)}})()}var le=E(()=>{k()});function de(){let n=document.getElementById("status-info");if(!n){console.error("Monitor page error: #status-info element not found.");return}let e=n.dataset.serverName;if(!e){n.textContent="Configuration Error: Server name missing.",u("Could not initialize monitoring: server name not found on page.","error");return}let t=null;function o(s){s?n.textContent=`
PID          : ${s.pid??"N/A"}
CPU Usage    : ${s.cpu_percent!=null?s.cpu_percent.toFixed(1)+"%":"N/A"}
Memory Usage : ${s.memory_mb!=null?s.memory_mb.toFixed(1)+" MB":"N/A"}
Uptime       : ${s.uptime??"N/A"}
            `.trim():n.textContent="Server Status: STOPPED or process info not found."}async function r(){try{let s=await fetch(`/api/server/${encodeURIComponent(e)}/process_info`);if(!s.ok)throw new Error(`API request failed with status ${s.status}`);let d=await s.json();d&&d.status==="success"?o(d.data?.process_info):d&&d.status==="error"?n.textContent=`Error: ${d.message||"API error."}`:o(null)}catch(s){n.textContent=`Client-side error: ${s.message}`,t&&clearInterval(t)}}function i(){let s=`resource-monitor:${e}`;document.addEventListener("websocket-message",f=>{let v=f.detail;if(v&&v.topic===s&&v.type==="resource_update"){let g=v.data?.process_info;o(g)}});let d=()=>{t||(console.warn("Monitor Page: Starting polling (fallback)."),r(),t=setInterval(r,2e3))};I.shouldUseFallback()?d():(document.addEventListener("websocket-fallback",()=>{d()}),I.shouldUseFallback()?d():I.subscribe(s))}i(),window.addEventListener("beforeunload",()=>{t&&clearInterval(t);let s=`resource-monitor:${e}`;I.unsubscribe(s)}),console.log(`Monitoring started for server: ${e}`)}var ue=E(()=>{k();A()});function me(){let n=document.querySelectorAll(".sidebar-nav .nav-link"),e=document.querySelectorAll(".main-content .content-section"),t=document.querySelectorAll(".sidebar-nav .has-submenu");if(n.length===0){console.warn("Sidebar navigation links not found.");return}function o(i){i.preventDefault();let s=i.currentTarget,d=s.dataset.target;if(!d)return;let f=document.getElementById(d);if(f){n.forEach(g=>g.classList.remove("active")),e.forEach(g=>g.classList.remove("active")),s.classList.add("active"),f.classList.add("active");let v=s.closest(".submenu");if(v){v.style.maxHeight=v.scrollHeight+"px";let g=v.previousElementSibling;g&&g.classList.contains("has-submenu")&&g.classList.add("active")}}}function r(i){i.preventDefault();let d=i.currentTarget.nextElementSibling;d&&d.classList.contains("submenu")&&(d.style.maxHeight=d.style.maxHeight?null:d.scrollHeight+"px")}n.forEach(i=>{i.dataset.target&&i.addEventListener("click",o)}),t.forEach(i=>{i.addEventListener("click",r)}),n.length>0&&n[0].dataset.target&&n[0].click(),console.log("Sidebar navigation initialized.")}var ge=E(()=>{});function pe(){let n=new URLSearchParams(window.location.search),e=n.get("message"),t=n.get("category");if(e){typeof u=="function"?u(e,t):console.warn("showStatusMessage function not found. Cannot display message from URL.");let o=new URL(window.location.href);o.searchParams.delete("message"),o.searchParams.delete("category"),window.history.replaceState({},document.title,o.toString())}}var fe=E(()=>{k()});function je(n){navigator.clipboard.writeText(n).then(()=>{alert("Copied to clipboard")},e=>{alert("Could not copy text: ",e)})}function Ge(){let n=document.getElementById("generate-token-form"),e=new FormData(n),t=Object.fromEntries(e.entries());h(null,"/register/generate-token","POST",t).then(o=>{o&&o.status==="success"&&(window.location.href=o.redirect_url)})}function Ve(n){confirm("Are you sure you want to disable this user?")&&h(null,`/users/${n}/disable`,"POST").then(e=>{e&&e.status==="success"&&window.location.reload()})}function Je(n){confirm("Are you sure you want to enable this user?")&&h(null,`/users/${n}/enable`,"POST").then(e=>{e&&e.status==="success"&&window.location.reload()})}function Qe(n){confirm("Are you sure you want to delete this user?")&&h(null,`/users/${n}/delete`,"POST").then(e=>{e&&e.status==="success"&&window.location.reload()})}function Ze(n){let t={role:document.getElementById(`role-${n}`).value};h(null,`/users/${n}/role`,"POST",t).then(o=>{o&&o.status==="success"&&window.location.reload()})}function ve(){document.getElementById("generate-token-btn")?.addEventListener("click",Ge),document.querySelectorAll(".copy-link-btn").forEach(n=>{n.addEventListener("click",e=>{je(e.currentTarget.dataset.link)})}),document.querySelectorAll(".update-role-btn").forEach(n=>{n.addEventListener("click",e=>{Ze(e.currentTarget.dataset.userId)})}),document.querySelectorAll(".disable-user-btn").forEach(n=>{n.addEventListener("click",e=>{Ve(e.currentTarget.dataset.userId)})}),document.querySelectorAll(".enable-user-btn").forEach(n=>{n.addEventListener("click",e=>{Je(e.currentTarget.dataset.userId)})}),document.querySelectorAll(".delete-user-btn").forEach(n=>{n.addEventListener("click",e=>{Qe(e.currentTarget.dataset.userId)})})}var he=E(()=>{k()});function Ye(){let n=document.getElementById("register-form"),e=document.getElementById("username").value,t=document.getElementById("password").value,o=document.getElementById("confirm_password").value;if(!e||!t||!o){u("All fields are required.","error");return}if(t!==o){u("Passwords do not match.","error");return}let r=new FormData(n),i=Object.fromEntries(r.entries()),s=document.getElementById("register-form").dataset.token;h(null,`/register/${s}`,"POST",i).then(d=>{d&&d.status==="success"&&(window.location.href=d.redirect_url)})}function ye(){let n=document.getElementById("register-form");n&&n.addEventListener("submit",e=>{e.preventDefault(),Ye()})}var be=E(()=>{k()});function Xe(){let n=document.getElementById("setup-form"),e=document.getElementById("username").value,t=document.getElementById("password").value,o=document.getElementById("confirm_password").value;if(!e||!t||!o){u("All fields are required.","error");return}if(t!==o){u("Passwords do not match.","error");return}let r=new FormData(n),i=Object.fromEntries(r.entries());h(null,"/setup/create-first-user","POST",i).then(s=>{s&&s.status==="success"&&(window.location.href=s.redirect_url)})}function we(){let n=document.getElementById("setup-form");n&&n.addEventListener("submit",e=>{e.preventDefault(),Xe()})}var $e=E(()=>{k()});var Ke=Ee(()=>{B();z();H();G();J();Y();K();se();re();ie();le();ue();ge();fe();he();be();$e();A();document.addEventListener("DOMContentLoaded",()=>{I.connect(),me(),pe(),document.getElementById("server-card-list")?D():document.getElementById("change-password-form")?W():document.getElementById("current-allowlist-display")?j():document.getElementById("login-form")?V():document.getElementById("backup-restore-page")?Z():document.getElementById("content-management-page")?X():document.getElementById("install-config-page")?ne():document.getElementById("plugin-list")?oe():document.getElementById("settings-form-container")?window.location.pathname.startsWith("/servers/")?ce():ae():document.getElementById("status-info")?de():document.getElementById("user-management-section")?ve():document.getElementById("register-form")?ye():document.getElementById("setup-form")&&we(),console.log("main.js loaded and initialized")})});Ke();})();
//# sourceMappingURL=bundle.js.map
