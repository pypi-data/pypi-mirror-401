{"version":3,"file":"main.datetime_GridElement.57525abbf530b9e94b93.js","mappings":"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","sources":["webpack://lino_react/./lino_react/react/components/datetime.jsx"],"sourcesContent":["export const name = \"datetime\";\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport * as constants from './constants';\nimport { LeafComponentInput } from \"./LinoComponentUtils\";\nimport { RegisterImportPool } from \"./Base\";\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nlet ex; const exModulePromises = ex = {\n    prCalendar: import(/* webpackChunkName: \"prCalendar_datetime\" */\"primereact/calendar\"),\n};RegisterImportPool(ex);\n\n\nclass DTFieldElement extends LeafComponentInput {\n    static requiredModules = [\"prCalendar\"].concat(LeafComponentInput.requiredModules);\n    static iPool = Object.assign(ex, LeafComponentInput.iPool.copy());\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            ...this.state,\n            key: this.c.newSlug().toString(),\n            blurFired: false,\n        };\n\n        this.getLinoInput = this.getLinoInput.bind(this);\n        this.getValue = this.getValue.bind(this);\n        this.innerHTML = this.innerHTML.bind(this);\n        this.isValid = this.isValid.bind(this);\n        this.updateValue = this.updateValue.bind(this);\n    }\n\n    getLinoInput(fieldProps={}) {\n        return <this.ex.prCalendar.Calendar\n            {...fieldProps}\n            autoFocus={!this.state.blurFired && this.leafIndexMatch()}\n            className={\"l-DateFieldElement\"}\n            inputMode={this.props.urlParams.controller.globals.isMobile ? 'numeric' : 'none'}\n            inputStyle={{width: \"100%\"}}\n            keepInvalid={true}\n            key={this.state.key}\n            onBlur={() => {\n                this.setState({key: this.c.newSlug().toString(), blurFired: true});\n                setTimeout(() => this.setState({blurFired: false}), 100);\n            }}\n            onChange={(e) => this.updateValue(e)}\n            onClearButtonClick={(e) => {e.value = null; this.updateValue(e)}}\n            // TODO: check if https://github.com/primefaces/primereact/commit/16eafe5a171154da63bbfa9d83f84827e9d8363f#\n            // is available on a packaged version\n            // onSelect={(e) => this.updateValue(e)}\n            ref={this.onInputRef}\n            showButtonBar={true}\n            showIcon={this.props[constants.URL_PARAM_WINDOW_TYPE] !== constants.WINDOW_TYPE_TABLE}\n            showOnFocus={false}\n            style={{width: \"100%\"}}\n            tabIndex={this.props.tabIndex}\n            value={this.getValue()}/>\n    }\n\n    getValue() {\n        let v = super.getValue();\n        if (!this.props.urlParams.controller.filled(v)) return null;\n        return this.str2date(v);\n    }\n\n    innerHTML = () => (<div>{super.getValue() || \"\\u00a0\"}</div>);\n\n    isValid = (v) => (\n        v === null || v instanceof Date || this.str2date(v) instanceof Date);\n\n    updateValue(e) {\n        let value = e.value;\n        if (!this.props.urlParams.controller.filled(value)) value = null\n        else if (value instanceof Date) value = this.date2str(value);\n\n        this.container.classList.remove('dangling-modification');\n        this.container.classList.remove('unsaved-modification');\n\n        if (this.isValid(value)) {\n            this.update({[this.dataKey]: value});\n            this.setCellStyle(this.container, false);\n        } else this.container.classList.add('dangling-modification');\n    }\n}\n\n\nexport class DateFieldElement extends DTFieldElement {\n    constructor(props) {\n        super(props);\n        this.date2str = this.date2str.bind(this);\n        this.getLinoInput = this.getLinoInput.bind(this);\n        this.str2date = this.str2date.bind(this);\n    }\n\n    date2str(date) {\n        return (\"0\" + date.getDate()).slice(-2) + \".\" +\n            (\"0\" + (date.getMonth() + 1)).slice(-2) + \".\" +\n            date.getFullYear();\n    }\n\n    getLinoInput = () => super.getLinoInput({\n        dateFormat: \"dd.mm.yy\", yearNavigator: true, yearRange: \"1900:2900\"});\n\n    str2date(value) {\n        let parts = value.split(\".\");\n        if (parts.length === 3 && !parts.includes(\"\") && parts[2].length === 4)\n            return new Date(parts[2], parts[1] - 1, parts[0]);\n        return false;\n    }\n}\n\n\nexport class TimeFieldElement extends DTFieldElement {\n    constructor(props) {\n        super(props);\n        this.date2str = this.date2str.bind(this);\n        this.getLinoInput = this.getLinoInput.bind(this);\n        this.str2date = this.str2date.bind(this);\n    }\n\n    date2str(date) {\n        return (\"0\" + date.getHours()).slice(-2) + \":\" +\n            (\"0\" + date.getMinutes()).slice(-2);\n    }\n\n    getLinoInput = () => super.getLinoInput(\n        {hourFormat: '24', showTime: true, timeOnly: true});\n\n    str2date(timeStr) {\n        let regex = /^(\\d(?:\\d(?=[.,:; ]?\\d\\d|[.,:; ]\\d|$))?)?[.,:; ]?(\\d{0,2})$/g;\n        if (timeStr.match(regex)) {\n            let m = regex.exec(timeStr),\n                viewDate = new Date(),\n                hours = m[1],\n                min = m[2];\n            viewDate.setHours(hours || 0);\n            viewDate.setMinutes(min || 0);\n            return viewDate;\n        }\n        return false;\n    }\n}\n\n\nexport class DateFilter extends DateFieldElement {\n    static propTypes = {\n        parent: PropTypes.object.isRequired,\n    }\n\n    static defaultProps = {\n        editing_mode: true,\n        hide_label: true,\n    }\n\n    constructor(props) {\n        super(props);\n\n        this.disabled = this.disabled.bind(this);\n        this.filled = this.filled.bind(this);\n        this.getValue = this.getValue.bind(this);\n        this.update = this.update.bind(this);\n    }\n\n    filled = () => this.props.parent.context.controller.filled(this.props.value);\n    disabled = () => false;\n    getValue() {\n        if (!this.filled()) return null;\n        return this.str2date(this.props.parent.state.value);\n    }\n    update = (values) => this.props.parent.pushFilter({value: values[this.dataKey]});\n}\n"],"names":["ex","name","prCalendar","RegisterImportPool","DTFieldElement","_LeafComponentInput","props","_this","_classCallCheck","_callSuper","innerHTML","React","_superPropGet","isValid","v","Date","str2date","state","_objectSpread","key","c","newSlug","toString","blurFired","getLinoInput","bind","getValue","updateValue","_inherits","_createClass","value","_this2","fieldProps","arguments","length","undefined","Calendar","_extends","autoFocus","this","leafIndexMatch","className","inputMode","urlParams","controller","globals","isMobile","inputStyle","width","keepInvalid","onBlur","setState","setTimeout","onChange","e","onClearButtonClick","ref","onInputRef","showButtonBar","showIcon","constants","showOnFocus","style","tabIndex","filled","date2str","container","classList","remove","update","_defineProperty","dataKey","setCellStyle","add","LeafComponentInput","requiredModules","concat","iPool","Object","assign","copy","DateFieldElement","_DTFieldElement","_this3","dateFormat","yearNavigator","yearRange","date","getDate","slice","getMonth","getFullYear","parts","split","includes","TimeFieldElement","_DTFieldElement2","_this4","hourFormat","showTime","timeOnly","getHours","getMinutes","timeStr","regex","match","m","exec","viewDate","hours","min","setHours","setMinutes","DateFilter","_DateFieldElement","_this5","parent","context","disabled","values","pushFilter","propTypes","PropTypes","isRequired","defaultProps","editing_mode","hide_label"],"ignoreList":[],"sourceRoot":""}