"""Pydantic state models for Langgraph flows."""

from pydantic import BaseModel, Field

from quiz_me.config import MultiQuestionConfig, SingleQuestionConfig
from quiz_me.models import Question, QuestionPlan, SupervisionResult


class SingleQuestionState(BaseModel):
    """Internal state for single question generation flow."""

    model_config = {"arbitrary_types_allowed": True}

    config: SingleQuestionConfig = Field(
        ...,
        description="Configuration for the generation",
    )
    current_question: Question | None = Field(
        default=None,
        description="The currently generated question",
    )
    supervision_result: SupervisionResult | None = Field(
        default=None,
        description="Result from the supervision node",
    )
    retry_count: int = Field(
        default=0,
        ge=0,
        description="Number of retry attempts made",
    )
    error: str | None = Field(
        default=None,
        description="Error message if generation failed",
    )
    completed: bool = Field(
        default=False,
        description="Whether the flow has completed",
    )
    supervisor_feedback: str | None = Field(
        default=None,
        description="Feedback from supervisor to use in retry",
    )


class MultiQuestionState(BaseModel):
    """Internal state for multi-question generation flow."""

    model_config = {"arbitrary_types_allowed": True}

    config: MultiQuestionConfig = Field(
        ...,
        description="Configuration for the generation",
    )
    plan: QuestionPlan | None = Field(
        default=None,
        description="The question plan generated by the planner",
    )
    questions: list[Question] = Field(
        default_factory=list,
        description="List of generated questions",
    )
    current_index: int = Field(
        default=0,
        ge=0,
        description="Index of the current question being generated",
    )
    current_question: Question | None = Field(
        default=None,
        description="The question currently being worked on (before adding to questions list)",
    )
    current_supervision_result: SupervisionResult | None = Field(
        default=None,
        description="Supervision result for the current question",
    )
    current_retry_count: int = Field(
        default=0,
        ge=0,
        description="Retry count for the current question",
    )
    current_supervisor_feedback: str | None = Field(
        default=None,
        description="Supervisor feedback for retry on current question",
    )
    total_retries: int = Field(
        default=0,
        ge=0,
        description="Total retry attempts across all questions",
    )
    error: str | None = Field(
        default=None,
        description="Error message if generation failed",
    )
    completed: bool = Field(
        default=False,
        description="Whether the flow has completed",
    )
