[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "drsai"
license = "MIT"
dynamic = ["version"]
description = "Developed by Dr. Sai's team at the Institute of High Energy Physics, Chinese Academy of Sciences (IHEP, CAS), this is a development framework designed for both single-agent and multi-agent collaborative systems"
readme = "README.md"
requires-python = ">=3.11"
keywords = []
authors = [
    { name = "hepai" }
]
urls = { "Homepage" = "https://github.com/hepaihub/drsai" }
classifiers = [
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
]
dependencies = [
    # drsai-core
    "autogen-agentchat==0.5.7",
    "autogen-core==0.5.7",
    "autogen-ext[openai, mcp]==0.5.7",
    "pydantic",
    "pydantic-settings",
    "schedule",
    "fastapi[standard]",
    "loguru",
    "python-dotenv",

    # open_webui_pipeline
    "openai",
    "tiktoken",
    "passlib",
    "jwt",
    "aiohttp",
    "python-multipart",
    "json_schema_to_pydantic",

    # hepai
    "damei",
    "hepai>=1.3.3",

    # sql
    "sqlmodel",
    "alembic",

]

[project.optional-dependencies]
eval = [
    "huggingface_hub",
    "pandas",
    "scipy",
]

azure = [
    "autogen-ext[azure]==0.5.7"
]

ollama = [
    "autogen-ext[ollama]==0.5.7"
]


[tool.uv]
dev-dependencies = [
    "poethepoet",
    "pyright==1.1.389",
    "mypy==1.13.0",
    "ruff==0.4.8",
    "pytest_asyncio",
    "pytest-cov",
    "pytest",
    "sphinx",
    "sphinx-autodoc-typehints",
    "sphinx_rtd_theme",
    "types-aiofiles",
    "types-docker",
    "types-PyYaml"
]

[tool.hatch.metadata]
allow-direct-references = true

[tool.poe.tasks]
fmt = "ruff format src"
format.ref = "fmt src"
lint = "ruff check src"
mypy = "mypy src"
pyright = "pyright src"
test.env = { PYTHONPATH = "src" }
test.sequence = [
    "playwright install",
    "pytest tests --cov=src --cov-report=xml --cov-report=term-missing",
]
test.default_item_type = "cmd"
check = ["fmt", "lint", "pyright", "test"]

[tool.mypy]
strict = true
python_version = "3.12"
ignore_missing_imports = true

# from https://blog.wolt.com/engineering/2021/09/30/professional-grade-mypy-configuration/
disallow_untyped_defs = true
no_implicit_optional = true
check_untyped_defs = true
warn_return_any = true
show_error_codes = true
warn_unused_ignores = false

disallow_incomplete_defs = true
disallow_untyped_decorators = true
disallow_any_unimported = true

[tool.pyright]
include = ["src", "tests", "samples"]
typeCheckingMode = "off"
reportUnnecessaryIsInstance = false
reportMissingTypeStubs = false


[tool.hatch.build.targets.wheel]
include-package-data = true
packages = [
    "src/drsai",
    ]

[tool.hatch.version]
path = "src/drsai/version.py"

[tool.hatch.build]
include = [
  "src/drsai/**/*.py",
  "src/drsai/**/*.yaml",
  "src/drsai/**/*.json",
  "src/drsai/**/*.js",
]
exclude = [
  "src/drsai/tests/**",
  "**/__pycache__",
  "**/.*.swp",
]
ignore-vcs = true 
