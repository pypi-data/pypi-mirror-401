# OpenSTARLab PhaseLearn Modeling package
[![Documentation Status](https://readthedocs.org/projects/openstarlab/badge/?version=latest)](https://openstarlab.readthedocs.io/en/latest/?badge=latest)
[![dm](https://img.shields.io/pypi/dm/openstarlab-phaselearn)](https://pypi.org/project/openstarlab-phaselearn/)
[![ArXiv](https://img.shields.io/badge/ArXiv-2502.02785-b31b1b?logo=arxiv)](https://arxiv.org/abs/2502.02785)
[![Discord](https://img.shields.io/badge/Discord-Join%20Chat-5865F2?logo=discord&logoColor=white)](https://discord.gg/PnH2MDDaCf)

## Introduction
The OpenSTARLab PhaseLearn package is the fundamental library for modeling and analyzing play phases in sports. It provides a robust framework to train and perform inference on play phases using state-of-the-art spatio-temporal architectures.

### Key Concepts
- [Definition of Play Phase](https://openstarlab.readthedocs.io/en/latest/PhaseLearn_Modeling/Sports/Soccer/phase.html): Learn how we categorize soccer match events into distinct phases.
- This package supports data preprocessed by the [OpenSTARLab PreProcessing package](https://openstarlab.readthedocs.io/en/latest/Pre_Processing/Sports/Phase_data/index.html).

![image](../phase/sports/soccer/assets/phases_of_play_diagram.png)

---

## Installation
- Install [pytorch](https://pytorch.org/get-started/locally/) (recommended version 2.4.0 linux pip python3.9 cuda11.8)
```
pip install torch torchvision torchaudio
```
- To install this package via PyPI
```
pip install openstarlab-phaselearn
```
- To install manually
```
git clone git@github.com:open-starlab/PhaseLearn.git
cd ./PhaseLearn
pip install -e .
```

## Quick Start
Get started with inference using pre-trained models.

1. **Download Pre-trained Model**: Download the model weights from [MODEL_URL](https://tsukuba.repo.nii.ac.jp/records/2021338) and place them in the ```model/``` directory.

1. **Generate Phase Data**: Convert your raw tracking and event data into the standardized Phase Data format using the Pre-Processing package.
    - [PreProcessing Documentation](https://openstarlab.readthedocs.io/en/latest/Pre_Processing/Sports/Phase_data/index.html)

1. **Run Inference**: Perform phase estimation on your data.

    - [Inference Example Guide](https://openstarlab.readthedocs.io/en/latest/PhaseLearn_Modeling/Sports/Soccer/example.html)

## Training and Analysis from Scratch

Follow these steps to train your own play phase model using the SoccerTrack-v2 dataset.

1. **Data Acquisition**
    - **Tracking Data**: Obtain the raw data from [SoccerTrack-v2](https://atomscott.github.io/SoccerTrack-v2/).
      - [Required Files Guide](https://openstarlab.readthedocs.io/en/latest/PhaseLearn_Modeling/Sports/Soccer/models_framework.html) (Note: Different files are required for Match IDs >= 130000 and < 130000).
    - **Phase Annotation Data**: These labels are not public. Please contact Kento Kuroda (kuroda.kento@image.iit.tsukuba.ac.jp) to request access.

2. **Generate Phase Data**
Before training, you must convert the raw tracking into the ```Phase Data``` format.
    - Use the functions provided in the [Pre-Processing package](https://openstarlab.readthedocs.io/en/latest/Pre_Processing/Sports/Phase_data/index.html).

3. **Training & Evaluation**
Once the data is prepared, you can execute the training pipeline.

    - Refer to the [Train and Inference Example](https://openstarlab.readthedocs.io/en/latest/PhaseLearn_Modeling/Sports/Soccer/example.html) for the code implementation of ```phase_model_soccer.train()```.

## Repository Layout
```
PhaseLearn/
â”œâ”€â”€ phase/sports/soccer/         
â”‚   â”œâ”€â”€ dataloaders/data_module.py
|   â”œâ”€â”€ inference/inference.py
|   â”œâ”€â”€ main_class_soccer/main.py
|   â”œâ”€â”€ models/
|   |   â”œâ”€â”€ model_yaml/
|   |   |   â”œâ”€â”€ train_baller2vec.yaml
|   |   |   â”œâ”€â”€ train_gat_transformer.yaml
|   |   |   â”œâ”€â”€ train_gcn_transformer.yaml
|   |   |   â””â”€â”€ train_transformer.yaml
|   |   â”œâ”€â”€ baller2vec.py
|   |   â”œâ”€â”€ gat_transformer.py
|   |   â”œâ”€â”€ gcn_transformer.py
|   |   â””â”€â”€ transformer.py
|   â”œâ”€â”€ trainers/train.py
â”‚   â””â”€â”€ utils/
|       â”œâ”€â”€ evaluation.py
|       â”œâ”€â”€ load_train_data.py
|       â””â”€â”€ preprocessing.py
â”œâ”€â”€ data/                              # Data storage (gitignored except .gitkeep)
|   â”œâ”€â”€ phase_annotation_data/
|   |   â”œâ”€â”€ 117092/
|   |   |   â”œâ”€â”€ 117092_00_01-04_18_annotation
|   |   |   â”œâ”€â”€ ...
|   |   â”œâ”€â”€ ...
|   â”œâ”€â”€ phase_data/
|   |   â”œâ”€â”€ bepro/
|   |   |   â”œâ”€â”€ 117092/117092_main_data
|   |   |   â”œâ”€â”€ ...
|   |   â””â”€â”€ statsbomb_skillcorner/
|   |       â”œâ”€â”€ 3894537_1018887/3894537_1018887_main_data
|   |       â”œâ”€â”€ ...
|   â””â”€â”€ train_data/bepro/              # generated by preprocessing_data()
|       â”œâ”€â”€ label_np.bpy
|       â””â”€â”€ sequence_np.bpy
â””â”€â”€ model/                              # Model storage (gitignored except .gitkeep)
    â”œâ”€â”€ baller2vec/
    |   â”œâ”€â”€ ...
    â”œâ”€â”€ gat_transformer/
    |   â”œâ”€â”€ 2team_mode/
    |   |   â”œâ”€â”€ 20251221_155257/run1
    |   |   |   â”œâ”€â”€ best.pth
    |   |   |   â”œâ”€â”€ hyperparameters.json
    |   |   |   â”œâ”€â”€ loss.csv
    |   |   |   â””â”€â”€ model_stats.txt
    |   |   â”œâ”€â”€ ...
    |   â”œâ”€â”€ ...
    â”œâ”€â”€ gcn_transformer/
    |   â”œâ”€â”€ ...
    â””â”€â”€ trnsformer/
        â”œâ”€â”€ ...
```

## RoadMap
- [ ] Release the package
- [ ] Provide pre-trained models

## Other Information
Development torch version
```
version 0.0.1 linux pip python3.9 cuda11.8 
```

## Citation

If you use phaselearn modeling in your research, please cite it as follows:

```bibtex
@article{playphase,
  title={Estimating Probability Distributions of FIFA-Defined Phases of Play Based on Inter-Analyst Diversity},
  author={Kento Kuroda, Keisuke Fujii and Yoshinari Kameda},
  journal={International Journal of Computer Science in Sport},
  year={2026},
  volume={XX},
  pages={XXX-XXX},
  publisher={Publisher}
}
```

## Developer
<table>
  <tbody>
    <tr>
      <td align="center" valign="top" width="14.28%"><a href="https://github.com/KentoKuroda"><img src="https://github.com/KentoKuroda.png" width="100px;" alt="Kento Kuroda"/><br /><sub><b>Kento Kuroda</b></sub></a><br /><a href="#Developer-KentoKuroda" title="Lead Developer">ğŸ’»</a></td>
      <td align="center" valign="top" width="14.28%"><a href="https://github.com/kenjiro-mk"><img src="https://github.com/kenjiro-mk.png" width="100px;" alt="Kenjiro Ide"/><br /><sub><b>Kenjiro Ide</b></sub></a><br /><a href="#Developer-KenjiroIde" title="Developer">ğŸ’»</a></td>
    </tr>
  </tbody>
</table>
