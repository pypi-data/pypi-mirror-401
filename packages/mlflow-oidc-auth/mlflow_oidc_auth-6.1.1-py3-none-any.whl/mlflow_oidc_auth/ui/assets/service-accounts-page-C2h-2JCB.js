import{r as e,t}from"./jsx-runtime-DAs1UGHr.js";import{t as n}from"./react-DxF41JXl.js";import"./use-runtime-config-D_-Z8FUB.js";import{E as r,b as i,j as a}from"./use-api-BAbm8GVs.js";import{n as o,t as s}from"./user-service-Cq_o-JT5.js";import{t as c}from"./use-current-user-BFZt1PYV.js";import"./toast-context-val-CcPDsXTx.js";import{t as l}from"./page-container-DV9_twon.js";import{i as u,n as d,r as f,t as p}from"./search-input-DVDKmJAY.js";import{t as m}from"./icon-button-8v1zbWfj.js";import{n as h,r as g,t as _}from"./use-toast-CpnYXdO8.js";import{t as v}from"./use-all-accounts-C7-hDCIu.js";import{t as y}from"./row-action-button-CWxfWRow.js";var b=e(n(),1),x=e(t(),1);const S=({isOpen:e,onClose:t,onSave:n})=>{let[r,i]=(0,b.useState)(``),[o,s]=(0,b.useState)(``),[c,l]=(0,b.useState)(!1),[u,d]=(0,b.useState)(!1),f=(0,b.useRef)(null);(0,b.useEffect)(()=>{e&&(i(``),s(``),l(!1),d(!1),setTimeout(()=>f.current?.focus(),0))},[e]);let p=e=>{let t=e.target.value;i(t),u||s(t)},m=e=>{s(e.target.value),d(!0)},_=async()=>{!r||!o||(await n({name:r,display_name:o,is_admin:c}),t())},v=r.trim()!==``&&o.trim()!==``;return(0,x.jsxs)(g,{isOpen:e,onClose:t,title:`Create Service Account`,children:[(0,x.jsxs)(`div`,{className:`space-y-4`,children:[(0,x.jsx)(h,{ref:f,id:`service-account-name`,label:`Service Account Name*`,type:`text`,value:r,onChange:p,placeholder:`my-service-account`,required:!0}),(0,x.jsx)(h,{id:`display-name`,label:`Display Name*`,type:`text`,value:o,onChange:m,placeholder:`My Service Account`,required:!0})]}),(0,x.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,x.jsx)(`input`,{id:`grant-admin`,type:`checkbox`,checked:c,onChange:e=>l(e.target.checked),className:`h-4 w-4 rounded border-gray-300 text-btn-primary focus:ring-btn-primary`}),(0,x.jsx)(`label`,{htmlFor:`grant-admin`,className:`text-sm font-medium text-text-primary dark:text-text-primary-dark cursor-pointer`,children:`Grant Admin Privileges`})]}),(0,x.jsxs)(`div`,{className:`flex justify-end space-x-3 pt-4 border-t border-ui-secondary-bg dark:border-ui-secondary-bg-dark`,children:[(0,x.jsx)(a,{onClick:t,variant:`ghost`,children:`Cancel`}),(0,x.jsx)(a,{onClick:()=>{_()},variant:`primary`,disabled:!v,children:`Save`})]})]})};function C(){let[e,t]=(0,b.useState)(!1),{searchTerm:n,submittedTerm:h,handleInputChange:g,handleSearchSubmit:C,handleClearSearch:w}=u(),{isLoading:T,error:E,refresh:D,allServiceAccounts:O}=v(),{currentUser:k}=c(),{showToast:A}=_(),j=(O||[]).filter(e=>e.toLowerCase().includes(h.toLowerCase())),M=async e=>{try{await s({username:e.name,display_name:e.display_name,is_admin:e.is_admin,is_service_account:!0}),A(`Service account ${e.name} created successfully.`,`success`),D(),t(!1)}catch(e){console.error(`Failed to create service account:`,e),A(`Failed to create service account. Please try again.`,`error`)}},N=async e=>{try{await o(e),A(`Service account ${e} removed successfully.`,`success`),D()}catch(e){console.error(`Failed to remove service account:`,e),A(`Failed to remove service account. Please try again.`,`error`)}},P=k?.is_admin===!0,F=j.map(e=>({id:e,username:e})),I=[{header:`Service Account Name`,render:({username:e})=>e},{header:`Permissions`,render:({username:e})=>(0,x.jsx)(`div`,{className:`invisible group-hover:visible`,children:(0,x.jsx)(y,{entityId:`${e}/experiments`,route:`/service-accounts`,buttonText:`Manage permissions`})}),className:`w-48`},...P?[{header:`Actions`,render:({username:e})=>(0,x.jsx)(m,{icon:r,title:`Remove service account`,onClick:()=>{N(e)}}),className:`w-24`}]:[]];return(0,x.jsxs)(l,{title:`Service Accounts`,children:[(0,x.jsx)(d,{isLoading:T,loadingText:`Loading service accounts list...`,error:E,onRetry:D}),!T&&!E&&(0,x.jsxs)(x.Fragment,{children:[P&&(0,x.jsx)(`div`,{className:`mb-2`,children:(0,x.jsx)(a,{variant:`secondary`,onClick:()=>t(!0),icon:i,children:`Create Service Account`})}),(0,x.jsx)(`div`,{className:`mb-2`,children:(0,x.jsx)(p,{value:n,onInputChange:g,onSubmit:C,onClear:w,placeholder:`Search service accounts...`})}),(0,x.jsx)(f,{mode:`object`,data:F,columns:I,searchTerm:h}),(0,x.jsx)(S,{isOpen:e,onClose:()=>t(!1),onSave:e=>{M(e)}})]})]})}export{C as default};