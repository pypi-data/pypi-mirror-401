document.addEventListener("alpine:init",()=>{Alpine.data("celeryHealth",t=>({url:t,tabWorker:!0,tabTasks:!1,alive:!1,tasksMap:{},datetime:null,beat:!1,beatLastUpdate:"",flash:!1,loading:!1,interval:null,error:null,runningFrom(t){var e,a;return t?(t=Number(t),e=Date.now(),(e=Math.floor((e-t)/1e3))<0?"just started":(t=Math.floor(e/3600),e%=3600,a=Math.floor(e/60),e%=60,0<t?t+`h ${a}m`:0<a?a+`m ${e}s`:e+"s")):""},init(){this.check(),this.interval=setInterval(()=>this.check(),1e4)},async check(){this.loading=!0,this.flash=!0,this.error=null,setTimeout(()=>this.flash=!1,1e3);try{var t=await fetch(this.url,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({})});if(!t.ok)throw new Error(`HTTP ${t.status}: `+t.statusText);var e=await t.json();this.beat=Boolean(e.beat.status),""!==e.beat.seen&&(this.beatLastUpdate=new Date(e.beat.seen).toLocaleString(void 0,{dateStyle:"short",timeStyle:"medium"})),this.datetime=e.datetime||"",this.tasksMap=e.workers||{},this.alive=Boolean(e.alive)||0<Object.keys(this.tasksMap).length}catch(t){this.beat=!1,this.alive=!1,this.tasksMap={},t instanceof TypeError&&"Failed to fetch"===t.message?this.error="Connection refused or network error":this.error=t.message}finally{this.loading=!1}},getCSRFToken(){return document.querySelector("[name=csrfmiddlewaretoken]")?.value},destroy(){this.interval&&clearInterval(this.interval)}}))});
