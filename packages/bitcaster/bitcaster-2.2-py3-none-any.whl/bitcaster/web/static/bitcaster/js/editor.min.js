var $=django.jQuery;function Editor(){var o=this;function n(){var t=o.ACTIVE.attr("id"),e="",n=o.$context.val();if("btn_html"===t)e=tinymce.activeEditor.getContent("id_html_content");else if("btn_subject"===t)e=o.$subject.val();else{if("btn_content"!==t)return;e=o.$content.val()}django.jQuery.post(o.render_url,{content_type:$(o.ACTIVE).data("content-type"),content:e,context:n,recipient:$("#id_recipient").val()},function(t){t=t,o.iframeElement.src="about:blank",o.iframeElement.contentWindow.document.open(),o.iframeElement.contentWindow.document.write(t),o.iframeElement.contentWindow.document.close()})}o.setup=function(t){var e;o.$context=$("#id_context"),o.$subject=$("#id_subject"),o.$content=$("#id_content"),o.csrftoken=$("[name=csrfmiddlewaretoken]").val(),o.render_url=$("meta[name='render-url']").attr("content"),o.test_url=$("meta[name='test-url']").attr("content"),o.change_url=$("meta[name='change-url']").attr("content"),o.iframeElement=document.getElementById("preview"),o.ACTIVE=null,$.ajaxSetup({beforeSend:function(t,e){/^(GET|HEAD|OPTIONS|TRACE)$/.test(e.type)||this.crossDomain||t.setRequestHeader("X-CSRFToken",o.csrftoken)}}),o.$context.on("change",function(){n()}),o.$content.on("keyup",function(){n()}),o.$subject.on("keyup",function(){n()}),$("#btn_test").on("click",function(t){django.jQuery.post(o.test_url,{content_type:"text/plain",recipient:$("#id_recipient").val(),subject:o.$subject.val(),content:o.$content.val(),html_content:tinymce.activeEditor.getContent("id_html_content"),context:o.$context.val()})}),$(".button.toggler").on("click",function(t){$(".button.toggler").removeClass("active"),$(".tab").hide(),o.ACTIVE=$(this),$($(o.ACTIVE).data("panel")).show(),o.ACTIVE.addClass("active"),n()}),$("#btn_content").click(),(t=t).on("keydown",function(){clearTimeout(e)}),t.on("change",function(){n()}),t.on("keyup",function(){clearTimeout(e),e=setTimeout(n,500)}),$(".button.toggler:first").click()}}function setupTinyMCE(t){$(document).ready(function(){editor.setup(t)})}editor=new Editor;
