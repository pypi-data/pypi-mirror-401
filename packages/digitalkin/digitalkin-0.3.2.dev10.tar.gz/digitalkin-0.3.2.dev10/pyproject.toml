[build-system]
    requires      = [ "setuptools >= 75.8.2", "wheel" ]
    build-backend = "setuptools.build_meta"

[project]

    name            = "digitalkin"
    description     = "SDK to build kin used in DigitalKin"
    readme          = "README.md"
    requires-python = ">=3.10"
    license         = { file = "LICENSE" }

    keywords = [ "digitalkin", "kin", "agent", "gprc", "sdk" ]

    version = "0.3.2.dev10"
    classifiers = [
        "Development Status :: 3 - Alpha",
        "Intended Audience :: Developers",
        "Operating System :: OS Independent",
        "Topic :: Software Development :: Libraries",
        "Programming Language :: Python",
        "Programming Language :: Python :: 3.10",
        "Programming Language :: Python :: 3.11",
        "Programming Language :: Python :: 3.12",
        "Programming Language :: Python :: 3.13",
        "Programming Language :: Python :: 3 :: Only",
        "License :: Other/Proprietary License",
    ]

    dependencies = [
        "agentic-mesh-protocol==0.2.1.dev0",
        "grpcio-health-checking>=1.76.0",
        "grpcio-reflection>=1.76.0",
        "grpcio-status>=1.76.0",
        "pydantic>=2.12.5",
        "surrealdb>=1.0.7",
    ]

    [project.optional-dependencies]
        taskiq = [
            "rstream>=0.40.0",
            "taskiq-aio-pika>=0.5.0",
            "taskiq-redis>=1.2.0",
            "taskiq[reload]>=0.12.1",
        ]

    [project.urls]
        Homepage      = "https://github.com/DigitalKin-ai/digitalkin"
        Documentation = "https://github.com/DigitalKin-ai/digitalkin"
        Issues        = "https://github.com/DigitalKin-ai/digitalkin/issues"

    [[project.authors]]
        name  = "DigitalKin.ai"
        email = "contact@digitalkin.ai"

[dependency-groups]
    dev = [
        "typos>=1.40.0",
        "ruff>=0.14.9",
        "mypy>=1.19.1",
        "pyright>=1.1.407",
        "pre-commit>=4.5.1",
        "bump-my-version>=1.2.5",
        "build>=1.3.0",
        "twine>=6.2.0",
        "cryptography>=46.0.3",
    ]
    tests = [
        "freezegun>=1.5.5",
        "hdrhistogram>=0.10.3",
        "grpcio-testing>=1.76.0",
        "psutil>=7.1.3",
        "pytest>=9.0.2",
        "pytest-asyncio>=1.3.0",
        "pytest-cov>=7.0.0",
        "pytest-html==4.1.1",
        "pytest-json-report==1.5.0",
        "pytest-timeout>=2.4.0",
    ]
    docs = [
        "mike>=2.1.3",
        "markdown-callouts>=0.4.0",
        "markdown-exec>=1.12.1",
        "mkdocs>=1.6.1",
        "mkdocs-coverage>=2.0.0",
        "mkdocs-llmstxt>=0.5.0",
        "mkdocs-redirects>=1.2.2",
        "mkdocstrings>=1.0.0",
        "griffe-inherited-docstrings>=1.1.2",
        "mkdocs-autorefs>=1.4.3",
        "mkdocs-awesome-pages-plugin>=2.10.1",
        "mkdocs-git-committers-plugin-2>=2.5.0",
        "mkdocs-git-revision-date-localized-plugin>=1.5.0",
        "mkdocs-glightbox>=0.5.2",
        "mkdocs-include-markdown-plugin>=7.2.0",
        "mkdocs-literate-nav>=0.6.2",
        "mkdocs-material[imaging]>=9.7.0",
        "mkdocs-minify-plugin>=0.8.0",
        "mkdocs-section-index>=0.3.10",
        "mkdocstrings-python>=2.0.1",
        "mkdocs-open-in-new-tab>=1.0.8",
        "tomli>=2.3.0",
    ]
[tool.setuptools]
    package-dir = { "" = "src" }

    [tool.setuptools.packages.find]
        where = [ "src", "examples" ]

[tool.ruff]
    src            = [ "src" ]
    target-version = "py310"
    line-length    = 120
    indent-width   = 4
    show-fixes     = true
    unsafe-fixes   = true
    # Enable preview features.
    exclude = [
        ".bzr",
        ".direnv",
        ".eggs",
        ".git",
        ".git-rewrite",
        ".hg",
        ".mypy_cache",
        ".nox",
        ".pants.d",
        ".pytype",
        ".ruff_cache",
        ".svn",
        ".tox",
        ".venv",
        "__pypackages__",
        "_build",
        "buck-out",
        "build",
        "dist",
        "node_modules",
        "venv",
        "factory.py",
        "generate_certificates.py",
        "examples/*",
        "tests/*",
        "docs/*",
    ]
    preview = true

    [tool.ruff.lint]
        select = [
            "ANN",   # flake8-annotations
            "ASYNC", # flake8-async
            "S",     # flake8-bandit
            "FBT",   # flake8-boolean-trap
            "A",     # flake8-builtins
            "COM",   # flake8-commas
            "C4",    # flake8-comprehensions
            "DTZ",   # flake8-datetimez
            "EM",    # flake8-errmsg
            "ISC",   # flake8-implicit-str-concat
            "ICN",   # flake8-import-conventions
            "G",     # flake8-logging-format
            "LOG",   # flake8-logging
            "PIE",   # flake8-pie
            "T20",   # flake8-print
            "PYI",   # flake8-pyi
            "PT",    # flake8-pytest-style
            "Q",     # flake8-quotes
            "RSE",   # flake8-raise
            "RET",   # flake8-return
            "SLF",   # flake8-self
            "SIM",   # flake8-simplify
            "TC",    # flake8-type-checking
            "ARG",   # flake8-unused-arguments
            "FLY",   # flynt
            "C90",   # mccabe (complex-structure)
            "PL",    # Pylint
            "TRY",   # tryceratops
            "PERF",  # Perflint
            "E",     # pycodestyle-errors
            "W",     # pycodestyle-warnings
            "F",     # pyflakes
            "I",     # isort
            "D",     # pydocstyle
            "UP",    # pyupgrade
            "N",     # pep8-naming
            "ERA",   # eradicate
            "RUF",   # Ruff-specific rules
            "DOC",   # pydoclint
            "FURB",  # Refurb
            "PL",    # Pylint
        ]

        ignore = [
            "COM812", # Disable because of formatter incompatibility
            "DOC502", # Allow extraneous-exception in docstring
            "S105",   # Hardcoded-password
        ]

        fixable = [ "ALL" ]

        [tool.ruff.lint.pydocstyle]
            convention = "google"

        [tool.ruff.lint.per-file-ignores]
            "tests/**/*.py" = [
                "S101",
                "SLF001",
                "PLC2701",
                "PLR6301",
                "TRY002",
                "FBT001",
                "FBT002",
                "ANN001",
                "ANN003",
                "ANN002",
                "ARG002",
                "PLR0914",
                "PLR2004",
                "PLR0915",
                "PLR1702",
                "D417",
                "ARG001",
                "D103",
                "D102",
                "D101",
                "D107",
                "N802",
                "DOC201",
                "DOC501",
                "PERF203",
                "C901",
                "PLR0911",
                "G004",
                "ERA001",
                "E501",
                "ANN401",
                "PLR0912",
                "ANN201",
                "D100",
            ]

        [tool.ruff.lint.pylint]
            max-args = 10

    [tool.ruff.format]
        quote-style               = "double"
        indent-style              = "space"
        line-ending               = "auto"
        docstring-code-format     = true
        skip-magic-trailing-comma = false

[tool.pyright]
    include = [ "src" ]
    exclude = [ "**/.venv", "**/__pycache__" ]

[tool.mypy]
    exclude = [ "tests", "examples" ]

[tool.pytest.ini_options]
    testpaths    = [ "tests" ]
    python_files = "test_*.py"
    asyncio_mode = "auto"

    log_cli   = false
    log_level = "ERROR"

    # Default timeout for tests (in seconds)
    timeout        = 10
    timeout_method = "signal" # More reliable for asyncio tests on Linux

    # Custom markers
    markers = [
        "integration: marks tests that require real SurrealDB connection (deselect with '-m \"not integration\"')",
        "grpc: marks tests for gRPC service functionality",
        "smoke: marks critical path tests that should always pass",
        "edge_case: marks tests for boundary conditions and edge cases",
        "validation: marks tests for input validation and schema checking",
        "regression: marks tests for previously fixed bugs",
    ]
