<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body class="form-page">
    
    <div class="header-actions">
        <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">
            <svg class="moon-icon theme-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
            <svg class="sun-icon theme-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="4"/>
                <path d="M12 2v4M12 18v4M22 12h-4M6 12H2"/>
                <path d="M17.66 6.34l-2.83 2.83M9.17 14.83l-2.83 2.83M6.34 6.34l2.83 2.83M14.83 14.83l2.83 2.83"/>
            </svg>
        </button>

        {% if has_auth %}
        <a href="/logout" class="logout-button" aria-label="Logout" title="Logout">
            <svg viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
        </a>
        {% endif %}
    </div>

    {% if show_back_button %}
    <a href="/" class="back-button" aria-label="Back to tools">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
    </a>
    {% endif %}

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3 id="loadingTitle">Uploading...</h3>
            <div class="progress-bar-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div id="progressText" class="progress-text">0%</div>
        </div>
    </div>

    <div class="container"> 
        <div class="form-page">
            <h1>{{ title }}</h1>
            
            {% if description %}
            <div class="function-description">
                <p>{{ description }}</p>
            </div>
            {% endif %}
            
            <form id="form" novalidate>
                {% for field in fields %}
                    {% if field.is_list %}
                        <div class="field {% if field.is_optional %}optional-field{% endif %}">
                            <label for="{{ field.name }}">
                                {{ field.name.replace('_', ' ') }}
                            </label>
                            {% if field.is_optional %}
                            <div class="optional-toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" 
                                           name="{{ field.name }}_optional_toggle" 
                                           data-optional-toggle="{{ field.name }}"
                                           {% if field.optional_enabled %}checked{% endif %}>
                                    <span class="toggle-slider"></span>
                                </label>
                                
                            </div>
                            {% endif %}
                            <div class="list-container" 
                                data-list="{{ field.name }}" 
                                data-list-type="{{ field.type }}"
                                data-list-default='{{ field.default | tojson }}'
                                data-list-min="{{ field.get('min', '') }}"
                                data-list-max="{{ field.get('max', '') }}"
                                data-list-step="{{ field.get('step', '') }}"
                                data-list-minlength="{{ field.get('minlength', '') }}"
                                data-list-maxlength="{{ field.get('maxlength', '') }}"
                                data-list-pattern="{{ field.get('pattern', '') }}"
                                data-list-required="{{ 'true' if field.required else 'false' }}"
                                data-list-container-min="{{ field.get('list_min_length', '') }}"
                                data-list-container-max="{{ field.get('list_max_length', '') }}"
                                {% if field.is_optional and not field.optional_enabled %}data-disabled="true"{% endif %}>
                            </div>
                            <div class="field-error" id="error-{{ field.name }}"></div>
                        </div>
                    {% elif field.type == 'checkbox' %}
                        <div class="field checkbox-field">
                            <input type="checkbox" 
                                   name="{{ field.name }}" 
                                   id="{{ field.name }}"
                                   {% if field.default %}checked{% endif %}>
                            <label for="{{ field.name }}">{{ field.name.replace('_', ' ') }}</label>
                        </div>
                    {% elif field.type == 'select' %}
                        <div class="field {% if field.is_optional %}optional-field{% endif %}">
                            <label for="{{ field.name }}">
                                {{ field.name.replace('_', ' ') }}
                                
                            </label>
                            {% if field.is_optional %}
                            <div class="optional-toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" 
                                           name="{{ field.name }}_optional_toggle" 
                                           data-optional-toggle="{{ field.name }}"
                                           {% if field.optional_enabled %}checked{% endif %}>
                                    <span class="toggle-slider"></span>
                                </label>
                                
                            </div>
                            {% endif %}
                            <select name="{{ field.name }}" 
                                    id="{{ field.name }}" 
                                    {% if field.required %}required{% endif %}
                                    {% if field.is_optional and not field.optional_enabled %}disabled{% endif %}>
                                {% for option in field.options %}
                                    <option value="{{ option }}" 
                                            {% if field.default == option %}selected{% endif %}>
                                            {{ option }}
                                    </option>
                                {% endfor %}
                            </select>
                            <div class="field-error" id="error-{{ field.name }}"></div>
                        </div>
                    {% elif field.type == 'color' %}
                        <div class="field {% if field.is_optional %}optional-field{% endif %}">
                            <label for="{{ field.name }}">
                                {{ field.name.replace('_', ' ') }}
                                
                            </label>
                            {% if field.is_optional %}
                            <div class="optional-toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" 
                                           name="{{ field.name }}_optional_toggle" 
                                           data-optional-toggle="{{ field.name }}"
                                           {% if field.optional_enabled %}checked{% endif %}>
                                    <span class="toggle-slider"></span>
                                </label>
                                
                            </div>
                            {% endif %}
                            <div class="color-input-wrapper">
                                <input type="text" 
                                       name="{{ field.name }}" 
                                       id="{{ field.name }}"
                                       {% if field.required %}required{% endif %}
                                       {% if field.get('pattern') %}pattern="{{ field.pattern }}"{% endif %}
                                       {% if field.default is not none %}value="{{ field.default }}"{% endif %}
                                       placeholder="#000000"
                                       data-color-input
                                       {% if field.is_optional and not field.optional_enabled %}disabled{% endif %}>
                                <input type="color" 
                                       class="color-picker-hidden"
                                       data-color-picker="{{ field.name }}"
                                       {% if field.default is not none %}value="{{ field.default }}"{% endif %}
                                       {% if field.is_optional and not field.optional_enabled %}disabled{% endif %}>
                                <div class="color-preview" 
                                     data-color-preview="{{ field.name }}"
                                     style="background-color: {{ field.default or '#000000' }}"
                                     title="Click to pick color"></div>
                            </div>
                            <div class="field-error" id="error-{{ field.name }}"></div>
                        </div>
                    {% elif field.type == 'file' %}
                        <div class="field {% if field.is_optional %}optional-field{% endif %}">
                            <label for="{{ field.name }}">
                                {{ field.name.replace('_', ' ') }}
                                
                            </label>
                            {% if field.is_optional %}
                            <div class="optional-toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" 
                                           name="{{ field.name }}_optional_toggle" 
                                           data-optional-toggle="{{ field.name }}"
                                           {% if field.optional_enabled %}checked{% endif %}>
                                    <span class="toggle-slider"></span>
                                </label>
                                
                            </div>
                            {% endif %}
                            <input type="file" 
                                   name="{{ field.name }}" 
                                   id="{{ field.name }}"
                                   {% if field.required %}required{% endif %}
                                   {% if field.get('accept') %}accept="{{ field.accept }}"{% endif %}
                                   class="file-input"
                                   {% if field.is_optional and not field.optional_enabled %}disabled{% endif %}>
                            <div class="field-error" id="error-{{ field.name }}"></div>
                        </div>
                    {% else %}
                        <div class="field {% if field.is_optional %}optional-field{% endif %}">
                            <label for="{{ field.name }}">
                                {{ field.name.replace('_', ' ') }}
                                
                            </label>
                            {% if field.is_optional %}
                            <div class="optional-toggle-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" 
                                           name="{{ field.name }}_optional_toggle" 
                                           data-optional-toggle="{{ field.name }}"
                                           {% if field.optional_enabled %}checked{% endif %}>
                                    <span class="toggle-slider"></span>
                                </label>
                                
                            </div>
                            {% endif %}
                            <input type="{{ field.type }}" 
                                   name="{{ field.name }}" 
                                   id="{{ field.name }}"
                                   {% if field.required %}required{% endif %}
                                   {% if field.get('min') is not none %}min="{{ field.min }}"{% endif %}
                                   {% if field.get('max') is not none %}max="{{ field.max }}"{% endif %}
                                   {% if field.get('step') %}step="{{ field.step }}"{% endif %}
                                   {% if field.get('minlength') %}minlength="{{ field.minlength }}"{% endif %}
                                   {% if field.get('maxlength') %}maxlength="{{ field.maxlength }}"{% endif %}
                                   {% if field.get('pattern') %}pattern="{{ field.pattern }}"{% endif %}
                                   {% if field.default is not none %}value="{{ field.default }}"{% endif %}
                                   {% if field.is_optional and not field.optional_enabled %}disabled{% endif %}>
                            <div class="field-error" id="error-{{ field.name }}"></div>
                        </div>
                    {% endif %}
                {% endfor %}
                <button type="submit" id="submitBtn">Submit</button>
            </form>
            
            <div id="result"></div>
            <div id="error"></div>
        </div>
    </div>
    <script src="/static/utils.js"></script>
    <script src="/static/builders.js"></script>
    <script src="/static/validators.js"></script>
    <script src="/static/main.js"></script>
    <script>
        initializeForm('{{ submit_url }}');
    </script>
</body>
</html>