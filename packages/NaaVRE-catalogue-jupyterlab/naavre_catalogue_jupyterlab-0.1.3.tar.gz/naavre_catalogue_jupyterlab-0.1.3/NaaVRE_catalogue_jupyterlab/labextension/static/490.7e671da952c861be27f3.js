"use strict";(self.webpackChunk_naavre_catalogue_jupyterlab=self.webpackChunk_naavre_catalogue_jupyterlab||[]).push([[490],{6490:(e,t,n)=>{n.r(t),n.d(t,{CommandIDs:()=>ct,default:()=>dt});var a=n(489),l=n(14),r=n(8581),o=n(3083),s=n(8490),c=n(3345),i=n.n(c),u=n(2515),d=n(1359),m=n(1155);const h=(0,d.createRootRoute)({component:function(){const{status:e,location:t}=(0,d.useRouterState)(),{basepath:n}=(0,d.useRouter)(),[a,l]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{a||"idle"!==e||"/"!==t.pathname||window.location.hash.startsWith(`#/${n}`)||(history.replaceState(null,"",`${window.location.pathname}${window.location.search}#/${n}`),l(!0))},[e,t]),i().createElement(m.Container,{maxWidth:!1,disableGutters:!0,sx:{height:"100%",width:"100%",overflow:"scroll",color:"text.primary",bgcolor:"background.paper"}},i().createElement(m.Container,{sx:{minWidth:"650px",padding:"1rem"}},i().createElement(d.Outlet,null)))}}),p=[{name:"notebook file",namePlural:"notebook file",slug:"notebook-files",cataloguePath:"notebook-files"},{name:"workflow component",namePlural:"workflow component",slug:"workflow-cells",cataloguePath:"workflow-cells"},{name:"workflow file",namePlural:"workflow file",slug:"workflow-files",cataloguePath:"workflow-files"}],g=(0,d.createFileRoute)("/assets")({component:function(){const e=(0,d.useNavigate)(),t=(0,d.useRouterState)();return i().createElement(m.Stack,{spacing:4},i().createElement(m.Stack,{direction:"row",spacing:2},i().createElement(m.Button,{variant:"outlined",onClick:()=>e({to:"/"})},"Home"),i().createElement(m.ToggleButtonGroup,{value:t.location.pathname,onChange:(t,n)=>e({to:n}),exclusive:!0,"aria-label":"Asset kind",color:"primary"},p.map(e=>i().createElement(m.ToggleButton,{key:e.slug,value:`/assets/${e.slug}`,"aria-label":"left aligned"},e.namePlural)))),i().createElement(d.Outlet,null))}}),f=(0,d.createFileRoute)("/")({component:function(){return i().createElement(m.Stack,{direction:"column",spacing:3},i().createElement(m.Typography,{variant:"h4"},"Assets catalogue"),i().createElement(m.Stack,{direction:"row",spacing:2},p.map(e=>i().createElement(E,{key:e.slug,assetKind:e}))))}});function E({assetKind:e}){const t=(0,d.useNavigate)();return i().createElement(m.Button,{variant:"outlined",onClick:()=>t({to:`/assets/${e.slug}`})},e.namePlural)}var v=n(6761),b=n(2691),w=n(709),y=n(4848);const x=(0,w.A)((0,y.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");var A=n(1228),k=n(7763),C=n(6247),S=n(3603),R=n(2823),P=n(6143),_=n(4554),$=n(6299),F=n(3269),U=n(7583),L=n(8179),j=n(597),I=n(9349);const M=(0,w.A)((0,y.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),O=(0,w.A)((0,y.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),z=(0,w.A)((0,y.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"People"),N=(0,w.A)((0,y.jsx)("path",{d:"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92"}),"Share");var T=n(2485),V=n(5613),B=n(2369),K=n(2452),W=n(1),D=n(4721),H=n(3619),J=n(2931),G=n(1763),Y=n(4083),q=n(2307),Z=n(3293),Q=n(8183),X=n(2819),ee=n(4996);const te=(0,c.createContext)(null),ne=(0,c.createContext)({}),ae=/^.*sharing-scopes\/([^/]+)\/?$/,le={community:"Communities",virtual_lab:"Virtual labs"};function re(e,t,n,a){return t.map(t=>{const l=t.url.replace(ae,"$1");return{key:l,title:t.title,section:t.label,checked:!e.virtualLab||t.check_in_virtual_labs.includes(e.virtualLab),getSearchParams:e=>{const t=n;return e?t.add(l):t.delete(l),a(t),{shared_with_scopes:Array.from(t).join(","),page:null}}}})}function oe(e){const[t,n]=(0,c.useState)(!0),a=(0,c.useContext)(ne),[l,r]=(0,c.useState)(e),o=function(e){const t=Array.from(new Set(e.map(e=>e.section)));return t.sort((e,t)=>null===e&&null===t?0:null===e?-1:null===t?1:e.localeCompare(t)),t.map(t=>({key:t,title:null!==t&&le[t]||null,checkboxFilters:e.filter(e=>e.section===t)}))}(l),s=(0,c.useContext)(te),[i,u]=(0,c.useState)(new Set([]));return(0,c.useEffect)(()=>{null!==s&&(r(e=>[...e,...re(a,s.filter(e=>!a.virtualLab||e.show_in_virtual_labs.includes(a.virtualLab)),i,u).filter(t=>!e.some(e=>e.key===t.key))]),n(!1))},[n,a,s,i,u]),{loading:t,checkboxFilters:l,setCheckboxFilters:r,checkboxFiltersBySection:o,activeSharingScopes:i}}var se=n(1079);function ce(e){const t=new URL(e);if(t.searchParams.has("page")){const n=Number(t.searchParams.get("page"));if(isNaN(n))throw Error(`Unexpected url: ${e}`);return n}return 1}async function ie(e){const t=await(0,ee.NaaVREExternalService)("GET",e,{accept:"application/json"});if(200!==t.status_code)throw`${t.status_code} ${t.reason}`;return JSON.parse(t.content)}async function ue(e,t){let n=await ie(e);if(t){const e={count:n.count,next:null,previous:null,results:n.results};for(;null!==n.next;)n=await ie(n.next),e.results=e.results.concat(n.results);return e}return n}function de({children:e}){return i().createElement(X.A,{variant:"subtitle2",sx:{mt:2}},e)}function me({usernames:e,setUsernames:t,disabled:n,sx:a}){const l=(0,c.useContext)(ne),[r,o]=i().useState(!1),[s,u]=i().useState([]),[d,m]=i().useState(!1),[h,p]=(0,c.useState)(null),[g]=(0,T.useDebouncedValue)(h,200);return(0,c.useEffect)(()=>{const e=g&&l.catalogueServiceUrl?`${l.catalogueServiceUrl}/users/?search=${g}`:null;e&&(m(!0),ue(e).then(e=>{u(e.results.map(e=>e.username))}).catch(e=>{const t=`Error loading assets: ${String(e)}`;console.error(t)}).finally(()=>{m(!1)}))},[g]),i().createElement(V.A,{multiple:!0,sx:a,open:r,disabled:n,onOpen:()=>o(!0),onClose:()=>{o(!1),u([])},value:e,onChange:(e,n)=>t(n),onInputChange:(e,t)=>{p(t)},noOptionsText:"Search users",options:s,loading:d,filterOptions:e=>e,renderInput:e=>i().createElement(Q.A,{...e,slotProps:{input:{...e.InputProps,endAdornment:i().createElement(i().Fragment,null,d?i().createElement(W.A,{color:"inherit",size:20}):null,e.InputProps.endAdornment)}}})})}function he({open:e,onClose:t,onUpdated:n,asset:a,readonly:l}){const[r,o]=(0,c.useState)(a.shared_with_users||[]),{checkboxFilters:s,setCheckboxFilters:u,checkboxFiltersBySection:d,activeSharingScopes:m}=oe([]),[h,p]=(0,c.useState)(!1),[g,f]=(0,c.useState)(null);(0,c.useEffect)(()=>{u(e=>(e.forEach(e=>{var t;e.checked=(null===(t=a.shared_with_scopes)||void 0===t?void 0:t.includes(e.key))||!1}),e))},[a]),(0,c.useEffect)(()=>{s.forEach(e=>{e.getSearchParams(e.checked)})},[s]);const E=(0,c.useCallback)(async()=>{const e=await(0,ee.NaaVREExternalService)("PATCH",a.url,{accept:"application/json"},{shared_with_users:r,shared_with_scopes:Array.from(m)});if(200!==e.status_code)throw`${e.status_code} ${e.reason}`},[a,r,m]);return i().createElement(D.A,{onClose:t,open:e},i().createElement(G.A,null,a.title),i().createElement(J.A,null,l&&i().createElement(v.A,{severity:"info",sx:{mb:2}},"You cannot modify this asset because it belongs to another user."),i().createElement(de,null,"Share with users"),i().createElement(me,{usernames:r,setUsernames:o,disabled:l,sx:{width:500,mt:1}}),d.map(e=>i().createElement(q.A,{key:e.key},i().createElement(de,null,e.title),e.checkboxFilters.map(e=>i().createElement(Y.A,{key:e.key,label:e.title,control:i().createElement(K.A,{checked:e.checked,disabled:l,onChange:t=>{u(n=>{const a=[...n];return a[a.findIndex(t=>t.key===e.key)].checked=t.target.checked,a})}})})))),g&&i().createElement(v.A,{severity:"error",sx:{mt:2}},"Cannot update asset: ",g),h&&i().createElement(Z.A,{sx:{mt:2}})),i().createElement(H.A,null,i().createElement(B.A,{onClick:t},"Cancel"),i().createElement(B.A,{disabled:l,onClick:async()=>{f(null),p(!0),E().then(t).then(n).catch(e=>f(e)).finally(()=>p(!1))}},"Apply")))}const pe=(0,c.createContext)(null),ge={sub:null,preferred_username:null,username:null},fe=(0,c.createContext)(ge);var Ee=n(3387);function ve({sharedWithList:e,label:t}){return e&&e.length>0?i().createElement(A.A,{spacing:1},i().createElement(Ee.A,null,"The following ",t," will lose access:"),i().createElement(Ee.A,{component:"ul"},e.map(e=>i().createElement(Ee.A,{key:e,component:"li"},e)))):i().createElement(i().Fragment,null)}function be({open:e,onClose:t,onUpdated:n,asset:a,assetKind:l,readonly:r}){const[o,s]=(0,c.useState)(!1),[u,d]=(0,c.useState)(null),[m,h]=(0,c.useState)(""),p=(0,c.useCallback)(async()=>{const e=await(0,ee.NaaVREExternalService)("DELETE",a.url,{accept:"application/json"});if(204!==e.status_code)throw`${e.status_code} ${e.reason}`},[a]);return i().createElement(D.A,{onClose:t,open:e},i().createElement(G.A,null,"Delete ",a.title),i().createElement(J.A,null,r?i().createElement(v.A,{severity:"info",sx:{mb:2}},"You cannot delete this asset because it belongs to another user."):i().createElement(A.A,{spacing:2},i().createElement(Ee.A,null,"You are about to delete the following ",l.name,":"),i().createElement(Ee.A,{style:{fontWeight:"bold",marginLeft:"1.5rem"}},a.title),i().createElement(ve,{label:"users",sharedWithList:a.shared_with_users}),i().createElement(ve,{label:"virtual labs or communities",sharedWithList:a.shared_with_scopes}),i().createElement(Ee.A,null,'To confirm, type "',i().createElement("span",{style:{fontWeight:"bold"}},a.title),'" in the box below'),i().createElement(Q.A,{value:m,sx:{"& .MuiOutlinedInput-root":{"& .MuiOutlinedInput-notchedOutline":{borderColor:"error.main"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"error.main"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"error.main"}}},onChange:e=>h(e.currentTarget.value)})),u&&i().createElement(v.A,{severity:"error",sx:{mt:2}},"Cannot delete asset: ",u),o&&i().createElement(Z.A,{sx:{mt:2}})),i().createElement(H.A,null,i().createElement(B.A,{onClick:t},"Cancel"),i().createElement(B.A,{color:"error",disabled:r||m!==a.title,onClick:async()=>{d(null),s(!0),p().then(t).then(n).catch(e=>d(`${e}`)).finally(()=>s(!1))}},"Delete this ",l.name)))}var we=n(2830);function ye(e){return e.name.split(".").pop()}function xe(e){return i().createElement(L.A,{...e,inheritViewBox:!0},i().createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",viewBox:"0 0 22 22"},i().createElement("path",{d:"m12.04 5.191c-0.8691-0.003638-1.685 0.3147-2.387 0.7976-0.3292 0.2264-0.6346 0.4882-0.9158 0.7815l1.289 1.241c0.203-0.2116 0.419-0.3991 0.6392-0.5505 0.4697-0.323 0.946-0.4825 1.367-0.4807 0.6234 0.00258 1.153 0.06533 1.552 0.2927 0.3992 0.2274 0.7776 0.6197 1.061 1.652l0.1772 0.6472 0.6714 0.008057c0.8614 0.0113 1.476 0.2898 1.909 0.7493 0.4333 0.4595 0.709 1.14 0.709 2.089 0 0.7938-0.2222 1.463-0.5801 1.901-0.3579 0.4387-0.8291 0.7036-1.622 0.7036h-10.52c-0.04279 0-0.3637-0.1427-0.8083-0.4941l-1.109 1.402c0.4734 0.3742 1.036 0.8809 1.917 0.8809h10.52c1.254 0 2.332-0.5293 3.01-1.362s0.9802-1.911 0.9802-3.032c5e-6 -1.312-0.4108-2.482-1.198-3.317-0.6527-0.6921-1.578-1.053-2.583-1.19-0.3932-1.017-0.945-1.793-1.649-2.194-0.8367-0.4767-1.714-0.5234-2.43-0.5264zm-6.448 1.41c-0.0293-9.106e-4 -0.05912 6.85e-4 -0.08862 0.002686-0.2362 0.01605-0.4565 0.1252-0.6123 0.3035l-2.498 2.857c-0.3018 0.345-0.2936 0.8624 0.0188 1.198l2.549 2.72c0.3369 0.36 0.9016 0.3793 1.262 0.04297 0.36-0.3369 0.3793-0.9016 0.04297-1.262l-1.157-1.235 4.616-0.02148c0.494-0.001184 0.8934-0.4029 0.8916-0.897-0.002661-0.494-0.4056-0.8922-0.8997-0.8889l-4.67 0.02148 1.19-1.362c0.3235-0.3717 0.285-0.9352-0.08594-1.26-0.1561-0.1359-0.3535-0.2138-0.5586-0.2202z",fill:"#3c8f49"})))}function Ae(e,t){const n="file"in e;return n&&null!==t?{title:"Add to my files",icon:i().createElement(L.A,{component:xe}),handler:()=>async function(e,t){const n=new URL(t).pathname.split("/").pop();if(void 0===n)throw Error(`Cannot download file from URL: ${t}`);const a=l.Notification.emit(`Downloading\n${n}`,"in-progress",{autoClose:!1}),r=new we.ContentsManager;try{const o=await async function(e){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch file: ${t.statusText}`);return await t.text()}(t);await r.save(n,{type:"file",format:"text",content:o}),l.Notification.update({id:a,type:"success",message:`Downloaded \n${n}`,autoClose:5e3,actions:[{label:"Open",callback:t=>{e.openOrReveal(n)}}]})}catch(e){throw l.Notification.update({id:a,type:"error",message:`Could not download file\n${n}\n${e}`,autoClose:5e3}),console.error("Error downloading or opening file",e),e}}(null==t?void 0:t.docManager,e.file),enabled:n,showInline:!0}:{title:"",icon:i().createElement(i().Fragment,null),handler:()=>{},enabled:!1,showInline:!0}}function ke({actions:e}){const[t,n]=i().useState(null),a=Boolean(t),l=()=>{n(null)};return i().createElement(i().Fragment,null,i().createElement(b.A,{id:"basic-button","aria-label":"More","aria-controls":a?"basic-menu":void 0,"aria-haspopup":"true","aria-expanded":a?"true":void 0,onClick:e=>{n(e.currentTarget)},style:{borderRadius:"100%"}},i().createElement(O,null)),i().createElement($.A,{id:"basic-menu",anchorEl:t,open:a,onClose:l,slotProps:{list:{"aria-labelledby":"basic-button"}}},e.filter(e=>e.enabled).map(e=>i().createElement(F.A,{key:e.title,onClick:t=>{e.handler(),l()}},i().createElement(j.A,null,e.icon),i().createElement(I.A,null,e.title)))))}function Ce({asset:e,assetKind:t,fetchAssetsListResponse:n}){const a=(0,c.useContext)(fe),l=(0,c.useContext)(pe),r=e.owner===a.preferred_username,o="version"in e,s=(e.shared_with_users||[]).length>0||(e.shared_with_scopes||[]).length>0,[u,d]=(0,c.useState)(!1),[m,h]=(0,c.useState)(!1),p=new RegExp(`-${e.owner}$`),g=e.title.replace(p,""),f=[Ae(e,l),{title:s?r?"Shared":"Shared with me":"Share",icon:s?i().createElement(z,null):i().createElement(N,null),handler:()=>d(!0),enabled:!0,showInline:!0},{title:"Delete",icon:i().createElement(M,null),handler:()=>h(!0),enabled:r,showInline:!1}];return i().createElement(_.A,{hover:!0},i().createElement(R.A,{sx:{fontWeight:"bold"}},g),o&&i().createElement(R.A,null,"v",e.version),i().createElement(R.A,null,e.owner&&r?"me":e.owner),i().createElement(R.A,null,i().createElement(i().Fragment,null,f.filter(e=>e.enabled&&e.showInline).map(e=>i().createElement(k.A,{key:e.title,title:e.title},i().createElement(b.A,{"aria-label":e.title,style:{borderRadius:"100%"},sx:{width:"40px"},onClick:e.handler},e.icon)))),i().createElement(he,{open:u,onClose:()=>d(!1),onUpdated:n,asset:e,readonly:!r}),i().createElement(be,{open:m,onClose:()=>h(!1),onUpdated:n,asset:e,assetKind:t,readonly:!r}),i().createElement(ke,{actions:f})))}function Se(){return i().createElement(U.A,{variant:"rounded",style:{fontSize:"14px",borderRadius:"5px",display:"flex",height:"53px",margin:"10px"}})}function Re({assets:e,assetKind:t,fetchAssetsListResponse:n,pageNav:a}){return e.length?i().createElement(A.A,{spacing:3},i().createElement(C.A,null,i().createElement(P.A,null,i().createElement(_.A,null,i().createElement(R.A,null,"Title"),"version"in e[0]&&i().createElement(R.A,null,"Version"),i().createElement(R.A,null,"Owner"),i().createElement(R.A,null))),i().createElement(S.A,null,e.map(e=>i().createElement(Ce,{key:e.url,asset:e,assetKind:t,fetchAssetsListResponse:n})))),a&&a):i().createElement(v.A,{severity:"info"},"No ",t.namePlural," to display.")}function Pe(){return i().createElement(A.A,{sx:{marginTop:"56px"}},i().createElement(Se,null),i().createElement(Se,null),i().createElement(Se,null))}const _e=(0,w.A)((0,y.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var $e=n(5749);const Fe=(0,w.A)((0,y.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),Ue=(0,w.A)((0,y.jsx)("path",{d:"M16 17.01V10h-2v7.01h-3L15 21l4-3.99zM9 3 5 6.99h3V14h2V6.99h3z"}),"SwapVert"),Le=[{value:"created",title:"First created"},{value:"-created",title:"Last created"},{value:"title",title:"A-Z"},{value:"-name",title:"Z-A"}],je=(0,w.A)((0,y.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterList");var Ie=n(5851);const Me=[{key:"all_versions",title:"All versions",section:null,checked:!0,getSearchParams:e=>({all_versions:e?"true":"false",page:null})},{key:"shared_with_me",title:"Shared with me",section:null,checked:!0,getSearchParams:e=>({shared_with_me:e?"true":"false",page:null})}];function Oe({children:e}){return i().createElement(X.A,{variant:"subtitle2",sx:{mt:2}},e)}function ze(e,t){if(null===e)return null;const n=new URL(e);for(const[e,a]of Object.entries(t))null===a||""===a?n.searchParams.delete(e):n.searchParams.set(e,a);return n.toString()}const Ne={search:{Component:function({setUrl:e,setReady:t}){const[n,a]=(0,c.useState)(null),[l]=(0,T.useDebouncedValue)(n,200);return(0,c.useEffect)(()=>{e(e=>ze(e,{search:l,page:null})),t(!0)},[l]),i().createElement(Q.A,{value:n,onChange:e=>a(e.target.value),slotProps:{input:{startAdornment:i().createElement($e.A,{position:"start"},i().createElement(Fe,null)),endAdornment:n&&i().createElement($e.A,{position:"end"},i().createElement(b.A,{"aria-label":"clear search",onClick:()=>a(""),edge:"end",style:{borderRadius:"100%"}},i().createElement(_e,null)))}},size:"small",sx:{"& .MuiInputBase-root":{borderRadius:"100px"},width:"100%"}})},ready:!1},checkboxes:{Component:function({setUrl:e,setReady:t}){const{loading:n,checkboxFilters:a,setCheckboxFilters:l,checkboxFiltersBySection:r}=oe(Me),{virtualLab:o}=(0,c.useContext)(ne);(0,c.useEffect)(()=>{const e=[{key:"virtual_lab",title:"All virtual labs",section:null,checked:!0,getSearchParams:e=>({virtual_lab:e?null:o||null,page:null})}];l(t=>[...e,...t.filter(t=>!e.some(e=>e.key===t.key))])},[o]),(0,c.useEffect)(()=>{n||(a.forEach(t=>{e(e=>ze(e,t.getSearchParams(t.checked)))}),t(!0))},[a,n]);const[s,u]=i().useState(null),d=Boolean(s),m=d?"checkboxfilter-popover":void 0;return i().createElement(i().Fragment,null,i().createElement(k.A,{title:"Filters"},i().createElement(b.A,{"aria-describedby":m,"aria-label":"Filters",style:{borderRadius:"100%"},onClick:e=>u(e.currentTarget)},i().createElement(je,null))),i().createElement(Ie.Ay,{id:m,open:d,anchorEl:s,onClose:()=>u(null),anchorOrigin:{vertical:"bottom",horizontal:"left"}},i().createElement(q.A,{sx:{px:2,py:1}},r.map(e=>i().createElement(q.A,{key:e.key},i().createElement(Oe,null,e.title),e.checkboxFilters.map(e=>i().createElement(Y.A,{key:e.key,label:e.title,control:i().createElement(K.A,{checked:e.checked,onChange:t=>{l(n=>{const a=[...n];return a[a.findIndex(t=>t.key===e.key)].checked=t.target.checked,a})}})})))))))},ready:!1},ordering:{Component:function({setUrl:e,setReady:t}){const[n,a]=(0,c.useState)("-created");(0,c.useEffect)(()=>{e(e=>ze(e,{ordering:n,page:null})),t(!0)},[n]);const[l,r]=i().useState(null),o=Boolean(l);return i().createElement(i().Fragment,null,i().createElement(k.A,{title:"Order"},i().createElement(b.A,{id:"ordering-button","aria-label":"Order","aria-controls":o?"ordering-menu":void 0,"aria-expanded":o?"true":void 0,"aria-haspopup":"true",style:{borderRadius:"100%"},onClick:e=>r(e.currentTarget)},i().createElement(Ue,null))),i().createElement($.A,{id:"ordering-menu",anchorEl:l,open:o,onClose:()=>r(null),slotProps:{list:{"aria-labelledby":"ordering-button"}}},Le.map(e=>i().createElement(F.A,{key:e.value,selected:e.value===n,onClick:()=>{a(e.value),r(null)}},e.title))))},ready:!1}};function Te({setUrl:e,setPaused:t}){const[n,a]=(0,c.useState)(Ne),l=Object.values(n).every(e=>e.ready);return(0,c.useEffect)(()=>{t(!l)},[l]),i().createElement(i().Fragment,null,Object.entries(n).map(([t,n])=>i().createElement(n.Component,{key:t,setUrl:e,setReady:e=>((e,t)=>{a(n=>(n[e].ready=t,n))})(t,e)})))}const Ve=(0,w.A)((0,y.jsx)("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore"),Be=(0,w.A)((0,y.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext");function Ke({listResponse:e,setUrl:t}){const[n,a]=function(e){let t,n;if(null===e.previous&&null===e.next)t=1,n=1;else if(null===e.previous&&null!==e.next)t=1,n=(0,se.ceil)(e.count/e.results.length);else if(null!==e.previous&&null!==e.next){t=ce(e.previous)+1;const a=e.results.length;n=(0,se.ceil)(e.count/a)}else{if(null===e.previous||null!==e.next)throw Error(`Unexpected pagination: ${e}`);t=ce(e.previous)+1,n=t}return[t,n]}(e);return i().createElement(A.A,{direction:"row",spacing:1,sx:{justifyContent:"center",alignItems:"center"}},i().createElement(b.A,{"aria-label":"Previous",style:{borderRadius:"100%"},onClick:()=>t(e.previous),sx:{visibility:null===e.previous?"hidden":"visible"}},i().createElement(Ve,null)),i().createElement("p",null,"Page ",n," of ",a),i().createElement(b.A,{"aria-label":"Next",style:{borderRadius:"100%"},onClick:()=>t(e.next),sx:{visibility:null===e.next?"hidden":"visible"}},i().createElement(Be,null)))}function We(e,t,n){return e?`${e}/${t}/${n}`:null}function De({catalogueServiceUrl:e,path:t,initialSearchParams:n,startPaused:a=!1,getAllPages:l}){const[r,o]=(0,c.useState)(!0),[s,i]=(0,c.useState)(null),[u,d]=(0,c.useState)(a),[m,h]=(0,c.useState)(We(e,t,n));(0,c.useEffect)(()=>{h(a=>null!==a?We(e,t,new URL(a).search):e?We(e,t,n):null)},[e,t,n]);const[p,g]=(0,c.useState)(null),f=(0,c.useCallback)(()=>{i&&i(null),o&&o(!0),m&&ue(m,l).then(e=>{g(e)}).catch(e=>{const t=`Error listing items: ${String(e)}`;console.error(t),i&&i(t),g(null)}).finally(()=>{o&&o(!1)})},[m]);return(0,c.useEffect)(()=>{u||f()},[u,f]),{url:m,setUrl:h,loading:r,setLoading:o,errorMessage:s,setErrorMessage:i,paused:u,setPaused:d,fetchResponse:f,response:p}}function He({onClick:e}){return i().createElement(k.A,{title:"Refresh"},i().createElement(b.A,{"aria-label":"Refresh",style:{borderRadius:"100%"},onClick:e},i().createElement(x,null)))}function Je({assetKind:e}){const t=(0,c.useContext)(ne),{setUrl:n,loading:a,errorMessage:l,setPaused:r,fetchResponse:o,response:s}=De({catalogueServiceUrl:t.catalogueServiceUrl,path:e.cataloguePath,initialSearchParams:"?ordering=-created",startPaused:!0}),{response:u}=De({catalogueServiceUrl:t.catalogueServiceUrl,path:"sharing-scopes",initialSearchParams:"?page_size=100",getAllPages:!0}),d=function(){const[e,t]=(0,c.useState)(ge);return(0,c.useEffect)(()=>{(0,ee.requestAPI)("naavre-communicator/me").then(e=>{t(e)})},[]),e}();return i().createElement(te.Provider,{value:(null==u?void 0:u.results)||null},i().createElement(fe.Provider,{value:d},i().createElement(A.A,{spacing:3},i().createElement(A.A,{direction:"row",spacing:1,sx:{justifyContent:"start",alignItems:"center",padding:"10px"}},i().createElement(Te,{setUrl:n,setPaused:r}),i().createElement(He,{onClick:()=>o()})),a?i().createElement(Pe,null):l?i().createElement(v.A,{severity:"error"},l):null===s?i().createElement(v.A,{severity:"error"},"Could not load ",e.namePlural,"."):i().createElement(Re,{assets:s.results,assetKind:e,fetchAssetsListResponse:o,pageNav:i().createElement(Ke,{listResponse:s,setUrl:n})}))))}const Ge=(0,d.createFileRoute)("/assets/$assetKindSlug")({component:function(){const{assetKindSlug:e}=Ge.useParams(),t=p.filter(t=>t.slug===e);if(1!==t.length)throw Error(`Invalid asset kind: ${e}`);const n=t[0];return i().createElement(i().Fragment,null,i().createElement(Je,{assetKind:n}))}}),Ye=g.update({id:"/assets",path:"/assets",getParentRoute:()=>h}),qe=f.update({id:"/",path:"/",getParentRoute:()=>h}),Ze={AssetsAssetKindSlugRoute:Ge.update({id:"/$assetKindSlug",path:"/$assetKindSlug",getParentRoute:()=>Ye})},Qe={IndexRoute:qe,AssetsRouteRoute:Ye._addFileChildren(Ze)},Xe=h._addFileChildren(Qe)._addFileTypes(),et=(0,d.createRouter)({routeTree:Xe,history:(0,d.createHashHistory)(),basepath:"naavre-catalogue"});function tt(){return i().createElement(c.StrictMode,null,i().createElement(d.RouterProvider,{router:et}))}const nt=(0,n(710).A)({colorSchemes:{dark:!0},palette:{secondary:{main:"#ea5b2d",dark:"#b12800",light:"#ff8c5a"},primary:{main:"#0f4e8a",dark:"#00275c",light:"#4e79ba"}}});class at extends l.ReactWidget{constructor(e,t){super(),this.jupyterContext=null,this.settings={},this.jupyterContext=e,this.settings=t}updateSettings(e){this.settings={...this.settings,...e},this.update()}render(){return i().createElement(pe.Provider,{value:this.jupyterContext},i().createElement(ne.Provider,{value:this.settings},i().createElement(u.A,{theme:nt},i().createElement(tt,null))))}}var lt=n(2840);const rt=new lt.LabIcon({name:"naavre-catalogue-launcher-icon",svgstr:'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="66.69" height="66.69" version="1.1" viewBox="0 0 66.69 66.69" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><defs><clipPath id="clipPath26740-9"><path transform="translate(-128.9 -229.9)" d="m0 0h595.3v841.9h-595.3z"/></clipPath></defs><path transform="matrix(1.047 0 0 -1.047 66.44 25.96)" d="m0 0c-0.3 0.3-0.6 0.5-1 0.5h-2.8v15.1c0 1-0.8 1.9-1.9 1.9h-32.7l-2.6 4.4c-0.3 0.6-1 0.9-1.6 0.9h-14.8c-1 0-1.9-0.8-1.9-1.9v-20.5h-2.8c-0.4 0-0.8-0.2-1-0.5-0.3-0.3-0.4-0.7-0.3-1.1l5.2-34.6c0.1-0.7 0.7-1.1 1.3-1.1h50.6c0.7 0 1.2 0.5 1.3 1.2l5.2 34.5c0.1 0.5 0 0.9-0.2 1.2m-57.1 20.7h14.3l2.6-4.4c0.3-0.6 1-0.9 1.6-0.9h32.5v-14.9h-1.1v4.3h-1.1v3.2h-1.1v3.2h-44.5v-3.2h-1.1v-3.2h-1v-4.3h-1.1zm3.2-18.1h44.7v-2.1h-44.7zm1.1 3.2h42.6v-1.1h-42.6zm41.5 2.1h-40.5v1.1h40.5zm4.3-42.6h-49.2l-5 33h59.3z" clip-path="url(#clipPath26740-9)" fill="#3c8f49"/><path d="m42.32 39.13c-2.538-0.01039-5.044 1.229-6.688 3.494-2.341 0.04491-4.566 1.292-5.795 3.486-1.005 0.1705-1.991 0.5543-2.797 1.275-0.9857 0.8818-1.699 2.213-1.699 3.781 8e-6 1.268 0.2283 2.699 1.049 3.922 0.8205 1.223 2.326 2.119 4.281 2.119h18.42c2.268 0 4.052-1.091 5.107-2.6 1.055-1.509 1.477-3.37 1.477-5.148 8e-6 -4.077-3.215-6.794-6.682-6.77-1.626-2.288-4.127-3.55-6.67-3.561zm-0.0098 2.33c1.952 8e-3 3.895 0.9789 5.074 2.922l0.3945 0.6504 0.7539-0.09961c2.401-0.3168 4.809 1.41 4.809 4.527 0 1.394-0.3644 2.822-1.057 3.812-0.6922 0.99-1.618 1.605-3.197 1.605h-18.42c-1.329 1e-6 -1.904-0.4278-2.346-1.086-0.4415-0.6581-0.6543-1.664-0.6543-2.625 8e-6 -0.889 0.3612-1.542 0.9238-2.045 0.5626-0.5034 1.344-0.8018 2-0.8281l0.7266-0.0293 0.293-0.666c0.8267-1.877 2.695-2.853 4.504-2.701l0.7148 0.06055 0.375-0.6113c1.193-1.937 3.148-2.895 5.102-2.887z" fill="#3c8f49"/></svg>\n'}),ot=new lt.LabIcon({name:"naavre-catalogue-tab-icon",svgstr:'<?xml version="1.0" encoding="UTF-8"?>\n<svg width="16" height="16" version="1.1" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="#3c8f49"><path d="m9.452 9.501c-0.5864-0.002361-1.174 0.2949-1.525 0.8737-0.5737-0.04893-1.16 0.2686-1.417 0.8613-0.4733 0.01928-1.011 0.401-1.011 1.025 4.5e-6 0.5659 0.553 1.238 1.042 1.238h4.605c0.8956 0 1.355-0.8662 1.355-1.672 3e-6 -0.9518-0.7626-1.545-1.532-1.442-0.3469-0.5804-0.9313-0.8817-1.517-0.8841z"/><path d="m0.5 6.5h15l-1.5 9h-12z" stroke-linecap="round" stroke-linejoin="round" style="paint-order:stroke fill markers"/><path d="m2.5 6.5v-5h3l2 1 6-1.935e-4v4" stroke-linejoin="round" style="paint-order:stroke fill markers"/></g></svg>\n'}),st=new lt.LabIcon({name:"naavre-catalogue-add-to-cat-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 22 22">\n<path d="m12.03 5.191c-1.124-0.004658-2.04 0.5449-2.463 0.8513l1.184 1.356c0.4391-0.2815 0.8799-0.4206 1.273-0.4189 0.6234 0.00258 1.153 0.06533 1.552 0.2927 0.3992 0.2274 0.7749 0.6197 1.058 1.652l0.1772 0.6472 0.6714 0.00806c0.8614 0.0113 1.479 0.2898 1.912 0.7493 0.4333 0.4595 0.709 1.143 0.709 2.092 0 0.7938-0.2222 1.463-0.5801 1.901s-0.8291 0.7009-1.622 0.7009h-10.53c-0.1296 0-0.5456-0.1863-0.8862-0.5962-0.3314-0.3989-0.5675-0.9488-0.5989-1.348l-1.789-0.0081c0.01378 0.4743 0.158 1.469 1.015 2.5 0.5603 0.6744 1.302 1.241 2.259 1.241h10.53c1.254 0 2.329-0.5293 3.008-1.362 0.679-0.8322 0.9829-1.909 0.9829-3.029 5e-6 -1.312-0.4135-2.485-1.2-3.319-0.6524-0.6918-1.576-1.052-2.581-1.19-0.3932-1.017-0.945-1.793-1.649-2.194-0.8367-0.4767-1.717-0.5234-2.433-0.5264zm-4.906 1.413c-0.1964 0.01201-0.3833 0.08847-0.5317 0.2175-0.3702 0.3251-0.4074 0.8885-0.08325 1.26l1.19 1.362-4.67-0.02148c-0.494-0.00327-0.897 0.3949-0.8997 0.8889-0.00178 0.494 0.3976 0.8958 0.8916 0.897l4.616 0.02148-1.157 1.235c-0.3363 0.3606-0.3171 0.9253 0.04297 1.262 0.3606 0.3363 0.9253 0.3171 1.262-0.04297l2.549-2.72c0.3124-0.3354 0.3206-0.8527 0.0188-1.198l-2.498-2.857c-0.183-0.2093-0.453-0.3214-0.7305-0.3035z" fill="#3c8f49"/>\n</svg>\n'});var ct,it=n(6604);!function(e){e.openOrRestore="open-or-restore-catalogue",e.openFromUrl="open-catalogue-from-url",e.addFileToCat="add-file-to-catalogue"}(ct||(ct={}));const ut={id:"@naavre/catalogue-jupyterlab:plugin",description:"NaaVRE assets catalogue frontend on Jupyter Lab",autoStart:!0,requires:[it.IDocumentManager,r.IFileBrowserFactory,o.ILauncher,a.IRouter,s.ISettingRegistry],optional:[s.ISettingRegistry],activate:(e,t,n,a,r,o)=>{console.log("JupyterLab extension @naavre/catalogue-jupyterlab is activated!");const s=new l.WidgetTracker({namespace:"naavre-catalogue"});function c(e){s.forEach(t=>t.content.updateSettings(e.composite))}a&&a.add({command:ct.openOrRestore,category:"VRE Components",rank:1}),e.commands.addCommand(ct.openFromUrl,{label:"Open assets catalogue from URL",caption:"Open the catalogue of NaaVRE assets from the URL",icon:e=>e.isPalette?void 0:rt,execute:t=>{r.current.hash.match(/^#\/naavre-catalogue/)&&e.commands.execute(ct.openOrRestore).then()}}),r.register({command:ct.openFromUrl,pattern:/lab\/?/}),o&&Promise.all([e.restored,o.load(ut.id)]).then(([,a])=>{c(a),a.changed.connect(c),e.commands.addCommand(ct.openOrRestore,{label:"Assets catalogue",caption:"Catalogue of NaaVRE assets",icon:e=>e.isPalette?void 0:rt,execute:n=>{if(s.currentWidget)e.shell.activateById(s.currentWidget.id);else{const n=function(e){const n=new at({docManager:t},e),a=new l.MainAreaWidget({content:n});return a.title.label="Assets catalogue",a.title.icon=ot,a}(a.composite);s.add(n).then(),e.shell.add(n,"main")}}}),e.commands.addCommand(ct.addFileToCat,{label:"Add to NaaVRE catalogue",caption:"Add this file to the NaaVRE assets catalogue",icon:st,execute:e=>{const t=n.tracker.currentWidget,r=null==t?void 0:t.selectedItems().next();void 0===r||r.done||async function(e,t){const n=l.Notification.emit(`Uploading\n${e.name}`,"in-progress",{autoClose:!1});try{const a=new we.ContentsManager,r=await a.get(e.path),o=function(e){const t=ye(e);switch(t){case"ipynb":return"notebook-files";case"naavrewf":return"workflow-files";default:throw`unsupported file extension: ${t}`}}(e);if(void 0===t.catalogueServiceUrl)throw"catalogue service URL is undefined";const s=await async function(e,t){const n=await(0,ee.NaaVREExternalService)("POST",e,{accept:"application/json"},{filename:t,content_type:"application/json"});if(200!==n.status_code)throw`${n.status_code} ${n.reason}`;return JSON.parse(n.content)}(`${t.catalogueServiceUrl}/${o}/presign/`,e.name),c=function(e){const t=ye(e);switch(t){case"ipynb":return JSON.stringify(e.content);case"naavrewf":return e.content;default:throw`unsupported file extension: ${t}`}}(r);await async function(e,t){const n=await fetch(e,{method:"PUT",headers:{"Content-Type":"application/json"},body:t});if(!n.ok)throw new Error(`Failed to upload file: ${n.statusText}`)}(s.url,c),async function(e,t){const n=await(0,ee.NaaVREExternalService)("POST",e,{accept:"application/json"},t);if(201!==n.status_code)throw`${n.status_code} ${n.reason}`}(`${t.catalogueServiceUrl}/${o}/`,{virtual_lab:t.virtualLab||void 0,title:e.name,key:s.key}),l.Notification.update({id:n,type:"success",message:`Uploaded\n${e.name}`,autoClose:5e3})}catch(t){throw l.Notification.update({id:n,type:"error",message:`Could not upload file\n${e.name}\n${t}`,autoClose:5e3}),console.error("Error uploading or opening file",t),t}}(r.value,a.composite).then()}});for(const t of["notebook","naavrewf"])e.contextMenu.addItem({command:ct.addFileToCat,selector:`.jp-DirListing-item[data-file-type="${t}"]`,rank:50})}).catch(e=>{console.error("Failed to load settings for @naavre/catalogue-jupyterlab.",e)})}},dt=ut}}]);