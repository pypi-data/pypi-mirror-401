{
    "name": "amtrak_routine",
    "description": "A routine to search for trains on Amtrak",
    "incognito": true,
    "operations": [
        {"type": "navigate", "url": "https://www.amtrak.com/"},
        {"type": "sleep", "timeout_seconds": 2.0},
        {
            "type": "fetch",
            "endpoint": {
                "description": "Amtrak station/location autocomplete. GET with query parameter searchTerm; returns JSON with autoCompleterResponse.autoCompleteList.",
                "url": "https://www.amtrak.com/services/MapDataService/AutoCompleterArcgis/getResponseList?searchTerm=\"{{origin}}\"",
                "method": "GET",
                "headers": {"Accept": "application/json, text/plain, */*"},
                "body": {},
                "credentials": "same-origin"
            },
            "session_storage_key": "amtrak_autocomplete_stations_origin"
        },
        {
            "type": "fetch",
            "endpoint": {
                "description": "Amtrak station/location autocomplete. GET with query parameter searchTerm; returns JSON with autoCompleterResponse.autoCompleteList.",
                "url": "https://www.amtrak.com/services/MapDataService/AutoCompleterArcgis/getResponseList?searchTerm=\"{{destination}}\"",
                "method": "GET",
                "headers": {"Accept": "application/json, text/plain, */*"},
                "body": {},
                "credentials": "same-origin"
            },
            "session_storage_key": "amtrak_autocomplete_stations_destination"
        },
        {
            "type": "sleep",
            "timeout_seconds": 3.0
        },
        {
            "type": "fetch",
            "endpoint": {
                "description": "Look for one-way amtrak tickets",
                "url": "https://www.amtrak.com/dotcom/journey-solution-option",
                "method": "POST",
                "headers": {
                    "Content-Type": "application/json",
                    "Origin": "https://www.amtrak.com",
                    "Referer": "https://www.amtrak.com",
                    "Accept": "application/json, text/plain, */*",
                    "x-amtrak-trace-id": "{{sessionStorage:ibsession.sessionid}}"
                },
                "body": {
                    "journeyRequest": {
                        "fare": {"pricingUnit": "DOLLARS"},
                        "alternateDayOption": false,
                        "type": "OW",
                        "journeyLegRequests": [
                            {
                                "origin": {
                                    "code": "{{sessionStorage:amtrak_autocomplete_stations_origin.autoCompleterResponse.autoCompleteList.0.stationCode}}",
                                    "schedule": {"departureDateTime": "\"{{departureDate}}\"T00:00:00"}
                                },
                                "destination": {
                                    "code": "{{sessionStorage:amtrak_autocomplete_stations_destination.autoCompleterResponse.autoCompleteList.0.stationCode}}"
                                },
                                "passengers": [
                                    {"id": "P1", "type": "F", "initialType": "adult"}
                                ]
                            }
                        ],
                        "customer": {"tierStatus": "MEMBER"},
                        "isPassRider": false,
                        "isCorporateTraveller": false,
                        "tripTags": true,
                        "singleAdultFare": true,
                        "cascadesWSDOTFilter": false
                    },
                    "initialJourneyLegOnly": false,
                    "reservableAccomodationOptions": "ALL"
                },
                "credentials": "same-origin"
            },
            "session_storage_key": "amtrak_search_one_way"
        },
        {
            "type": "return",
            "session_storage_key": "amtrak_search_one_way"
        }
    ],
    "parameters": [
        {
            "name": "origin",
            "description": "The origin city or station code",
            "type": "string",
            "required": true
        },
        {
            "name": "destination",
            "description": "The destination city or station code",
            "type": "string",
            "required": true
        },
        {
            "name": "departureDate",
            "description": "The departure date",
            "type": "string",
            "required": true
        }
    ]
}