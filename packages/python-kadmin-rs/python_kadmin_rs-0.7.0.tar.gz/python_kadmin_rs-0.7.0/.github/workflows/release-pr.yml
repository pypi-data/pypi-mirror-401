---
name: Create release PR

on:
  workflow_dispatch:
    inputs:
      package:
        description: Package to release
        required: true
        type: choice
        options:
          - kadmin
      version:
        description: Version to release
        required: true
        type: string

env:
  DEBIAN_FRONTEND: noninteractive
  CARGO_INCREMENTAL: "false"

jobs:
  release-pr:
    permissions:
      id-token: write
      pull-requests: write
      contents: write
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      - uses: chainguard-dev/actions/setup-gitsign@45b63119e860d7dc145c2b11f29be65b2c44e9ac # main
      - uses: actions-rust-lang/setup-rust-toolchain@1780873c7b576612439a134613cc4cc74ce5538c # v1.15.2
      - uses: taiki-e/install-action@2e9d707ef49c9b094d45955b60c7e5c0dfedeb14 # v2.66.5
        with:
          tool: just,cargo-release,cargo-workspaces
      - run: just ci-build-deps
      - uses: cargo-bins/release-pr@0c019c0e5a6b9f722578d231d43ba900cacc5ffa # v2.1.3
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          version: ${{ inputs.version }}
          crate-name: ${{ inputs.package }}
          pr-label: release
