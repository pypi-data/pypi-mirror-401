name: add_gitignore
version: "0.1.0"
description: "Creates a .gitignore file with appropriate patterns for the specified project type"

inputs:
  - name: target_dir
    type: path
    description: "Target directory for the project"
    required: true

  - name: project_type
    type: string
    description: "Project type: python, node, or rust"
    required: true

preconditions:
  - "Target directory must exist"

steps:
  - id: create_gitignore
    type: shell
    name: "Create .gitignore for project type"
    cwd: "{sandbox_dir}"
    command: |
      case "{project_type}" in
        python)
          cat > .gitignore << 'EOF'
      # Byte-compiled / optimized / DLL files
      __pycache__/
      *.py[cod]
      *$py.class

      # Virtual environments
      .venv/
      venv/
      ENV/

      # Distribution / packaging
      dist/
      build/
      *.egg-info/
      *.egg

      # IDE
      .idea/
      .vscode/
      *.swp
      *.swo

      # Testing
      .pytest_cache/
      .coverage
      htmlcov/
      .tox/

      # Environment
      .env
      .env.local

      # OS
      .DS_Store
      Thumbs.db
      EOF
          ;;
        node)
          cat > .gitignore << 'EOF'
      # Dependencies
      node_modules/

      # Build output
      dist/
      build/
      .next/

      # IDE
      .idea/
      .vscode/
      *.swp
      *.swo

      # Testing
      coverage/

      # Environment
      .env
      .env.local
      .env.*.local

      # Logs
      *.log
      npm-debug.log*
      yarn-debug.log*
      yarn-error.log*

      # OS
      .DS_Store
      Thumbs.db
      EOF
          ;;
        rust)
          cat > .gitignore << 'EOF'
      # Generated by Cargo
      /target/
      Cargo.lock

      # IDE
      .idea/
      .vscode/
      *.swp
      *.swo

      # Environment
      .env

      # OS
      .DS_Store
      Thumbs.db

      # Backup files
      **/*.rs.bk
      EOF
          ;;
        *)
          echo "Unknown project type: {project_type}"
          exit 1
          ;;
      esac

checks:
  - id: check_gitignore_exists
    type: file_exists
    path: "{sandbox_dir}/.gitignore"

  - id: check_step_exit_code
    type: exit_code
    step_id: create_gitignore
    equals: 0
