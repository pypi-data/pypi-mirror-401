# Vibe Tools æŠ€æœ¯æ¶æ„

> "ç®€å•æ¶æ„ï¼Œå¼ºå¤§åŠŸèƒ½" - Vibe Tools æŠ€æœ¯å®ç°è¯¦è§£

## ğŸ—ï¸ æ•´ä½“æ¶æ„æ¦‚è§ˆ

### ç³»ç»Ÿåˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·ç•Œé¢å±‚                      â”‚
â”‚         CLI + äº¤äº’å¼èœå• + Rich æ˜¾ç¤º             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   åº”ç”¨é€»è¾‘å±‚                      â”‚
â”‚        å‘½ä»¤è§£æ + èœå•å¯¼èˆª + ä¸šåŠ¡æµç¨‹           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   å·¥å…·æŠ½è±¡å±‚                      â”‚
â”‚        BaseTool + æ’ä»¶ç³»ç»Ÿ + å·¥å…·æ³¨å†Œ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   ç³»ç»Ÿæ¥å£å±‚                      â”‚
â”‚        ç¯å¢ƒæ£€æµ‹ + åŒ…ç®¡ç† + Shell æ“ä½œ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   æ“ä½œç³»ç»Ÿå±‚                      â”‚
â”‚        è¿›ç¨‹æ‰§è¡Œ + æ–‡ä»¶æ“ä½œ + ç½‘ç»œè¯·æ±‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—ä¸“æ³¨ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½
2. **ä¾èµ–å€’ç½®**: é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—çš„å…·ä½“å®ç°
3. **æ’ä»¶æ‰©å±•**: æ–°åŠŸèƒ½é€šè¿‡æ’ä»¶è€Œéä¿®æ”¹æ ¸å¿ƒä»£ç 
4. **é”™è¯¯éš”ç¦»**: å•ç‚¹æ•…éšœä¸å½±å“æ•´ä½“ç³»ç»Ÿç¨³å®šæ€§

## ğŸ› ï¸ æŠ€æœ¯æ ˆé€‰æ‹©

### æ ¸å¿ƒæŠ€æœ¯

| æŠ€æœ¯ç»„ä»¶ | é€‰æ‹© | ç‰ˆæœ¬ | é€‰æ‹©ç†ç”± |
|----------|------|------|----------|
| **Python** | 3.8+ | ç³»ç»Ÿå…¼å®¹æ€§å¥½ï¼Œä¸°å¯Œçš„ç”Ÿæ€ |
| **Click** | 8.0+ | æˆç†Ÿçš„ CLI æ¡†æ¶ï¼Œæ¸…æ™°çš„è£…é¥°å™¨è¯­æ³• |
| **Rich** | 13.0+ | ç°ä»£åŒ–ç»ˆç«¯æ˜¾ç¤ºï¼Œäº¤äº’å¼ UI |
| **Pyproject.toml** | æ ‡å‡† | ç°ä»£ Python æ‰“åŒ…æ ‡å‡†ï¼Œå‘åå…¼å®¹ |

### æ„å»ºå’Œå‘å¸ƒ

| å·¥å…· | ç”¨é€” | é…ç½® |
|------|------|------|
| **Hatchling** | æ„å»º | ç°ä»£åŒ–æ„å»ºåç«¯ï¼Œé›¶é…ç½® |
| **Twine** | å‘å¸ƒ | PyPI å®˜æ–¹å‘å¸ƒå·¥å…· |
| **pip** | åŒ…ç®¡ç† | æ ‡å‡† Python åŒ…ç®¡ç†å™¨ |

## ğŸ›ï¸ æ¨¡å—æ¶æ„è¯¦è§£

### 1. CLI å…¥å£æ¨¡å— (`cli.py`)

```python
# ä¸»å…¥å£è®¾è®¡
@click.group()
@click.option("--verbose")
@click.option("--dry-run")
def cli(verbose, dry_run):
    """ä¸»å‘½ä»¤ç»„"""
    pass

@cli.command()
@click.argument("tools", nargs=-1)
@click.option("--interactive", default=True)
def install(tools, interactive):
    """å·¥å…·å®‰è£…å‘½ä»¤"""
    if interactive and not tools:
        show_interactive_menu()
```

**è®¾è®¡ç‰¹ç‚¹**:
- **è£…é¥°å™¨æ¨¡å¼**: ä½¿ç”¨ Click è£…é¥°å™¨ç®€åŒ–å‘½ä»¤å®šä¹‰
- **å‚æ•°éªŒè¯**: è‡ªåŠ¨ç±»å‹æ£€æŸ¥å’Œå¸®åŠ©ç”Ÿæˆ
- **ä¸Šä¸‹æ–‡ä¼ é€’**: é€šè¿‡ click.Context ä¼ é€’å…¨å±€çŠ¶æ€

### 2. ç”¨æˆ·ç•Œé¢æ¨¡å— (`ui/`)

#### Rich æ˜¾ç¤ºç»„ä»¶ (`display.py`)

```python
class DisplayManager:
    def __init__(self, console=None):
        self.console = console or Console()
    
    def show_banner(self, title, subtitle=""):
        """æ˜¾ç¤ºç¨‹åºæ ‡é¢˜æ¨ªå¹…"""
        # ä½¿ç”¨ Rich Panel + Text åˆ›å»ºç¾è§‚ç•Œé¢
        
    def show_progress(self, message, progress=None):
        """æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯"""
        # Rich Progress ç»„ä»¶æä¾›å®æ—¶åé¦ˆ
```

**è®¾è®¡ä¼˜åŠ¿**:
- **ä¸»é¢˜ä¸€è‡´æ€§**: ç»Ÿä¸€çš„è§†è§‰é£æ ¼
- **å“åº”å¼å¸ƒå±€**: é€‚åº”ä¸åŒç»ˆç«¯å¤§å°
- **æ— é—ªçƒ**: ä½¿ç”¨ Rich çš„å±å¹•æ›´æ–°æœºåˆ¶

#### äº¤äº’å¼èœå• (`menu.py`)

```python
def show_main_menu(console) -> str:
    """æ˜¾ç¤ºä¸»èœå•"""
    # çŠ¶æ€: æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯
    # é€‰é¡¹: åˆ†ç±»çš„åŠŸèƒ½èœå•
    # å¯¼èˆª: é”®ç›˜è¾“å…¥å¤„ç†
    
def handle_menu_selection(choice, console) -> None:
    """å¤„ç†èœå•é€‰æ‹©"""
    # è·¯ç”±: é€‰æ‹©åˆ°å…·ä½“åŠŸèƒ½
    # æ‰§è¡Œ: è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°
```

### 3. æ ¸å¿ƒä¸šåŠ¡æ¨¡å— (`core/`)

#### ç³»ç»Ÿæ£€æµ‹å™¨ (`detector.py`)

```python
class SystemDetector:
    def __init__(self):
        self.system_info = self._detect_system()
        self.installed_tools = self._detect_tools()
    
    def _detect_system(self):
        """æ£€æµ‹ç³»ç»ŸåŸºç¡€ä¿¡æ¯"""
        return {
            "os": platform.system(),
            "shell": self._detect_shell(),
            "python_version": platform.python_version(),
        }
    
    def _check_tool(self, tool_name, version_cmd):
        """æ£€æŸ¥å•ä¸ªå·¥å…·"""
        # æ£€æŸ¥å‘½ä»¤æ˜¯å¦å­˜åœ¨
        # æ‰§è¡Œç‰ˆæœ¬æŸ¥è¯¢
        # è§£æç‰ˆæœ¬ä¿¡æ¯
        return {
            "installed": bool,
            "version": str,
            "path": str,
        }
```

**æ£€æµ‹èƒ½åŠ›**:
- **æ“ä½œç³»ç»Ÿ**: Windows, macOS, Linux è¯†åˆ«
- **Shell ç¯å¢ƒ**: bash, zsh, fish, powershell
- **å·¥å…·çŠ¶æ€**: ç‰ˆæœ¬æ£€æµ‹ã€è·¯å¾„å®šä½ã€è¿è¡ŒçŠ¶æ€
- **æƒé™æ£€æŸ¥**: æ–‡ä»¶æƒé™ã€ç½‘ç»œè®¿é—®ã€æ‰§è¡Œæƒé™

#### å·¥å…·å®‰è£…å™¨ (`installer.py`)

```python
class BaseTool(ABC):
    """å·¥å…·åŸºç±»"""
    @abstractmethod
    def detect(self) -> bool: pass
    
    @abstractmethod
    def install(self) -> InstallResult: pass
    
    @abstractmethod
    def verify(self) -> bool: pass

class UVTool(BaseTool):
    def install(self) -> InstallResult:
        """UV å®‰è£…å®ç°"""
        # 1. æ£€æŸ¥é¢„å®‰è£…
        # 2. æ‰§è¡Œå®‰è£…è„šæœ¬
        # 3. é…ç½®ç¯å¢ƒå˜é‡
        # 4. éªŒè¯å®‰è£…ç»“æœ
```

**æ’ä»¶æ¶æ„ä¼˜åŠ¿**:
- **æ‰©å±•æ€§**: æ–°å·¥å…·åªéœ€ç»§æ‰¿ BaseTool
- **ä¸€è‡´æ€§**: ç»Ÿä¸€çš„æ¥å£å’Œè¡Œä¸ºæ¨¡å¼
- **é”™è¯¯å¤„ç†**: æ¯ä¸ªå·¥å…·ç‹¬ç«‹çš„é”™è¯¯å¤„ç†
- **å›æ»šæœºåˆ¶**: å®‰è£…å¤±è´¥æ—¶è‡ªåŠ¨æ¸…ç†

### 4. å·¥å…·é›†æˆæ¨¡å— (`tools/`)

```python
# æ”¯æŒçš„å·¥å…·ç±»å‹
SUPPORTED_TOOLS = {
    "python": ["uv", "poetry", "pre-commit", "ruff"],
    "nodejs": ["node", "npm", "pnpm", "nvm"],
    "git": ["git", "git-lfs", "gh"],
    "containers": ["docker", "docker-compose"],
    "editors": ["code", "cursor", "nvim"],
}

# å·¥å…·ä¾èµ–ç®¡ç†
DEPENDENCY_GRAPH = {
    "poetry": ["python"],
    "pre-commit": ["python", "git"],
    "docker": ["git"],
}
```

### 5. å·¥å…·å‡½æ•°æ¨¡å— (`utils/`)

```python
class ShellHelper:
    @staticmethod
    def execute_command(cmd, timeout=300, capture=True):
        """å®‰å…¨çš„å‘½ä»¤æ‰§è¡Œ"""
        
    @staticmethod
    def add_to_path(path, shell_file=None):
        """æ·»åŠ è·¯å¾„åˆ°ç¯å¢ƒå˜é‡"""
        
    @staticmethod
    def source_file(file_path):
        """æ¨¡æ‹Ÿ source å‘½ä»¤"""
```

## ğŸ”„ æ•°æ®æµè®¾è®¡

### å·¥å…·å®‰è£…æµç¨‹

```
ç”¨æˆ·è¯·æ±‚ â†’ ç¯å¢ƒæ£€æµ‹ â†’ å·¥å…·é€‰æ‹© â†’ ä¾èµ–è§£æ â†’ å®‰è£…æ‰§è¡Œ â†’ éªŒè¯ç¡®è®¤ â†’ çŠ¶æ€æ›´æ–°
    â†“           â†“           â†“         â†“         â†“         â†“         â†“
 uvx vibe-tools â†’ SystemDetector â†’ MenuRouter â†’ DepResolver â†’ ToolInstaller â†’ VerifyTool â†’ StateManager
```

### é”™è¯¯å¤„ç†ç­–ç•¥

```python
class InstallError(Exception):
    def __init__(self, tool_name, error_type, details):
        self.tool_name = tool_name
        self.error_type = error_type
        self.details = details

# é”™è¯¯åˆ†ç±»
ERROR_TYPES = {
    "network": "ç½‘ç»œè¿æ¥é—®é¢˜",
    "permission": "æƒé™ä¸è¶³", 
    "dependency": "ä¾èµ–å†²çª",
    "timeout": "æ“ä½œè¶…æ—¶",
    "unknown": "æœªçŸ¥é”™è¯¯",
}
```

## ğŸ“¦ é…ç½®ç®¡ç†

### é…ç½®æ–‡ä»¶ç»“æ„

```toml
# ~/.vibe-tools/config.toml
[general]
default_language = "zh-CN"
auto_update = true
telemetry = false

[tools]
auto_install_dependencies = true
preferred_versions = { uv = "latest", node = "lts" }

[ui]
theme = "auto"
show_tips = true
```

### é…ç½®ä¼˜å…ˆçº§

1. **å‘½ä»¤è¡Œå‚æ•°** (`--config file.toml`)
2. **ç¯å¢ƒå˜é‡** (`VIBE_TOOLS_CONFIG=/path/to/config`)
3. **ç”¨æˆ·é…ç½®** (`~/.vibe-tools/config.toml`)
4. **ç³»ç»Ÿé…ç½®** (`/etc/vibe-tools/config.toml`)
5. **é»˜è®¤é…ç½®** (å†…ç½®é»˜è®¤å€¼)

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### å¯åŠ¨æ€§èƒ½

```python
# æ‡’åŠ è½½å·¥å…·æ£€æµ‹
@lru_cache(maxsize=1)
def get_system_info():
    return SystemDetector().get_system_info()

# å¼‚æ­¥å·¥å…·æ£€æµ‹
async def detect_tools_async(tools):
    tasks = [detect_tool_async(tool) for tool in tools]
    return await asyncio.gather(*tasks)
```

### å†…å­˜ä¼˜åŒ–

```python
# æœ€å°åŒ– Rich å¯¹è±¡åˆ›å»º
console = Console()  # å…¨å±€å•ä¾‹

# æµå¼å¤„ç†å¤§æ–‡ä»¶
def process_large_file(file_path):
    with open(file_path, 'r', buffering=1024) as f:
        for line in f:
            yield process_line(line)
```

## ğŸ”§ æ‰©å±•æ€§è®¾è®¡

### æ’ä»¶å‘ç°æœºåˆ¶

```python
# è‡ªåŠ¨å‘ç°æ’ä»¶
def discover_plugins():
    plugins = []
    for plugin_dir in PLUGIN_DIRS:
        if os.path.exists(plugin_dir):
            plugins.extend(load_plugins_from_dir(plugin_dir))
    return plugins

# æ’ä»¶æ³¨å†Œ
def register_plugin(plugin_class):
    if issubclass(plugin_class, BaseTool):
        AVAILABLE_TOOLS[plugin_class.name] = plugin_class
```

### äº‹ä»¶ç³»ç»Ÿ

```python
class EventBus:
    def __init__(self):
        self._listeners = defaultdict(list)
    
    def emit(self, event_type, data):
        for listener in self._listeners[event_type]:
            listener(data)
    
    def on(self, event_type, callback):
        self._listeners[event_type].append(callback)

# ä½¿ç”¨ç¤ºä¾‹
event_bus.on("tool_installed", update_ui)
event_bus.emit("tool_installed", {"tool": "uv", "version": "0.5.0"})
```

## ğŸ§ª æµ‹è¯•æ¶æ„

### å•å…ƒæµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ unit/                # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_detector.py
â”‚   â”œâ”€â”€ test_installer.py
â”‚   â””â”€â”€ test_menu.py
â”œâ”€â”€ integration/         # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_full_workflow.py
â”‚   â””â”€â”€ test_tool_installation.py
â””â”€â”€ fixtures/           # æµ‹è¯•æ•°æ®
    â”œâ”€â”€ mock_system.py
    â””â”€â”€ fake_commands.py
```

### æµ‹è¯•ç­–ç•¥

```python
# Mock ç³»ç»Ÿè°ƒç”¨
@patch('shutil.which')
def test_tool_detection(mock_which):
    mock_which.return_value = "/usr/bin/uv"
    detector = SystemDetector()
    assert detector.is_tool_installed("uv")
    assert detector.get_tool_version("uv") != "unknown"

# éš”ç¦»æµ‹è¯•ç¯å¢ƒ
class TestEnvironment:
    def __enter__(self):
        self.original_env = os.environ.copy()
        # è®¾ç½®æµ‹è¯•ç¯å¢ƒ
        os.environ.update(self.test_env)
    
    def __exit__(self, exc_type, exc_val, exc_tb):
        os.environ.clear()
        os.environ.update(self.original_env)
```

## ğŸ“Š ç›‘æ§å’Œè¯Šæ–­

### æ€§èƒ½æŒ‡æ ‡

```python
# æ€§èƒ½ç›‘æ§
class PerformanceMonitor:
    def __init__(self):
        self.metrics = {}
    
    def time_operation(self, operation_name):
        @contextmanager
        def wrapper():
            start = time.time()
            try:
                yield
            finally:
                duration = time.time() - start
                self.record_metric(operation_name, duration)
        return wrapper
    
    def record_metric(self, name, value):
        self.metrics[name] = value
```

### é”™è¯¯è¿½è¸ª

```python
# é”™è¯¯æ”¶é›†
class ErrorReporter:
    def __init__(self):
        self.error_log = []
    
    def report_error(self, error, context):
        error_data = {
            "timestamp": datetime.now().isoformat(),
            "error_type": type(error).__name__,
            "message": str(error),
            "context": context,
            "system_info": get_system_info(),
        }
        self.error_log.append(error_data)
```

## ğŸš€ æœªæ¥æ¶æ„æ¼”è¿›

### å¾®æœåŠ¡åŒ–å‡†å¤‡

```python
# æ¥å£æŠ½è±¡
class BackendInterface:
    def get_tool_info(self, tool_name): pass
    def download_tool(self, tool_url, target_path): pass

# å¤šåç«¯æ”¯æŒ
class LocalBackend(BackendInterface):
    # æœ¬åœ°å®‰è£…å®ç°
    
class CloudBackend(BackendInterface):
    # äº‘ç«¯å®‰è£…å®ç°
```

### AI é›†æˆæ¶æ„

```python
# AI å†³ç­–æ¥å£
class AIAdvisor:
    def recommend_tools(self, project_type, user_preferences):
        """åŸºäºé¡¹ç›®ç±»å‹æ¨èå·¥å…·"""
        return self._ml_model.predict(project_type, user_preferences)
    
    def optimize_installation_order(self, tools, constraints):
        """ä¼˜åŒ–å®‰è£…é¡ºåºä»¥æœ€å°åŒ–ä¾èµ–å†²çª"""
        return self._algorithm.optimize(tools, constraints)
```

---

## ğŸ“ æ€»ç»“

Vibe Tools çš„æŠ€æœ¯æ¶æ„ä½“ç°äº†ä»¥ä¸‹æ ¸å¿ƒä»·å€¼ï¼š

1. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»å’Œæ¥å£è®¾è®¡
2. **å¯æ‰©å±•æ€§**: æ’ä»¶åŒ–æ¶æ„æ”¯æŒæ— é™æ‰©å±•
3. **å¯æµ‹è¯•æ€§**: å®Œæ•´çš„æµ‹è¯•ç­–ç•¥å’Œ Mock æœºåˆ¶
4. **æ€§èƒ½ä¼˜åŒ–**: æ‡’åŠ è½½ã€ç¼“å­˜ã€å¼‚æ­¥å¤„ç†
5. **é”™è¯¯å¤„ç†**: å…¨é¢çš„é”™è¯¯åˆ†ç±»å’Œæ¢å¤æœºåˆ¶
6. **ç”¨æˆ·ä½“éªŒ**: ä¸€è‡´çš„ç•Œé¢å’Œæ¸è¿›å¼äº¤äº’

è¿™ä¸ªæ¶æ„ä¸ä»…è§£å†³äº†å½“å‰çš„éœ€æ±‚ï¼Œæ›´ä¸ºæœªæ¥çš„å‘å±•å¥ å®šäº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚