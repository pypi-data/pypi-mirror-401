<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="../../../">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>molecular_simulations.analysis.autocluster &mdash; molecular-simulations 0.3.28 documentation</title>
    
    <link rel="stylesheet" type="text/css" href="../../../_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
            <link rel="index" title="Index" href="../../../genindex.html" />
            <link rel="search" title="Search" href="../../../search.html" />
            <link rel="top" title="molecular-simulations 0.3.28 documentation" href="#" />
            <link rel="up" title="Module code" href="../../index.html" />
    </head>
<body>
    <script type="text/javascript" src="../../../_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="../../../index.html"
                        title="Wagtail"
                        class="logo navbar-brand"
                    >
                        <img src="../../../_static/img/wagtail-logo-circle.svg" width="45" height="59" alt="Wagtail"
                            class="logo-img"
                        />
                        molecular-simulations
                    </a>
                
                
                    <div class="collapse navbar-collapse justify-content-end">
                        <ul class="navbar-nav">
                            
                                
                                
                                <li class="nav-item"><a class="nav-link"  href="/index">Documentation</a></li>
                            
                        </ul>
                    </div>
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="../../../search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/basic_simulation.html">Basic Protein Simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/ligand_systems.html">Protein-Ligand Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/hpc_deployment.html">HPC Deployment with Parsl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/analysis_workflows.html">Analysis Workflows</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/overview.html">API Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/modules.html">molecular_simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/molecular_simulations.html">molecular_simulations package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/molecular_simulations.analysis.html">molecular_simulations.analysis package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.analysis.autocluster.html">molecular_simulations.analysis.autocluster module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.analysis.constant_pH_analysis.html">molecular_simulations.analysis.constant_pH_analysis module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.analysis.cov_ppi.html">molecular_simulations.analysis.cov_ppi module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.analysis.fingerprinter.html">molecular_simulations.analysis.fingerprinter module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.analysis.interaction_energy.html">molecular_simulations.analysis.interaction_energy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.analysis.ipSAE.html">molecular_simulations.analysis.ipSAE module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.analysis.sasa.html">molecular_simulations.analysis.sasa module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.analysis.utils.html">molecular_simulations.analysis.utils module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/molecular_simulations.build.html">molecular_simulations.build package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.build.build_amber.html">molecular_simulations.build.build_amber module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.build.build_calvados.html">molecular_simulations.build.build_calvados module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.build.build_interface.html">molecular_simulations.build.build_interface module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.build.build_ligand.html">molecular_simulations.build.build_ligand module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/molecular_simulations.simulate.html">molecular_simulations.simulate package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.simulate.free_energy.html">molecular_simulations.simulate.free_energy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.simulate.mmpbsa.html">molecular_simulations.simulate.mmpbsa module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.simulate.multires_simulator.html">molecular_simulations.simulate.multires_simulator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.simulate.omm_simulator.html">molecular_simulations.simulate.omm_simulator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.simulate.reporters.html">molecular_simulations.simulate.reporters module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/molecular_simulations.utils.html">molecular_simulations.utils package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.utils.amber_utils.html">molecular_simulations.utils.amber_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.utils.mda_utils.html">molecular_simulations.utils.mda_utils module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../api/molecular_simulations.utils.parsl_settings.html">molecular_simulations.utils.parsl_settings module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/molecular_simulations.logging_config.html">molecular_simulations.logging_config module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="../../../index.html">Docs</a></li>
            <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
        <li class="breadcrumb-item active" aria-current="page">molecular_simulations.analysis.autocluster</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/wagtail/sphinx_wagtail_theme/blob/main/docs/_modules/molecular_simulations/analysis/autocluster" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <h1>Source code for molecular_simulations.analysis.autocluster</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Automated clustering module for molecular dynamics data.</span>

<span class="sd">This module provides tools for automatic clustering of molecular dynamics</span>
<span class="sd">trajectory data using KMeans++ with dimensionality reduction.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">silhouette_score</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">Union</span>

<span class="n">PathLike</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;_T&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="GenericDataloader">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.GenericDataloader">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GenericDataloader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads generic data stored in numpy arrays.</span>

<span class="sd">    Stores the full dataset and is capable of loading data with variable</span>
<span class="sd">    row lengths but must be consistent in the columnar dimension.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        files: List of paths to the loaded data files.</span>
<span class="sd">        data_array: The concatenated data array.</span>
<span class="sd">        shapes: List of shapes of the original data files.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_files: List of paths to input data files (.npy format).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; loader = GenericDataloader([&#39;data1.npy&#39;, &#39;data2.npy&#39;])</span>
<span class="sd">        &gt;&gt;&gt; print(loader.data.shape)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="GenericDataloader.__init__">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.GenericDataloader.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PathLike</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the dataloader with a list of data files.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_files: List of paths to input data files (.npy format).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="n">data_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span></div>


<div class="viewcode-block" id="GenericDataloader.load_data">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.GenericDataloader.load_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load and concatenate data from all files into one array.</span>

<span class="sd">        Lumps data into one large array by vertical stacking. If the</span>
<span class="sd">        resulting array has more than 2 dimensions, it is reshaped to 2D.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">shape2</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">y</span><span class="p">:</span>
                <span class="n">shape2</span> <span class="o">*=</span> <span class="n">shape</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shape2</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the internal data array.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The concatenated and reshaped data array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the shape(s) of the input data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            If all input files have the same shape, returns that shape.</span>
<span class="sd">            Otherwise, returns a list of shapes in the order the files</span>
<span class="sd">            were provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span></div>



<div class="viewcode-block" id="PeriodicDataloader">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.PeriodicDataloader">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PeriodicDataloader</span><span class="p">(</span><span class="n">GenericDataloader</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataloader that decomposes periodic data using sin and cos.</span>

<span class="sd">    Extends GenericDataloader to handle periodic data by decomposing</span>
<span class="sd">    each feature into sin and cos components, effectively doubling</span>
<span class="sd">    the number of features.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_files: List of paths to input data files containing</span>
<span class="sd">            periodic data (e.g., dihedral angles).</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; loader = PeriodicDataloader([&#39;dihedrals.npy&#39;])</span>
<span class="sd">        &gt;&gt;&gt; # Original 10 features become 20 features</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PeriodicDataloader.__init__">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.PeriodicDataloader.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PathLike</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the periodic dataloader.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_files: List of paths to input data files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data_files</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="PeriodicDataloader.load_data">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.PeriodicDataloader.load_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load periodic data and remove periodicity.</span>

<span class="sd">        Loads each file, applies the periodicity removal transformation,</span>
<span class="sd">        and stores the results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_periodicity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_array</span><span class="p">)</span></div>


<div class="viewcode-block" id="PeriodicDataloader.remove_periodicity">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.PeriodicDataloader.remove_periodicity">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">remove_periodicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove periodicity from each feature using sin and cos.</span>

<span class="sd">        Each column is expanded into two columns such that the indices</span>
<span class="sd">        become i -&gt; 2*i, 2*i + 1. This preserves the circular nature</span>
<span class="sd">        of periodic variables like angles.</span>

<span class="sd">        Args:</span>
<span class="sd">            arr: Data array with periodic features. Shape should be</span>
<span class="sd">                (n_samples, n_features).</span>

<span class="sd">        Returns:</span>
<span class="sd">            New array with shape (arr.shape[0], arr.shape[1] * 2) where</span>
<span class="sd">            each original feature is replaced by its cos and sin values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_features</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">return_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_features</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_features</span><span class="p">):</span>
            <span class="n">return_arr</span><span class="p">[:,</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
            <span class="n">return_arr</span><span class="p">[:,</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">return_arr</span></div>
</div>



<div class="viewcode-block" id="AutoKMeans">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.AutoKMeans">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">AutoKMeans</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Automatic clustering using KMeans++ with dimensionality reduction.</span>

<span class="sd">    Performs automatic clustering including dimensionality reduction of</span>
<span class="sd">    the feature space and parameter sweep over number of clusters using</span>
<span class="sd">    silhouette score optimization.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        data: The loaded data array.</span>
<span class="sd">        shape: Shape of the input data.</span>
<span class="sd">        reduced: Dimensionality-reduced data.</span>
<span class="sd">        centers: Cluster centers in reduced space.</span>
<span class="sd">        labels: Cluster assignments for each data point.</span>
<span class="sd">        cluster_centers: Mapping of cluster index to (replica, frame) tuple.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_directory: Directory where data files can be found.</span>
<span class="sd">        pattern: Optional filename pattern to select subset of npy files</span>
<span class="sd">            using glob. Defaults to empty string (all .npy files).</span>
<span class="sd">        dataloader: Which dataloader class to use. Defaults to</span>
<span class="sd">            GenericDataloader.</span>
<span class="sd">        max_clusters: Maximum number of clusters to test during parameter</span>
<span class="sd">            sweep. Defaults to 10.</span>
<span class="sd">        stride: Linear stride of number of clusters during parameter sweep.</span>
<span class="sd">            Helps avoid testing too many values. Defaults to 1.</span>
<span class="sd">        reduction_algorithm: Which dimensionality reduction algorithm to</span>
<span class="sd">            use. Currently only &#39;PCA&#39; is supported. Defaults to &#39;PCA&#39;.</span>
<span class="sd">        reduction_kws: Keyword arguments for the reduction algorithm.</span>
<span class="sd">            Defaults to {&#39;n_components&#39;: 2}.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; clusterer = AutoKMeans(&#39;data/&#39;, max_clusters=15)</span>
<span class="sd">        &gt;&gt;&gt; clusterer.run()</span>
<span class="sd">        &gt;&gt;&gt; print(clusterer.cluster_centers)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="AutoKMeans.__init__">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.AutoKMeans.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data_directory</span><span class="p">:</span> <span class="n">PathLike</span><span class="p">,</span>
        <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">dataloader</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">_T</span><span class="p">]</span> <span class="o">=</span> <span class="n">GenericDataloader</span><span class="p">,</span>
        <span class="n">max_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">stride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">reduction_algorithm</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;PCA&#39;</span><span class="p">,</span>
        <span class="n">reduction_kws</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_components&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the automatic clustering workflow.</span>

<span class="sd">        Args:</span>
<span class="sd">            data_directory: Directory where data files can be found.</span>
<span class="sd">            pattern: Optional filename pattern for glob matching.</span>
<span class="sd">            dataloader: Dataloader class to use for loading data.</span>
<span class="sd">            max_clusters: Maximum number of clusters to test.</span>
<span class="sd">            stride: Step size for cluster number sweep.</span>
<span class="sd">            reduction_algorithm: Dimensionality reduction method.</span>
<span class="sd">            reduction_kws: Arguments for the reduction algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_directory</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">dataloader</span> <span class="o">=</span> <span class="n">dataloader</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s1">*.npy&#39;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">shape</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span> <span class="o">=</span> <span class="n">max_clusters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stride</span> <span class="o">=</span> <span class="n">stride</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decomposition</span> <span class="o">=</span> <span class="n">Decomposition</span><span class="p">(</span><span class="n">reduction_algorithm</span><span class="p">,</span> <span class="o">**</span><span class="n">reduction_kws</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="AutoKMeans.run">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.AutoKMeans.run">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run the complete automated clustering workflow.</span>

<span class="sd">        Executes dimensionality reduction, parameter sweep, center mapping,</span>
<span class="sd">        and saves results to disk.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduce_dimensionality</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_n_clusters</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_clusters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stride</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_centers_to_frames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_centers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_labels</span><span class="p">()</span></div>


<div class="viewcode-block" id="AutoKMeans.reduce_dimensionality">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.AutoKMeans.reduce_dimensionality">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reduce_dimensionality</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform dimensionality reduction on the data.</span>

<span class="sd">        Uses the configured decomposition algorithm to reduce the</span>
<span class="sd">        feature space dimensionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomposition</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>


<div class="viewcode-block" id="AutoKMeans.sweep_n_clusters">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.AutoKMeans.sweep_n_clusters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sweep_n_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_clusters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sweep over number of clusters to find optimal clustering.</span>

<span class="sd">        Uses silhouette score to perform a parameter sweep over number</span>
<span class="sd">        of clusters. Stores the cluster centers and labels for the best</span>
<span class="sd">        performing parameterization.</span>

<span class="sd">        Args:</span>
<span class="sd">            n_clusters: List of cluster numbers to test.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">best_centers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best_labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">best_score</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">n_clusters</span><span class="p">),</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
                      <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Sweeping `n_clusters`&#39;</span><span class="p">):</span>
            <span class="n">clusterer</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">clusterer</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduced</span><span class="p">)</span>
            <span class="n">average_score</span> <span class="o">=</span> <span class="n">silhouette_score</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduced</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">average_score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
                <span class="n">best_centers</span> <span class="o">=</span> <span class="n">clusterer</span><span class="o">.</span><span class="n">cluster_centers_</span>
                <span class="n">best_labels</span> <span class="o">=</span> <span class="n">labels</span>
                <span class="n">best_score</span> <span class="o">=</span> <span class="n">average_score</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">centers</span> <span class="o">=</span> <span class="n">best_centers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">best_labels</span></div>


<div class="viewcode-block" id="AutoKMeans.map_centers_to_frames">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.AutoKMeans.map_centers_to_frames">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">map_centers_to_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map cluster centers to the closest actual data points.</span>

<span class="sd">        Finds and stores the data point which lies closest to each</span>
<span class="sd">        cluster center, recording the replica and frame indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cluster_centers</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centers</span><span class="p">))}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">center</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">centers</span><span class="p">):</span>
            <span class="n">closest</span> <span class="o">=</span> <span class="mf">100.</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reduced</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dist</span> <span class="o">:=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">point</span> <span class="o">-</span> <span class="n">center</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">closest</span><span class="p">:</span>
                    <span class="n">rep</span> <span class="o">=</span> <span class="n">p</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">frame</span> <span class="o">=</span> <span class="n">p</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">cluster_centers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">rep</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>
                    <span class="n">closest</span> <span class="o">=</span> <span class="n">dist</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cluster_centers</span> <span class="o">=</span> <span class="n">cluster_centers</span></div>


<div class="viewcode-block" id="AutoKMeans.save_centers">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.AutoKMeans.save_centers">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save cluster centers to a JSON file.</span>

<span class="sd">        Writes the cluster_centers dictionary to &#39;cluster_centers.json&#39;</span>
<span class="sd">        in the data directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;cluster_centers.json&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fout</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster_centers</span><span class="p">,</span> <span class="n">fout</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></div>


<div class="viewcode-block" id="AutoKMeans.save_labels">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.AutoKMeans.save_labels">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">save_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save cluster labels to a Parquet file.</span>

<span class="sd">        Generates a Polars DataFrame containing system, frame, and cluster</span>
<span class="sd">        label assignments and saves to &#39;cluster_assignments.parquet&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">files</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataloader</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">shape</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">shapes</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;system&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">,</span> <span class="s1">&#39;frame&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">shape</span><span class="p">)})</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">temp</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">))</span>

        <span class="n">df</span><span class="o">.</span><span class="n">write_parquet</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;cluster_assignments.parquet&#39;</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="Decomposition">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.Decomposition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Decomposition</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for dimensionality reduction algorithms.</span>

<span class="sd">    Provides a thin wrapper around various dimensionality reduction</span>
<span class="sd">    algorithms using scikit-learn style methods.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        decomposer: The underlying decomposition algorithm instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        algorithm: Which algorithm to use. Options are &#39;PCA&#39;, &#39;TICA&#39;,</span>
<span class="sd">            and &#39;UMAP&#39;. Currently only &#39;PCA&#39; is fully supported.</span>
<span class="sd">        **kwargs: Algorithm-specific keyword arguments passed to the</span>
<span class="sd">            decomposer constructor.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; decomp = Decomposition(&#39;PCA&#39;, n_components=3)</span>
<span class="sd">        &gt;&gt;&gt; reduced_data = decomp.fit_transform(data)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Decomposition.__init__">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.Decomposition.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the decomposition wrapper.</span>

<span class="sd">        Args:</span>
<span class="sd">            algorithm: Name of the decomposition algorithm.</span>
<span class="sd">            **kwargs: Arguments passed to the algorithm constructor.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If an unsupported algorithm is specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">algorithms</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;PCA&#39;</span><span class="p">:</span> <span class="n">PCA</span><span class="p">,</span>
            <span class="s1">&#39;TICA&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;UMAP&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">decomposer</span> <span class="o">=</span> <span class="n">algorithms</span><span class="p">[</span><span class="n">algorithm</span><span class="p">](</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Decomposition.fit">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.Decomposition.fit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the decomposer with data.</span>

<span class="sd">        Args:</span>
<span class="sd">            X: Array of input data with shape (n_samples, n_features).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decomposer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>


<div class="viewcode-block" id="Decomposition.transform">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.Decomposition.transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform data using the fitted decomposer.</span>

<span class="sd">        Args:</span>
<span class="sd">            X: Array of input data with shape (n_samples, n_features).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Reduced dimension data with shape (n_samples, n_components).</span>

<span class="sd">        Raises:</span>
<span class="sd">            sklearn.exceptions.NotFittedError: If called before fit().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomposer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>


<div class="viewcode-block" id="Decomposition.fit_transform">
<a class="viewcode-back" href="../../../api/molecular_simulations.analysis.autocluster.html#molecular_simulations.analysis.autocluster.Decomposition.fit_transform">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fit the decomposer and transform data in one step.</span>

<span class="sd">        Args:</span>
<span class="sd">            X: Array of input data with shape (n_samples, n_features).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Reduced dimension data with shape (n_samples, n_components).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">decomposer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></div>
</div>

</pre></div>
</main>
                        
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/features/">Features</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/about-wagtail/"> About Wagtail</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/services/"> Services</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/blog/"> Blog</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/packages/"> Packages</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/developers/"> Developers</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2025, Matt Sinclair
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="../../../_static/documentation_options.js?v=11b5e5c7"></script>
        <script src="../../../_static/doctools.js?v=9bcbadda"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=fd10adb8"></script>
        <script type="text/javascript" src="../../../_static/dist/theme.js"></script>
        <script type="text/javascript" src="../../../_static/dist/vendor.js"></script>
        <script type="text/javascript" src="../../../_static/searchtools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("../../../searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>