Metadata-Version: 2.4
Name: ola-ra-nacos-sdk
Version: 0.2.0
Summary: ä¸€ä¸ªè½»é‡çº§çš„Python SDKï¼Œç”¨äºç›‘å¬Nacosé…ç½®ä¸­å¿ƒçš„é…ç½®å˜æ›´
Home-page: 
Author: RA Team
Author-email: 
License: MIT
Project-URL: Homepage, https://github.com/your-org/ra-common-sdk
Project-URL: Documentation, https://github.com/your-org/ra-common-sdk#readme
Project-URL: Repository, https://github.com/your-org/ra-common-sdk
Keywords: nacos,config,configuration,pydantic,settings
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.8
Description-Content-Type: text/markdown
Requires-Dist: nacos-sdk-python>=3.0.2
Requires-Dist: pydantic>=2.0.0
Requires-Dist: pydantic-settings>=2.0.0
Requires-Dist: httpx>=0.24.0
Provides-Extra: yaml
Requires-Dist: pyyaml>=6.0; extra == "yaml"
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: build>=1.0.0; extra == "dev"
Requires-Dist: twine>=4.0.0; extra == "dev"
Dynamic: requires-python

# Nacosé…ç½®ä¸­å¿ƒSDK

ä¸€ä¸ªè½»é‡çº§çš„Python SDKï¼Œç”¨äºç›‘å¬Nacosé…ç½®ä¸­å¿ƒçš„é…ç½®å˜æ›´ï¼Œå¹¶è‡ªåŠ¨åŒæ­¥åˆ°æœ¬åœ°é…ç½®ã€‚

## ç‰¹æ€§

- ğŸš€ **ä½ä¾µå…¥æ€§** - å‡ ä¹ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
- ğŸ”„ **å®æ—¶åŒæ­¥** - é…ç½®å˜æ›´åè‡ªåŠ¨æ›´æ–°æœ¬åœ°é…ç½®
- ğŸ“¦ **å¤šæ ¼å¼æ”¯æŒ** - æ”¯æŒ propertiesã€yamlã€json æ ¼å¼
- ğŸ¯ **ç²¾ç¡®ç›‘å¬** - å¯æŒ‡å®šè¦ç›‘å¬çš„é…ç½®é¡¹
- ğŸ”— **çµæ´»æ˜ å°„** - æ”¯æŒé…ç½®é”®åæ˜ å°„

## å®‰è£…

### é€šè¿‡pipå®‰è£…ï¼ˆæ¨èï¼‰

```bash
pip install ra-nacos-sdk
```

å¦‚æœéœ€è¦YAMLé…ç½®æ ¼å¼æ”¯æŒï¼š

```bash
pip install ra-nacos-sdk[yaml]
```

### ä»æºç å®‰è£…

```bash
git clone https://github.com/your-org/ra-common-sdk.git
cd ra-common-sdk/nacos/python
pip install -e .
```

### å¼€å‘ç¯å¢ƒå®‰è£…

```bash
pip install -e ".[dev]"
```

## å¿«é€Ÿå¼€å§‹

### åˆå§‹åŒ–Nacosé…ç½®ç®¡ç†å™¨

```python
from nacos_sdk import NacosConfigManager

manager = NacosConfigManager(
    server_addresses="127.0.0.1:8848",
    namespace="public",
    data_id="your-app-config",
    group="DEFAULT_GROUP",
    config_format="properties",  # æ”¯æŒ properties, yaml, json
)
```

## é…ç½®ç›‘å¬æ–¹å¼

æ ¹æ®é¡¹ç›®ä¸­é…ç½®çš„ä½¿ç”¨æ–¹å¼ï¼ŒSDKæä¾›äº†ä¸¤ç§ä½ä¾µå…¥æ€§çš„ç›‘å¬æ–¹æ¡ˆï¼š

---

### æ–¹å¼1ï¼šç›‘å¬ pydantic_settings çš„ Settings ç±»

é€‚ç”¨äºä½¿ç”¨ `pydantic_settings` ç®¡ç†é…ç½®çš„é¡¹ç›®ã€‚

#### åŸæœ‰ä»£ç 

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    EXCLUDED_BUSINESS_STATUS_ENDPOINTS: str = "/ping,/health,/metric"
    APP_NAME: str = "data_llm_service"
    APP_VERSION: str = "1.0.0"
    API_PREFIX: str = "/api"
    DEBUG: bool = False
    
    class Config:
        validate_assignment = True  # å…è®¸è¿è¡Œæ—¶ä¿®æ”¹

settings = Settings()
```

#### é›†æˆNacosç›‘å¬

åªéœ€åœ¨åº”ç”¨å¯åŠ¨æ—¶æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```python
from nacos_sdk import NacosConfigManager

def setup_nacos():
    manager = NacosConfigManager(
        server_addresses="127.0.0.1:8848",
        namespace="public",
        data_id="app-config",
        group="DEFAULT_GROUP",
    )
    
    # æ³¨å†Œç›‘å¬ - æŒ‡å®šè¦ç›‘å¬çš„é…ç½®é¡¹
    manager.watch_settings(
        settings,
        keys=["APP_NAME", "APP_VERSION", "DEBUG"],
        # å¯é€‰ï¼šé…ç½®é”®åæ˜ å°„
        key_mapping={
            "app.name": "APP_NAME",      # Nacosä¸­çš„app.name -> Settings.APP_NAME
            "app.version": "APP_VERSION",
            "app.debug": "DEBUG",
        }
    )
    
    manager.start()
    return manager

# åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
nacos_manager = setup_nacos()
```

å½“Nacosä¸­çš„é…ç½®å‘ç”Ÿå˜æ›´æ—¶ï¼Œ`settings` å®ä¾‹ä¸­å¯¹åº”çš„å­—æ®µä¼šè‡ªåŠ¨æ›´æ–°ã€‚

---

### æ–¹å¼2ï¼šç›‘å¬æ¨¡å—çº§å˜é‡

é€‚ç”¨äºä½¿ç”¨æ¨¡å—çº§å˜é‡ç®¡ç†é…ç½®çš„é¡¹ç›®ã€‚

#### åŸæœ‰ä»£ç 

```python
# config.py
EXCLUDED_BUSINESS_STATUS_ENDPOINTS = "/ping,/health,/metric"
APP_NAME = "data_llm_service"
APP_VERSION = "1.0.0"
API_PREFIX = "/api"
DEBUG = False
```

#### é›†æˆNacosç›‘å¬

```python
# åœ¨åº”ç”¨å¯åŠ¨æ¨¡å—ä¸­
import config
from nacos_sdk import NacosConfigManager

def setup_nacos():
    manager = NacosConfigManager(
        server_addresses="127.0.0.1:8848",
        namespace="public",
        data_id="app-config",
        group="DEFAULT_GROUP",
    )
    
    # ç›‘å¬æ¨¡å—å˜é‡
    manager.watch_module(
        config,
        keys=["APP_NAME", "APP_VERSION", "DEBUG"],
        # å¯é€‰ï¼šé…ç½®é”®åæ˜ å°„
        key_mapping={
            "app.name": "APP_NAME",
            "app.debug": "DEBUG",
        }
    )
    
    manager.start()
    return manager

nacos_manager = setup_nacos()
```

> âš ï¸ **æ³¨æ„**ï¼šä½¿ç”¨æ¨¡å—å˜é‡æ—¶ï¼Œæ¨èç”¨ `import config` ç„¶å `config.APP_NAME` çš„æ–¹å¼è®¿é—®é…ç½®ã€‚
> å¦‚æœä½¿ç”¨ `from config import APP_NAME`ï¼Œå˜é‡åœ¨å¯¼å…¥æ—¶è¢«å¤åˆ¶ï¼Œåç»­æ›´æ–°ä¸ä¼šåæ˜ åˆ°å¯¼å…¥çš„å˜é‡ä¸­ã€‚

---

## é«˜çº§ç”¨æ³•

### æ·»åŠ é…ç½®å˜æ›´å›è°ƒ

```python
@manager.add_callback
def on_config_change(config: dict):
    """é…ç½®å˜æ›´æ—¶çš„å›è°ƒ"""
    print(f"é…ç½®å·²æ›´æ–°: {config}")
    # å¯ä»¥åœ¨è¿™é‡Œé‡æ–°åˆå§‹åŒ–æŸäº›ç»„ä»¶
```

### ä½¿ç”¨è£…é¥°å™¨æ–¹å¼

```python
from nacos_sdk import NacosConfigManager, ConfigWatcher

manager = NacosConfigManager(...)
watcher = ConfigWatcher(manager)

# è£…é¥°Settingsç±»
@watcher.settings(keys=["APP_NAME", "DEBUG"])
class Settings(BaseSettings):
    APP_NAME: str = "myapp"
    DEBUG: bool = False

# è£…é¥°å›è°ƒå‡½æ•°
@watcher.on_change
def handle_change(config: dict):
    print(f"é…ç½®å˜æ›´: {config}")
```

### ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python
with NacosConfigManager(...) as manager:
    manager.watch_settings(settings, keys=["APP_NAME"])
    # åº”ç”¨è¿è¡Œ...
# è‡ªåŠ¨åœæ­¢ç›‘å¬
```

### æ”¯æŒçš„é…ç½®æ ¼å¼

#### Propertiesæ ¼å¼

```properties
app.name=myapp
app.debug=true
app.version=1.0.0
```

#### YAMLæ ¼å¼

```yaml
app:
  name: myapp
  debug: true
  version: 1.0.0
```

é…ç½®ä¼šè¢«å±•å¹³ä¸ºï¼š`app.name`, `app.debug`, `app.version`

#### JSONæ ¼å¼

```json
{
  "app": {
    "name": "myapp",
    "debug": true,
    "version": "1.0.0"
  }
}
```

åŒæ ·ä¼šè¢«å±•å¹³ä¸ºç‚¹å·åˆ†éš”çš„é”®åã€‚

---

## APIå‚è€ƒ

### NacosConfigManager

ä¸»è¦çš„é…ç½®ç®¡ç†ç±»ã€‚

```python
NacosConfigManager(
    server_addresses: str,        # NacosæœåŠ¡åœ°å€
    namespace: str = "public",    # å‘½åç©ºé—´
    data_id: str = "",            # é…ç½®çš„data_id
    group: str = "DEFAULT_GROUP", # é…ç½®åˆ†ç»„
    username: str = None,         # ç”¨æˆ·å
    password: str = None,         # å¯†ç 
    config_format: str = "properties",  # é…ç½®æ ¼å¼
    ak: str = None,               # é˜¿é‡Œäº‘AKï¼ˆä½¿ç”¨MSEæ—¶ï¼‰
    sk: str = None,               # é˜¿é‡Œäº‘SKï¼ˆä½¿ç”¨MSEæ—¶ï¼‰
)
```

#### æ–¹æ³•

| æ–¹æ³• | è¯´æ˜ |
|------|------|
| `watch_settings(settings, keys, key_mapping)` | ç›‘å¬pydantic Settingså®ä¾‹ |
| `watch_module(module, keys, key_mapping)` | ç›‘å¬æ¨¡å—å˜é‡ |
| `add_callback(func)` | æ·»åŠ é…ç½®å˜æ›´å›è°ƒ |
| `start()` | å¯åŠ¨é…ç½®ç›‘å¬ |
| `stop()` | åœæ­¢é…ç½®ç›‘å¬ |
| `get_config()` | è·å–åŸå§‹é…ç½®å†…å®¹ |
| `get_config_parsed()` | è·å–è§£æåçš„é…ç½®å­—å…¸ |

### key_mapping å‚æ•°è¯´æ˜

å½“Nacosä¸­çš„é…ç½®é”®åä¸æœ¬åœ°é…ç½®åä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ `key_mapping` è¿›è¡Œæ˜ å°„ï¼š

```python
key_mapping = {
    "nacos.config.key": "LOCAL_CONFIG_NAME",
    "app.name": "APP_NAME",
}
```

---

## é¡¹ç›®ç»“æ„

```
nacos/python/
â”œâ”€â”€ README.md
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ nacos_sdk/
â”‚   â”œâ”€â”€ __init__.py      # SDKå…¥å£
â”‚   â”œâ”€â”€ client.py        # Nacosé…ç½®ç®¡ç†å™¨
â”‚   â”œâ”€â”€ adapters.py      # Settingså’ŒModuleé€‚é…å™¨
â”‚   â”œâ”€â”€ parsers.py       # é…ç½®è§£æå™¨
â”‚   â””â”€â”€ watcher.py       # è£…é¥°å™¨æ¥å£
â””â”€â”€ examples/
    â”œâ”€â”€ example_settings.py  # pydantic_settingsç¤ºä¾‹
    â””â”€â”€ example_module.py    # æ¨¡å—å˜é‡ç¤ºä¾‹
```

## License

MIT
