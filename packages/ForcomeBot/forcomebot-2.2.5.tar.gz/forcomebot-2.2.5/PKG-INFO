Metadata-Version: 2.4
Name: ForcomeBot
Version: 2.2.5
Summary: FORCOME åº·åº· - åƒå¯»å¾®ä¿¡æ¡†æ¶Proä¸LangBotçš„ä¸­é—´ä»¶
Project-URL: Homepage, https://github.com/yourname/ForcomeBot
Project-URL: Documentation, https://github.com/yourname/ForcomeBot#readme
Project-URL: Repository, https://github.com/yourname/ForcomeBot
Author-email: Your Name <your@email.com>
License-Expression: MIT
Keywords: chatbot,langbot,middleware,onebot,qianxun,wechat
Classifier: Development Status :: 5 - Production/Stable
Classifier: Framework :: AsyncIO
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Communications :: Chat
Requires-Python: >=3.10
Requires-Dist: apscheduler>=3.10.0
Requires-Dist: fastapi>=0.104.0
Requires-Dist: httpx>=0.25.0
Requires-Dist: pydantic>=2.0
Requires-Dist: python-multipart>=0.0.6
Requires-Dist: pyyaml>=6.0
Requires-Dist: uvicorn>=0.24.0
Requires-Dist: websockets>=11.0
Provides-Extra: dev
Requires-Dist: hypothesis>=6.0.0; extra == 'dev'
Requires-Dist: pytest-asyncio>=0.21.0; extra == 'dev'
Requires-Dist: pytest>=7.0.0; extra == 'dev'
Description-Content-Type: text/markdown

# FORCOME åº·åº·

è¿™æ˜¯ä¸€ä¸ªç”¨äºè¿æ¥åƒå¯»å¾®ä¿¡æ¡†æ¶Proå’ŒLangBotçš„ä¸­é—´ä»¶ï¼Œå®ç°å¾®ä¿¡æ¶ˆæ¯ä¸LangBot AIå¯¹è¯çš„åŒå‘é€šä¿¡ã€‚

## æ¶æ„

```
å¾®ä¿¡ç”¨æˆ· <-> åƒå¯»æ¡†æ¶Pro <-> æœ¬ä¸­é—´ä»¶ <-> LangBot (OneBot v11)
```

## åŠŸèƒ½ç‰¹æ€§

- æ”¯æŒç§èŠæ¶ˆæ¯
- æ”¯æŒç¾¤èŠæ¶ˆæ¯ï¼ˆ@æœºå™¨äººè§¦å‘ï¼‰
- æ”¯æŒå¤šè½®å¯¹è¯ï¼ˆåŸºäºç”¨æˆ·IDç»´æŠ¤ä¼šè¯ï¼‰
- æ”¯æŒå›¾ç‰‡æ¶ˆæ¯ï¼ˆå‘é€å’Œæ¥æ”¶ï¼‰
- æ”¯æŒè¯­éŸ³æ¶ˆæ¯ï¼ˆæ¥æ”¶ï¼‰
- æ”¯æŒå¼•ç”¨æ¶ˆæ¯
- æ”¯æŒæ‹ä¸€æ‹æ¶ˆæ¯
- æ”¯æŒå¤šå¾®ä¿¡è´¦å·
- å…¥ç¾¤æ¬¢è¿åŠŸèƒ½
- æ˜µç§°æ£€æµ‹åŠŸèƒ½
- å®šæ—¶æé†’åŠŸèƒ½
- ç¾¤å‘åŠŸèƒ½ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ã€åˆ†äº«é“¾æ¥ã€å°ç¨‹åºï¼‰
- Webç®¡ç†ç•Œé¢ï¼ˆReactå‰ç«¯ï¼‰
- é…ç½®çƒ­æ›´æ–°
- æŒ‡æ•°é€€é¿é‡è¿æœºåˆ¶
- APIé‡è¯•æœºåˆ¶
- çŠ¶æ€æŒä¹…åŒ–

## ğŸ“¦ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šuvx ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

éœ€è¦å…ˆå®‰è£… [uv](https://docs.astral.sh/uv/getting-started/installation/)

```bash
# ä» PyPI ä¸€é”®å¯åŠ¨ï¼ˆå‘å¸ƒåå¯ç”¨ï¼‰
uvx ForcomeBot

# æˆ–æŒ‡å®š Python ç‰ˆæœ¬
uvx --python 3.12 ForcomeBot
```

é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åœ¨å½“å‰ç›®å½•åˆ›å»º `config.yaml` é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹é…ç½®åé‡æ–°è¿è¡Œå³å¯ã€‚

### æ–¹å¼äºŒï¼šä»æºç ä½¿ç”¨ uvx å¯åŠ¨

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourname/ForcomeBot.git
cd ForcomeBot

# åˆ›å»ºå¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶
cp config.example.yaml config.yaml
# ç¼–è¾‘ config.yaml å¡«å…¥ä½ çš„é…ç½®

# ä½¿ç”¨ uvx ä»æœ¬åœ°æºç å¯åŠ¨
uvx --from . ForcomeBot
```

### æ–¹å¼ä¸‰ï¼špip å®‰è£…åå¯åŠ¨

```bash
# ä» PyPI å®‰è£…ï¼ˆå‘å¸ƒåå¯ç”¨ï¼‰
pip install ForcomeBot

# æˆ–ä»æºç å®‰è£…
git clone https://github.com/yourname/ForcomeBot.git
cd ForcomeBot
pip install .

# å¯åŠ¨
ForcomeBot
```

### æ–¹å¼å››ï¼šç›´æ¥è¿è¡Œ Python

```bash
git clone https://github.com/yourname/ForcomeBot.git
cd ForcomeBot
pip install -r requirements.txt
python main.py
```

### é…ç½®åƒå¯»æ¡†æ¶

åœ¨åƒå¯»æ¡†æ¶Proä¸­è®¾ç½®HTTPäº‹ä»¶å›è°ƒåœ°å€ä¸ºï¼š

```
http://ä½ çš„IP:8000/qianxun/callback
```

## è®¿é—®åœ°å€

å¯åŠ¨åå¯è®¿é—®ä»¥ä¸‹åœ°å€ï¼š

| åœ°å€ | è¯´æ˜ |
|------|------|
| `http://IP:8000/app/` | Reactç®¡ç†ç•Œé¢ |
| `http://IP:8000/docs` | APIæ–‡æ¡£ï¼ˆSwaggerï¼‰ |
| `http://IP:8000/health` | å¥åº·æ£€æŸ¥ |
| `ws://IP:8000/api/ws` | WebSocketå®æ—¶æ¨é€ |

## é…ç½®è¯´æ˜

```yaml
# ä¸­é—´ä»¶æœåŠ¡é…ç½®
server:
  host: "0.0.0.0"
  port: 8000

# åƒå¯»æ¡†æ¶é…ç½®
qianxun:
  api_url: "http://127.0.0.1:7777/qianxun/httpapi"
  robot_wxid: "wxid_xxx"  # æœºå™¨äººå¾®ä¿¡ID

# LangBoté…ç½®ï¼ˆOneBot v11 WebSocketï¼‰
langbot:
  ws_host: "127.0.0.1"
  ws_port: 2280
  access_token: ""  # å¯é€‰

# æ¶ˆæ¯é™æµé…ç½®
rate_limit:
  min_interval: 1  # æœ€å°å‘é€é—´éš”ï¼ˆç§’ï¼‰
  max_interval: 3  # æœ€å¤§å‘é€é—´éš”ï¼ˆç§’ï¼‰

# æ¶ˆæ¯åˆ†æ®µå‘é€
message_split:
  enabled: false
  separator: "/!"
  min_delay: 1
  max_delay: 3

# è¿‡æ»¤é…ç½®
filter:
  ignore_wxids: []  # å¿½ç•¥çš„wxidåˆ—è¡¨
  reply_at_all: false  # æ˜¯å¦å›å¤@æ‰€æœ‰äºº

# å…¥ç¾¤æ¬¢è¿é…ç½®
welcome:
  - target_groups: ["xxx@chatroom"]
    message: "æ¬¢è¿åŠ å…¥ï¼"

# æ˜µç§°æ£€æµ‹é…ç½®
nickname_check:
  - task_id: "check1"
    enabled: true
    cron: "0 9 * * *"
    target_groups: ["xxx@chatroom"]
    regex: "^[\\u4e00-\\u9fa5]+$"
    message_tpl: "âš ï¸ @{user} è¯·ä¿®æ”¹æ˜µç§°"
    exclude_users: []

# å®šæ—¶æé†’é…ç½®
scheduled_reminders:
  - task_name: "daily_reminder"
    enabled: true
    cron: "0 9 * * *"
    target_groups: ["xxx@chatroom"]
    mention_users: ["all"]
    content: "æ—©ä¸Šå¥½ï¼"

# æ—¥å¿—é…ç½®
logging:
  level: "INFO"
```

## ç›®å½•ç»“æ„

```
forcome-kangkang/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.yaml                # é…ç½®æ–‡ä»¶
â”œâ”€â”€ config.example.yaml        # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”œâ”€â”€ pyproject.toml             # é¡¹ç›®é…ç½®
â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”œâ”€â”€ data/                      # æŒä¹…åŒ–æ•°æ®ç›®å½•
â”‚   â””â”€â”€ state.json             # çŠ¶æ€æ•°æ®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py            # æ¨¡å—å¯¼å‡º
â”‚   â”œâ”€â”€ models.py              # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ web.py                 # æ—§ç‰ˆWebè·¯ç”±ï¼ˆå…¼å®¹ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒæœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ config_manager.py  # é…ç½®ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ state_store.py     # çŠ¶æ€å­˜å‚¨å™¨
â”‚   â”‚   â””â”€â”€ log_collector.py   # æ—¥å¿—æ”¶é›†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ clients/               # å®¢æˆ·ç«¯å±‚
â”‚   â”‚   â”œâ”€â”€ qianxun.py         # åƒå¯»å®¢æˆ·ç«¯ï¼ˆå¸¦é‡è¯•ï¼‰
â”‚   â”‚   â””â”€â”€ langbot.py         # LangBotå®¢æˆ·ç«¯ï¼ˆå¸¦é‡è¿ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/              # ä¸šåŠ¡å¤„ç†å±‚
â”‚   â”‚   â”œâ”€â”€ message_handler.py # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ message_parser.py  # æ¶ˆæ¯è§£æå™¨
â”‚   â”‚   â””â”€â”€ scheduler.py       # å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ text_processor.py  # æ–‡æœ¬å¤„ç†ï¼ˆæ¢è¡Œç¬¦ã€emojiï¼‰
â”‚   â”‚   â””â”€â”€ xml_parser.py      # XMLè§£æå·¥å…·
â”‚   â”‚
â”‚   â””â”€â”€ api/                   # APIå±‚
â”‚       â”œâ”€â”€ routes.py          # RESTful APIè·¯ç”±
â”‚       â””â”€â”€ websocket.py       # WebSocketå¤„ç†
â”‚
â”œâ”€â”€ web/                       # Reactå‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/               # APIè°ƒç”¨
â”‚   â”‚   â”œâ”€â”€ components/        # ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ pages/             # é¡µé¢
â”‚   â”‚   â””â”€â”€ hooks/             # è‡ªå®šä¹‰hooks
â”‚   â””â”€â”€ dist/                  # æ„å»ºäº§ç‰©
â”‚
â””â”€â”€ tests/                     # æµ‹è¯•
    â”œâ”€â”€ test_infrastructure.py # åŸºç¡€è®¾æ–½æµ‹è¯•
    â”œâ”€â”€ test_clients.py        # å®¢æˆ·ç«¯æµ‹è¯•
    â””â”€â”€ test_handlers.py       # å¤„ç†å™¨æµ‹è¯•
```

## æ¨¡å—è¯´æ˜

### æ ¸å¿ƒæœåŠ¡å±‚ (src/core/)

| æ¨¡å— | è¯´æ˜ |
|------|------|
| ConfigManager | é…ç½®ç®¡ç†å™¨ï¼Œæ”¯æŒçƒ­æ›´æ–°ã€éªŒè¯ã€è§‚å¯Ÿè€…æ¨¡å¼ |
| StateStore | çŠ¶æ€å­˜å‚¨å™¨ï¼Œç®¡ç†æ¶ˆæ¯å»é‡ã€å›¾ç‰‡ç¼“å­˜ã€IDæ˜ å°„ï¼Œæ”¯æŒæŒä¹…åŒ– |
| LogCollector | æ—¥å¿—æ”¶é›†å™¨ï¼Œæ”¯æŒWebSocketå®æ—¶æ¨é€ |

### å®¢æˆ·ç«¯å±‚ (src/clients/)

| æ¨¡å— | è¯´æ˜ |
|------|------|
| QianXunClient | åƒå¯»æ¡†æ¶HTTP APIå®¢æˆ·ç«¯ï¼Œå¸¦è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰ |
| LangBotClient | LangBot OneBot v11 WebSocketå®¢æˆ·ç«¯ï¼Œå¸¦æŒ‡æ•°é€€é¿é‡è¿ |

### ä¸šåŠ¡å¤„ç†å±‚ (src/handlers/)

| æ¨¡å— | è¯´æ˜ |
|------|------|
| MessageParser | æ¶ˆæ¯è§£æå™¨ï¼Œç»Ÿä¸€å¤„ç†å„ç§æ¶ˆæ¯ç±»å‹ |
| MessageHandler | æ¶ˆæ¯å¤„ç†å™¨ï¼Œå¤„ç†ç§èŠ/ç¾¤èŠæ¶ˆæ¯ |
| TaskScheduler | å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼Œæ”¯æŒæ˜µç§°æ£€æµ‹å’Œå®šæ—¶æé†’ |

### å·¥å…·æ¨¡å— (src/utils/)

| æ¨¡å— | è¯´æ˜ |
|------|------|
| TextProcessor | æ–‡æœ¬å¤„ç†ï¼Œæ¢è¡Œç¬¦è½¬æ¢ã€emojiç¼–è§£ç  |
| XMLParser | XMLè§£æï¼Œå¤„ç†å¼•ç”¨æ¶ˆæ¯ã€æ‹ä¸€æ‹ã€è¯­éŸ³ç­‰ |

## APIæ¥å£

### RESTful API

| æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| GET | /api/config | è·å–é…ç½® |
| POST | /api/config | æ›´æ–°é…ç½® |
| POST | /api/config/validate | éªŒè¯é…ç½® |
| GET | /api/status | è·å–ç³»ç»ŸçŠ¶æ€ |
| GET | /api/status/langbot | è·å–LangBotè¿æ¥çŠ¶æ€ |
| GET | /api/status/memory | è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ |
| GET | /api/logs | è·å–æ¶ˆæ¯æ—¥å¿— |
| GET | /api/tasks | è·å–å®šæ—¶ä»»åŠ¡åˆ—è¡¨ |
| POST | /api/tasks/{id}/run | æ‰‹åŠ¨æ‰§è¡Œä»»åŠ¡ |
| GET | /api/tasks/history | è·å–ä»»åŠ¡æ‰§è¡Œå†å² |
| POST | /api/cache/clear | æ¸…ç†ç¼“å­˜ |
| GET | /api/chatrooms | è·å–ç¾¤èŠåˆ—è¡¨ |
| GET | /api/friends | è·å–å¥½å‹åˆ—è¡¨ |
| GET | /api/group_members/{id} | è·å–ç¾¤æˆå‘˜åˆ—è¡¨ |
| GET | /api/robot_info | è·å–æœºå™¨äººä¿¡æ¯ |

### WebSocket

è¿æ¥ `ws://IP:8000/api/ws` å¯æ¥æ”¶å®æ—¶æ¨é€ï¼š

```json
{"type": "log", "data": {...}}      // æ¶ˆæ¯æ—¥å¿—
{"type": "status", "data": {...}}   // çŠ¶æ€å˜æ›´
```

## å¼€å‘

### å®‰è£…å¼€å‘ä¾èµ–

```bash
pip install -e ".[dev]"
```

### è¿è¡Œæµ‹è¯•

```bash
pytest
```

### æ„å»ºå‰ç«¯

```bash
cd web
npm install
npm run build
```

## License

MIT
