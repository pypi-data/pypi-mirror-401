policy_name: "Pragmatic Internal API Governance"
policy_version: "1.0"

inputs:
  openapi_versions_allowed: ["3.0.x", "3.1.x"]

enforcement:
  default_severity:
    contract_validity: "BLOCKER"
    security_missing: "MAJOR"
    error_model_inconsistent: "MAJOR"
    pagination_inconsistent: "MAJOR"
    versioning_inconsistent: "MINOR"
    naming_inconsistent: "MINOR"
    observability_missing: "MINOR"
  allow_merge_with_breaking_changes_if:
    deprecation_plan_present: true

api_style:
  prefer_kebab_case_paths: true
  discourage_verbs_in_paths: true
  operation_id:
    required: false
    convention: "camelCase"
  tags:
    required: false

versioning:
  strategy: "none_or_header"
  header_versioning:
    enabled: true
    header_name: "X-API-Version"
  url_versioning:
    enabled: false
  deprecation:
    require_deprecated_marker: true
    allow_undeprecated_breaking_changes: false

errors:
  require_standard_error_envelope: true
  envelope_name: "Error"
  problem_fields_required:
    - code
    - message
    - requestId
  http_status_mapping_guidance: true

pagination:
  required_for_list_endpoints: true
  style: "cursor"
  request_params:
    limit: "limit"
    cursor: "cursor"
  response_shape:
    items: "items"
    nextCursor: "nextCursor"
  max_limit:
    enabled: true
    max: 200

security:
  require_security_by_default: true
  allow_public_endpoints_if:
    explicitly_marked: true
    marker: "x-public: true"
  require_scopes_if_oauth: false
  auth_schemes_allowed:
    - "bearerAuth"
    - "apiKeyAuth"
    - "oauth2"

reliability:
  idempotency:
    recommend_for_post_create: true
    header_name: "Idempotency-Key"
  retries:
    encourage_retry_after_on_429: true

observability:
  require_request_id_header: true
  header_name: "X-Request-Id"
  encourage_correlation_id_header: true
  correlation_header_name: "X-Correlation-Id"

breaking_change_detection:
  enabled: true
  breaking_changes:
    removed_operation: true
    removed_parameter: true
    removed_response_field: true
    required_to_optional_flip: false
    optional_to_required_flip: true
    narrowed_enum: true
    narrowed_numeric_range: true
    auth_requirement_change: true
    status_code_removed: true
  default_breaking_severity: "MAJOR"
  escalate_to_blocker_if:
    no_deprecation_plan: true
