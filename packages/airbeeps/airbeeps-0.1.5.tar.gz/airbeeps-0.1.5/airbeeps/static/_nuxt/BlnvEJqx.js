import{R as M,h as z,e as X,G as fe,k as b,c,I as v,o as i,a as s,b as g,g as t,t as C,J as Z,K as J,a1 as ge,y as B,v as E,a2 as be,D as ve,E as D,m as ye,V as P,H as xe,M as S,L as _e,w as we,d as K,a3 as ke,a4 as Ce}from"./BzhixHsn.js";import{S as G}from"./BEcuULY5.js";import{F as De}from"./DkVjT0nP.js";import{u as $e}from"./BiXAZkt9.js";import{_ as Ae}from"./DlAUqK2U.js";import{u as Te}from"./D01W4VS-.js";import{L}from"./B9I6JWJy.js";import{A as Me}from"./DzpHhHXI.js";import{T as Se}from"./RCxqQWZp.js";const Ie=M("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const Fe=M("camera",[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);const Ve=M("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const Le=M("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);const Be=M("terminal",[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]]),Ee={key:0,class:"animate-in fade-in slide-in-from-bottom-4 py-16 duration-500"},ze={class:"mx-auto max-w-2xl space-y-10 text-center"},Re={class:"space-y-4"},je={class:"from-primary/20 to-primary/5 mb-4 inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-gradient-to-br"},Ne={class:"from-foreground to-foreground/70 bg-gradient-to-br bg-clip-text text-3xl font-bold tracking-tight md:text-4xl"},We={key:0,class:"text-muted-foreground mx-auto max-w-md text-lg leading-relaxed"},He={key:0,class:"grid grid-cols-1 gap-3 md:grid-cols-2"},Ue=["onClick"],Oe={class:"min-w-0 flex-1"},Pe={class:"text-foreground group-hover:text-primary text-sm font-semibold transition-colors"},Ke={class:"text-muted-foreground/80 mt-0.5 truncate text-xs"},Ge=z({__name:"Welcome",props:{assistant:{},showWelcome:{type:Boolean,default:!0}},emits:["select-suggestion"],setup(n,{emit:$}){const{t:A}=X(),p=n,y=$,f=fe(),x=b(()=>p.assistant?.mode==="RAG"?!1:f.config.ui_show_chat_suggestions!==!1),o=b(()=>""),l=[{icon:G,label:"Creative Writing",prompt:"Write a short story about a time traveler who gets stuck in 2024.",color:"text-purple-500",bg:"bg-purple-500/10",border:"border-purple-200 dark:border-purple-800"},{icon:Be,label:"Code Helper",prompt:"Write a Python script to scrape a website and save data to CSV.",color:"text-blue-500",bg:"bg-blue-500/10",border:"border-blue-200 dark:border-blue-800"},{icon:De,label:"Summarization",prompt:"Summarize the key points of a recent tech news article.",color:"text-green-500",bg:"bg-green-500/10",border:"border-green-200 dark:border-green-800"},{icon:Ve,label:"Explain Concept",prompt:"Explain quantum computing to a 5-year old.",color:"text-amber-500",bg:"bg-amber-500/10",border:"border-amber-200 dark:border-amber-800"}],_=T=>{y("select-suggestion",T)};return(T,m)=>n.showWelcome?(i(),c("div",Ee,[s("div",ze,[s("div",Re,[s("div",je,[g(t(G),{class:"text-primary h-8 w-8"})]),s("h2",Ne,C(t(A)("chat.input.greeting","What can I help with?")),1),t(o)?(i(),c("p",We,C(t(o)),1)):v("",!0)]),t(x)?(i(),c("div",He,[(i(),c(Z,null,J(l,(h,w)=>s("button",{key:w,onClick:R=>_(h.prompt),class:"border-border/50 bg-card/50 hover:bg-card hover:border-border group flex items-center gap-3 rounded-2xl border p-4 text-left backdrop-blur-sm transition-all duration-300 hover:shadow-md",style:ge({animationDelay:`${w*50}ms`})},[s("div",{class:B(["flex h-11 w-11 shrink-0 items-center justify-center rounded-xl transition-transform group-hover:scale-105",[h.bg,h.color]])},[(i(),E(be(h.icon),{class:"h-5 w-5"}))],2),s("div",Oe,[s("div",Pe,C(h.label),1),s("div",Ke,C(h.prompt),1)]),g(t(Ie),{class:"text-muted-foreground/50 h-4 w-4 -translate-x-2 opacity-0 transition-all duration-200 group-hover:translate-x-0 group-hover:opacity-100"})],12,Ue)),64))])):v("",!0)])])):v("",!0)}}),Mt=Object.assign(Ge,{__name:"ChatWelcome"}),qe={class:"flex"},Xe={class:"w-full"},Ze={key:0,class:"markdown-content"},Je=["innerHTML"],Qe={key:1,class:"flex items-center space-x-2"},Ye={class:"text-muted-foreground text-sm"},et=z({__name:"Loading",props:{assistant:{},message:{default:"..."},isStreaming:{type:Boolean,default:!1},streamingContent:{default:""}},setup(n){const $=n,{renderMarkdown:A}=$e(),p=b(()=>A($.streamingContent||""));return(y,f)=>(i(),c("div",qe,[s("div",Xe,[n.isStreaming&&n.streamingContent?(i(),c("div",Ze,[s("div",{innerHTML:t(p)},null,8,Je),f[0]||(f[0]=s("span",{class:"ml-1 inline-block h-4 w-2 animate-pulse bg-current"},null,-1))])):(i(),c("div",Qe,[f[1]||(f[1]=s("div",{class:"flex space-x-1"},[s("div",{class:"h-2 w-2 animate-bounce rounded-full bg-current",style:{"animation-delay":"0ms"}}),s("div",{class:"h-2 w-2 animate-bounce rounded-full bg-current",style:{"animation-delay":"150ms"}}),s("div",{class:"h-2 w-2 animate-bounce rounded-full bg-current",style:{"animation-delay":"300ms"}})],-1)),s("p",Ye,C(n.message),1)]))])]))}}),St=Object.assign(Ae(et,[["__scopeId","data-v-554e4f73"]]),{__name:"ChatLoading"}),tt={class:"flex w-full min-w-0 flex-col"},at={key:0,class:"flex flex-wrap gap-2 px-3 pt-3"},st=["src","alt"],ot={key:0,class:"bg-background/80 absolute inset-0 flex items-center justify-center backdrop-blur-sm"},nt={key:1,class:"bg-destructive/80 text-destructive-foreground absolute inset-0 flex items-center justify-center px-1 text-center text-[10px] font-medium"},rt=["onClick"],it={class:"flex items-end gap-2 p-3"},lt={key:0,class:"flex items-center gap-1 pb-0.5"},ct=["disabled","title"],dt=["disabled","title"],ut=["capture"],pt={class:"min-w-0 flex-1"},mt=["value","placeholder","disabled"],ht={class:"shrink-0 pb-0.5"},ft={key:1,class:"px-3 pb-2"},gt={class:"text-muted-foreground flex items-center gap-2 text-xs"},bt={key:0,class:"flex items-center gap-1"},vt={key:1,class:"text-destructive flex items-center gap-1"},q=5,yt=z({__name:"Input",props:{modelValue:{},placeholder:{},disabled:{type:Boolean,default:!1},sendDisabled:{type:Boolean,default:!1},supportsVision:{type:Boolean,default:!1},cameraCapture:{default:"environment"}},emits:["update:modelValue","send","keydown"],setup(n,{expose:$,emit:A}){const p=n,y=A,{$api:f}=ve(),{showError:x}=Te(),{t:o}=X(),l=D(),_=D(),T=D(),m=D([]),h=D(!1),w=D(0),R=b(()=>p.cameraCapture!=="any"?p.cameraCapture:void 0),Q=b(()=>p.placeholder||o("chat.input.placeholder")),Y=q*1024*1024,j=b(()=>m.value.filter(e=>e.status==="uploading").length),k=b(()=>j.value>0),I=b(()=>m.value.filter(e=>e.status==="error")),N=b(()=>m.value.filter(e=>e.status==="ready"&&(e.url||e.dataUrl))),W=()=>{if(N.value.length)return N.value.map(({id:e,url:a,alt:d,mimeType:r,size:u,fileKey:V})=>({id:e,url:a,alt:d,mimeType:r,size:u,fileKey:V}))},H=()=>{m.value=[]},ee=e=>{if(e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),!p.sendDisabled)){if(k.value){x(o("chat.input.pendingUploads"));return}const a=W();y("send",a),H()}y("keydown",e)},te=e=>{const a=e.target;y("update:modelValue",a.value)},ae=()=>{if(k.value){x(o("chat.input.pendingUploads"));return}const e=W();y("send",e),H()},se=()=>{_.value?.click()},oe=()=>{T.value?.click()},ne=async(e,a)=>{try{const d=new FormData;d.append("file",e),d.append("file_type","image");const r=await f("/v1/files/upload",{method:"POST",body:d}),u=m.value.find(V=>V.id===a);u&&(u.url=r.url,u.fileKey=r.file_path||r.fileKey,u.status="ready")}catch{x(o("chat.input.uploadFailed",{name:e.name}));const r=m.value.find(u=>u.id===a);r&&(r.status="error",r.errorMessage=o("chat.input.imageErrorMessage",{name:e.name}))}},re=e=>{if(!e.type.startsWith("image/")){x(o("chat.input.fileNotImage",{name:e.name}));return}if(e.size>Y){x(o("chat.input.fileTooLarge",{name:e.name,max:`${q}MB`}));return}const a=new FileReader;a.onload=async d=>{const r=d.target?.result,u=`img-${Date.now()}-${Math.random()}`;m.value.push({id:u,dataUrl:r,alt:e.name,mimeType:e.type,size:e.size,status:"uploading"}),await ne(e,u)},a.readAsDataURL(e)},F=e=>{const a=Array.isArray(e)?e:Array.from(e);for(const d of a)re(d)},U=e=>{e&&e.length>0&&F(e)},ie=e=>{const a=e.target;U(a.files),a.value=""},le=e=>{const a=e.target;U(a.files),a.value=""},ce=e=>{if(!p.supportsVision)return;const a=e.clipboardData?.items;if(!a||a.length===0)return;const d=[];for(const r of a)if(r.kind==="file"){const u=r.getAsFile();u&&u.type.startsWith("image/")&&d.push(u)}d.length>0&&(e.clipboardData?.getData("text")||e.preventDefault(),F(d))},de=e=>{!p.supportsVision||!(e.dataTransfer?.types&&Array.from(e.dataTransfer.types).includes("Files"))||(e.preventDefault(),w.value+=1,h.value=!0)},ue=e=>{!p.supportsVision||!(e.dataTransfer?.types&&Array.from(e.dataTransfer.types).includes("Files"))||(e.preventDefault(),e.dataTransfer.dropEffect="copy")},pe=e=>{p.supportsVision&&(w.value>0&&(w.value-=1),w.value===0&&(h.value=!1))},me=e=>{if(!p.supportsVision)return;e.preventDefault(),w.value=0,h.value=!1;const a=e.dataTransfer?.files;a&&a.length>0&&F(a)},he=e=>{m.value=m.value.filter(a=>a.id!==e)},O=()=>{if(l.value){l.value.style.height="auto";const e=Math.min(l.value.scrollHeight,192);l.value.style.height=e+"px"}};return ye(()=>p.modelValue,()=>{P(()=>O())}),xe(()=>{O(),P(()=>{l.value?.focus()})}),$({focus:()=>l.value?.focus()}),(e,a)=>{const d=_e;return i(),c("fieldset",tt,[s("div",{class:B(["bg-card border-border/80 dark:border-border/60 focus-within:border-primary/60 hover:border-border dark:hover:border-border/80 relative z-10 flex cursor-text flex-col items-stretch rounded-2xl border-2 shadow-lg backdrop-blur-md transition-all duration-200 focus-within:shadow-xl hover:shadow-xl",{"ring-primary/50 border-primary/40 ring-2":t(h)}]),onDragenter:S(de,["prevent"]),onDragover:S(ue,["prevent"]),onDragleave:S(pe,["prevent"]),onDrop:S(me,["prevent"])},[t(m).length>0?(i(),c("div",at,[(i(!0),c(Z,null,J(t(m),r=>(i(),c("div",{key:r.id,class:"group border-border/50 relative h-16 w-16 overflow-hidden rounded-lg border shadow-sm"},[s("img",{src:r.dataUrl,alt:r.alt||t(o)("chat.input.previewAlt"),class:"h-full w-full object-cover"},null,8,st),r.status==="uploading"?(i(),c("div",ot,[g(t(L),{class:"text-primary h-4 w-4 animate-spin"})])):r.status==="error"?(i(),c("div",nt,C(t(o)("chat.input.uploadFailedLabel")),1)):v("",!0),s("button",{onClick:u=>he(r.id),class:"bg-foreground text-background absolute -top-1 -right-1 rounded-full p-1 opacity-0 shadow-md transition-opacity group-hover:opacity-100",type:"button"},[g(t(ke),{class:"h-3 w-3"})],8,rt)]))),128))])):v("",!0),s("div",it,[n.supportsVision?(i(),c("div",lt,[s("button",{onClick:se,type:"button",disabled:n.disabled,class:"hover:bg-muted rounded-lg p-2 transition-colors disabled:opacity-50",title:t(o)("chat.input.uploadButton")},[g(t(Le),{class:"text-muted-foreground h-5 w-5"})],8,ct),s("button",{onClick:oe,type:"button",disabled:n.disabled,class:"hover:bg-muted rounded-lg p-2 transition-colors disabled:opacity-50",title:t(o)("chat.input.cameraButton")},[g(t(Fe),{class:"text-muted-foreground h-5 w-5"})],8,dt),s("input",{ref_key:"fileInputRef",ref:_,type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:ie},null,544),s("input",{ref_key:"cameraInputRef",ref:T,type:"file",accept:"image/*",capture:t(R),class:"hidden",onChange:le},null,40,ut)])):v("",!0),s("div",pt,[s("textarea",{ref_key:"textareaRef",ref:l,value:n.modelValue,onInput:te,onKeydown:ee,onPaste:ce,placeholder:t(Q),disabled:n.disabled,autofocus:"","data-testid":"chat-input",class:"placeholder:text-muted-foreground/70 max-h-40 min-h-[24px] w-full resize-none overflow-y-auto border-0 bg-transparent py-1 text-sm leading-6 outline-none md:text-[15px]",rows:"1"},null,40,mt)]),s("div",ht,[g(d,{onClick:ae,disabled:n.sendDisabled||t(k),"data-testid":"send-message-btn",class:B(["size-9 rounded-full shadow-sm transition-all duration-200",{"bg-primary hover:bg-primary/90":!n.sendDisabled&&!t(k),"bg-muted":n.sendDisabled||t(k)}])},{default:we(()=>[t(k)?(i(),E(t(L),{key:0,class:"h-4 w-4 animate-spin"})):(i(),E(t(Me),{key:1,class:"h-4 w-4"}))]),_:1},8,["disabled","class"])])]),t(k)||t(I).length?(i(),c("div",ft,[s("div",gt,[t(k)?(i(),c("span",bt,[g(t(L),{class:"h-3 w-3 animate-spin"}),K(" "+C(t(o)("chat.input.uploadingStatus",{count:t(j)})),1)])):v("",!0),t(I).length?(i(),c("span",vt,[g(t(Se),{class:"h-3 w-3"}),K(" "+C(t(o)("chat.input.failedStatus",{count:t(I).length})),1)])):v("",!0)])])):v("",!0)],34)])}}}),It=Object.assign(yt,{__name:"ChatInput"}),Ft=Ce("new-conversation",()=>{const n=D({conversations:{}});return{state:n,setConversationData:(o,l,_)=>{n.value.conversations[o]={userMessage:l,assistant:_,isTransitioning:!0,timestamp:Date.now()}},getConversationData:o=>n.value.conversations[o]||null,clearConversationData:o=>{delete n.value.conversations[o]},completeTransition:o=>{const l=n.value.conversations[o];l&&(l.isTransitioning=!1)},isNewConversation:o=>n.value.conversations[o]?.isTransitioning||!1,cleanupOldConversations:()=>{const o=Date.now()-3e5;for(const[l,_]of Object.entries(n.value.conversations))_.timestamp<o&&delete n.value.conversations[l]}}});export{Mt as _,St as a,It as b,Ft as u};
