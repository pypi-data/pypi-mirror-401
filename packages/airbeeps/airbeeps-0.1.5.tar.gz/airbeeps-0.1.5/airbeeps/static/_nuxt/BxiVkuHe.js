import{_ as ae}from"./Di_95mgX.js";import{h as de,ac as xt,af as Ke,ag as Ae,m as ke,V as yt,k as Y,ah as Je,v as S,o as c,w as n,x as He,g as e,ae as Xe,ad as Qe,R as Z,ai as wt,b as s,a1 as kt,N as Ct,c as v,a as l,D as We,e as Ye,E as f,W as Ze,H as je,I as $,d as _,t as d,J as le,K as ne,M as fe,y as ye,L as M,Q as N,a3 as Lt,s as et,B as $t,a7 as St,i as re,a2 as Te,aj as It,ak as Nt,al as Dt,am as Et,an as Mt}from"./BzhixHsn.js";import{_ as ce}from"./DlAUqK2U.js";import{_ as Bt,a as zt,b as bt,c as Ft,d as Pt}from"./C9XbPd6k.js";import{_ as Ut}from"./CHPRih2d.js";import{_ as At,a as Tt,b as Vt,c as qt,d as Rt,e as Ot,f as Gt,g as Kt}from"./B-FcqR0d.js";import{_ as Jt,a as Ht}from"./BYr6U6oc.js";import{_ as Xt}from"./CawQPbYo.js";import{u as Qt,D as Wt}from"./BTANIQ8V.js";import{_ as ve}from"./4isL45Eu.js";import{_ as Yt}from"./B_FRSInF.js";import{_ as ge,a as _e}from"./DjusaS8W.js";import{_ as he}from"./CG_BwZdW.js";import{_ as xe}from"./D0aoH_0m.js";import{_ as Ve,a as qe,d as Re,b as Oe,c as Be,C as Zt}from"./Bi0Cqvs9.js";import{I as jt}from"./DU0NpF9R.js";import{U as ze}from"./C-9Ampo3.js";import{L as we}from"./B9I6JWJy.js";import{T as Ce}from"./C-xhCs27.js";import{R as be}from"./A-tu-Llp.js";import{D as es}from"./C8B8ONuC.js";import{T as ts}from"./RCxqQWZp.js";import{C as Ge}from"./BoBF9D-p.js";import{C as ss}from"./C56gk0qC.js";import{C as as}from"./CW7RC7pq.js";import{C as ls}from"./DhvzP0AS.js";import{F as ns}from"./DkVjT0nP.js";import"./Di109XjC.js";import"./CRjpF7qy.js";import"./IgXGHcdR.js";import"./COjiOs1v.js";import"./Bp3-KBkO.js";import"./DKMWZZOl.js";import"./XCOtPLqC.js";import"./C-zlyDS5.js";import"./KyMCIHQI.js";import"./DzpHhHXI.js";import"./vJ3Jskde.js";import"./BkS3akZz.js";import"./BmCC6msl.js";import"./CCA1r4XF.js";const ie=100,[os,rs]=xt("ProgressRoot"),Le=x=>typeof x=="number";function is(x,p){return Je(x)||Le(x)&&!Number.isNaN(x)&&x<=p&&x>=0?x:(console.error(`Invalid prop \`value\` of value \`${x}\` supplied to \`ProgressRoot\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${ie} if no \`max\` prop is set)
  - \`null\`  or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`),null)}function ds(x){return Le(x)&&!Number.isNaN(x)&&x>0?x:(console.error(`Invalid prop \`max\` of value \`${x}\` supplied to \`ProgressRoot\`. Only numbers greater than 0 are valid max values. Defaulting to \`${ie}\`.`),ie)}var cs=de({__name:"ProgressRoot",props:{modelValue:{type:[Number,null],required:!1},max:{type:Number,required:!1,default:ie},getValueLabel:{type:Function,required:!1,default:(x,p)=>Le(x)?`${Math.round(x/p*ie)}%`:void 0},getValueText:{type:Function,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["update:modelValue","update:max"],setup(x,{emit:p}){const C=x,g=p;Ke();const y=Ae(C,"modelValue",g,{passive:C.modelValue===void 0}),z=Ae(C,"max",g,{passive:C.max===void 0});ke(()=>y.value,async k=>{const h=is(k,C.max);h!==k&&(await yt(),y.value=h)},{immediate:!0}),ke(()=>C.max,k=>{const h=ds(C.max);h!==k&&(z.value=h)},{immediate:!0});const F=Y(()=>Je(y.value)?"indeterminate":y.value===z.value?"complete":"loading");return rs({modelValue:y,max:z,progressState:F}),(k,h)=>(c(),S(e(Xe),{"as-child":k.asChild,as:k.as,"aria-valuemax":e(z),"aria-valuemin":0,"aria-valuenow":Le(e(y))?e(y):void 0,"aria-valuetext":k.getValueText?.(e(y),e(z)),"aria-label":k.getValueLabel(e(y),e(z)),role:"progressbar","data-state":F.value,"data-value":e(y)??void 0,"data-max":e(z)},{default:n(()=>[He(k.$slots,"default",{modelValue:e(y)})]),_:3},8,["as-child","as","aria-valuemax","aria-valuenow","aria-valuetext","aria-label","data-state","data-value","data-max"]))}}),us=cs,ms=de({__name:"ProgressIndicator",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(x){const p=x,C=os();return Ke(),(g,y)=>(c(),S(e(Xe),Qe(p,{"data-state":e(C).progressState.value,"data-value":e(C).modelValue?.value??void 0,"data-max":e(C).max.value}),{default:n(()=>[He(g.$slots,"default")]),_:3},16,["data-state","data-value","data-max"]))}}),ps=ms;const tt=Z("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);const fs=Z("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);const vs=Z("cpu",[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]]);const gs=Z("file-stack",[["path",{d:"M11 21a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-8a1 1 0 0 1 1-1",key:"likhh7"}],["path",{d:"M16 16a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1",key:"17ky3x"}],["path",{d:"M21 6a2 2 0 0 0-.586-1.414l-2-2A2 2 0 0 0 17 2h-3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1z",key:"1hyeo0"}]]);const _s=Z("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);const hs=Z("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);const xs=Z("split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]),st=de({__name:"Progress",props:{modelValue:{default:0},max:{},getValueLabel:{},getValueText:{},asChild:{type:Boolean},as:{},class:{}},setup(x){const p=x,C=wt(p,"class");return(g,y)=>(c(),S(e(us),Qe(e(C),{class:e(Ct)("bg-secondary relative h-4 w-full overflow-hidden rounded-full",p.class)}),{default:n(()=>[s(e(ps),{class:"bg-primary h-full w-full flex-1 transition-all",style:kt(`transform: translateX(-${100-(p.modelValue??0)}%);`)},null,8,["style"])]),_:1},16,["class"]))}}),ys={},ws={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"};function ks(x,p){return c(),v("svg",ws,[...p[0]||(p[0]=[l("path",{fill:"#0062ff",d:"M128 128C128 92.7 156.7 64 192 64L341.5 64C358.5 64 374.8 70.7 386.8 82.7L493.3 189.3C505.3 201.3 512 217.6 512 234.6L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 128zM336 122.5L336 216C336 229.3 346.7 240 360 240L453.5 240L336 122.5zM263.4 338.8C260.5 325.9 247.7 317.7 234.8 320.6C221.9 323.5 213.7 336.3 216.6 349.2L248.6 493.2C250.9 503.7 260 511.4 270.8 512C281.6 512.6 291.4 505.9 294.8 495.6L320 419.9L345.2 495.6C348.6 505.8 358.4 512.5 369.2 512C380 511.5 389.1 503.8 391.4 493.2L423.4 349.2C426.3 336.3 418.1 323.4 405.2 320.6C392.3 317.8 379.4 325.9 376.6 338.8L363.4 398.2L342.8 336.4C339.5 326.6 330.4 320 320 320C309.6 320 300.5 326.6 297.2 336.4L276.6 398.2L263.4 338.8z"},null,-1)])])}const Cs=Object.assign(ce(ys,[["render",ks]]),{__name:"FileTypeIconDoc"}),Ls={},$s={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"};function Ss(x,p){return c(),v("svg",$s,[...p[0]||(p[0]=[l("path",{fill:"#fe3e3e",d:"M128 64C92.7 64 64 92.7 64 128L64 512C64 547.3 92.7 576 128 576L208 576L208 464C208 428.7 236.7 400 272 400L448 400L448 234.5C448 217.5 441.3 201.2 429.3 189.2L322.7 82.7C310.7 70.7 294.5 64 277.5 64L128 64zM389.5 240L296 240C282.7 240 272 229.3 272 216L272 122.5L389.5 240zM272 444C261 444 252 453 252 464L252 592C252 603 261 612 272 612C283 612 292 603 292 592L292 564L304 564C337.1 564 364 537.1 364 504C364 470.9 337.1 444 304 444L272 444zM304 524L292 524L292 484L304 484C315 484 324 493 324 504C324 515 315 524 304 524zM400 444C389 444 380 453 380 464L380 592C380 603 389 612 400 612L432 612C460.7 612 484 588.7 484 560L484 496C484 467.3 460.7 444 432 444L400 444zM420 572L420 484L432 484C438.6 484 444 489.4 444 496L444 560C444 566.6 438.6 572 432 572L420 572zM508 464L508 592C508 603 517 612 528 612C539 612 548 603 548 592L548 548L576 548C587 548 596 539 596 528C596 517 587 508 576 508L548 508L548 484L576 484C587 484 596 475 596 464C596 453 587 444 576 444L528 444C517 444 508 453 508 464z"},null,-1)])])}const Is=Object.assign(ce(Ls,[["render",Ss]]),{__name:"FileTypeIconPdf"}),Ns={},Ds={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"};function Es(x,p){return c(),v("svg",Ds,[...p[0]||(p[0]=[l("path",{d:"M593.8 123.1L46.2 123.1C20.7 123.1 0 143.8 0 169.2L0 470.7C0 496.2 20.7 516.9 46.2 516.9L593.9 516.9C619.4 516.9 640.1 496.2 640 470.8L640 169.2C640 143.8 619.3 123.1 593.8 123.1zM338.5 424.6L277 424.6L277 304.6L215.5 381.5L154 304.6L154 424.6L92.3 424.6L92.3 215.4L153.8 215.4L215.3 292.3L276.8 215.4L338.3 215.4L338.3 424.6L338.5 424.6zM473.8 427.7L381.5 320L443 320L443 215.4L504.5 215.4L504.5 320L566 320L473.8 427.7z"},null,-1)])])}const Ms=Object.assign(ce(Ns,[["render",Es]]),{__name:"FileTypeIconMd"}),Bs={},zs={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"};function bs(x,p){return c(),v("svg",zs,[...p[0]||(p[0]=[l("path",{fill:"#74C0FC",d:"M128 128C128 92.7 156.7 64 192 64L341.5 64C358.5 64 374.8 70.7 386.8 82.7L493.3 189.3C505.3 201.3 512 217.6 512 234.6L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 128zM336 122.5L336 216C336 229.3 346.7 240 360 240L453.5 240L336 122.5zM248 320C234.7 320 224 330.7 224 344C224 357.3 234.7 368 248 368L392 368C405.3 368 416 357.3 416 344C416 330.7 405.3 320 392 320L248 320zM248 416C234.7 416 224 426.7 224 440C224 453.3 234.7 464 248 464L392 464C405.3 464 416 453.3 416 440C416 426.7 405.3 416 392 416L248 416z"},null,-1)])])}const Fs=Object.assign(ce(Bs,[["render",bs]]),{__name:"FileTypeIconTxt"}),Ps={},Us={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"};function As(x,p){return c(),v("svg",Us,[...p[0]||(p[0]=[l("path",{fill:"#16c041",d:"M128 128C128 92.7 156.7 64 192 64L341.5 64C358.5 64 374.8 70.7 386.8 82.7L493.3 189.3C505.3 201.3 512 217.6 512 234.6L512 512C512 547.3 483.3 576 448 576L192 576C156.7 576 128 547.3 128 512L128 128zM336 122.5L336 216C336 229.3 346.7 240 360 240L453.5 240L336 122.5zM292 330.7C284.6 319.7 269.7 316.7 258.7 324C247.7 331.3 244.7 346.3 252 357.3L291.2 416L252 474.7C244.6 485.7 247.6 500.6 258.7 508C269.8 515.4 284.6 512.4 292 501.3L320 459.3L348 501.3C355.4 512.3 370.3 515.3 381.3 508C392.3 500.7 395.3 485.7 388 474.7L348.8 416L388 357.3C395.4 346.3 392.4 331.4 381.3 324C370.2 316.6 355.4 319.6 348 330.7L320 372.7L292 330.7z"},null,-1)])])}const Ts=Object.assign(ce(Ps,[["render",As]]),{__name:"FileTypeIconXls"}),Vs={class:"space-y-5"},qs={class:"flex flex-col gap-2"},Rs={class:"flex flex-col gap-3 sm:flex-row sm:items-start sm:justify-between"},Os={class:"flex-1 space-y-2"},Gs={class:"flex items-center gap-2"},Ks={class:"flex items-center gap-2 sm:pt-6"},Js={key:0,class:"pt-2"},Hs={class:"flex items-center gap-2"},Xs={key:0,class:"text-muted-foreground ml-1"},Qs={key:1,class:"text-muted-foreground ml-1"},Ws={class:"space-y-2"},Ys={key:0,class:"space-y-4"},Zs={class:"flex justify-center"},js={class:"border-primary/40 text-primary flex h-12 w-12 items-center justify-center rounded-full border border-dashed"},ea={class:"space-y-2"},ta={class:"text-muted-foreground text-sm"},sa={class:"text-muted-foreground text-xs"},aa={class:"flex justify-center gap-2"},la={key:1,class:"space-y-4"},na={class:"max-h-60 space-y-2 overflow-auto pr-1"},oa={class:"flex flex-col text-left"},ra={class:"truncate text-sm font-medium"},ia={class:"text-muted-foreground text-xs"},da={class:"flex flex-wrap items-center justify-end gap-2"},ca={key:0,class:"space-y-3"},ua={class:"flex items-center justify-between"},ma={class:"flex min-w-0 flex-1 items-center gap-2"},pa={class:"truncate text-sm font-medium"},fa={class:"flex shrink-0 items-center gap-1"},va={key:0,class:"space-y-1"},ga={class:"text-muted-foreground flex justify-between text-xs"},_a={key:0,class:"text-muted-foreground text-xs"},ha={key:1,class:"text-destructive text-sm"},xa={key:2,class:"flex items-center gap-1 text-sm text-green-600"},ya="file-upload-dropzone",wa=de({__name:"FileUploadToKB",props:{defaultKnowledgeBaseId:{default:""}},emits:["upload-complete"],setup(x,{emit:p}){const{$api:C}=We(),g=et(),{t:y}=Ye(),z=x,F=p,k=f(z.defaultKnowledgeBaseId),h=f([]),O=f(!1),P=f([]),X=f([]),G=f(),q=f(!1),K=f(!0),U=f([]),B=f(""),R=f(!1);ke(()=>z.defaultKnowledgeBaseId,t=>{k.value=t},{immediate:!0}),Ze(()=>{P.value.forEach(t=>{t.eventSource&&t.eventSource.close()})});const j=t=>{const i=t.target;if(i.files){const r=Array.from(i.files);h.value.push(...r)}},Q=t=>{const i=Array.from(t);i.length&&h.value.push(...i)},A=t=>{t.preventDefault()},oe=t=>{t.preventDefault(),q.value=!0},T=t=>{t.preventDefault(),q.value=!1},ee=t=>{t.preventDefault(),q.value=!1,t.dataTransfer?.files&&Q(t.dataTransfer.files)},W=t=>{h.value.splice(t,1)},$e=Y(()=>h.value.map(t=>({name:t.name,size:t.size,type:t.type||t.name.split(".").pop()||""}))),Se=t=>{if(!t)return"0 B";const i=["B","KB","MB","GB"],r=Math.min(Math.floor(Math.log(t)/Math.log(1024)),i.length-1),D=t/Math.pow(1024,r);return`${D.toFixed(D>=10?0:1)} ${i[r]}`},ue=async()=>{try{const t=await C("/v1/admin/rag/knowledge-bases");X.value=t.items||t||[]}catch{N.error(y("components.fileUpload.loadKnowledgeBasesFailed"))}},Ie=async()=>{if(!k.value){U.value=[],B.value="";return}try{const t=await C(`/v1/admin/rag/knowledge-bases/${k.value}/ingestion-profiles`);U.value=t||[];const i=U.value.find(r=>r.is_default);i?B.value=i.id:U.value.length>0?B.value=U.value[0].id:B.value="",R.value=U.value.length>0}catch{U.value=[]}};ke(k,()=>{Ie()});const Ne=t=>t?{PARSING:"Parsing file...",CHUNKING:"Creating chunks...",EMBEDDING:"Generating embeddings...",UPSERTING:"Saving to vector store...",CANCELING:"Canceling..."}[t]||t:"",De=t=>{switch(t){case"succeeded":return"default";case"failed":case"canceled":return"destructive";case"running":return"secondary";default:return"outline"}},te=(t,i=!1)=>{const r=g.public.apiBase||"",D=i&&t.lastSeq>0?`?last_event_id=${t.lastSeq}`:"",V=`${r}/v1/admin/rag/ingestion-jobs/${t.jobId}/events${D}`;t.eventSource&&t.eventSource.close();const w=new EventSource(V,{withCredentials:!0});t.eventSource=w,w.onopen=()=>{t.reconnectAttempts=0},w.onmessage=I=>{if(I.lastEventId){const u=parseInt(I.lastEventId,10);isNaN(u)||(t.lastSeq=u)}},w.addEventListener("heartbeat",I=>{try{const u=JSON.parse(I.data);t.status=u.status?.toLowerCase()||t.status,t.stage=u.stage,t.progress=u.progress||0,t.totalItems=u.total_items,t.processedItems=u.processed_items}catch{}}),w.addEventListener("stage_change",I=>{try{const u=JSON.parse(I.data);t.stage=u.data?.stage||u.stage,t.progress=u.data?.progress||u.progress||t.progress,u.seq&&(t.lastSeq=u.seq)}catch{}}),w.addEventListener("progress",I=>{try{const u=JSON.parse(I.data),b=u.data||u;u.seq&&(t.lastSeq=u.seq),b.total_items!=null&&(t.totalItems=b.total_items),b.processed_items!=null&&(t.processedItems=b.processed_items),b.progress!=null&&(t.progress=b.progress),b.stage&&(t.stage=b.stage),b.total_chunks!=null&&(t.totalItems=b.total_chunks)}catch{}}),w.addEventListener("completed",I=>{try{const u=JSON.parse(I.data);t.status="succeeded",t.progress=100,t.stage=null,u.seq&&(t.lastSeq=u.seq),N.success(`'${t.fileName}' ingested successfully`),F("upload-complete")}catch{}w.close(),t.eventSource=null}),w.addEventListener("error",I=>{try{const u=JSON.parse(I.data);t.status="failed",t.error=u.data?.error||u.error||"Unknown error",t.stage=null,u.seq&&(t.lastSeq=u.seq)}catch{}w.close(),t.eventSource=null}),w.addEventListener("canceled",I=>{try{const u=JSON.parse(I.data);u.seq&&(t.lastSeq=u.seq)}catch{}t.status="canceled",t.stage=null,w.close(),t.eventSource=null}),w.addEventListener("done",()=>{w.close(),t.eventSource=null}),w.onerror=I=>{w.close(),t.eventSource=null,t.status==="running"&&t.reconnectAttempts<5&&(t.reconnectAttempts++,setTimeout(()=>{t.status==="running"&&te(t,!0)},2e3*t.reconnectAttempts))}},se=async()=>{if(!k.value||h.value.length===0){N.error(y("components.fileUpload.selectKnowledgeBaseAndFiles"));return}O.value=!0;try{for(const t of h.value){const i={jobId:"",fileName:t.name,status:"pending",stage:null,progress:0,totalItems:null,processedItems:null,error:null,eventSource:null,lastSeq:0,reconnectAttempts:0};P.value.push(i);try{const r=new FormData;r.append("file",t),r.append("knowledge_base_id",k.value),r.append("dedup_strategy","replace"),r.append("clean_data",K.value.toString()),B.value&&r.append("profile_id",B.value);const D=await C("/v1/admin/rag/ingestion-jobs/from-upload",{method:"POST",body:r});i.jobId=D.job_id,i.status="running",te(i)}catch(r){i.status="failed",i.error=r?.message||"Failed to create ingestion job",N.error(y("components.fileUpload.uploadFileFailed",{name:t.name}))}}h.value=[]}finally{O.value=!1}},Ee=async t=>{if(!(!t.jobId||t.status!=="running"))try{await C(`/v1/admin/rag/ingestion-jobs/${t.jobId}/cancel`,{method:"POST"}),t.stage="CANCELING",N.info(`Cancellation requested for '${t.fileName}'`)}catch{N.error("Failed to cancel job")}},me=async t=>{if(!(!t.jobId||!["failed","canceled"].includes(t.status)))try{const i=await C(`/v1/admin/rag/ingestion-jobs/${t.jobId}/retry`,{method:"POST"});t.jobId=i.job_id,t.status="running",t.stage=null,t.progress=0,t.error=null,te(t),N.info(`Retrying '${t.fileName}'...`)}catch{N.error("Failed to retry job")}},pe=t=>{const i=P.value[t];i?.eventSource&&i.eventSource.close(),P.value.splice(t,1)};return je(()=>{ue()}),(t,i)=>(c(),v("div",Vs,[l("div",qs,[l("div",Rs,[l("div",Os,[l("div",Gs,[s(e(ve),{for:"kb-select",class:"text-sm font-medium"},{default:n(()=>[_(d(e(y)("components.fileUpload.selectKnowledgeBase")),1)]),_:1})]),s(e(Ve),{modelValue:k.value,"onUpdate:modelValue":i[0]||(i[0]=r=>k.value=r),required:""},{default:n(()=>[s(e(qe),{class:"h-10"},{default:n(()=>[s(e(Re),{placeholder:e(y)("components.fileUpload.selectKnowledgeBasePlaceholder")},null,8,["placeholder"])]),_:1}),s(e(Oe),null,{default:n(()=>[(c(!0),v(le,null,ne(X.value,r=>(c(),S(e(Be),{key:r.id,value:r.id},{default:n(()=>[_(d(r.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),l("div",Ks,[s(e(Yt),{id:"clean-data",checked:K.value,"onUpdate:checked":i[1]||(i[1]=r=>K.value=r)},null,8,["checked"]),s(e(ve),{for:"clean-data",class:"text-foreground text-sm font-medium"},{default:n(()=>[_(d(e(y)("components.fileUpload.cleanData")),1)]),_:1}),s(e(xe),null,{default:n(()=>[s(e(ge),null,{default:n(()=>[s(e(_e),{"as-child":""},{default:n(()=>[s(e(jt),{class:"text-foreground/80 h-4 w-4 cursor-help"})]),_:1}),s(e(he),{side:"top",class:"max-w-xs text-left"},{default:n(()=>[_(d(e(y)("components.fileUpload.cleanDataHelp")),1)]),_:1})]),_:1})]),_:1})])]),R.value?(c(),v("div",Js,[l("div",Hs,[s(e(ve),{for:"profile-select",class:"text-sm font-medium whitespace-nowrap"},{default:n(()=>[...i[5]||(i[5]=[_(" Ingestion Profile: ",-1)])]),_:1}),s(e(Ve),{modelValue:B.value,"onUpdate:modelValue":i[2]||(i[2]=r=>B.value=r),class:"flex-1"},{default:n(()=>[s(e(qe),{class:"h-9"},{default:n(()=>[s(e(Re),{placeholder:"Select profile..."})]),_:1}),s(e(Oe),null,{default:n(()=>[s(e(Be),{value:""},{default:n(()=>[...i[6]||(i[6]=[_("Auto-detect",-1)])]),_:1}),(c(!0),v(le,null,ne(U.value,r=>(c(),S(e(Be),{key:r.id,value:r.id},{default:n(()=>[_(d(r.name)+" ",1),r.is_default?(c(),v("span",Xs,"(default)")):$("",!0),r.is_builtin?(c(),v("span",Qs,"(built-in)")):$("",!0)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])])])):$("",!0)]),l("div",Ws,[s(e(ve),{for:"file-upload",class:"text-sm font-medium"},{default:n(()=>[_(d(e(y)("components.fileUpload.uploadFiles")),1)]),_:1}),l("div",{id:ya,class:ye(["bg-muted/40 rounded-xl border-2 border-dashed p-6 text-center transition-all duration-200",[q.value?"border-primary bg-primary/5 shadow-sm":"border-border hover:border-primary/70 hover:bg-muted/60"]]),onDragover:fe(A,["prevent"]),onDragenter:fe(oe,["prevent"]),onDragleave:fe(T,["prevent"]),onDrop:fe(ee,["prevent"])},[l("input",{ref_key:"fileInput",ref:G,type:"file",multiple:"",accept:".pdf,.txt,.md,.docx,.doc,.pptx,.xlsx,.xls,.csv",class:"hidden",onChange:j},null,544),h.value.length===0?(c(),v("div",Ys,[l("div",Zs,[l("div",js,[s(e(ze),{class:"h-6 w-6"})])]),l("div",ea,[l("p",ta,d(e(y)("components.fileUpload.supportedFormats")),1),l("p",sa,d(e(y)("components.fileUpload.orDragDrop")),1)]),l("div",aa,[s(e(M),{variant:"outline",class:"border-primary/70 text-primary shadow-sm",onClick:i[3]||(i[3]=r=>G.value?.click())},{default:n(()=>[_(d(e(y)("components.fileUpload.selectFiles")),1)]),_:1})])])):(c(),v("div",la,[l("div",na,[(c(!0),v(le,null,ne($e.value,(r,D)=>(c(),v("div",{key:`${r.name}-${D}`,class:"border-border/70 bg-card flex items-center justify-between rounded-lg border px-3 py-2"},[l("div",oa,[l("span",ra,d(r.name),1),l("span",ia,d(Se(r.size))+" · "+d(r.type||"file"),1)]),s(e(M),{variant:"ghost",size:"sm",onClick:V=>W(D)},{default:n(()=>[s(e(Ce),{class:"text-muted-foreground h-4 w-4"})]),_:1},8,["onClick"])]))),128))]),l("div",da,[s(e(M),{variant:"outline",size:"sm",onClick:i[4]||(i[4]=r=>G.value?.click())},{default:n(()=>[_(d(e(y)("components.fileUpload.addMore")),1)]),_:1}),s(e(M),{onClick:se,disabled:!k.value||O.value,class:"min-w-[140px]"},{default:n(()=>[O.value?(c(),S(e(we),{key:1,class:"mr-2 h-4 w-4 animate-spin"})):(c(),S(e(ze),{key:0,class:"mr-2 h-4 w-4"})),_(" "+d(O.value?e(y)("components.fileUpload.uploading"):e(y)("components.fileUpload.startUpload")),1)]),_:1},8,["disabled"])])]))],34)]),P.value.length>0?(c(),v("div",ca,[i[11]||(i[11]=l("h4",{class:"font-medium"},"Ingestion Jobs",-1)),(c(!0),v(le,null,ne(P.value,(r,D)=>(c(),v("div",{key:r.jobId||`pending-${D}`,class:"border-border/60 bg-card space-y-2 rounded-lg border px-4 py-3"},[l("div",ua,[l("div",ma,[l("span",pa,d(r.fileName),1),s(e(ae),{variant:De(r.status),class:"shrink-0 capitalize"},{default:n(()=>[_(d(r.status),1)]),_:2},1032,["variant"])]),l("div",fa,[r.status==="running"?(c(),S(e(xe),{key:0},{default:n(()=>[s(e(ge),null,{default:n(()=>[s(e(_e),{"as-child":""},{default:n(()=>[s(e(M),{variant:"ghost",size:"icon",class:"h-7 w-7",disabled:r.stage==="CANCELING",onClick:V=>Ee(r)},{default:n(()=>[s(e(Lt),{class:"h-4 w-4"})]),_:1},8,["disabled","onClick"])]),_:2},1024),s(e(he),null,{default:n(()=>[...i[7]||(i[7]=[_("Cancel",-1)])]),_:1})]),_:2},1024)]),_:2},1024)):$("",!0),["failed","canceled"].includes(r.status)?(c(),S(e(xe),{key:1},{default:n(()=>[s(e(ge),null,{default:n(()=>[s(e(_e),{"as-child":""},{default:n(()=>[s(e(M),{variant:"ghost",size:"icon",class:"h-7 w-7",onClick:V=>me(r)},{default:n(()=>[s(e(be),{class:"h-4 w-4"})]),_:1},8,["onClick"])]),_:2},1024),s(e(he),null,{default:n(()=>[...i[8]||(i[8]=[_("Retry",-1)])]),_:1})]),_:2},1024)]),_:2},1024)):$("",!0),["succeeded","failed","canceled"].includes(r.status)?(c(),S(e(xe),{key:2},{default:n(()=>[s(e(ge),null,{default:n(()=>[s(e(_e),{"as-child":""},{default:n(()=>[s(e(M),{variant:"ghost",size:"icon",class:"h-7 w-7",onClick:V=>pe(D)},{default:n(()=>[s(e(Ce),{class:"h-4 w-4"})]),_:1},8,["onClick"])]),_:2},1024),s(e(he),null,{default:n(()=>[...i[9]||(i[9]=[_("Remove",-1)])]),_:1})]),_:2},1024)]),_:2},1024)):$("",!0)])]),r.status==="running"?(c(),v("div",va,[l("div",ga,[l("span",null,d(Ne(r.stage)),1),l("span",null,d(r.progress)+"%",1)]),s(e(st),{"model-value":r.progress,class:"h-2"},null,8,["model-value"]),r.totalItems!=null?(c(),v("div",_a,d(r.processedItems||0)+" / "+d(r.totalItems)+" items ",1)):$("",!0)])):$("",!0),r.error?(c(),v("div",ha,d(r.error),1)):$("",!0),r.status==="succeeded"?(c(),v("div",xa,[s(e(tt),{class:"h-4 w-4"}),i[10]||(i[10]=l("span",null,"Ingestion complete",-1))])):$("",!0)]))),128))])):$("",!0)]))}}),ka=Object.assign(wa,{__name:"AdminFileUploadToKB"}),Ca={class:"flex h-full flex-col"},La={class:"from-background to-muted/30 border-b bg-gradient-to-r px-1 py-3"},$a={class:"flex items-center justify-between gap-4"},Sa={class:"flex min-w-0 items-center gap-3"},Ia={class:"bg-primary/10 text-primary flex h-10 w-10 shrink-0 items-center justify-center rounded-lg"},Na={class:"min-w-0"},Da={class:"flex items-center gap-2"},Ea={class:"truncate text-lg font-semibold"},Ma={class:"text-muted-foreground flex items-center gap-3 text-xs"},Ba={class:"flex items-center gap-1"},za={class:"flex items-center gap-1"},ba={class:"flex items-center gap-1"},Fa={class:"flex shrink-0 items-center gap-2"},Pa={key:2,class:"absolute -top-1 -right-1 flex h-3 w-3"},Ua={class:"bg-muted/30 mt-2 rounded-lg border p-3"},Aa={class:"grid gap-4 text-sm sm:grid-cols-2 lg:grid-cols-4"},Ta={class:"mt-0.5"},Va={class:"mt-0.5 font-medium"},qa={class:"mt-0.5"},Ra={class:"mt-0.5"},Oa={class:"flex-1 overflow-hidden p-1"},Ga={class:"flex-1 overflow-y-auto py-4"},Ka={key:0,class:"mt-6 border-t pt-4"},Ja={class:"mb-3 flex items-center justify-between"},Ha={class:"space-y-2"},Xa={class:"flex items-center gap-2"},Qa={class:"min-w-0 flex-1 truncate text-sm font-medium"},Wa={key:0,class:"mt-2 space-y-1"},Ya={class:"text-muted-foreground flex justify-between text-xs"},Za={key:1,class:"text-destructive mt-2 text-xs"},ja={key:2,class:"text-muted-foreground mt-1 text-xs"},el={class:"flex-1 gap-4 overflow-y-auto px-6 py-4"},tl={key:0,class:"flex items-center justify-center py-8"},sl={key:1,class:"flex items-center justify-center py-8"},al={class:"text-muted-foreground"},ll={key:2,class:"space-y-3"},nl={class:"mb-2 flex items-center justify-between"},ol={class:"text-sm font-medium"},rl={class:"text-muted-foreground text-xs"},il={class:"text-sm whitespace-pre-wrap"},dl={class:"flex w-full items-center justify-between"},cl={class:"text-muted-foreground text-sm"},ul={class:"flex items-center gap-2"},jl=de({__name:"index",setup(x){const{$api:p}=We(),C=et(),{t:g}=Ye(),y=$t(),z=St(),F=y.params.id,k=f(!1),h=f(null),O=f(0),P=f(!1),X=f(!1),G=f(!1),q=f(null),K=f(!1),U=f(!1),B=f(!1),R=f(null),j=f([]),Q=f(0),A=f(1),oe=f(50),T=f([]),ee=f(!1),W=async()=>{ee.value=!0;try{const a=await p(`/v1/admin/rag/ingestion-jobs?knowledge_base_id=${F}&limit=20`);T.value.forEach(o=>{o.eventSource&&o.eventSource.close()}),T.value=(a||[]).map(o=>({...o,eventSource:null,lastSeq:0})),T.value.filter(o=>o.status==="RUNNING"||o.status==="PENDING").forEach(o=>$e(o))}catch(a){console.error("Failed to load ingestion jobs:",a)}finally{ee.value=!1}},$e=a=>{const m=`${C.public.apiBase||""}/v1/admin/rag/ingestion-jobs/${a.id}/events`;a.eventSource&&a.eventSource.close();const L=new EventSource(m,{withCredentials:!0});a.eventSource=L,L.addEventListener("heartbeat",J=>{try{const E=JSON.parse(J.data);a.status=E.status||a.status,a.stage=E.stage,a.progress=E.progress||0,a.total_items=E.total_items,a.processed_items=E.processed_items}catch{}}),L.addEventListener("progress",J=>{try{const E=JSON.parse(J.data),H=E.data||E;H.total_items!=null&&(a.total_items=H.total_items),H.processed_items!=null&&(a.processed_items=H.processed_items),H.progress!=null&&(a.progress=H.progress),H.stage&&(a.stage=H.stage)}catch{}}),L.addEventListener("completed",J=>{a.status="SUCCEEDED",a.progress=100,a.stage=null,L.close(),a.eventSource=null,w()}),L.addEventListener("error",J=>{try{const E=JSON.parse(J.data);a.status="FAILED",a.error_message=E.data?.error||E.error||"Unknown error",a.stage=null}catch{}L.close(),a.eventSource=null}),L.addEventListener("canceled",()=>{a.status="CANCELED",a.stage=null,L.close(),a.eventSource=null}),L.addEventListener("done",()=>{L.close(),a.eventSource=null}),L.onerror=()=>{L.close(),a.eventSource=null}};Ze(()=>{T.value.forEach(a=>{a.eventSource&&a.eventSource.close()})});const Se=Y(()=>T.value.filter(a=>a.status==="RUNNING"||a.status==="PENDING").length),ue=Y(()=>Se.value>0),Ie=a=>a?{PARSING:"Parsing...",CHUNKING:"Chunking...",EMBEDDING:"Embedding...",UPSERTING:"Saving...",CANCELING:"Canceling..."}[a]||a:"",Ne=a=>{switch(a){case"SUCCEEDED":return tt;case"FAILED":case"CANCELED":return fs;case"RUNNING":return we;default:return Ge}},De=a=>{switch(a){case"SUCCEEDED":return"text-green-600";case"FAILED":case"CANCELED":return"text-destructive";case"RUNNING":return"text-primary";default:return"text-muted-foreground"}},te=async()=>{P.value=!0;try{const a=await p(`/v1/admin/rag/knowledge-bases/${F}`);h.value=a}catch{N.error(g("admin.pages.knowledgeBases.detail.loadFailed")),z.push("/admin/kbs")}finally{P.value=!1}},se=f(!1),Ee=async()=>{if(h.value){se.value=!0;try{await p(`/v1/admin/rag/knowledge-bases/${F}/reindex`,{method:"POST"}),N.success(g("admin.pages.knowledgeBases.detail.reindexSuccess")||"Reindex started"),await te()}catch{N.error(g("admin.pages.knowledgeBases.detail.reindexFailed")||"Reindex failed")}finally{se.value=!1}}},me=Qt(`/v1/admin/rag/knowledge-bases/${F}/documents`,{update:"/v1/admin/rag/documents",delete:"/v1/admin/rag/documents"}),pe=f([]),t=f(0),i=f(""),r=f({}),D=f([]),V=f({pageIndex:0,pageSize:20}),w=async()=>{P.value=!0;try{const a={page:V.value.pageIndex+1,size:V.value.pageSize,search:i.value||void 0,sort_by:D.value[0]?.id,sort_desc:D.value[0]?.desc,...r.value},o=await me.getList(a);pe.value=o.items,t.value=o.total}catch{N.error(g("admin.pages.knowledgeBases.detail.loadDataFailed"))}finally{P.value=!1}},I=[{accessorKey:"title",header:g("admin.pages.knowledgeBases.detail.columns.title"),cell:a=>{const o=a.row.original,L=(J=>{switch(J?.toLowerCase()){case"pdf":return Is;case"doc":case"docx":return Cs;case"md":case"markdown":return Ms;case"txt":return Fs;case"xls":case"xlsx":return Ts;default:return ns}})(o.file_type);return re("div",{class:"flex items-center"},[re(L,{class:"size-8 mr-2 shrink-0"}),re("span",{class:"truncate"},o.title)])}},{accessorKey:"file_size",header:g("admin.pages.knowledgeBases.detail.columns.size"),cell:a=>{const o=a.getValue();return o?o<1024?`${o} B`:o<1024*1024?`${(o/1024).toFixed(1)} KB`:`${(o/(1024*1024)).toFixed(1)} MB`:"-"}},{accessorKey:"file_type",header:g("admin.pages.knowledgeBases.detail.columns.type"),cell:a=>{const o=a.getValue();return re(ae,{variant:"secondary",class:"uppercase"},()=>o||"—")}},{accessorKey:"status",header:g("admin.pages.knowledgeBases.detail.columns.status"),cell:a=>{const o=a.getValue(),m={INDEXING:"secondary",ACTIVE:"default",FAILED:"destructive"},L={INDEXING:"Indexing",ACTIVE:"Active",FAILED:"Failed"};return re(ae,{variant:m[o]||"secondary"},()=>L[o]||o)}},{accessorKey:"created_at",header:g("admin.pages.knowledgeBases.detail.columns.createdAt"),cell:a=>new Date(a.getValue()).toLocaleDateString()}],u=[{key:"view-chunks",label:g("admin.pages.knowledgeBases.detail.viewChunks"),icon:xs},{key:"delete",label:g("admin.pages.knowledgeBases.detail.delete"),icon:Ce,variant:"destructive"}],b=[{key:"bulk-delete",label:g("common.delete")||"Delete",icon:Ce,variant:"destructive"}],at=async()=>{O.value++,await Promise.all([w(),W()])},lt=async a=>{k.value=a,a||await Promise.all([w(),W()])},nt=()=>{G.value=!1,q.value=null},ot=(a,o)=>{switch(a.key){case"view-chunks":vt(o);break;case"delete":q.value=o,G.value=!0;break}},rt=async(a,o)=>{if(a.key==="bulk-delete")try{const m=o.map(L=>L.id);await p(`/v1/admin/rag/knowledge-bases/${F}/documents`,{method:"DELETE",body:{ids:m}}),N.success(g("admin.pages.knowledgeBases.detail.deleteConfirm.success")),O.value++,await w()}catch{N.error(g("admin.pages.knowledgeBases.detail.deleteConfirm.failed"))}},it=async()=>{if(q.value){X.value=!0;try{await me.remove(q.value.id),N.success(g("admin.pages.knowledgeBases.detail.deleteConfirm.success")),nt(),w()}catch{N.error(g("admin.pages.knowledgeBases.detail.deleteConfirm.failed"))}finally{X.value=!1}}},dt=a=>{i.value=a,V.value.pageIndex=0,w()},ct=a=>{r.value=a,V.value.pageIndex=0,w()},ut=a=>{D.value=a,w()},mt=a=>{V.value=a,w()},pt=()=>{w(),W()},ft=a=>{G.value=a},Me=async(a,o=1)=>{B.value=!0;try{const m=await p(`/v1/admin/rag/documents/${a}/chunks?page=${o}&size=${oe.value}`);j.value=m.items||[],Q.value=m.total||0,A.value=o}catch{N.error(g("admin.pages.knowledgeBases.detail.chunks.loadFailed"))}finally{B.value=!1}},vt=a=>{R.value=a,U.value=!0,A.value=1,Me(a.id,1)},gt=()=>{U.value=!1,R.value=null,j.value=[],Q.value=0,A.value=1},Fe=Y(()=>Math.ceil(Q.value/oe.value)),Pe=Y(()=>A.value>1),Ue=Y(()=>A.value<Fe.value),_t=()=>{Pe.value&&R.value&&Me(R.value.id,A.value-1)},ht=()=>{Ue.value&&R.value&&Me(R.value.id,A.value+1)};return je(async()=>{await Promise.all([te(),w(),W()])}),(a,o)=>(c(),v("div",Ca,[l("div",La,[l("div",$a,[l("div",Sa,[l("div",Ia,[s(e(es),{class:"h-5 w-5"})]),l("div",Na,[l("div",Da,[l("h1",Ea,d(h.value?.name||"..."),1),h.value?.status?(c(),S(e(ae),{key:0,variant:"outline",class:"shrink-0"},{default:n(()=>[_(d(h.value.status),1)]),_:1})):$("",!0),h.value?.reindex_required?(c(),S(e(ae),{key:1,variant:"destructive",class:"shrink-0"},{default:n(()=>[s(e(ts),{class:"mr-1 h-3 w-3"}),o[5]||(o[5]=_(" Reindex needed ",-1))]),_:1})):$("",!0)]),l("div",Ma,[l("span",Ba,[s(e(vs),{class:"h-3 w-3"}),_(" "+d(h.value?.embedding_model_name||"No model"),1)]),l("span",za,[s(e(_s),{class:"h-3 w-3"}),_(" "+d(h.value?.chunk_size||0)+" / "+d(h.value?.chunk_overlap||0),1)]),l("span",ba,[s(e(gs),{class:"h-3 w-3"}),_(" "+d(t.value)+" docs ",1)])])])]),l("div",Fa,[T.value.length>0?(c(),S(e(M),{key:0,variant:"outline",size:"sm",class:"relative",onClick:o[0]||(o[0]=m=>k.value=!0)},{default:n(()=>[ue.value?(c(),S(e(we),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):(c(),S(e(Ge),{key:1,class:"mr-2 h-4 w-4"})),_(" "+d(T.value.length)+" Jobs ",1),ue.value?(c(),v("span",Pa,[...o[6]||(o[6]=[l("span",{class:"bg-primary absolute inline-flex h-full w-full animate-ping rounded-full opacity-75"},null,-1),l("span",{class:"bg-primary relative inline-flex h-3 w-3 rounded-full"},null,-1)])])):$("",!0)]),_:1})):$("",!0),s(e(M),{variant:"outline",size:"sm",onClick:o[1]||(o[1]=m=>e(z).push(`/admin/kbs/${e(F)}/profiles`))},{default:n(()=>[s(e(hs),{class:"mr-2 h-4 w-4"}),o[7]||(o[7]=_(" Profiles ",-1))]),_:1}),h.value?.reindex_required?(c(),S(e(M),{key:1,size:"sm",variant:"destructive",onClick:Ee,disabled:se.value},{default:n(()=>[s(e(be),{class:ye(["mr-2 h-4 w-4",{"animate-spin":se.value}])},null,8,["class"]),o[8]||(o[8]=_(" Reindex ",-1))]),_:1},8,["disabled"])):$("",!0),s(e(M),{size:"sm",onClick:o[2]||(o[2]=m=>k.value=!0)},{default:n(()=>[s(e(ze),{class:"mr-2 h-4 w-4"}),o[9]||(o[9]=_(" Upload ",-1))]),_:1})])]),s(e(Ht),{open:K.value,"onUpdate:open":o[3]||(o[3]=m=>K.value=m),class:"mt-2"},{default:n(()=>[s(e(Xt),{asChild:""},{default:n(()=>[s(e(M),{variant:"ghost",size:"sm",class:"text-muted-foreground h-6 px-2 text-xs"},{default:n(()=>[(c(),S(Te(K.value?e(Zt):e(ss)),{class:"mr-1 h-3 w-3"})),_(" "+d(K.value?"Hide details":"Show details"),1)]),_:1})]),_:1}),s(e(Jt),null,{default:n(()=>[l("div",Ua,[l("div",Aa,[l("div",null,[o[10]||(o[10]=l("span",{class:"text-muted-foreground text-xs"},"Description",-1)),l("p",Ta,d(h.value?.description||"No description"),1)]),l("div",null,[o[11]||(o[11]=l("span",{class:"text-muted-foreground text-xs"},"Embedding Model",-1)),l("p",Va,d(h.value?.embedding_model_name||"Not configured"),1)]),l("div",null,[o[12]||(o[12]=l("span",{class:"text-muted-foreground text-xs"},"Chunk Settings",-1)),l("p",qa," Size: "+d(h.value?.chunk_size)+", Overlap: "+d(h.value?.chunk_overlap),1)]),l("div",null,[o[13]||(o[13]=l("span",{class:"text-muted-foreground text-xs"},"Last Updated",-1)),l("p",Ra,d(h.value?.updated_at?new Date(h.value.updated_at).toLocaleString():"—"),1)])])])]),_:1})]),_:1},8,["open"])]),l("div",Oa,[(c(),S(Wt,{key:O.value,data:pe.value,columns:I,"total-count":t.value,loading:P.value,selectable:!0,"can-create":!1,"show-filters":!0,"bulk-actions":b,"row-actions":u,"empty-message":e(g)("admin.pages.knowledgeBases.detail.noDocuments"),onRefresh:pt,onSearch:dt,onFilter:ct,onSort:ut,onPaginate:mt,onRowAction:ot,onBulkAction:rt},null,8,["data","total-count","loading","empty-message"]))]),s(e(Mt),{open:k.value,"onUpdate:open":lt},{default:n(()=>[s(e(It),{class:"flex w-full flex-col sm:max-w-lg"},{default:n(()=>[s(e(Nt),null,{default:n(()=>[s(e(Dt),null,{default:n(()=>[...o[14]||(o[14]=[_("Upload Documents",-1)])]),_:1}),s(e(Et),null,{default:n(()=>[_(" Add documents to "+d(h.value?.name),1)]),_:1})]),_:1}),l("div",Ga,[s(ka,{"default-knowledge-base-id":e(F),onUploadComplete:at},null,8,["default-knowledge-base-id"]),T.value.length>0?(c(),v("div",Ka,[l("div",Ja,[o[15]||(o[15]=l("h4",{class:"text-sm font-medium"},"Recent Jobs",-1)),s(e(M),{variant:"ghost",size:"sm",onClick:W,disabled:ee.value},{default:n(()=>[s(e(be),{class:ye(["h-4 w-4",{"animate-spin":ee.value}])},null,8,["class"])]),_:1},8,["disabled"])]),l("div",Ha,[(c(!0),v(le,null,ne(T.value,m=>(c(),v("div",{key:m.id,class:"bg-muted/30 rounded-lg border p-3"},[l("div",Xa,[(c(),S(Te(Ne(m.status)),{class:ye(["h-4 w-4 shrink-0",[De(m.status),{"animate-spin":m.status==="RUNNING"}]])},null,8,["class"])),l("span",Qa,d(m.original_filename),1),s(e(ae),{variant:"outline",class:"shrink-0 text-xs"},{default:n(()=>[_(d(m.status.toLowerCase()),1)]),_:2},1024)]),m.status==="RUNNING"?(c(),v("div",Wa,[l("div",Ya,[l("span",null,d(Ie(m.stage)),1),l("span",null,d(m.progress)+"%",1)]),s(e(st),{"model-value":m.progress,class:"h-1.5"},null,8,["model-value"])])):$("",!0),m.error_message?(c(),v("div",Za,d(m.error_message),1)):$("",!0),m.status==="SUCCEEDED"?(c(),v("div",ja," Completed "+d(new Date(m.updated_at).toLocaleString()),1)):$("",!0)]))),128))])])):$("",!0)])]),_:1})]),_:1},8,["open"]),s(e(Kt),{open:G.value,"onUpdate:open":ft},{default:n(()=>[s(e(At),null,{default:n(()=>[s(e(Tt),null,{default:n(()=>[s(e(Vt),null,{default:n(()=>[_(d(e(g)("admin.pages.knowledgeBases.detail.deleteConfirm.title")),1)]),_:1}),s(e(qt),null,{default:n(()=>[_(d(e(g)("admin.pages.knowledgeBases.detail.deleteConfirm.description",{title:q.value?.title})),1)]),_:1})]),_:1}),s(e(Rt),null,{default:n(()=>[s(e(Ot),null,{default:n(()=>[_(d(e(g)("common.cancel")),1)]),_:1}),s(e(Gt),{class:"bg-destructive hover:bg-destructive/90",disabled:X.value,onClick:it},{default:n(()=>[_(d(X.value?e(g)("common.deleting"):e(g)("common.confirmDelete")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["open"]),s(e(Pt),{open:U.value,"onUpdate:open":o[4]||(o[4]=m=>{m||gt()})},{default:n(()=>[s(e(Bt),{class:"max-h-[80vh] max-w-4xl grid-rows-[auto_minmax(0,1fr)_auto] p-0"},{default:n(()=>[s(e(zt),{class:"p-6 pb-0"},{default:n(()=>[s(e(bt),null,{default:n(()=>[_(d(e(g)("admin.pages.knowledgeBases.detail.chunks.title")),1)]),_:1}),s(e(Ft),null,{default:n(()=>[_(d(e(g)("admin.pages.knowledgeBases.detail.chunks.description",{title:R.value?.title,count:Q.value})),1)]),_:1})]),_:1}),l("div",el,[B.value?(c(),v("div",tl,[s(e(we),{class:"text-muted-foreground h-6 w-6 animate-spin"})])):j.value.length===0?(c(),v("div",sl,[l("div",al,d(e(g)("admin.pages.knowledgeBases.detail.chunks.empty")),1)])):(c(),v("div",ll,[(c(!0),v(le,null,ne(j.value,(m,L)=>(c(),v("div",{key:m.id||L,class:"bg-muted/30 rounded-lg border p-4"},[l("div",nl,[l("span",ol,"Chunk "+d((A.value-1)*oe.value+L+1),1),l("span",rl,d(m.content?.length||0)+" chars ",1)]),l("p",il,d(m.content),1)]))),128))]))]),s(e(Ut),{class:"border-t p-4"},{default:n(()=>[l("div",dl,[l("div",cl," Page "+d(A.value)+" of "+d(Fe.value)+" ("+d(Q.value)+" chunks) ",1),l("div",ul,[s(e(M),{variant:"outline",size:"sm",disabled:!Pe.value||B.value,onClick:_t},{default:n(()=>[s(e(as),{class:"h-4 w-4"})]),_:1},8,["disabled"]),s(e(M),{variant:"outline",size:"sm",disabled:!Ue.value||B.value,onClick:ht},{default:n(()=>[s(e(ls),{class:"h-4 w-4"})]),_:1},8,["disabled"])])])]),_:1})]),_:1})]),_:1},8,["open"])]))}});export{jl as default};
