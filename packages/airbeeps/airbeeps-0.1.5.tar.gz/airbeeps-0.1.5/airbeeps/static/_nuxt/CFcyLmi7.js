import{h as oe,e as ue,D as me,f as _e,k as x,E as V,m as pe,c as k,o as v,v as D,I as g,b as t,g as e,w as i,d as n,t as o,a as u,L as F,J as fe,K as ce}from"./BzhixHsn.js";import{_ as K,a as L}from"./CRjpF7qy.js";import{_ as P}from"./Co_Pqrtl.js";import{_ as R,a as B}from"./DfqdNhl2.js";import{_ as f}from"./Di109XjC.js";import{_ as p}from"./4isL45Eu.js";import{_ as U}from"./_XME2JEy.js";import{_ as ve}from"./Le8goM6p.js";import{_ as ye,a as be,b as ge}from"./4TAfYWvs.js";import{_ as I,a as J,d as j,b as Q,c as N}from"./Bi0Cqvs9.js";import{u as ke}from"./D01W4VS-.js";import{u as Y}from"./G5O1m7ek.js";import{L as H}from"./B9I6JWJy.js";import"./vJ3Jskde.js";import"./BkS3akZz.js";import"./DKMWZZOl.js";import"./C56gk0qC.js";import"./Bp3-KBkO.js";import"./BmCC6msl.js";import"./BmLyE0U0.js";import"./CMS48I6h.js";const he={class:"space-y-6"},xe={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ve={class:"space-y-2"},De={class:"space-y-2"},Ne={class:"space-y-2"},qe={class:"text-muted-foreground text-xs"},$e={class:"flex gap-2"},Ue={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},we={class:"space-y-2"},Ce={class:"space-y-2"},Me={class:"space-y-2"},Ae={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},Se={class:"space-y-2"},Oe={class:"space-y-2"},Te={class:"space-y-2"},Ee={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ge={class:"space-y-2 rounded-md border p-3"},Fe={class:"flex items-center space-x-2"},Ke={key:0,class:"mt-3 space-y-2"},Le={class:"space-y-2 rounded-md border p-3"},Pe={class:"flex items-center space-x-2"},Re={key:0,class:"mt-3 space-y-2"},Be={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ie={class:"space-y-2 rounded-md border p-3"},Je={class:"text-sm font-medium"},je={class:"mt-2 grid grid-cols-1 gap-3 md:grid-cols-2"},Qe={class:"space-y-2"},Ye={class:"space-y-2"},He={class:"space-y-2 rounded-md border p-3"},ze={class:"flex items-center space-x-2"},We={key:0,class:"mt-3 space-y-2"},Xe={class:"flex gap-2"},z="assistant_generation_defaults",W="assistant_rag_defaults",xa=oe({__name:"assistant-defaults",async setup(Ze){let h,w;const{t:d}=ue(),{showError:C,showSuccess:M}=ke(),{$api:X}=me(),q=()=>({temperature:.7,max_tokens:2048,additional_params_text:"{}"}),b=()=>({retrieval_count:5,fetch_k:"",similarity_threshold:.7,context_max_tokens:1200,search_type:"similarity",mmr_lambda:.5,skip_smalltalk:!1,skip_patterns_text:"",multi_query:!1,multi_query_count:3,rerank_top_k:"",rerank_model_id:"__none__",hybrid_enabled:!1,hybrid_corpus_limit:1e3}),{data:Z,pending:m,error:A,refresh:S}=([h,w]=_e(()=>Y("/v1/admin/config",{server:!1})),h=await h,w(),h),$=x(()=>Z.value?.configs??[]),O=x(()=>$.value.find(r=>r.key===z)),T=x(()=>$.value.find(r=>r.key===W)),{data:ee}=Y("/v1/admin/all-models?capabilities=reranker",{server:!1}),ae=x(()=>(ee.value??[]).map(r=>({label:r.display_name||r.name||r.id,value:r.id}))),c=V(q()),l=V(b());pe($,()=>{const r=O.value?.value;c.value={temperature:typeof r?.temperature=="number"?r.temperature:q().temperature,max_tokens:typeof r?.max_tokens=="number"?r.max_tokens:q().max_tokens,additional_params_text:JSON.stringify(r?.additional_params??{},null,2)};const a=T.value?.value;l.value={retrieval_count:typeof a?.retrieval_count=="number"?a.retrieval_count:b().retrieval_count,fetch_k:a?.fetch_k??"",similarity_threshold:typeof a?.similarity_threshold=="number"?a.similarity_threshold:b().similarity_threshold,context_max_tokens:typeof a?.context_max_tokens=="number"?a.context_max_tokens:b().context_max_tokens,search_type:typeof a?.search_type=="string"?a.search_type:"similarity",mmr_lambda:typeof a?.mmr_lambda=="number"?a.mmr_lambda:.5,skip_smalltalk:!!a?.skip_smalltalk,skip_patterns_text:Array.isArray(a?.skip_patterns)?a.skip_patterns.join(", "):"",multi_query:!!a?.multi_query,multi_query_count:typeof a?.multi_query_count=="number"?a.multi_query_count:b().multi_query_count,rerank_top_k:a?.rerank_top_k??"",rerank_model_id:a?.rerank_model_id?String(a.rerank_model_id):"__none__",hybrid_enabled:!!a?.hybrid_enabled,hybrid_corpus_limit:typeof a?.hybrid_corpus_limit=="number"?a.hybrid_corpus_limit:b().hybrid_corpus_limit}},{immediate:!0});const y=V(!1),_=V(!1),te=r=>{const a=(r||"").trim();if(!a)return{};const s=JSON.parse(a);if(s===null||typeof s!="object"||Array.isArray(s))throw new Error("JSON must be an object");return s},E=r=>{if(r==null)return null;const a=String(r).trim();if(!a)return null;const s=Number(a);return Number.isFinite(s)?Math.trunc(s):null},se=r=>{if(r==null)return null;const a=String(r).trim();if(!a)return null;const s=Number(a);return Number.isFinite(s)?s:null},G=async(r,a,s,re)=>{const de=a?{value:s,is_enabled:!0}:{key:r,value:s,description:re,is_public:!1,is_enabled:!0},ne=a?`/v1/admin/config/${r}`:"/v1/admin/config";await X(ne,{method:a?"PUT":"POST",body:de})},le=async()=>{y.value=!0;try{const r=te(c.value.additional_params_text),a={temperature:Number(c.value.temperature),max_tokens:Number(c.value.max_tokens),additional_params:r};await G(z,O.value,a,"Global defaults for assistant generation settings"),await S(),M(d("admin.assistantDefaults.messages.saved"))}catch(r){C(r?.message||d("admin.assistantDefaults.messages.saveFailed"))}finally{y.value=!1}},ie=async()=>{_.value=!0;try{const r=(l.value.skip_patterns_text||"").split(",").map(s=>s.trim()).filter(Boolean),a={retrieval_count:Number(l.value.retrieval_count),fetch_k:E(l.value.fetch_k),similarity_threshold:se(l.value.similarity_threshold),context_max_tokens:Number(l.value.context_max_tokens),search_type:l.value.search_type,mmr_lambda:Number(l.value.mmr_lambda),skip_smalltalk:!!l.value.skip_smalltalk,skip_patterns:r,multi_query:!!l.value.multi_query,multi_query_count:Number(l.value.multi_query_count),rerank_top_k:E(l.value.rerank_top_k),rerank_model_id:l.value.rerank_model_id&&l.value.rerank_model_id!=="__none__"?l.value.rerank_model_id:null,hybrid_enabled:!!l.value.hybrid_enabled,hybrid_corpus_limit:Number(l.value.hybrid_corpus_limit)};await G(W,T.value,a,"Global defaults for assistant RAG retrieval settings"),await S(),M(d("admin.assistantDefaults.messages.saved"))}catch(r){C(r?.message||d("admin.assistantDefaults.messages.saveFailed"))}finally{_.value=!1}};return(r,a)=>(v(),k("div",he,[e(A)?(v(),D(e(ge),{key:0,variant:"destructive"},{default:i(()=>[t(e(ye),null,{default:i(()=>[n(o(e(d)("common.error")),1)]),_:1}),t(e(be),null,{default:i(()=>[n(o(e(A)?.message||e(d)("admin.assistantDefaults.messages.loadFailed")),1)]),_:1})]),_:1})):g("",!0),t(e(L),null,{default:i(()=>[t(e(R),null,{default:i(()=>[t(e(B),null,{default:i(()=>[n(o(e(d)("admin.assistantDefaults.generation.title")),1)]),_:1}),t(e(P),null,{default:i(()=>[n(o(e(d)("admin.assistantDefaults.generation.description")),1)]),_:1})]),_:1}),t(e(K),{class:"space-y-4"},{default:i(()=>[u("div",xe,[u("div",Ve,[t(e(p),{for:"gen-temperature"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.generation.temperature")),1)]),_:1}),t(e(f),{id:"gen-temperature",type:"number",modelValue:c.value.temperature,"onUpdate:modelValue":a[0]||(a[0]=s=>c.value.temperature=s),modelModifiers:{number:!0},min:"0",max:"2",step:"0.1",disabled:e(m)||y.value},null,8,["modelValue","disabled"])]),u("div",De,[t(e(p),{for:"gen-max-tokens"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.generation.maxTokens")),1)]),_:1}),t(e(f),{id:"gen-max-tokens",type:"number",modelValue:c.value.max_tokens,"onUpdate:modelValue":a[1]||(a[1]=s=>c.value.max_tokens=s),modelModifiers:{number:!0},min:"1",max:"100000",disabled:e(m)||y.value},null,8,["modelValue","disabled"])])]),u("div",Ne,[t(e(p),{for:"gen-additional"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.generation.additionalParams")),1)]),_:1}),t(e(ve),{id:"gen-additional",modelValue:c.value.additional_params_text,"onUpdate:modelValue":a[2]||(a[2]=s=>c.value.additional_params_text=s),rows:8,disabled:e(m)||y.value,class:"font-mono text-xs"},null,8,["modelValue","disabled"]),u("p",qe,o(e(d)("admin.assistantDefaults.generation.additionalParamsHelp")),1)]),u("div",$e,[t(e(F),{onClick:le,disabled:e(m)||y.value},{default:i(()=>[y.value?(v(),D(e(H),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):g("",!0),n(" "+o(e(d)("common.save")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1}),t(e(L),null,{default:i(()=>[t(e(R),null,{default:i(()=>[t(e(B),null,{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.title")),1)]),_:1}),t(e(P),null,{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.description")),1)]),_:1})]),_:1}),t(e(K),{class:"space-y-4"},{default:i(()=>[u("div",Ue,[u("div",we,[t(e(p),{for:"rag-k"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.retrievalCount")),1)]),_:1}),t(e(f),{id:"rag-k",type:"number",modelValue:l.value.retrieval_count,"onUpdate:modelValue":a[3]||(a[3]=s=>l.value.retrieval_count=s),modelModifiers:{number:!0},min:"1",max:"50",disabled:e(m)||_.value},null,8,["modelValue","disabled"])]),u("div",Ce,[t(e(p),{for:"rag-fetch-k"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.fetchK")),1)]),_:1}),t(e(f),{id:"rag-fetch-k",type:"number","model-value":l.value.fetch_k,placeholder:"Auto (3x K)",disabled:e(m)||_.value,"onUpdate:modelValue":a[4]||(a[4]=s=>l.value.fetch_k=s)},null,8,["model-value","disabled"])]),u("div",Me,[t(e(p),{for:"rag-threshold"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.similarityThreshold")),1)]),_:1}),t(e(f),{id:"rag-threshold",type:"number",modelValue:l.value.similarity_threshold,"onUpdate:modelValue":a[5]||(a[5]=s=>l.value.similarity_threshold=s),modelModifiers:{number:!0},min:"0",max:"1",step:"0.01",disabled:e(m)||_.value},null,8,["modelValue","disabled"])])]),u("div",Ae,[u("div",Se,[t(e(p),{for:"rag-context-max"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.contextMaxTokens")),1)]),_:1}),t(e(f),{id:"rag-context-max",type:"number",modelValue:l.value.context_max_tokens,"onUpdate:modelValue":a[6]||(a[6]=s=>l.value.context_max_tokens=s),modelModifiers:{number:!0},min:"200",max:"6000",disabled:e(m)||_.value},null,8,["modelValue","disabled"])]),u("div",Oe,[t(e(p),{for:"rag-search-type"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.searchType")),1)]),_:1}),t(e(I),{modelValue:l.value.search_type,"onUpdate:modelValue":a[7]||(a[7]=s=>l.value.search_type=s),disabled:e(m)||_.value},{default:i(()=>[t(e(J),null,{default:i(()=>[t(e(j),{placeholder:"similarity"})]),_:1}),t(e(Q),null,{default:i(()=>[t(e(N),{value:"similarity"},{default:i(()=>[...a[17]||(a[17]=[n("similarity",-1)])]),_:1}),t(e(N),{value:"mmr"},{default:i(()=>[...a[18]||(a[18]=[n("mmr",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])]),u("div",Te,[t(e(p),{for:"rag-mmr-lambda"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.mmrLambda")),1)]),_:1}),t(e(f),{id:"rag-mmr-lambda",type:"number",modelValue:l.value.mmr_lambda,"onUpdate:modelValue":a[8]||(a[8]=s=>l.value.mmr_lambda=s),modelModifiers:{number:!0},min:"0",max:"1",step:"0.05",disabled:e(m)||_.value},null,8,["modelValue","disabled"])])]),u("div",Ee,[u("div",Ge,[u("div",Fe,[t(e(U),{id:"rag-skip-smalltalk","model-value":l.value.skip_smalltalk,"onUpdate:modelValue":a[9]||(a[9]=s=>l.value.skip_smalltalk=s),disabled:e(m)||_.value},null,8,["model-value","disabled"]),t(e(p),{for:"rag-skip-smalltalk"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.skipSmalltalk")),1)]),_:1})]),l.value.skip_smalltalk?(v(),k("div",Ke,[t(e(p),{for:"rag-skip-patterns"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.skipPatterns")),1)]),_:1}),t(e(f),{id:"rag-skip-patterns",modelValue:l.value.skip_patterns_text,"onUpdate:modelValue":a[10]||(a[10]=s=>l.value.skip_patterns_text=s),placeholder:"hi, hello, thanks",disabled:e(m)||_.value},null,8,["modelValue","disabled"])])):g("",!0)]),u("div",Le,[u("div",Pe,[t(e(U),{id:"rag-multi-query","model-value":l.value.multi_query,"onUpdate:modelValue":a[11]||(a[11]=s=>l.value.multi_query=s),disabled:e(m)||_.value},null,8,["model-value","disabled"]),t(e(p),{for:"rag-multi-query"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.multiQuery")),1)]),_:1})]),l.value.multi_query?(v(),k("div",Re,[t(e(p),{for:"rag-multi-query-count"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.multiQueryCount")),1)]),_:1}),t(e(f),{id:"rag-multi-query-count",type:"number",modelValue:l.value.multi_query_count,"onUpdate:modelValue":a[12]||(a[12]=s=>l.value.multi_query_count=s),modelModifiers:{number:!0},min:"1",max:"5",disabled:e(m)||_.value},null,8,["modelValue","disabled"])])):g("",!0)])]),u("div",Be,[u("div",Ie,[u("div",Je,o(e(d)("admin.assistantDefaults.rag.rerankTitle")),1),u("div",je,[u("div",Qe,[t(e(p),{for:"rag-rerank-top-k"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.rerankTopK")),1)]),_:1}),t(e(f),{id:"rag-rerank-top-k",type:"number","model-value":l.value.rerank_top_k,placeholder:"Optional",disabled:e(m)||_.value,"onUpdate:modelValue":a[13]||(a[13]=s=>l.value.rerank_top_k=s)},null,8,["model-value","disabled"])]),u("div",Ye,[t(e(p),{for:"rag-rerank-model"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.rerankModel")),1)]),_:1}),t(e(I),{modelValue:l.value.rerank_model_id,"onUpdate:modelValue":a[14]||(a[14]=s=>l.value.rerank_model_id=s),disabled:e(m)||_.value},{default:i(()=>[t(e(J),null,{default:i(()=>[t(e(j),{placeholder:e(d)("admin.notSet")},null,8,["placeholder"])]),_:1}),t(e(Q),null,{default:i(()=>[t(e(N),{value:"__none__"},{default:i(()=>[...a[19]||(a[19]=[n("None",-1)])]),_:1}),(v(!0),k(fe,null,ce(ae.value,s=>(v(),D(e(N),{key:s.value,value:s.value},{default:i(()=>[n(o(s.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])])])]),u("div",He,[u("div",ze,[t(e(U),{id:"rag-hybrid","model-value":l.value.hybrid_enabled,"onUpdate:modelValue":a[15]||(a[15]=s=>l.value.hybrid_enabled=s),disabled:e(m)||_.value},null,8,["model-value","disabled"]),t(e(p),{for:"rag-hybrid"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.hybridEnabled")),1)]),_:1})]),l.value.hybrid_enabled?(v(),k("div",We,[t(e(p),{for:"rag-hybrid-limit"},{default:i(()=>[n(o(e(d)("admin.assistantDefaults.rag.hybridCorpusLimit")),1)]),_:1}),t(e(f),{id:"rag-hybrid-limit",type:"number",modelValue:l.value.hybrid_corpus_limit,"onUpdate:modelValue":a[16]||(a[16]=s=>l.value.hybrid_corpus_limit=s),modelModifiers:{number:!0},min:"100",max:"5000",disabled:e(m)||_.value},null,8,["modelValue","disabled"])])):g("",!0)])]),u("div",Xe,[t(e(F),{onClick:ie,disabled:e(m)||_.value},{default:i(()=>[_.value?(v(),D(e(H),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):g("",!0),n(" "+o(e(d)("common.save")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1})]))}});export{xa as default};
