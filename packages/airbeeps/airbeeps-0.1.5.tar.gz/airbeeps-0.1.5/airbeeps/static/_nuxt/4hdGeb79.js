import{_ as os}from"./hcYt5xb6.js";import{_ as ls,a as is,b as ns,c as us,d as ds}from"./DC3gMtZB.js";import{h as rs,e as ms,u as _s,a9 as cs,F as ps,G as fs,k as vs,E as v,H as B,c as p,o as c,b as e,a as l,w as o,d as r,t as i,g as s,J as k,M as bs,I as h,y as g,K as S,v as I,$ as ys,aa as hs,L as N,a3 as xs,D,Q as w}from"./BzhixHsn.js";import{_ as Fs}from"./DB-9e68Q.js";import{_ as gs}from"./pRipWecN.js";import{_ as ws}from"./2RVX2kid.js";import{_ as H,a as T}from"./CRjpF7qy.js";import{_ as Vs}from"./Co_Pqrtl.js";import{_ as $s,a as ks}from"./DfqdNhl2.js";import{_ as L}from"./Di109XjC.js";import{_ as f}from"./4isL45Eu.js";import{_ as Cs}from"./_XME2JEy.js";import{_ as j}from"./Le8goM6p.js";import{_ as C,a as M,d as q,b as A,c as x}from"./Bi0Cqvs9.js";import{u as Ms}from"./G5O1m7ek.js";import{S as qs}from"./CHh9YBUH.js";import"./DhvzP0AS.js";import"./Dosvfmhb.js";import"./CCA1r4XF.js";import"./lcKie01k.js";import"./qyVZgQpg.js";import"./C9XbPd6k.js";import"./CeWx-USI.js";import"./B9I6JWJy.js";import"./COjiOs1v.js";import"./Bp3-KBkO.js";import"./DKMWZZOl.js";import"./XCOtPLqC.js";import"./BSaEE8c4.js";import"./DdeO54y7.js";import"./DQj8dpKz.js";import"./C-9Ampo3.js";import"./C-xhCs27.js";import"./vJ3Jskde.js";import"./BkS3akZz.js";import"./C56gk0qC.js";import"./BmCC6msl.js";import"./BmLyE0U0.js";import"./CMS48I6h.js";const As={class:"absolute inset-0 flex flex-col overflow-hidden rounded-[inherit]"},Us={class:"flex-1 overflow-y-auto"},Ps={class:"container mx-auto max-w-4xl space-y-6 py-6"},Es={key:0,class:"flex justify-center py-12"},Bs={class:"space-y-4"},Ss={class:"space-y-2"},Is={class:"text-muted-foreground text-sm"},Ns={class:"space-y-2"},Ds={key:0,class:"text-destructive text-sm"},Hs={class:"space-y-2"},Ts={key:0,class:"text-destructive text-sm"},Ls={class:"space-y-4"},js={class:"text-lg font-medium"},Gs={class:"space-y-2"},Rs={key:0,class:"text-destructive text-sm"},Os={class:"text-muted-foreground text-sm"},Qs={class:"space-y-2"},zs={key:0,class:"text-destructive text-sm"},Js={class:"text-muted-foreground text-sm"},Ks={class:"space-y-2"},Xs={class:"text-muted-foreground text-sm"},Ws={class:"space-y-4"},Ys={class:"text-lg font-medium"},Zs={class:"bg-muted/30 space-y-3 rounded-md border p-4"},se={key:0,class:"text-muted-foreground text-sm"},ee={class:"flex items-center justify-between gap-3"},te={class:"text-sm font-semibold"},ae={class:"space-y-2"},oe={class:"text-muted-foreground text-sm"},le={class:"space-y-4"},ie={class:"text-lg font-medium"},ne={class:"flex items-center space-x-2"},ue=["disabled"],de={class:"space-y-2"},re={class:"flex justify-end gap-3"},Ye=rs({__name:"edit",setup(me){const{t:a}=ms();_s({title:a("assistantForm.editTitle")});const V=cs(),U=ps().params.id,G=fs(),{data:R}=Ms("/v1/models",{server:!1}),O=vs(()=>(R.value??[]).filter(d=>d.status==="ACTIVE").map(d=>({label:d.display_name,value:d.id}))),m=v(!1),$=v(!0),u=v({name:"",avatar_file_path:"",description:"",system_prompt:"",model_id:"",max_history_messages:10,is_public:!1,status:"ACTIVE",followup_questions_enabled:!0,followup_questions_count:null}),F=v(!1),b=v(3),y=v("__global__");B(async()=>{const d=await G.getConfig();F.value=d.ui_generate_followup_questions!==!1;const t=Number(d.ui_followup_question_count??3);b.value=Number.isFinite(t)?Math.max(1,Math.min(5,Math.trunc(t))):3});const Q=async()=>{$.value=!0;try{const{$api:d}=D(),t=await d(`/v1/assistants/${U}`);u.value={...t,max_history_messages:Number(t.max_history_messages)},u.value.followup_questions_enabled=t.followup_questions_enabled??!0,y.value=typeof t.followup_questions_count=="number"?String(Math.max(1,Math.min(b.value,Math.trunc(t.followup_questions_count)))):"__global__"}catch(d){console.error("Failed to fetch assistant details:",d),w.error(a("assistantForm.fetchFailed")),V.push("/assistants")}finally{$.value=!1}};B(()=>{Q()});const _=v({}),z=()=>{const d={};return(!u.value.name||u.value.name.length<2)&&(d.name=a("assistantForm.nameError")),(!u.value.system_prompt||u.value.system_prompt.length<10)&&(d.system_prompt=a("assistantForm.systemPromptError")),u.value.model_id||(d.model_id=a("assistantForm.modelError")),_.value=d,Object.keys(d).length===0},P=async()=>{if(!z()){w.error(a("assistantForm.validationError"));return}m.value=!0;try{const{$api:d}=D(),t={...u.value};t.followup_questions_enabled===!1?t.followup_questions_count=null:t.followup_questions_count=y.value==="__global__"?null:Math.min(b.value,Math.max(1,Number(y.value))),await d(`/v1/assistants/${U}`,{method:"PUT",body:t}),w.success(a("assistantForm.updateSuccess")),V.push("/assistants")}catch(d){console.error("Update failed:",d),w.error(a("assistantForm.updateFailed"))}finally{m.value=!1}},J=()=>{V.push("/assistants")};return(d,t)=>{const K=os,X=Fs,E=ns,W=us,Y=ds,Z=is,ss=ls,es=gs,ts=ws;return c(),p("div",As,[e(es,null,{default:o(()=>[e(ss,null,{default:o(()=>[e(Z,null,{default:o(()=>[e(E,null,{default:o(()=>[e(X,{"as-child":""},{default:o(()=>[e(K,{to:"/assistants"},{default:o(()=>[r(i(s(a)("chat.breadcrumbAssistants")),1)]),_:1})]),_:1})]),_:1}),e(W),e(E,null,{default:o(()=>[e(Y,null,{default:o(()=>[r(i(s(a)("assistantForm.editTitle")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l("div",Us,[l("div",Ps,[$.value?(c(),p("div",Es,[...t[10]||(t[10]=[l("div",{class:"border-primary h-8 w-8 animate-spin rounded-full border-b-2"},null,-1)])])):(c(),p(k,{key:1},[e(s(T),null,{default:o(()=>[e(s($s),null,{default:o(()=>[e(s(ks),null,{default:o(()=>[r(i(s(a)("assistantForm.basicInfo")),1)]),_:1}),e(s(Vs),null,{default:o(()=>[r(i(s(a)("assistantForm.basicInfoDesc")),1)]),_:1})]),_:1}),e(s(H),null,{default:o(()=>[l("form",{onSubmit:bs(P,["prevent"]),class:"space-y-6"},[l("div",Bs,[l("div",Ss,[e(s(f),{for:"avatar"},{default:o(()=>[r(i(s(a)("assistantForm.avatar")),1)]),_:1}),e(ts,{id:"avatar",modelValue:u.value.avatar_file_path,"onUpdate:modelValue":t[0]||(t[0]=n=>u.value.avatar_file_path=n),disabled:m.value},null,8,["modelValue","disabled"]),l("div",Is,i(s(a)("assistantForm.avatarHelp")),1)]),l("div",Ns,[e(s(f),{for:"name"},{default:o(()=>[r(i(s(a)("assistantForm.name"))+" ",1),t[11]||(t[11]=l("span",{class:"text-destructive"},"*",-1))]),_:1}),e(s(L),{id:"name",modelValue:u.value.name,"onUpdate:modelValue":t[1]||(t[1]=n=>u.value.name=n),placeholder:s(a)("assistantForm.namePlaceholder"),class:g({"border-destructive":_.value.name}),disabled:m.value},null,8,["modelValue","placeholder","class","disabled"]),_.value.name?(c(),p("div",Ds,i(_.value.name),1)):h("",!0)]),l("div",Hs,[e(s(f),{for:"description"},{default:o(()=>[r(i(s(a)("assistantForm.description")),1)]),_:1}),e(s(j),{id:"description",modelValue:u.value.description,"onUpdate:modelValue":t[2]||(t[2]=n=>u.value.description=n),placeholder:s(a)("assistantForm.descriptionPlaceholder"),rows:3,class:g({"border-destructive":_.value.description}),disabled:m.value},null,8,["modelValue","placeholder","class","disabled"]),_.value.description?(c(),p("div",Ts,i(_.value.description),1)):h("",!0)])]),l("div",Ls,[l("h3",js,i(s(a)("assistantForm.modelConfig")),1),l("div",Gs,[e(s(f),{for:"system_prompt"},{default:o(()=>[r(i(s(a)("assistantForm.systemPrompt"))+" ",1),t[12]||(t[12]=l("span",{class:"text-destructive"},"*",-1))]),_:1}),e(s(j),{id:"system_prompt",modelValue:u.value.system_prompt,"onUpdate:modelValue":t[3]||(t[3]=n=>u.value.system_prompt=n),placeholder:s(a)("assistantForm.systemPromptPlaceholder"),rows:5,class:g({"border-destructive":_.value.system_prompt}),disabled:m.value},null,8,["modelValue","placeholder","class","disabled"]),_.value.system_prompt?(c(),p("div",Rs,i(_.value.system_prompt),1)):h("",!0),l("div",Os,i(s(a)("assistantForm.systemPromptHelp")),1)]),l("div",Qs,[e(s(f),{for:"model_id"},{default:o(()=>[r(i(s(a)("assistantForm.model"))+" ",1),t[13]||(t[13]=l("span",{class:"text-destructive"},"*",-1))]),_:1}),e(s(C),{modelValue:u.value.model_id,"onUpdate:modelValue":t[4]||(t[4]=n=>u.value.model_id=n),disabled:m.value},{default:o(()=>[e(s(M),{class:g({"border-destructive":_.value.model_id})},{default:o(()=>[e(s(q),{placeholder:s(a)("assistantForm.modelPlaceholder")},null,8,["placeholder"])]),_:1},8,["class"]),e(s(A),null,{default:o(()=>[(c(!0),p(k,null,S(O.value,n=>(c(),I(s(x),{key:n.value,value:n.value},{default:o(()=>[r(i(n.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),_.value.model_id?(c(),p("div",zs,i(_.value.model_id),1)):h("",!0),l("div",Js,i(s(a)("assistantForm.modelHelp")),1)]),l("div",Ks,[e(s(f),{for:"max_history_messages"},{default:o(()=>[r(i(s(a)("assistantForm.maxHistory")),1)]),_:1}),e(s(L),{id:"max_history_messages",modelValue:u.value.max_history_messages,"onUpdate:modelValue":t[5]||(t[5]=n=>u.value.max_history_messages=n),modelModifiers:{number:!0},type:"number",placeholder:"10",min:"0",max:"100",disabled:m.value},null,8,["modelValue","disabled"]),l("div",Xs,i(s(a)("assistantForm.maxHistoryHelp")),1)])]),l("div",Ws,[l("h3",Ys,i(s(a)("assistantForm.followupsTitle")),1),l("div",Zs,[F.value?h("",!0):(c(),p("div",se,i(s(a)("assistantForm.followupsGloballyDisabled")),1)),l("div",ee,[l("div",te,i(s(a)("assistantForm.followupsEnableLabel")),1),e(s(Cs),{id:"assistant-followups-enabled","model-value":u.value.followup_questions_enabled!==!1,"onUpdate:modelValue":t[6]||(t[6]=n=>u.value.followup_questions_enabled=n),disabled:m.value||!F.value},null,8,["model-value","disabled"])]),l("div",ae,[e(s(f),{for:"assistant-followups-count"},{default:o(()=>[r(i(s(a)("assistantForm.followupsCountLabel")),1)]),_:1}),e(s(C),{modelValue:y.value,"onUpdate:modelValue":t[7]||(t[7]=n=>y.value=n),disabled:m.value||!F.value||u.value.followup_questions_enabled===!1},{default:o(()=>[e(s(M),{id:"assistant-followups-count",class:"max-w-xs"},{default:o(()=>[e(s(q))]),_:1}),e(s(A),null,{default:o(()=>[e(s(x),{value:"__global__"},{default:o(()=>[r(i(s(a)("assistantForm.followupsUseGlobal",{count:b.value})),1)]),_:1}),(c(!0),p(k,null,S(Array.from({length:b.value},(n,as)=>as+1),n=>(c(),I(s(x),{key:n,value:String(n)},{default:o(()=>[r(i(n),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),l("div",oe,i(s(a)("assistantForm.followupsMaxAllowed",{count:b.value})),1)])])]),l("div",le,[l("h3",ie,i(s(a)("assistantForm.publishSettings")),1),l("div",ne,[ys(l("input",{id:"is_public",type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=n=>u.value.is_public=n),disabled:m.value,class:"text-primary focus:ring-primary h-4 w-4 rounded border-gray-300"},null,8,ue),[[hs,u.value.is_public]]),e(s(f),{for:"is_public",class:"cursor-pointer text-sm"},{default:o(()=>[r(i(s(a)("assistantForm.isPublic")),1)]),_:1})]),l("div",de,[e(s(f),{for:"status"},{default:o(()=>[r(i(s(a)("assistantForm.status"))+" ",1),t[14]||(t[14]=l("span",{class:"text-destructive"},"*",-1))]),_:1}),e(s(C),{modelValue:u.value.status,"onUpdate:modelValue":t[9]||(t[9]=n=>u.value.status=n),disabled:m.value},{default:o(()=>[e(s(M),null,{default:o(()=>[e(s(q),{placeholder:s(a)("assistantForm.statusPlaceholder")},null,8,["placeholder"])]),_:1}),e(s(A),null,{default:o(()=>[e(s(x),{value:"ACTIVE"},{default:o(()=>[r(i(s(a)("assistantForm.statusActive")),1)]),_:1}),e(s(x),{value:"DRAFT"},{default:o(()=>[r(i(s(a)("assistantForm.statusDraft")),1)]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])])])],32)]),_:1})]),_:1}),e(s(T),null,{default:o(()=>[e(s(H),{class:"pt-6"},{default:o(()=>[l("div",re,[e(s(N),{variant:"outline",onClick:J,disabled:m.value},{default:o(()=>[e(s(xs),{class:"mr-2 h-4 w-4"}),r(" "+i(s(a)("common.cancel")),1)]),_:1},8,["disabled"]),e(s(N),{onClick:P,disabled:m.value},{default:o(()=>[e(s(qs),{class:"mr-2 h-4 w-4"}),r(" "+i(s(a)("assistantForm.saveButton")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1})],64))])])])}}});export{Ye as default};
