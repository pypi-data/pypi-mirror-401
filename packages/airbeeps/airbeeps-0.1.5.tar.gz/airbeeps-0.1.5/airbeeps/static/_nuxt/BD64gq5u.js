import{_ as G,a as W}from"./CRjpF7qy.js";import{_ as X}from"./Co_Pqrtl.js";import{_ as Y,a as Z}from"./DfqdNhl2.js";import{_ as m}from"./4isL45Eu.js";import{_ as v}from"./Di109XjC.js";import{h as ee,e as te,E as B,k as q,H as se,v as K,o as p,w as o,b as t,g as e,d,t as i,a,c as x,I as N,L as le,y as ae,J as O,K as H,D as S,Q as oe}from"./BzhixHsn.js";import{_ as ne,a as de,d as ie,b as re,c as T}from"./Bi0Cqvs9.js";import{_ as g,a as h}from"./DjusaS8W.js";import{_ as k}from"./CG_BwZdW.js";import{_ as ue}from"./D0aoH_0m.js";import{D as ce}from"./C8B8ONuC.js";import{R as me}from"./A-tu-Llp.js";import{I as y}from"./DU0NpF9R.js";const _e={class:"space-y-6"},fe={class:"space-y-3"},pe={class:"flex items-center justify-between"},ge={key:0,class:"text-muted-foreground"},he={class:"max-h-40 space-y-2 overflow-y-auto rounded-md border p-3"},ke={key:0,class:"text-muted-foreground py-4 text-center"},ye={key:1,class:"text-muted-foreground py-4 text-center"},be=["id","checked","disabled","onChange"],ve={class:"text-sm font-medium"},xe={class:"text-muted-foreground text-xs"},we={class:"bg-muted/30 space-y-3 rounded-md border p-4"},Ce={class:"grid grid-cols-1 gap-4 md:grid-cols-3"},Be={class:"space-y-2"},Ve={class:"flex items-center gap-1"},Re={type:"button",class:"inline-flex cursor-help","aria-label":"retrieval-count-help"},$e={class:"space-y-2"},qe={class:"flex items-center gap-1"},Ke={type:"button",class:"inline-flex cursor-help","aria-label":"fetch-k-help"},Ne={class:"space-y-2"},Oe={class:"flex items-center gap-1"},He={type:"button",class:"inline-flex cursor-help","aria-label":"similarity-threshold-help"},Se={class:"bg-muted/30 space-y-3 rounded-md border p-4"},Te={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},Ie={class:"space-y-2"},Me={class:"flex items-center gap-2"},Ue=["checked","disabled"],Fe={type:"button",class:"inline-flex cursor-help","aria-label":"multi-query-help"},Ae={class:"space-y-2"},De={class:"space-y-1"},je={class:"grid grid-cols-1 gap-2 md:grid-cols-2"},Le={class:"space-y-1"},Pe={class:"flex items-center gap-1"},Qe={type:"button",class:"inline-flex cursor-help","aria-label":"rerank-topk-help"},ze={class:"space-y-1"},Ee={class:"flex items-center gap-1"},Je={type:"button",class:"inline-flex cursor-help","aria-label":"reranker-help"},Ge={class:"space-y-2"},We={class:"flex items-center gap-2"},Xe=["checked","disabled"],Ye={type:"button",class:"inline-flex cursor-help","aria-label":"hybrid-help"},Ze={class:"space-y-1"},et={class:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-2"},tt={class:"space-y-2"},st={class:"flex items-center gap-2"},lt=["checked","disabled"],at={type:"button",class:"inline-flex cursor-help","aria-label":"skip-smalltalk-help"},ot={key:0,class:"space-y-2"},nt={class:"flex items-center gap-2"},dt={type:"button",class:"inline-flex cursor-help","aria-label":"skip-patterns-help"},it={class:"bg-muted/50 space-y-2 rounded-md p-3 text-sm"},rt={class:"font-medium"},ut={class:"text-muted-foreground ml-4 space-y-1 text-xs"},ct=ee({__name:"KnowledgeBaseConfig",props:{modelValue:{},disabled:{type:Boolean,default:!1},settingsReadOnly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(u,{emit:I}){const{t:r}=te(),_=u,M=I,w=B([]),C=B([]),b=B(!1),n=q({get:()=>({knowledge_base_ids:_.modelValue.knowledge_base_ids||[],retrieval_count:_.modelValue.rag_config?.retrieval_count||5,fetch_k:_.modelValue.rag_config?.fetch_k,similarity_threshold:_.modelValue.rag_config?.similarity_threshold||.7,skip_smalltalk:_.modelValue.rag_config?.skip_smalltalk??!1,skip_patterns:_.modelValue.rag_config?.skip_patterns||[],multi_query:_.modelValue.rag_config?.multi_query??!1,multi_query_count:_.modelValue.rag_config?.multi_query_count||3,rerank_top_k:_.modelValue.rag_config?.rerank_top_k,rerank_model_id:_.modelValue.rag_config?.rerank_model_id,hybrid_enabled:_.modelValue.rag_config?.hybrid_enabled??!1,hybrid_corpus_limit:_.modelValue.rag_config?.hybrid_corpus_limit||1e3}),set:s=>{M("update:modelValue",{knowledge_base_ids:s.knowledge_base_ids,rag_config:{retrieval_count:s.retrieval_count,fetch_k:s.fetch_k,similarity_threshold:s.similarity_threshold,skip_smalltalk:s.skip_smalltalk,skip_patterns:s.skip_patterns,multi_query:s.multi_query,multi_query_count:s.multi_query_count,rerank_top_k:s.rerank_top_k,rerank_model_id:s.rerank_model_id,hybrid_enabled:s.hybrid_enabled,hybrid_corpus_limit:s.hybrid_corpus_limit}})}}),V=q(()=>{const s=new Set(w.value.map(l=>l.id));return n.value.knowledge_base_ids.filter(l=>s.has(l)).length}),R=async()=>{b.value=!0;try{const{$api:s}=S(),l=await s("/v1/admin/rag/knowledge-bases/all");w.value=l.items||l||[]}catch(s){console.error("Failed to load knowledge base list:",s),w.value=[],oe.error(r("components.fileUpload.loadKnowledgeBasesFailed"))}finally{b.value=!1}},U=async()=>{try{const{$api:s}=S(),l=await s("/v1/admin/all-models?capabilities=reranker");C.value=(l||[]).map(c=>({label:c.display_name||c.name||c.id,value:c.id}))}catch(s){console.error("Failed to load reranker models:",s),C.value=[]}},F=(s,l)=>{const c=l.target.checked,f=[...n.value.knowledge_base_ids];if(c)f.includes(s)||f.push(s);else{const $=f.indexOf(s);$>-1&&f.splice($,1)}n.value={...n.value,knowledge_base_ids:f}},A=s=>{const l=typeof s=="number"?s:parseInt(s);isNaN(l)||(n.value={...n.value,retrieval_count:l})},D=s=>{const l=typeof s=="number"?s:parseInt(s);n.value={...n.value,fetch_k:isNaN(l)?void 0:l}},j=s=>{const l=typeof s=="number"?s:parseFloat(s);isNaN(l)||(n.value={...n.value,similarity_threshold:l})},L=s=>{const l=s.target.checked;n.value={...n.value,skip_smalltalk:l}},P=s=>{const c=(typeof s=="number"?String(s):s).split(",").map(f=>f.trim()).filter(f=>f.length>0);n.value={...n.value,skip_patterns:c}},Q=s=>{const l=typeof s=="number"?s:parseInt(s);isNaN(l)||(n.value={...n.value,multi_query_count:l})},z=s=>{const l=typeof s=="number"?s:parseInt(s);n.value={...n.value,rerank_top_k:isNaN(l)?void 0:l}},E=s=>{n.value={...n.value,rerank_model_id:!s||s==="__none__"?void 0:s}},J=s=>{const l=typeof s=="number"?s:parseInt(s);isNaN(l)||(n.value={...n.value,hybrid_corpus_limit:l})};return se(()=>{R(),U()}),(s,l)=>(p(),K(e(W),null,{default:o(()=>[t(e(Y),null,{default:o(()=>[t(e(Z),{class:"flex items-center gap-2"},{default:o(()=>[t(e(ce),{class:"h-5 w-5"}),d(" "+i(e(r)("components.knowledgeBaseConfig.title")),1)]),_:1}),t(e(X),null,{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.description")),1)]),_:1})]),_:1}),t(e(G),{class:"space-y-6"},{default:o(()=>[t(e(ue),null,{default:o(()=>[a("div",_e,[a("div",fe,[a("div",pe,[t(e(m),{class:"text-sm font-medium"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.selectKnowledgeBase"))+" ",1),V.value>0?(p(),x("span",ge,i(e(r)("components.knowledgeBaseConfig.selectedCount",{count:V.value})),1)):N("",!0)]),_:1}),t(e(le),{variant:"outline",size:"sm",onClick:R,disabled:b.value},{default:o(()=>[t(e(me),{class:ae(["mr-1 h-4 w-4",{"animate-spin":b.value}])},null,8,["class"]),d(" "+i(e(r)("components.knowledgeBaseConfig.refresh")),1)]),_:1},8,["disabled"])]),a("div",he,[b.value?(p(),x("div",ke,i(e(r)("components.knowledgeBaseConfig.loading")),1)):w.value.length===0?(p(),x("div",ye,i(e(r)("components.knowledgeBaseConfig.noKnowledgeBases")),1)):(p(!0),x(O,{key:2},H(w.value,c=>(p(),x("div",{key:c.id,class:"hover:bg-muted flex items-start space-x-3 rounded p-2 transition-colors"},[a("input",{id:`kb-${c.id}`,type:"checkbox",checked:n.value.knowledge_base_ids.includes(c.id),disabled:u.disabled,onChange:f=>F(c.id,f),class:"text-primary focus:ring-primary mt-1 h-4 w-4 rounded border-gray-300"},null,40,be),t(e(m),{for:`kb-${c.id}`,class:"flex-1 cursor-pointer space-y-1"},{default:o(()=>[a("div",ve,i(c.name),1),a("div",xe,i(c.description),1)]),_:2},1032,["for"])]))),128))])]),a("div",we,[l[2]||(l[2]=a("div",{class:"text-foreground text-sm font-semibold"},"Retrieval basics",-1)),a("div",Ce,[a("div",Be,[a("div",Ve,[t(e(m),{for:"retrieval-count",class:"text-sm font-medium"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.retrievalCount")),1)]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",Re,[t(e(y),{class:"text-muted-foreground h-3.5 w-3.5"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.retrievalCountHelp")),1)]),_:1})]),_:1})]),t(e(v),{id:"retrieval-count",type:"number","model-value":n.value.retrieval_count,disabled:u.disabled||u.settingsReadOnly,min:1,max:20,placeholder:"5","onUpdate:modelValue":A},null,8,["model-value","disabled"])]),a("div",$e,[a("div",qe,[t(e(m),{for:"fetch-k",class:"text-sm font-medium"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.fetchK")),1)]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",Ke,[t(e(y),{class:"text-muted-foreground h-3.5 w-3.5"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.fetchKHelp")),1)]),_:1})]),_:1})]),t(e(v),{id:"fetch-k",type:"number","model-value":n.value.fetch_k??"",disabled:u.disabled||u.settingsReadOnly,min:1,max:500,placeholder:"Auto (3x K)","onUpdate:modelValue":D},null,8,["model-value","disabled"])]),a("div",Ne,[a("div",Oe,[t(e(m),{for:"similarity-threshold",class:"text-sm font-medium"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.similarityThreshold")),1)]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",He,[t(e(y),{class:"text-muted-foreground h-3.5 w-3.5"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.similarityThresholdHelp")),1)]),_:1})]),_:1})]),t(e(v),{id:"similarity-threshold",type:"number","model-value":n.value.similarity_threshold,disabled:u.disabled||u.settingsReadOnly,min:0,max:1,step:.01,placeholder:"0.7","onUpdate:modelValue":j},null,8,["model-value","disabled"])])])]),a("div",Se,[l[10]||(l[10]=a("div",{class:"text-foreground text-sm font-semibold"},"Advanced recall & rerank",-1)),a("div",Te,[a("div",Ie,[a("div",Me,[a("input",{id:"multi-query",type:"checkbox",checked:n.value.multi_query,disabled:u.disabled||b.value||u.settingsReadOnly,onChange:l[0]||(l[0]=c=>n.value.value={...n.value.value,multi_query:c.target.checked}),class:"text-primary focus:ring-primary h-4 w-4 rounded border-gray-300"},null,40,Ue),t(e(m),{for:"multi-query",class:"cursor-pointer text-sm font-medium"},{default:o(()=>[...l[3]||(l[3]=[d(" Multi-query recall ",-1)])]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",Fe,[t(e(y),{class:"text-muted-foreground h-3.5 w-3.5"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.multiQueryHelp")),1)]),_:1})]),_:1})]),a("div",Ae,[a("div",De,[t(e(m),{for:"multi-query-count",class:"text-xs font-medium"},{default:o(()=>[...l[4]||(l[4]=[d("Alt queries",-1)])]),_:1}),t(e(v),{id:"multi-query-count",type:"number","model-value":n.value.multi_query_count,disabled:u.disabled||u.settingsReadOnly||!n.value.multi_query,min:"1",max:"5","onUpdate:modelValue":Q},null,8,["model-value","disabled"])]),a("div",je,[a("div",Le,[a("div",Pe,[t(e(m),{for:"rerank-top-k",class:"text-xs font-medium"},{default:o(()=>[...l[5]||(l[5]=[d("Rerank top K",-1)])]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",Qe,[t(e(y),{class:"text-muted-foreground h-3 w-3"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.rerankTopKHelp")),1)]),_:1})]),_:1})]),t(e(v),{id:"rerank-top-k",type:"number","model-value":n.value.rerank_top_k,disabled:u.disabled||u.settingsReadOnly,min:"1",max:"50",placeholder:"Optional","onUpdate:modelValue":z},null,8,["model-value","disabled"])]),a("div",ze,[a("div",Ee,[t(e(m),{for:"rerank-model",class:"text-xs font-medium"},{default:o(()=>[...l[6]||(l[6]=[d("Reranker model",-1)])]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",Je,[t(e(y),{class:"text-muted-foreground h-3 w-3"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.rerankModelHelp")),1)]),_:1})]),_:1})]),t(e(ne),{id:"rerank-model",class:"w-full",disabled:u.disabled||u.settingsReadOnly||C.value.length===0,"model-value":n.value.rerank_model_id||"__none__","onUpdate:modelValue":E},{default:o(()=>[t(e(de),null,{default:o(()=>[t(e(ie),{placeholder:"Select reranker (optional)"})]),_:1}),t(e(re),null,{default:o(()=>[t(e(T),{value:"__none__"},{default:o(()=>[...l[7]||(l[7]=[d("None",-1)])]),_:1}),(p(!0),x(O,null,H(C.value,c=>(p(),K(e(T),{key:c.value,value:c.value},{default:o(()=>[d(i(c.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["disabled","model-value"])])])])]),a("div",Ge,[a("div",We,[a("input",{id:"hybrid-enabled",type:"checkbox",checked:n.value.hybrid_enabled,disabled:u.disabled||b.value||u.settingsReadOnly,onChange:l[1]||(l[1]=c=>n.value.value={...n.value.value,hybrid_enabled:c.target.checked}),class:"text-primary focus:ring-primary h-4 w-4 rounded border-gray-300"},null,40,Xe),t(e(m),{for:"hybrid-enabled",class:"cursor-pointer text-sm font-medium"},{default:o(()=>[...l[8]||(l[8]=[d(" Hybrid (BM25 + dense) ",-1)])]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",Ye,[t(e(y),{class:"text-muted-foreground h-3.5 w-3.5"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.hybridHelp")),1)]),_:1})]),_:1})]),a("div",Ze,[t(e(m),{for:"hybrid-corpus-limit",class:"text-xs font-medium"},{default:o(()=>[...l[9]||(l[9]=[d("BM25 corpus cap",-1)])]),_:1}),t(e(v),{id:"hybrid-corpus-limit",type:"number","model-value":n.value.hybrid_corpus_limit,disabled:u.disabled||u.settingsReadOnly||!n.value.hybrid_enabled,min:"100",max:"5000","onUpdate:modelValue":J},null,8,["model-value","disabled"])])])])]),a("div",et,[a("div",tt,[a("div",st,[a("input",{id:"skip-smalltalk",type:"checkbox",checked:n.value.skip_smalltalk,disabled:u.disabled||b.value||u.settingsReadOnly,onChange:L,class:"text-primary focus:ring-primary h-4 w-4 rounded border-gray-300"},null,40,lt),t(e(m),{for:"skip-smalltalk",class:"cursor-pointer text-sm font-medium"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.skipSmalltalk")),1)]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",at,[t(e(y),{class:"text-muted-foreground h-3.5 w-3.5"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.skipSmalltalkHelp")),1)]),_:1})]),_:1})])]),n.value.skip_smalltalk?(p(),x("div",ot,[a("div",nt,[t(e(m),{for:"skip-patterns",class:"text-sm font-medium"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.skipPatterns")),1)]),_:1}),t(e(g),null,{default:o(()=>[t(e(h),{"as-child":""},{default:o(()=>[a("button",dt,[t(e(y),{class:"text-muted-foreground h-3 w-3"})])]),_:1}),t(e(k),{side:"top",class:"max-w-xs text-left"},{default:o(()=>[d(i(e(r)("components.knowledgeBaseConfig.skipPatternsHelp")),1)]),_:1})]),_:1})]),t(e(v),{id:"skip-patterns",type:"text","model-value":n.value.skip_patterns.join(", "),disabled:u.disabled||u.settingsReadOnly,placeholder:"hi, hello, thanks","onUpdate:modelValue":P},null,8,["model-value","disabled"])])):N("",!0)]),a("div",it,[a("div",rt,i(e(r)("components.knowledgeBaseConfig.configDescription")),1),a("ul",ut,[a("li",null,[l[11]||(l[11]=d(" • ",-1)),a("strong",null,i(e(r)("components.knowledgeBaseConfig.retrievalCount"))+":",1),d(" "+i(e(r)("components.knowledgeBaseConfig.configTips.retrievalCount")),1)]),a("li",null,[l[12]||(l[12]=d(" • ",-1)),a("strong",null,i(e(r)("components.knowledgeBaseConfig.similarityThreshold"))+":",1),d(" "+i(e(r)("components.knowledgeBaseConfig.configTips.similarityThreshold")),1)]),a("li",null,"• "+i(e(r)("components.knowledgeBaseConfig.configTips.recommended")),1)])])])]),_:1})]),_:1})]),_:1}))}}),Bt=Object.assign(ct,{__name:"AdminKnowledgeBaseConfig"});export{Bt as K};
