import{_ as ts}from"./hcYt5xb6.js";import{_ as as,a as os,b as ls,c as is,d as ns}from"./DC3gMtZB.js";import{h as rs,e as us,u as ds,a9 as ms,F as _s,G as cs,k as ps,E as b,H as P,D as M,Q as x,c as v,o as p,b as e,a as l,w as o,d,t as i,g as s,M as fs,I as F,y as V,J as U,K as B,v as I,$ as vs,aa as bs,L as T,a3 as ys}from"./BzhixHsn.js";import{_ as hs}from"./DB-9e68Q.js";import{_ as xs}from"./pRipWecN.js";import{_ as Fs}from"./2RVX2kid.js";import{_ as D,a as H}from"./CRjpF7qy.js";import{_ as ws}from"./Co_Pqrtl.js";import{_ as gs,a as Vs}from"./DfqdNhl2.js";import{_ as N}from"./Di109XjC.js";import{_ as f}from"./4isL45Eu.js";import{_ as $s}from"./_XME2JEy.js";import{_ as L}from"./Le8goM6p.js";import{_ as $,a as k,d as C,b as q,c as w}from"./Bi0Cqvs9.js";import{u as ks}from"./G5O1m7ek.js";import{S as Cs}from"./CHh9YBUH.js";import"./DhvzP0AS.js";import"./Dosvfmhb.js";import"./CCA1r4XF.js";import"./lcKie01k.js";import"./qyVZgQpg.js";import"./C9XbPd6k.js";import"./CeWx-USI.js";import"./B9I6JWJy.js";import"./COjiOs1v.js";import"./Bp3-KBkO.js";import"./DKMWZZOl.js";import"./XCOtPLqC.js";import"./BSaEE8c4.js";import"./DdeO54y7.js";import"./DQj8dpKz.js";import"./C-9Ampo3.js";import"./C-xhCs27.js";import"./vJ3Jskde.js";import"./BkS3akZz.js";import"./C56gk0qC.js";import"./BmCC6msl.js";import"./BmLyE0U0.js";import"./CMS48I6h.js";const qs={class:"absolute inset-0 flex flex-col overflow-hidden rounded-[inherit]"},As={class:"flex-1 overflow-y-auto"},Ss={class:"container mx-auto max-w-4xl space-y-6 py-6"},Es={class:"flex items-center justify-between"},Ps={class:"space-y-4"},Ms={class:"space-y-2"},Us={class:"text-muted-foreground text-sm"},Bs={class:"space-y-2"},Is={key:0,class:"text-destructive text-sm"},Ts={class:"space-y-2"},Ds={key:0,class:"text-destructive text-sm"},Hs={class:"space-y-4"},Ns={class:"text-lg font-medium"},Ls={class:"space-y-2"},js={key:0,class:"text-destructive text-sm"},Gs={class:"text-muted-foreground text-sm"},Os={class:"space-y-2"},Rs={key:0,class:"text-destructive text-sm"},Qs={class:"text-muted-foreground text-sm"},zs={class:"space-y-2"},Js={class:"text-muted-foreground text-sm"},Ks={class:"space-y-4"},Xs={class:"text-lg font-medium"},Ws={class:"bg-muted/30 space-y-3 rounded-md border p-4"},Ys={key:0,class:"text-muted-foreground text-sm"},Zs={class:"flex items-center justify-between gap-3"},se={class:"text-sm font-semibold"},ee={class:"space-y-2"},te={class:"text-muted-foreground text-sm"},ae={class:"space-y-4"},oe={class:"text-lg font-medium"},le={class:"flex items-center space-x-2"},ie=["disabled"],ne={class:"space-y-2"},re={class:"flex justify-end gap-3"},Ke=rs({__name:"create",setup(ue){const{t}=us();ds({title:t("assistantForm.createTitle")});const A=ms(),j=_s(),G=cs(),{data:O}=ks("/v1/models",{server:!1}),R=ps(()=>(O.value??[]).filter(u=>u.status==="ACTIVE").map(u=>({label:u.display_name,value:u.id}))),m=b(!1),n=b({name:"",avatar_file_path:"",description:"",system_prompt:"",model_id:"",max_history_messages:10,is_public:!1,status:"ACTIVE",followup_questions_enabled:!0,followup_questions_count:null}),g=b(!1),y=b(3),h=b("__global__");P(async()=>{const u=await G.getConfig();g.value=u.ui_generate_followup_questions!==!1;const a=Number(u.ui_followup_question_count??3);y.value=Number.isFinite(a)?Math.max(1,Math.min(5,Math.trunc(a))):3});const _=b({}),Q=()=>{const u={};return(!n.value.name||n.value.name.length<2)&&(u.name=t("assistantForm.nameError")),(!n.value.system_prompt||n.value.system_prompt.length<10)&&(u.system_prompt=t("assistantForm.systemPromptError")),n.value.model_id||(u.model_id=t("assistantForm.modelError")),_.value=u,Object.keys(u).length===0};P(async()=>{const u=j.query.source_id;if(u){m.value=!0;try{const{$api:a}=M(),c=await a(`/v1/assistants/${u}`);c&&(n.value={...n.value,name:`${c.name} (Copy)`,description:c.description,system_prompt:c.system_prompt,model_id:c.model_id,max_history_messages:c.max_history_messages,avatar_file_path:c.avatar_file_path,is_public:!1,status:"ACTIVE"},n.value.followup_questions_enabled=c.followup_questions_enabled??!0,h.value=typeof c.followup_questions_count=="number"?String(c.followup_questions_count):"__global__",x.success(t("assistantForm.loadedFromSource")))}catch(a){console.error("Failed to load source assistant:",a),x.error(t("assistantForm.loadSourceFailed"))}finally{m.value=!1}}});const S=async()=>{if(!Q()){x.error(t("assistantForm.validationError"));return}m.value=!0;try{const{$api:u}=M(),a={...n.value};a.followup_questions_enabled===!1?a.followup_questions_count=null:a.followup_questions_count=h.value==="__global__"?null:Math.min(y.value,Math.max(1,Number(h.value))),await u("/v1/assistants",{method:"POST",body:a}),x.success(t("assistantForm.createSuccess")),A.push("/assistants")}catch{x.error(t("assistantForm.createFailed"))}finally{m.value=!1}},z=()=>{A.push("/assistants")};return(u,a)=>{const c=ts,J=hs,E=ls,K=is,X=ns,W=os,Y=as,Z=xs,ss=Fs;return p(),v("div",qs,[e(Z,null,{default:o(()=>[e(Y,null,{default:o(()=>[e(W,null,{default:o(()=>[e(E,null,{default:o(()=>[e(J,{"as-child":""},{default:o(()=>[e(c,{to:"/assistants"},{default:o(()=>[d(i(s(t)("chat.breadcrumbAssistants")),1)]),_:1})]),_:1})]),_:1}),e(K),e(E,null,{default:o(()=>[e(X,null,{default:o(()=>[d(i(s(t)("assistantForm.createTitle")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l("div",As,[l("div",Ss,[e(s(H),null,{default:o(()=>[e(s(gs),null,{default:o(()=>[l("div",Es,[e(s(Vs),null,{default:o(()=>[d(i(s(t)("assistantForm.basicInfo")),1)]),_:1})]),e(s(ws),null,{default:o(()=>[d(i(s(t)("assistantForm.basicInfoDesc")),1)]),_:1})]),_:1}),e(s(D),null,{default:o(()=>[l("form",{onSubmit:fs(S,["prevent"]),class:"space-y-6"},[l("div",Ps,[l("div",Ms,[e(s(f),{for:"avatar"},{default:o(()=>[d(i(s(t)("assistantForm.avatar")),1)]),_:1}),e(ss,{id:"avatar",modelValue:n.value.avatar_file_path,"onUpdate:modelValue":a[0]||(a[0]=r=>n.value.avatar_file_path=r),disabled:m.value},null,8,["modelValue","disabled"]),l("div",Us,i(s(t)("assistantForm.avatarHelp")),1)]),l("div",Bs,[e(s(f),{for:"name"},{default:o(()=>[d(i(s(t)("assistantForm.name"))+" ",1),a[10]||(a[10]=l("span",{class:"text-destructive"},"*",-1))]),_:1}),e(s(N),{id:"name",modelValue:n.value.name,"onUpdate:modelValue":a[1]||(a[1]=r=>n.value.name=r),placeholder:s(t)("assistantForm.namePlaceholder"),class:V({"border-destructive":_.value.name}),disabled:m.value},null,8,["modelValue","placeholder","class","disabled"]),_.value.name?(p(),v("div",Is,i(_.value.name),1)):F("",!0)]),l("div",Ts,[e(s(f),{for:"description"},{default:o(()=>[d(i(s(t)("assistantForm.description")),1)]),_:1}),e(s(L),{id:"description",modelValue:n.value.description,"onUpdate:modelValue":a[2]||(a[2]=r=>n.value.description=r),placeholder:s(t)("assistantForm.descriptionPlaceholder"),rows:3,class:V({"border-destructive":_.value.description}),disabled:m.value},null,8,["modelValue","placeholder","class","disabled"]),_.value.description?(p(),v("div",Ds,i(_.value.description),1)):F("",!0)])]),l("div",Hs,[l("h3",Ns,i(s(t)("assistantForm.modelConfig")),1),l("div",Ls,[e(s(f),{for:"system_prompt"},{default:o(()=>[d(i(s(t)("assistantForm.systemPrompt"))+" ",1),a[11]||(a[11]=l("span",{class:"text-destructive"},"*",-1))]),_:1}),e(s(L),{id:"system_prompt",modelValue:n.value.system_prompt,"onUpdate:modelValue":a[3]||(a[3]=r=>n.value.system_prompt=r),placeholder:s(t)("assistantForm.systemPromptPlaceholder"),rows:5,class:V({"border-destructive":_.value.system_prompt}),disabled:m.value},null,8,["modelValue","placeholder","class","disabled"]),_.value.system_prompt?(p(),v("div",js,i(_.value.system_prompt),1)):F("",!0),l("div",Gs,i(s(t)("assistantForm.systemPromptHelp")),1)]),l("div",Os,[e(s(f),{for:"model_id"},{default:o(()=>[d(i(s(t)("assistantForm.model"))+" ",1),a[12]||(a[12]=l("span",{class:"text-destructive"},"*",-1))]),_:1}),e(s($),{modelValue:n.value.model_id,"onUpdate:modelValue":a[4]||(a[4]=r=>n.value.model_id=r),disabled:m.value},{default:o(()=>[e(s(k),{class:V({"border-destructive":_.value.model_id})},{default:o(()=>[e(s(C),{placeholder:s(t)("assistantForm.modelPlaceholder")},null,8,["placeholder"])]),_:1},8,["class"]),e(s(q),null,{default:o(()=>[(p(!0),v(U,null,B(R.value,r=>(p(),I(s(w),{key:r.value,value:r.value},{default:o(()=>[d(i(r.label),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),_.value.model_id?(p(),v("div",Rs,i(_.value.model_id),1)):F("",!0),l("div",Qs,i(s(t)("assistantForm.modelHelp")),1)]),l("div",zs,[e(s(f),{for:"max_history_messages"},{default:o(()=>[d(i(s(t)("assistantForm.maxHistory")),1)]),_:1}),e(s(N),{id:"max_history_messages",modelValue:n.value.max_history_messages,"onUpdate:modelValue":a[5]||(a[5]=r=>n.value.max_history_messages=r),modelModifiers:{number:!0},type:"number",placeholder:"10",min:"0",max:"100",disabled:m.value},null,8,["modelValue","disabled"]),l("div",Js,i(s(t)("assistantForm.maxHistoryHelp")),1)])]),l("div",Ks,[l("h3",Xs,i(s(t)("assistantForm.followupsTitle")),1),l("div",Ws,[g.value?F("",!0):(p(),v("div",Ys,i(s(t)("assistantForm.followupsGloballyDisabled")),1)),l("div",Zs,[l("div",se,i(s(t)("assistantForm.followupsEnableLabel")),1),e(s($s),{id:"assistant-followups-enabled","model-value":n.value.followup_questions_enabled!==!1,"onUpdate:modelValue":a[6]||(a[6]=r=>n.value.followup_questions_enabled=r),disabled:m.value||!g.value},null,8,["model-value","disabled"])]),l("div",ee,[e(s(f),{for:"assistant-followups-count"},{default:o(()=>[d(i(s(t)("assistantForm.followupsCountLabel")),1)]),_:1}),e(s($),{modelValue:h.value,"onUpdate:modelValue":a[7]||(a[7]=r=>h.value=r),disabled:m.value||!g.value||n.value.followup_questions_enabled===!1},{default:o(()=>[e(s(k),{id:"assistant-followups-count",class:"max-w-xs"},{default:o(()=>[e(s(C))]),_:1}),e(s(q),null,{default:o(()=>[e(s(w),{value:"__global__"},{default:o(()=>[d(i(s(t)("assistantForm.followupsUseGlobal",{count:y.value})),1)]),_:1}),(p(!0),v(U,null,B(Array.from({length:y.value},(r,es)=>es+1),r=>(p(),I(s(w),{key:r,value:String(r)},{default:o(()=>[d(i(r),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"]),l("div",te,i(s(t)("assistantForm.followupsMaxAllowed",{count:y.value})),1)])])]),l("div",ae,[l("h3",oe,i(s(t)("assistantForm.publishSettings")),1),l("div",le,[vs(l("input",{id:"is_public",type:"checkbox","onUpdate:modelValue":a[8]||(a[8]=r=>n.value.is_public=r),disabled:m.value,class:"text-primary focus:ring-primary h-4 w-4 rounded border-gray-300"},null,8,ie),[[bs,n.value.is_public]]),e(s(f),{for:"is_public",class:"cursor-pointer text-sm"},{default:o(()=>[d(i(s(t)("assistantForm.isPublic")),1)]),_:1})]),l("div",ne,[e(s(f),{for:"status"},{default:o(()=>[d(i(s(t)("assistantForm.status"))+" ",1),a[13]||(a[13]=l("span",{class:"text-destructive"},"*",-1))]),_:1}),e(s($),{modelValue:n.value.status,"onUpdate:modelValue":a[9]||(a[9]=r=>n.value.status=r),disabled:m.value},{default:o(()=>[e(s(k),null,{default:o(()=>[e(s(C),{placeholder:s(t)("assistantForm.statusPlaceholder")},null,8,["placeholder"])]),_:1}),e(s(q),null,{default:o(()=>[e(s(w),{value:"ACTIVE"},{default:o(()=>[d(i(s(t)("assistantForm.statusActive")),1)]),_:1}),e(s(w),{value:"DRAFT"},{default:o(()=>[d(i(s(t)("assistantForm.statusDraft")),1)]),_:1})]),_:1})]),_:1},8,["modelValue","disabled"])])])],32)]),_:1})]),_:1}),e(s(H),null,{default:o(()=>[e(s(D),{class:"pt-6"},{default:o(()=>[l("div",re,[e(s(T),{variant:"outline",onClick:z,disabled:m.value},{default:o(()=>[e(s(ys),{class:"mr-2 h-4 w-4"}),d(" "+i(s(t)("common.cancel")),1)]),_:1},8,["disabled"]),e(s(T),{onClick:S,disabled:m.value},{default:o(()=>[e(s(Cs),{class:"mr-2 h-4 w-4"}),d(" "+i(s(t)("assistantForm.createButton")),1)]),_:1},8,["disabled"])])]),_:1})]),_:1})])])])}}});export{Ke as default};
