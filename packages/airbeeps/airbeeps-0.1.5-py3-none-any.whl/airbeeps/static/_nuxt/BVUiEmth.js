import{_ as gs}from"./pRipWecN.js";import{u as _s,_ as hs,a as bs,b as ys}from"./BlnvEJqx.js";import{_ as ws}from"./BiXAZkt9.js";import{_ as $s}from"./CkJ8ft5o.js";import{h as Cs,e as ks,u as Ss,k as g,E as m,Z as W,D as As,S as Ts,G as Is,B as Ps,H as Ds,V as Es,W as Ms,m as Ns,c as _,o as l,v as D,I as w,g as e,w as a,a as i,t as n,b as o,d as u,L as p,O as c,X as J,J as X,K as Os}from"./BzhixHsn.js";import{_ as Vs,a as Bs,b as Rs,c as js,d as xs}from"./C9XbPd6k.js";import{_ as Fs}from"./CHPRih2d.js";import{u as Y}from"./G5O1m7ek.js";import{u as Ls}from"./2JFTuhAN.js";import{u as Us}from"./D01W4VS-.js";import"./Dosvfmhb.js";import"./CCA1r4XF.js";import"./lcKie01k.js";import"./qyVZgQpg.js";import"./4isL45Eu.js";import"./2RVX2kid.js";import"./C-9Ampo3.js";import"./C-xhCs27.js";import"./Di109XjC.js";import"./Bi0Cqvs9.js";import"./C56gk0qC.js";import"./Bp3-KBkO.js";import"./DKMWZZOl.js";import"./BmCC6msl.js";import"./vJ3Jskde.js";import"./CeWx-USI.js";import"./B9I6JWJy.js";import"./COjiOs1v.js";import"./XCOtPLqC.js";import"./BSaEE8c4.js";import"./DdeO54y7.js";import"./DQj8dpKz.js";import"./BEcuULY5.js";import"./DkVjT0nP.js";import"./DlAUqK2U.js";import"./DzpHhHXI.js";import"./RCxqQWZp.js";import"./BYr6U6oc.js";import"./CawQPbYo.js";import"./Dx78NuNM.js";import"./EdM3CJ8e.js";import"./D0pu0OPX.js";import"./BdE42Imj.js";import"./C8B8ONuC.js";import"./Le8goM6p.js";import"./DU0NpF9R.js";import"./CzLssp15.js";import"./BmLyE0U0.js";import"./CMS48I6h.js";const Hs={class:"flex h-screen flex-col"},qs={class:"flex items-center gap-2"},Ks={class:"font-semibold"},zs={key:1,class:"flex flex-1 items-center justify-center"},Gs={key:2,class:"flex flex-1 items-center justify-center px-4"},Ws={class:"space-y-4"},Js={class:"border-border/60 bg-muted/30 rounded-lg border p-4"},Xs={class:"font-medium"},Ys={key:0,class:"text-muted-foreground mt-2 text-sm"},Zs={key:0,class:"space-y-2"},Qs={class:"text-sm font-medium"},se={class:"text-muted-foreground list-inside list-decimal space-y-2 text-sm"},ee={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between"},te={key:0,class:"flex flex-wrap gap-2 sm:justify-end"},ne={key:0,class:"w-full max-w-2xl text-center"},ae={class:"border-border/70 bg-card/70 rounded-2xl border p-8 shadow-sm backdrop-blur-sm"},oe={class:"text-lg font-semibold"},ie={class:"text-muted-foreground mt-2 text-sm"},re={class:"mt-6 flex flex-wrap justify-center gap-2"},Z="airbeeps.onboarding.no_assistants.dismissed",ot=Cs({__name:"index",setup(le){const{t:$}=ks();Ss({title:$("nav.newChat")});const{data:Q,pending:ss,refresh:es}=Y("/v1/assistants",{query:{scope:"pinned",limit:50},lazy:!0}),{data:ts,pending:ns,refresh:as}=Y("/v1/assistants",{query:{sort_by:"usage_count",order:"desc",limit:50},lazy:!0}),T=g(()=>{const s=new Map;return(Q.value??[]).forEach(t=>s.set(t.id,t)),(ts.value??[]).forEach(t=>s.set(t.id,t)),Array.from(s.values())}),I=m(null);W(()=>{!I.value&&T.value.length>0&&(I.value=T.value[0].id)});const d=g(()=>T.value.find(s=>s.id===I.value)??null),h=m([]),f=m(""),b=m(!1),C=m(!1),E=m(!1),R=m(!1),M=m(null),j=m(),{$api:ue}=As(),x=_s(),os=Ls(),k=Ts(),F=Is(),{showError:L}=Us(),is=Ps(),U=g(()=>ss.value||ns.value),S=g(()=>!!k.user?.is_superuser),O=m(!1),y=m(!1),rs=g(()=>T.value.length>0),H=()=>{if(!U.value){if(rs.value){y.value=!1;return}O.value||(y.value=!0)}},ls=()=>{y.value=!1,O.value=!0,localStorage.setItem(Z,"1")},q=async()=>{await Promise.all([es(),as()])},us=g(()=>d.value?.model?.capabilities?d.value.model.capabilities.includes("vision"):!1),N=()=>{h.value=[],f.value="",b.value=!1,C.value=!1,x.cleanupOldConversations()},V=async()=>k.user?!0:(M.value||(M.value=(async()=>{try{if(await k.fetchUser()&&k.user)return!0}catch(s){console.error("Failed to fetch user state:",s)}return R.value||(L($("assistants.loginRequired")),R.value=!0),await c({path:"/sign-in",query:{redirect:is.fullPath}}),!1})().finally(()=>{M.value=null})),M.value),K=async()=>{k.user||(E.value=!0,await V())},ds=async s=>{await V()||(s.preventDefault(),s.stopPropagation())},z=async s=>{if(!await V()||!f.value.trim()||b.value||!d.value)return;const t=d.value.id,B=f.value.trim();f.value="",b.value=!0,C.value=!0;const A={id:Date.now().toString(),content:B,message_type:"USER",created_at:new Date().toISOString(),extra_data:s&&s.length>0?{images:s}:void 0};h.value.push(A);try{const v=await os.createConversation(t);if(!v){h.value=h.value.filter(P=>P.id!==A.id),b.value=!1,C.value=!1;return}d.value&&x.setConversationData(v.id,A,d.value),N(),await c(`/chat/${v.id}`)}catch(v){console.error("Failed to initiate conversation:",v),h.value=h.value.filter(P=>P.id!==A.id),b.value=!1,C.value=!1,L(`${$("chat.sendFailed")}: ${v instanceof Error?v.message:$("chat.unknownError")}`)}},ms=s=>{s!==I.value&&(I.value=s,N())},ps=s=>{f.value=s,z()},G=g(()=>h.value.length===0&&!C.value),cs=g(()=>F.config.ui_show_message_share_button!==!1);return g(()=>F.config.ui_show_assistant_dropdown!==!1),Ds(()=>{N(),O.value=localStorage.getItem(Z)==="1",H(),Es(()=>{j.value?.focus()})}),Ms(()=>{N()}),Ns(()=>k.user,s=>{s&&(E.value=!1)}),W(()=>{H()}),(s,t)=>{const B=gs,A=hs,v=ws,P=bs,fs=ys,vs=$s;return l(),_("div",Hs,[e(d)?w("",!0):(l(),D(B,{key:0},{default:a(()=>[i("div",qs,[i("span",Ks,n(e($)("nav.newChat")),1)])]),_:1})),e(U)?(l(),_("div",zs,[...t[10]||(t[10]=[i("div",{class:"border-primary h-8 w-8 animate-spin rounded-full border-b-2"},null,-1)])])):e(d)?(l(),D(vs,{key:3,assistant:e(d),assistants:e(T),"show-landing-input":e(G),onSelectAssistant:ms},{input:a(()=>[o(fs,{ref_key:"chatInputRef",ref:j,modelValue:e(f),"onUpdate:modelValue":t[9]||(t[9]=r=>J(f)?f.value=r:null),disabled:e(E)||e(b),"send-disabled":e(E)||e(b)||!e(f).trim(),"supports-vision":e(us),onKeydown:ds,onFocus:K,onClick:K,onSend:z},null,8,["modelValue","disabled","send-disabled","supports-vision"])]),default:a(()=>[e(G)?(l(),D(A,{key:0,assistant:e(d),"show-welcome":!0,onSelectSuggestion:ps},null,8,["assistant"])):(l(!0),_(X,{key:1},Os(e(h),r=>(l(),D(v,{key:r.id,message:r,assistant:e(d),"enable-share":e(cs)},null,8,["message","assistant","enable-share"]))),128)),e(C)?(l(),D(P,{key:2,assistant:e(d),message:e($)("chat.creatingConversation","Creating new conversation...")},null,8,["assistant","message"])):w("",!0)]),_:1},8,["assistant","assistants","show-landing-input"])):(l(),_("div",Gs,[o(e(xs),{open:e(y),"onUpdate:open":t[4]||(t[4]=r=>J(y)?y.value=r:null)},{default:a(()=>[o(e(Vs),{class:"sm:max-w-[560px]"},{default:a(()=>[o(e(Bs),null,{default:a(()=>[o(e(Rs),null,{default:a(()=>[u(n(s.$t("assistants.onboarding.title")),1)]),_:1}),o(e(js),null,{default:a(()=>[u(n(s.$t("assistants.onboarding.subtitle")),1)]),_:1})]),_:1}),i("div",Ws,[i("div",Js,[i("p",Xs,n(e(S)?s.$t("assistants.onboarding.adminTitle"):s.$t("assistants.onboarding.userTitle")),1),e(S)?w("",!0):(l(),_("p",Ys,n(s.$t("assistants.onboarding.userHelp")),1))]),e(S)?(l(),_("div",Zs,[i("p",Qs,n(s.$t("assistants.onboarding.stepsTitle")),1),i("ol",se,[i("li",null,n(s.$t("assistants.onboarding.steps.provider")),1),i("li",null,n(s.$t("assistants.onboarding.steps.model")),1),i("li",null,n(s.$t("assistants.onboarding.steps.assistant")),1)])])):w("",!0)]),o(e(Fs),{class:"flex-col-reverse gap-3 sm:flex-col sm:items-stretch sm:justify-start"},{default:a(()=>[i("div",ee,[o(e(p),{variant:"outline",onClick:ls},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.dismiss")),1)]),_:1}),o(e(p),{variant:"secondary",onClick:q},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.refresh")),1)]),_:1})]),e(S)?(l(),_("div",te,[o(e(p),{variant:"outline",onClick:t[0]||(t[0]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openAdmin")),1)]),_:1}),o(e(p),{variant:"outline",class:"whitespace-normal",onClick:t[1]||(t[1]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/model-providers"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openProviders")),1)]),_:1}),o(e(p),{variant:"outline",class:"whitespace-normal",onClick:t[2]||(t[2]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/models"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openModels")),1)]),_:1}),o(e(p),{onClick:t[3]||(t[3]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/assistants/create"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.createAssistant")),1)]),_:1})])):w("",!0)]),_:1})]),_:1})]),_:1},8,["open"]),e(y)?w("",!0):(l(),_("div",ne,[i("div",ae,[i("p",oe,n(s.$t("assistants.noAssistants")),1),i("p",ie,n(e(S)?s.$t("assistants.onboarding.adminTitle"):s.$t("assistants.onboarding.userHelp")),1),i("div",re,[o(e(p),{variant:"secondary",onClick:q},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.refresh")),1)]),_:1}),e(S)?(l(),_(X,{key:0},[o(e(p),{variant:"outline",onClick:t[5]||(t[5]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openAdmin")),1)]),_:1}),o(e(p),{variant:"outline",onClick:t[6]||(t[6]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/model-providers"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openProviders")),1)]),_:1}),o(e(p),{variant:"outline",onClick:t[7]||(t[7]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/models"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.openModels")),1)]),_:1}),o(e(p),{onClick:t[8]||(t[8]=r=>("navigateTo"in s?s.navigateTo:e(c))("/admin/assistants/create"))},{default:a(()=>[u(n(s.$t("assistants.onboarding.actions.createAssistant")),1)]),_:1})],64)):w("",!0)])])]))]))])}}});export{ot as default};
