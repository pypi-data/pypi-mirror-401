import{_ as j}from"./Di_95mgX.js";import{_ as J}from"./C-jt9Ih2.js";import{h as Q,e as X,D as Y,k as y,E as m,i as k,c as z,o as W,b as p,w as u,g as d,d as T,t as C,J as Z,Q as E}from"./BzhixHsn.js";import{_ as ee,a as ae,b as le,c as te,d as se,e as ie,f as oe,g as ne}from"./B-FcqR0d.js";import{u as O}from"./G5O1m7ek.js";import"./4isL45Eu.js";import"./C9XbPd6k.js";import"./BTANIQ8V.js";import"./Di109XjC.js";import"./CRjpF7qy.js";import"./IgXGHcdR.js";import"./COjiOs1v.js";import"./Bp3-KBkO.js";import"./DKMWZZOl.js";import"./XCOtPLqC.js";import"./Bi0Cqvs9.js";import"./C56gk0qC.js";import"./BmCC6msl.js";import"./vJ3Jskde.js";import"./BYr6U6oc.js";import"./C-zlyDS5.js";import"./KyMCIHQI.js";import"./C8B8ONuC.js";import"./CW7RC7pq.js";import"./DhvzP0AS.js";import"./DzpHhHXI.js";import"./2RVX2kid.js";import"./C-9Ampo3.js";import"./C-xhCs27.js";import"./Le8goM6p.js";import"./_XME2JEy.js";import"./BkS3akZz.js";import"./BLw_G03o.js";import"./B9I6JWJy.js";import"./CHh9YBUH.js";import"./zIw-xwcH.js";import"./BVAf69h5.js";import"./EdM3CJ8e.js";import"./BmLyE0U0.js";import"./CMS48I6h.js";const Xe=Q({__name:"models",setup(de){const{t:e}=X(),{$api:h}=Y(),{data:H}=O("/v1/admin/all-providers",{server:!1}),S=y(()=>(H.value??[]).map(a=>({label:a.display_name,value:a.id}))),F=y(()=>{const a={};return(H.value??[]).forEach(l=>{a[l.id]=l}),a}),{data:M,refresh:V}=O("/v1/admin/model-assets/huggingface/embeddings?status=READY",{server:!1}),P=y(()=>new Set((M.value??[]).map(a=>a.identifier))),c=m({}),b=m({}),f=m({}),g=m({}),R=async a=>{if(a&&!c.value[a]&&!b.value[a]){b.value={...b.value,[a]:!0};try{const l=await h(`/v1/admin/providers/${a}/model-suggestions`,{method:"GET"});c.value={...c.value,[a]:l??[]}}catch{c.value={...c.value,[a]:[]}}finally{b.value={...b.value,[a]:!1}}}},I=async a=>{if(a&&!g.value[a]){g.value={...g.value,[a]:!0};try{const l=await h(`/v1/admin/providers/${a}/discover-models`,{method:"GET"});f.value={...f.value,[a]:l??[]},E.success(e("admin.pages.models.discoverModelsSuccess",{count:(l??[]).length}))}catch(l){E.error(l?.data?.detail||l?.message||e("common.error")),f.value={...f.value,[a]:[]}}finally{g.value={...g.value,[a]:!1}}}},D=m(null),v=m(null),x=m(!1),w=m(null),$=m(null),_=m({}),U=async()=>{w.value&&await q(w.value),x.value=!1},q=async a=>{try{const l=await h("/v1/admin/model-assets/huggingface/embeddings/download",{method:"POST",body:{repo_id:a}});return E.success(e("admin.pages.models.hf.downloadQueued")),setTimeout(()=>V(),1500),l}catch(l){return E.error(l?.data?.detail||l?.message||e("common.error")),null}},B=async a=>{try{if((await h(`/v1/admin/model-assets/huggingface/embeddings/resolve?repo_id=${encodeURIComponent(a)}`,{method:"GET"}))?.available)return V(),!0}catch{}return!1},K=a=>{a&&(P.value.has(a)||_.value[a]||(_.value={..._.value,[a]:!0},(async()=>{const l=await B(a);_.value={..._.value,[a]:!1},!l&&a!==$.value&&(w.value=a,x.value=!0,$.value=a)})()))},N=y(()=>[{label:e("admin.pages.models.capabilities.chat"),value:"chat"},{label:e("admin.pages.models.capabilities.completion"),value:"completion"},{label:e("admin.pages.models.capabilities.embedding"),value:"embedding"},{label:e("admin.pages.models.capabilities.vision"),value:"vision"},{label:e("admin.pages.models.capabilities.audio"),value:"audio"},{label:e("admin.pages.models.capabilities.function_calling"),value:"function_calling"},{label:e("admin.pages.models.capabilities.tool_use"),value:"tool_use"},{label:e("admin.pages.models.capabilities.code"),value:"code"},{label:e("admin.pages.models.capabilities.image_generation"),value:"image_generation"},{label:e("admin.pages.models.capabilities.reranker"),value:"reranker"}]),L=y(()=>({title:e("admin.pages.models.title"),description:e("admin.pages.models.description"),apiEndpoint:"/v1/admin/models",onFormChange:({formData:a,mode:l,setValues:s})=>{if(l!=="create")return;const t=a?.provider_id||"",r=t?F.value[t]:void 0;t&&t!==D.value&&(D.value=t,v.value=null,$.value=null,R(t),r&&(r.interface_type==="OPENAI"||r.interface_type==="XAI")&&!f.value[t]&&!g.value[t]&&I(t));const i=a?.template_id||"";if(i===""&&v.value!==null){v.value=null;return}if(!t||!i||!s)return;const n=`${t}:${i}`;if(n===v.value)return;const o=(c.value[t]??[]).find(A=>A.name===i);o?(r?.interface_type==="HUGGINGFACE"&&K(i),s({name:o.name,display_name:o.display_name,description:o.description??"",capabilities:o.capabilities??[],generation_config:JSON.stringify(o.generation_config??{},null,2),max_context_tokens:o.max_context_tokens??0,max_output_tokens:o.max_output_tokens??0}),v.value=n):(f.value[t]??[]).includes(i)&&(s({name:i,display_name:i}),v.value=n)},columns:[{accessorKey:"name",header:e("admin.pages.models.columns.modelName"),cell:a=>{const l=a.getValue();if(!l)return"-";const s={key:"view",label:e("components.modelView.view")};return k("button",{class:"text-primary font-medium cursor-pointer text-left focus:outline-none focus:ring-2 focus:ring-primary/40 rounded-full bg-muted/30 hover:bg-muted/60 hover:underline px-2 py-0.5 transition-colors",type:"button",onClick:t=>{t.stopPropagation(),a.table.options.meta?.triggerRowAction?.(s,a.row.original)}},l)}},{accessorKey:"display_name",header:e("admin.pages.models.columns.displayName"),cell:a=>{const l=a.getValue();if(!l)return"-";const s={key:"view",label:e("components.modelView.view")};return k("button",{class:"text-primary font-medium cursor-pointer text-left focus:outline-none focus:ring-2 focus:ring-primary/40 rounded-full bg-muted/30 hover:bg-muted/60 hover:underline px-2 py-0.5 transition-colors",type:"button",onClick:t=>{t.stopPropagation(),a.table.options.meta?.triggerRowAction?.(s,a.row.original)}},l)}},{accessorKey:"provider_id",header:e("admin.pages.models.columns.provider"),cell:a=>{const l=a.getValue(),s=F.value[l];return s?s.display_name:l}},{accessorKey:"capabilities",header:e("admin.pages.models.columns.capabilities"),cell:a=>{const l=a.getValue()||[];return k("div",{class:"flex flex-wrap gap-1"},l.map(s=>{const t=N.value.find(r=>r.value===s);return k(j,{key:s,variant:"secondary",class:"text-xs"},()=>t?.label||s)}))}},{accessorKey:"created_at",header:e("admin.pages.models.columns.createdAt"),cell:a=>{const l=a.getValue();return new Date(l).toLocaleDateString()}}],detailFields:[{name:"id",label:e("admin.pages.models.detailFields.id"),type:"text"},{name:"name",label:e("admin.pages.models.detailFields.modelName"),type:"text"},{name:"display_name",label:e("admin.pages.models.detailFields.displayName"),type:"text"},{name:"provider_id",label:e("admin.pages.models.detailFields.provider"),type:"text",render:a=>F.value[a]?.display_name||a},{name:"description",label:e("admin.pages.models.detailFields.description"),type:"textarea"},{name:"capabilities",label:e("admin.pages.models.detailFields.capabilities"),type:"text",render:a=>!a||a.length===0?e("admin.pages.models.detailFields.capabilitiesNotSet"):a.map(l=>N.value.find(t=>t.value===l)?.label||l).join(", ")},{name:"generation_config",label:e("admin.pages.models.detailFields.generationConfig"),type:"json"},{name:"status",label:e("admin.pages.models.detailFields.status"),type:"text"},{name:"max_context_tokens",label:e("admin.pages.models.detailFields.maxContextTokens"),type:"text",render:a=>a?a.toLocaleString():e("admin.pages.models.detailFields.notSet")},{name:"max_output_tokens",label:e("admin.pages.models.detailFields.maxOutputTokens"),type:"text",render:a=>a?a.toLocaleString():e("admin.pages.models.detailFields.notSet")},{name:"created_at",label:e("admin.pages.models.detailFields.createdAt"),type:"datetime"}],formFields:[{name:"provider_id",label:e("admin.pages.models.formFields.provider"),type:"select",required:!0,options:S.value,placeholder:e("admin.pages.models.formFields.providerPlaceholder")},{name:"template_id",label:e("admin.pages.models.formFields.modelTemplate"),type:"select",required:!1,options:a=>{const l=a?.provider_id||"",s=l?F.value[l]:void 0,t=l?c.value[l]??[]:[],r=l?f.value[l]??[]:[],i=[];return i.push({label:e("admin.pages.models.formFields.noTemplate"),value:""}),s?.interface_type==="HUGGINGFACE"&&[...P.value].filter(o=>!t.some(A=>A.name===o)).forEach(o=>{i.push({label:`${e("admin.pages.models.hf.installedPrefix")}: ${o}`,value:o,group:"installed"})}),r.length>0&&s?.interface_type!=="HUGGINGFACE"?r.forEach(n=>{i.push({label:`${n}`,value:n,group:"discovered"})}):t.length>0&&t.forEach(n=>{const G=s?.interface_type==="HUGGINGFACE"&&P.value.has(n.name)?` (${e("admin.pages.models.hf.installedSuffix")})`:"";i.push({label:`${n.display_name} â€” ${n.name}${G}`,value:n.name,group:"catalog"})}),i},placeholder:e("admin.pages.models.formFields.modelTemplatePlaceholder"),help:e("admin.pages.models.formFields.modelTemplateHelp")},{name:"name",label:e("admin.pages.models.formFields.modelName"),type:"text",required:!0,placeholder:e("admin.pages.models.formFields.modelNamePlaceholder")},{name:"display_name",label:e("admin.pages.models.formFields.displayName"),type:"text",required:!0,placeholder:e("admin.pages.models.formFields.displayNamePlaceholder")},{name:"description",label:e("admin.pages.models.formFields.description"),type:"textarea",placeholder:e("admin.pages.models.formFields.descriptionPlaceholder")},{name:"capabilities",label:e("admin.pages.models.formFields.capabilities"),type:"multiselect",required:!0,options:N.value,placeholder:e("admin.pages.models.formFields.capabilitiesPlaceholder"),help:e("admin.pages.models.formFields.capabilitiesHelp")},{name:"generation_config",label:e("admin.pages.models.formFields.generationConfig"),type:"json",placeholder:e("admin.pages.models.formFields.generationConfigPlaceholder"),help:e("admin.pages.models.formFields.generationConfigHelp"),defaultValue:{}},{name:"max_context_tokens",label:e("admin.pages.models.formFields.maxContextTokens"),type:"number",placeholder:e("admin.pages.models.formFields.maxContextTokensPlaceholder"),help:e("admin.pages.models.formFields.maxContextTokensHelp")},{name:"max_output_tokens",label:e("admin.pages.models.formFields.maxOutputTokens"),type:"number",placeholder:e("admin.pages.models.formFields.maxOutputTokensPlaceholder"),help:e("admin.pages.models.formFields.maxOutputTokensHelp")},{name:"status",label:e("admin.pages.models.formFields.status"),type:"select",required:!0,options:[{label:e("admin.pages.models.formFields.statusActive"),value:"ACTIVE"},{label:e("admin.pages.models.formFields.statusInactive"),value:"INACTIVE"},{label:e("admin.pages.models.formFields.statusUnavailable"),value:"UNAVAILABLE"},{label:e("admin.pages.models.formFields.statusDeprecated"),value:"DEPRECATED"}],defaultValue:"ACTIVE"}]}));return(a,l)=>{const s=J;return W(),z(Z,null,[p(s,{config:L.value},{actions:u(()=>[...l[1]||(l[1]=[])]),_:1},8,["config"]),p(d(ne),{open:x.value,"onUpdate:open":l[0]||(l[0]=t=>x.value=t)},{default:u(()=>[p(d(ee),null,{default:u(()=>[p(d(ae),null,{default:u(()=>[p(d(le),null,{default:u(()=>[T(C(d(e)("admin.pages.models.hf.downloadTitle")),1)]),_:1}),p(d(te),null,{default:u(()=>[T(C(d(e)("admin.pages.models.hf.downloadDescription",{repo:w.value||""})),1)]),_:1})]),_:1}),p(d(se),null,{default:u(()=>[p(d(ie),null,{default:u(()=>[T(C(d(e)("common.cancel")),1)]),_:1}),p(d(oe),{onClick:U},{default:u(()=>[T(C(d(e)("admin.pages.models.hf.downloadAction")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["open"])],64)}}});export{Xe as default};
