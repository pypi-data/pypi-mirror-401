{"version":3,"file":"DtBwJrag.js","sources":["../../../../../../node_modules/svelte/src/internal/client/dom/blocks/branches.js","../../../../../../node_modules/svelte/src/internal/client/dom/blocks/if.js"],"sourcesContent":["/** @import { Effect, TemplateNode } from '#client' */\nimport { Batch, current_batch } from '../../reactivity/batch.js';\nimport {\n\tbranch,\n\tdestroy_effect,\n\tmove_effect,\n\tpause_effect,\n\tresume_effect\n} from '../../reactivity/effects.js';\nimport { hydrate_node, hydrating } from '../hydration.js';\nimport { create_text, should_defer_append } from '../operations.js';\n\n/**\n * @typedef {{ effect: Effect, fragment: DocumentFragment }} Branch\n */\n\n/**\n * @template Key\n */\nexport class BranchManager {\n\t/** @type {TemplateNode} */\n\tanchor;\n\n\t/** @type {Map<Batch, Key>} */\n\t#batches = new Map();\n\n\t/** @type {Map<Key, Effect>} */\n\t#onscreen = new Map();\n\n\t/** @type {Map<Key, Branch>} */\n\t#offscreen = new Map();\n\n\t/**\n\t * Whether to pause (i.e. outro) on change, or destroy immediately.\n\t * This is necessary for `<svelte:element>`\n\t */\n\t#transition = true;\n\n\t/**\n\t * @param {TemplateNode} anchor\n\t * @param {boolean} transition\n\t */\n\tconstructor(anchor, transition = true) {\n\t\tthis.anchor = anchor;\n\t\tthis.#transition = transition;\n\t}\n\n\t#commit = () => {\n\t\tvar batch = /** @type {Batch} */ (current_batch);\n\n\t\t// if this batch was made obsolete, bail\n\t\tif (!this.#batches.has(batch)) return;\n\n\t\tvar key = /** @type {Key} */ (this.#batches.get(batch));\n\n\t\tvar onscreen = this.#onscreen.get(key);\n\n\t\tif (onscreen) {\n\t\t\t// effect is already in the DOM â€” abort any current outro\n\t\t\tresume_effect(onscreen);\n\t\t} else {\n\t\t\t// effect is currently offscreen. put it in the DOM\n\t\t\tvar offscreen = this.#offscreen.get(key);\n\n\t\t\tif (offscreen) {\n\t\t\t\tthis.#onscreen.set(key, offscreen.effect);\n\t\t\t\tthis.#offscreen.delete(key);\n\n\t\t\t\t// remove the anchor...\n\t\t\t\t/** @type {TemplateNode} */ (offscreen.fragment.lastChild).remove();\n\n\t\t\t\t// ...and append the fragment\n\t\t\t\tthis.anchor.before(offscreen.fragment);\n\t\t\t\tonscreen = offscreen.effect;\n\t\t\t}\n\t\t}\n\n\t\tfor (const [b, k] of this.#batches) {\n\t\t\tthis.#batches.delete(b);\n\n\t\t\tif (b === batch) {\n\t\t\t\t// keep values for newer batches\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst offscreen = this.#offscreen.get(k);\n\n\t\t\tif (offscreen) {\n\t\t\t\t// for older batches, destroy offscreen effects\n\t\t\t\t// as they will never be committed\n\t\t\t\tdestroy_effect(offscreen.effect);\n\t\t\t\tthis.#offscreen.delete(k);\n\t\t\t}\n\t\t}\n\n\t\t// outro/destroy all onscreen effects...\n\t\tfor (const [k, effect] of this.#onscreen) {\n\t\t\t// ...except the one that was just committed\n\t\t\tif (k === key) continue;\n\n\t\t\tconst on_destroy = () => {\n\t\t\t\tconst keys = Array.from(this.#batches.values());\n\n\t\t\t\tif (keys.includes(k)) {\n\t\t\t\t\t// keep the effect offscreen, as another batch will need it\n\t\t\t\t\tvar fragment = document.createDocumentFragment();\n\t\t\t\t\tmove_effect(effect, fragment);\n\n\t\t\t\t\tfragment.append(create_text()); // TODO can we avoid this?\n\n\t\t\t\t\tthis.#offscreen.set(k, { effect, fragment });\n\t\t\t\t} else {\n\t\t\t\t\tdestroy_effect(effect);\n\t\t\t\t}\n\n\t\t\t\tthis.#onscreen.delete(k);\n\t\t\t};\n\n\t\t\tif (this.#transition || !onscreen) {\n\t\t\t\tpause_effect(effect, on_destroy, false);\n\t\t\t} else {\n\t\t\t\ton_destroy();\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t * @param {Batch} batch\n\t */\n\t#discard = (batch) => {\n\t\tthis.#batches.delete(batch);\n\n\t\tconst keys = Array.from(this.#batches.values());\n\n\t\tfor (const [k, branch] of this.#offscreen) {\n\t\t\tif (!keys.includes(k)) {\n\t\t\t\tdestroy_effect(branch.effect);\n\t\t\t\tthis.#offscreen.delete(k);\n\t\t\t}\n\t\t}\n\t};\n\n\t/**\n\t *\n\t * @param {any} key\n\t * @param {null | ((target: TemplateNode) => void)} fn\n\t */\n\tensure(key, fn) {\n\t\tvar batch = /** @type {Batch} */ (current_batch);\n\t\tvar defer = should_defer_append();\n\n\t\tif (fn && !this.#onscreen.has(key) && !this.#offscreen.has(key)) {\n\t\t\tif (defer) {\n\t\t\t\tvar fragment = document.createDocumentFragment();\n\t\t\t\tvar target = create_text();\n\n\t\t\t\tfragment.append(target);\n\n\t\t\t\tthis.#offscreen.set(key, {\n\t\t\t\t\teffect: branch(() => fn(target)),\n\t\t\t\t\tfragment\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.#onscreen.set(\n\t\t\t\t\tkey,\n\t\t\t\t\tbranch(() => fn(this.anchor))\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.#batches.set(batch, key);\n\n\t\tif (defer) {\n\t\t\tfor (const [k, effect] of this.#onscreen) {\n\t\t\t\tif (k === key) {\n\t\t\t\t\tbatch.skipped_effects.delete(effect);\n\t\t\t\t} else {\n\t\t\t\t\tbatch.skipped_effects.add(effect);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const [k, branch] of this.#offscreen) {\n\t\t\t\tif (k === key) {\n\t\t\t\t\tbatch.skipped_effects.delete(branch.effect);\n\t\t\t\t} else {\n\t\t\t\t\tbatch.skipped_effects.add(branch.effect);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbatch.oncommit(this.#commit);\n\t\t\tbatch.ondiscard(this.#discard);\n\t\t} else {\n\t\t\tif (hydrating) {\n\t\t\t\tthis.anchor = hydrate_node;\n\t\t\t}\n\n\t\t\tthis.#commit();\n\t\t}\n\t}\n}\n","/** @import { TemplateNode } from '#client' */\nimport { EFFECT_TRANSPARENT } from '#client/constants';\nimport {\n\thydrate_next,\n\thydrating,\n\tread_hydration_instruction,\n\tskip_nodes,\n\tset_hydrate_node,\n\tset_hydrating\n} from '../hydration.js';\nimport { block } from '../../reactivity/effects.js';\nimport { HYDRATION_START_ELSE } from '../../../../constants.js';\nimport { BranchManager } from './branches.js';\n\n// TODO reinstate https://github.com/sveltejs/svelte/pull/15250\n\n/**\n * @param {TemplateNode} node\n * @param {(branch: (fn: (anchor: Node) => void, flag?: boolean) => void) => void} fn\n * @param {boolean} [elseif] True if this is an `{:else if ...}` block rather than an `{#if ...}`, as that affects which transitions are considered 'local'\n * @returns {void}\n */\nexport function if_block(node, fn, elseif = false) {\n\tif (hydrating) {\n\t\thydrate_next();\n\t}\n\n\tvar branches = new BranchManager(node);\n\tvar flags = elseif ? EFFECT_TRANSPARENT : 0;\n\n\t/**\n\t * @param {boolean} condition,\n\t * @param {null | ((anchor: Node) => void)} fn\n\t */\n\tfunction update_branch(condition, fn) {\n\t\tif (hydrating) {\n\t\t\tconst is_else = read_hydration_instruction(node) === HYDRATION_START_ELSE;\n\n\t\t\tif (condition === is_else) {\n\t\t\t\t// Hydration mismatch: remove everything inside the anchor and start fresh.\n\t\t\t\t// This could happen with `{#if browser}...{/if}`, for example\n\t\t\t\tvar anchor = skip_nodes();\n\n\t\t\t\tset_hydrate_node(anchor);\n\t\t\t\tbranches.anchor = anchor;\n\n\t\t\t\tset_hydrating(false);\n\t\t\t\tbranches.ensure(condition, fn);\n\t\t\t\tset_hydrating(true);\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tbranches.ensure(condition, fn);\n\t}\n\n\tblock(() => {\n\t\tvar has_branch = false;\n\n\t\tfn((fn, flag = true) => {\n\t\t\thas_branch = true;\n\t\t\tupdate_branch(flag, fn);\n\t\t});\n\n\t\tif (!has_branch) {\n\t\t\tupdate_branch(false, null);\n\t\t}\n\t}, flags);\n}\n"],"names":["BranchManager","anchor","transition","__publicField","__privateAdd","_batches","_onscreen","_offscreen","_transition","_commit","batch","current_batch","__privateGet","key","onscreen","resume_effect","offscreen","b","k","destroy_effect","effect","on_destroy","fragment","move_effect","create_text","pause_effect","_discard","keys","branch","__privateSet","fn","defer","should_defer_append","target","hydrating","hydrate_node","if_block","node","elseif","hydrate_next","branches","flags","EFFECT_TRANSPARENT","update_branch","condition","is_else","read_hydration_instruction","HYDRATION_START_ELSE","skip_nodes","set_hydrate_node","set_hydrating","block","has_branch","flag"],"mappings":"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","x_google_ignoreList":[0,1]}