{"version":3,"file":"CiK9EZ13.js","sources":["../../../../../../src/lib/components/workspace/Prompts/PromptEditor.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { onMount, tick, getContext } from 'svelte';\n\n\timport Textarea from '$lib/components/common/Textarea.svelte';\n\timport { toast } from 'svelte-sonner';\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport AccessControl from '../common/AccessControl.svelte';\n\timport LockClosed from '$lib/components/icons/LockClosed.svelte';\n\timport AccessControlModal from '../common/AccessControlModal.svelte';\n\timport { user } from '$lib/stores';\n\timport { slugify } from '$lib/utils';\n\timport Spinner from '$lib/components/common/Spinner.svelte';\n\n\texport let onSubmit: Function;\n\texport let edit = false;\n\texport let prompt = null;\n\texport let clone = false;\n\texport let disabled = true;\n\n\tconst i18n = getContext('i18n');\n\n\tlet loading = false;\n\n\tlet title = '';\n\tlet command = '';\n\tlet content = '';\n\n\tlet accessControl = {};\n\n\tlet showAccessControlModal = false;\n\n\tlet hasManualEdit = false;\n\n\t$: if (!edit && !hasManualEdit) {\n\t\tcommand = title !== '' ? slugify(title) : '';\n\t}\n\n\t// Track manual edits\n\tfunction handleCommandInput(e: Event) {\n\t\thasManualEdit = true;\n\t}\n\n\tconst submitHandler = async () => {\n\t\tif (disabled) {\n\t\t\ttoast.error($i18n.t('You do not have permission to edit this prompt.'));\n\t\t\treturn;\n\t\t}\n\t\tloading = true;\n\n\t\tif (validateCommandString(command)) {\n\t\t\tawait onSubmit({\n\t\t\t\ttitle,\n\t\t\t\tcommand,\n\t\t\t\tcontent,\n\t\t\t\taccess_control: accessControl\n\t\t\t});\n\t\t} else {\n\t\t\ttoast.error(\n\t\t\t\t$i18n.t('Only alphanumeric characters and hyphens are allowed in the command string.')\n\t\t\t);\n\t\t}\n\n\t\tloading = false;\n\t};\n\n\tconst validateCommandString = (inputString) => {\n\t\t// Regular expression to match only alphanumeric characters, hyphen, and underscore\n\t\tconst regex = /^[a-zA-Z0-9-_]+$/;\n\n\t\t// Test the input string against the regular expression\n\t\treturn regex.test(inputString);\n\t};\n\n\tonMount(async () => {\n\t\tif (prompt) {\n\t\t\ttitle = prompt.title;\n\t\t\tawait tick();\n\n\t\t\tcommand = prompt.command.at(0) === '/' ? prompt.command.slice(1) : prompt.command;\n\t\t\tcontent = prompt.content;\n\n\t\t\taccessControl = prompt?.access_control === undefined ? {} : prompt?.access_control;\n\t\t}\n\t});\n</script>\n\n<AccessControlModal\n\tbind:show={showAccessControlModal}\n\tbind:accessControl\n\taccessRoles={['read', 'write']}\n\tshare={$user?.permissions?.sharing?.prompts || $user?.role === 'admin'}\n\tsharePublic={$user?.permissions?.sharing?.public_prompts || $user?.role === 'admin'}\n/>\n\n<div class=\"w-full max-h-full flex justify-center\">\n\t<form\n\t\tclass=\"flex flex-col w-full mb-10\"\n\t\ton:submit|preventDefault={() => {\n\t\t\tsubmitHandler();\n\t\t}}\n\t>\n\t\t<div class=\"my-2\">\n\t\t\t<Tooltip\n\t\t\t\tcontent={`${$i18n.t('Only alphanumeric characters and hyphens are allowed')} - ${$i18n.t(\n\t\t\t\t\t'Activate this command by typing \"/{{COMMAND}}\" to chat input.',\n\t\t\t\t\t{\n\t\t\t\t\t\tCOMMAND: command\n\t\t\t\t\t}\n\t\t\t\t)}`}\n\t\t\t\tplacement=\"bottom-start\"\n\t\t\t>\n\t\t\t\t<div class=\"flex flex-col w-full\">\n\t\t\t\t\t<div class=\"flex items-center\">\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass=\"text-2xl font-medium w-full bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Title')}\n\t\t\t\t\t\t\tbind:value={title}\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t{disabled}\n\t\t\t\t\t\t/>\n\n\t\t\t\t\t\t{#if disabled}\n\t\t\t\t\t\t\t<div class=\"text-xs shrink-0 text-gray-500\">\n\t\t\t\t\t\t\t\t{$i18n.t('Read Only')}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<div class=\"self-center shrink-0\">\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"bg-gray-50 hover:bg-gray-100 text-black dark:bg-gray-850 dark:hover:bg-gray-800 dark:text-white transition px-2 py-1 rounded-full flex gap-1 items-center\"\n\t\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\tshowAccessControlModal = true;\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<LockClosed strokeWidth=\"2.5\" className=\"size-3.5\" />\n\n\t\t\t\t\t\t\t\t\t<div class=\"text-sm font-medium shrink-0\">\n\t\t\t\t\t\t\t\t\t\t{$i18n.t('Access')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class=\"flex gap-0.5 items-center text-xs text-gray-500\">\n\t\t\t\t\t\t<div class=\"\">/</div>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tclass=\" w-full bg-transparent outline-hidden\"\n\t\t\t\t\t\t\tplaceholder={$i18n.t('Command')}\n\t\t\t\t\t\t\tbind:value={command}\n\t\t\t\t\t\t\ton:input={handleCommandInput}\n\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\tdisabled={edit || disabled}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Tooltip>\n\t\t</div>\n\n\t\t<div class=\"my-2\">\n\t\t\t<div class=\"flex w-full justify-between\">\n\t\t\t\t<div class=\" self-center text-sm font-medium\">{$i18n.t('Prompt Content')}</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"mt-2\">\n\t\t\t\t<div>\n\t\t\t\t\t<Textarea\n\t\t\t\t\t\tclassName=\"text-sm w-full bg-transparent outline-hidden overflow-y-hidden resize-none\"\n\t\t\t\t\t\tplaceholder={$i18n.t('Write a summary in 50 words that summarizes {{topic}}.')}\n\t\t\t\t\t\tbind:value={content}\n\t\t\t\t\t\trows={6}\n\t\t\t\t\t\trequired\n\t\t\t\t\t\treadonly={disabled}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"text-xs text-gray-400 dark:text-gray-500\">\n\t\t\t\t\tâ“˜ {$i18n.t('Format your variables using brackets like this:')}&nbsp;<span\n\t\t\t\t\t\tclass=\" text-gray-600 dark:text-gray-300 font-medium\"\n\t\t\t\t\t\t>{'{{'}{$i18n.t('variable')}{'}}'}</span\n\t\t\t\t\t>.\n\t\t\t\t\t{$i18n.t('Make sure to enclose them with')}\n\t\t\t\t\t<span class=\" text-gray-600 dark:text-gray-300 font-medium\">{'{{'}</span>\n\t\t\t\t\t{$i18n.t('and')}\n\t\t\t\t\t<span class=\" text-gray-600 dark:text-gray-300 font-medium\">{'}}'}</span>.\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"text-xs text-gray-400 dark:text-gray-500 underline\">\n\t\t\t\t\t<a href=\"https://docs.openwebui.com/features/workspace/prompts\" target=\"_blank\">\n\t\t\t\t\t\t{$i18n.t('To learn more about powerful prompt variables, click here')}\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"my-4 flex justify-end pb-20\">\n\t\t\t<Tooltip content={disabled ? $i18n.t('You do not have permission to save this prompt.') : ''}>\n\t\t\t\t<button\n\t\t\t\t\tclass=\" text-sm w-full lg:w-fit px-4 py-2 transition rounded-xl {loading || disabled\n\t\t\t\t\t\t? ' cursor-not-allowed bg-gray-200 text-gray-500 dark:bg-gray-700 dark:text-gray-400'\n\t\t\t\t\t\t: 'bg-black hover:bg-gray-900 text-white dark:bg-white dark:hover:bg-gray-100 dark:text-black'} flex w-full justify-center\"\n\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\tdisabled={loading || disabled}\n\t\t\t\t>\n\t\t\t\t\t<div class=\" self-center font-medium\">{$i18n.t('Save & Create')}</div>\n\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t<div class=\"ml-1.5 self-center\">\n\t\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</button>\n\t\t\t</Tooltip>\n\t\t</div>\n\t</form>\n</div>\n"],"names":["onSubmit","$.prop","$$props","edit","prompt","disabled","i18n","getContext","loading","title","command","content","accessControl","$.mutable_source","showAccessControlModal","hasManualEdit","handleCommandInput","e","$.set","submitHandler","toast","$i18n","validateCommandString","$.get","inputString","onMount","tick","_a","_b","slugify","_c","$user","_d","$$value","$.untrack","$.event","button","$$render","consequent","alternate","input_1","$.bind_value","input","consequent_1","$.set_class","button_1","form","$.preventDefault"],"mappings":"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"}