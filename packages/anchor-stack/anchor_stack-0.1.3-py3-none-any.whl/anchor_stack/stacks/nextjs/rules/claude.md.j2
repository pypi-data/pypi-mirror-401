# {{ app_name | pascal_case }} - Project Rules

> **Generated by Anchor Stack v{{ stack_version }}** | Stack: Next.js {{ dependencies.next }} + React {{ dependencies.react }}

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

æœ¬é¡¹ç›®éµå¾ª **Anchor Stack** è§„èŒƒï¼Œç¡®ä¿ AI è¾…åŠ©å¼€å‘çš„å¯ç»´æŠ¤æ€§å’Œä¸€è‡´æ€§ã€‚

---

## ğŸš¨ ç¦æ­¢äº‹é¡¹ (NEVER DO)

| âŒ ç¦æ­¢ | âœ… æ­£ç¡®åšæ³• |
|--------|------------|
| `console.log()` | `logger.info()` / `logger.error()` |
| `process.env.XXX` | `config.appName` / `getServerConfig()` |
| ä¿®æ”¹ `src/lib/core/*` | è¿™äº›æ˜¯æ¡†æ¶æ ¸å¿ƒæ–‡ä»¶ |
| åˆ é™¤ `anchor.config.json` | è¿™æ˜¯é¡¹ç›®å…ƒæ•°æ® |
| ç¡¬ç¼–ç é…ç½®å€¼ | ä½¿ç”¨ config å¯¹è±¡ |

---

## ğŸ“ æ—¥å¿—è§„èŒƒ

### å¯¼å…¥æ–¹å¼
```typescript
import { logger } from '@/lib/core/logger';
```

### ä½¿ç”¨ç¤ºä¾‹
```typescript
// âœ… æ­£ç¡® - ç»“æ„åŒ–æ—¥å¿—ï¼Œå¸¦ä¸Šä¸‹æ–‡
logger.info('User logged in', { userId: 123, ip: '192.168.1.1' });
logger.error('Payment failed', { orderId: 'ORD-001', error: err.message });
logger.warn('Rate limit approaching', { current: 95, limit: 100 });
logger.debug('Cache hit', { key: 'user:123', ttl: 300 });

// âŒ é”™è¯¯ - ä¸è¦è¿™æ ·åš
console.log('User logged in');              // ç¦æ­¢ä½¿ç”¨ console.log
console.error('Payment failed');            // ç¦æ­¢ä½¿ç”¨ console.error
logger.info(`User ${userId} logged in`);    // é¿å…æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œç”¨å¯¹è±¡
```

### æ—¥å¿—çº§åˆ«é€‰æ‹©
| çº§åˆ« | ä½¿ç”¨åœºæ™¯ |
|------|---------|
| `debug` | å¼€å‘è°ƒè¯•ä¿¡æ¯ |
| `info` | æ­£å¸¸ä¸šåŠ¡æ“ä½œï¼ˆç”¨æˆ·ç™»å½•ã€è®¢å•åˆ›å»ºï¼‰|
| `warn` | å¼‚å¸¸ä½†å¯æ¢å¤çš„æƒ…å†µ |
| `error` | é”™è¯¯ï¼Œéœ€è¦å…³æ³¨ |

### ä½•æ—¶æ·»åŠ æ—¥å¿—
- API è¯·æ±‚å¼€å§‹å’Œç»“æŸ
- æ•°æ®åº“æ“ä½œï¼ˆæŸ¥è¯¢ã€å†™å…¥ï¼‰
- å¤–éƒ¨æœåŠ¡è°ƒç”¨
- è®¤è¯/æˆæƒäº‹ä»¶
- ä¸šåŠ¡çŠ¶æ€å˜æ›´

---

## âš™ï¸ é…ç½®è§„èŒƒ

### å¯¼å…¥æ–¹å¼
```typescript
import { config, getServerConfig } from '@/lib/core/config';
```

### ä½¿ç”¨ç¤ºä¾‹
```typescript
// âœ… æ­£ç¡® - å®¢æˆ·ç«¯é…ç½® (å¯åœ¨æµè§ˆå™¨ä½¿ç”¨)
const appName = config.appName;
const isProduction = config.isProduction;

// âœ… æ­£ç¡® - æœåŠ¡ç«¯é…ç½® (ä»…é™ Server Components / API Routes)
const serverConfig = getServerConfig();
const apiKey = serverConfig.apiKey;
const databaseUrl = serverConfig.databaseUrl;

// âŒ é”™è¯¯ - ä¸è¦ç›´æ¥è®¿é—® process.env
const bad = process.env.API_KEY;           // ç¦æ­¢
const alsoBad = process.env.DATABASE_URL;  // ç¦æ­¢
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
src/
â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”œâ”€â”€ page.tsx              # é¦–é¡µ
â”‚   â”œâ”€â”€ layout.tsx            # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ api/                  # API è·¯ç”±
â”‚   â”‚   â””â”€â”€ health/route.ts   # å¥åº·æ£€æŸ¥
â”‚   â””â”€â”€ [å…¶ä»–è·¯ç”±]/page.tsx
â”‚
â”œâ”€â”€ components/               # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                   # UI åŸºç¡€ç»„ä»¶
â”‚   â””â”€â”€ [ä¸šåŠ¡ç»„ä»¶].tsx
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ core/                 # âš ï¸ æ ¸å¿ƒæ¨¡å— - è¯·å‹¿ä¿®æ”¹
â”‚   â”‚   â”œâ”€â”€ config.ts         # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ logger.ts         # æ—¥å¿—æ¡†æ¶
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ api-response.ts   # API å“åº”åŠ©æ‰‹
â”‚
â”œâ”€â”€ services/                 # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â””â”€â”€ [æ¨¡å—]-service.ts
â”‚
â””â”€â”€ types/                    # TypeScript ç±»å‹å®šä¹‰
    â””â”€â”€ index.ts
```

---

## ğŸ”§ æ–°å¢åŠŸèƒ½æŒ‡å—

### æ–°å¢é¡µé¢

**æ­¥éª¤**: åˆ›å»º `src/app/[è·¯ç”±]/page.tsx`

```typescript
// src/app/about/page.tsx
import { logger } from '@/lib/core/logger';

export default function AboutPage() {
  logger.info('About page rendered');

  return (
    <main>
      <h1>About Us</h1>
    </main>
  );
}
```

### æ–°å¢ API ç«¯ç‚¹

**æ­¥éª¤**: åˆ›å»º `src/app/api/[è·¯ç”±]/route.ts`

```typescript
// src/app/api/users/route.ts
import { NextRequest, NextResponse } from 'next/server';
import { logger } from '@/lib/core/logger';
import { apiSuccess, apiError } from '@/lib/utils/api-response';

export async function GET(request: NextRequest) {
  logger.info('GET /api/users');

  try {
    const users = []; // TODO: ä»æ•°æ®åº“è·å–
    return apiSuccess({ users });
  } catch (error) {
    logger.error('Failed to fetch users', { error: String(error) });
    return apiError('Failed to fetch users', 500);
  }
}

export async function POST(request: NextRequest) {
  logger.info('POST /api/users');

  try {
    const body = await request.json();
    logger.info('Creating user', { email: body.email });

    // TODO: ä¿å­˜åˆ°æ•°æ®åº“
    return apiSuccess({ user: { id: 1, ...body } }, 201);
  } catch (error) {
    logger.error('Failed to create user', { error: String(error) });
    return apiError('Failed to create user', 500);
  }
}
```

### æ–°å¢ç»„ä»¶

**æ­¥éª¤ 1**: åˆ›å»ºç»„ä»¶ `src/components/[ç»„ä»¶å].tsx`

```typescript
// src/components/user-card.tsx
interface UserCardProps {
  name: string;
  email: string;
  avatar?: string;
}

export function UserCard({ name, email, avatar }: UserCardProps) {
  return (
    <div className="p-4 border rounded-lg">
      <h3 className="font-bold">{name}</h3>
      <p className="text-gray-600">{email}</p>
    </div>
  );
}
```

**æ­¥éª¤ 2**: å¯¼å‡ºç»„ä»¶ `src/components/index.ts`

```typescript
export { UserCard } from './user-card';
```

### æ–°å¢ Service å±‚

å¤æ‚ä¸šåŠ¡é€»è¾‘åº”æ”¾åœ¨ `services/` ç›®å½•:

```typescript
// src/services/user-service.ts
import { logger } from '@/lib/core/logger';

export class UserService {
  async createUser(data: { email: string; name: string }) {
    logger.info('Creating user in service', { email: data.email });
    // ä¸šåŠ¡é€»è¾‘...
    return { id: 1, ...data };
  }

  async getUserById(id: number) {
    logger.info('Getting user', { id });
    // ä¸šåŠ¡é€»è¾‘...
    return null;
  }
}

export const userService = new UserService();
```

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

### API è·¯ç”±ä¸­çš„é”™è¯¯å¤„ç†
```typescript
import { apiError, apiSuccess } from '@/lib/utils/api-response';
import { logger } from '@/lib/core/logger';

export async function GET(request: NextRequest) {
  try {
    const data = await fetchData();
    return apiSuccess(data);
  } catch (error) {
    logger.error('Operation failed', { error: String(error) });

    // æ ¹æ®é”™è¯¯ç±»å‹è¿”å›ä¸åŒçŠ¶æ€ç 
    if (error instanceof NotFoundError) {
      return apiError('Resource not found', 404);
    }
    if (error instanceof ValidationError) {
      return apiError(error.message, 400);
    }
    return apiError('Internal server error', 500);
  }
}
```

---

## ğŸ§ª æµ‹è¯•è§„èŒƒ

æ¨èä½¿ç”¨ Vitest æˆ– Jest:

```typescript
// __tests__/api/users.test.ts
import { GET, POST } from '@/app/api/users/route';

describe('/api/users', () => {
  it('should return empty array', async () => {
    const response = await GET(new Request('http://localhost/api/users'));
    const data = await response.json();

    expect(response.status).toBe(200);
    expect(data.success).toBe(true);
  });
});
```

---

## ğŸ“‹ å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘æœåŠ¡å™¨
npm run dev

# æ„å»º
npm run build

# ç”Ÿäº§è¿è¡Œ
npm run start

# ä»£ç æ£€æŸ¥
npm run lint
```

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `CLAUDE.md` | Claude Code è§„åˆ™ (æœ¬æ–‡ä»¶) |
| `.cursor/rules/` | Cursor IDE è§„åˆ™ |
| `.windsurfrules` | Windsurf è§„åˆ™ |
| `anchor.config.json` | Anchor Stack é¡¹ç›®é…ç½® |
