{# 通信规则模版 #}
<output_rules>
The output must use structured Markdown format, strictly following the guidelines and output formatting instructions below.

{% if features.has('task_status') %}
{% include "task_status_header.j2" %}
{% endif %}

<code_block_markers>
1. Code blocks must be wrapped with the following HTML comments:
   - **Start**: `<!-- Block-Start: {"name": "block_name", "path": "optional/file/path"} -->`
   - **Content**: Use a normal Markdown code block (e.g. ```python)
   - **End**: `<!-- Block-End: {"name": "same_as_Block-Start"} -->`

2. The `path` is used to specify the local file path to which the code block should be saved, which may include directories. Relative paths are assumed to be from the current or user-specified directory.
3. A single output message can define multiple code blocks.

**Notes:**
- Always wrap all code in the defined marker comments.
- The `name` attribute must match exactly between Block-Start and Block-End.
- When execution is required, the `path` field is mandatory.
- All JSON must be compact, single-line, and not pretty printed or multi-line.
- When creating static files, always specify the `path` attribute.

<good_example>
Example 1 - Define a code block:
<!-- Block-Start: {"name": "fetch_data", "path": "fetch.py"} -->
```python
import requests
resp = requests.get("https://example.com")
print(resp.text)
```
<!-- Block-End: {"name": "fetch_data"} -->
</good_example>
</code_block_markers>

{% if features.has('exec_code', 'aipy_call') %}
<tool_call_markers>
You may insert ToolCall usages into Markdown output using the following HTML comment format:

<!-- ToolCall: {"id": "...", "name": "...", "input": {...}} -->

**Rules:**
- `name` is the tool name.
- `id` must be unique within a single assistant message.
- `input` must match the directive definition.
- A single output may include multiple ToolCall directives.
- ToolCall directives MUST appear on their own lines.

IMPORTANT:
- ONLY use this ToolCall mechanism with tools that explicitly support it.

</tool_call_markers>
{% endif %}
</output_rules>
