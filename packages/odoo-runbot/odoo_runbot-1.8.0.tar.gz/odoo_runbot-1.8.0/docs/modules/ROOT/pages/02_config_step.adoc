= Step de test

Une `step` reprÃ©sente une Ã©tape du `runbot`.
Elles seront jouÃ©e les unes aprÃ¨s les autres. +

IMPORTANT: Le runbot s'arrete dÃ¨s qu'une `step` est en echec.

== Champs possibles
Dans chaque `step` vous pouvez prÃ©ciser les attributs suivants :

|===
| name | Type Toml | Par dÃ©faut

| modules | https://toml.io/en/v1.0.0#array[liste] de https://toml.io/en/v1.0.0#string[string] | *Obligatoire* ou ceux de la xref:01_config_global.adoc[]
| action | `"tests"` ou `"install"` | `"tests"`
| test_tags | https://toml.io/en/v1.0.0#array[liste] de https://toml.io/en/v1.0.0#string[string] | `[]`
| coverage | https://toml.io/en/v1.0.0#boolean[boolean] | `true`
| log_filters | https://toml.io/en/v1.0.0#array-of-tables[liste de Log Filter] | `[]`
|===

NOTE: Les champs sont Ã  dÃ©clarer aprÃ¨s la section `[tool.runbot.step.name]` ou `step.name`.

== Le nom

Le nom de la `step` se trouve directement dans la dÃ©claration de la section.
En thÃ©orie, tous les formats sont acceptÃ©s. Mais il ne faut pas non plus Ãªtre fantaisiste.

NOTE: Si vous voulez mettre des caractÃ¨res spÃ©ciaux ou des espaces, vous devez alors mettre des `"`.

.Nom de `step` valide
[tabs]
======
pyproject.toml::
+
====
[,toml]
----
[tool.runbot.step.step1] # <1>
[tool.runbot.step."My Awsome Step"] # <1>
[tool.runbot.step."Step with ğŸ”¥"] # <1>
----
====

runbot.toml::
+
====
[,toml]
----
[step.step1] # <1>
[step."My Awsome Step"] # <1>
[step."Step with ğŸ”¥"] # <1>
----
====
======

== L'action

Une `step` peut faire l'une des actions suivantes :

`install` ou `warmup`:: Installer un ou plusieurs modules sans Ã©xÃ©cuter les tests.
`tests` ou n'importe qu'elle valeur:: Tester un ou plusieurs modules.

Vous pouvez paramÃ©trer l'action via l'attribut `action` de chaque `step`.

[[default_act_by_name]]
=== Convention
Si votre `step` s'appelle `install` ou `warmup`, alors l'action sera forcÃ©ment `install`.

[tabs]
======
pyproject.toml::
+
====
[,toml]
----
[tool.runbot.step.install] # <1>
modules = ["sale"]
[tool.runbot.step.warmup] # <1>
modules = ["sale"]
action = "tests" # <2>
----
<1> Nom utilisant la convention
<2> Essai de forcer la valeur
====

runbot.toml::
+
====
[,toml]
----
[step.install] # <1>
modules = ["sale"]
[step.warmup] # <1>
modules = ["sale"]
action = "tests" # <2>
----
<1> Nom utilisant la convention
<2> Essai de forcer la valeur
====

result.toml::
+
====
[,toml]
----
[step.install] # <1>
modules = ["sale"]
action = "install" # <2>

[step.warmup] # <1>
modules = ["sale"]
action = "install" # <2>
----
<1> Nom utilisant la convention
<2> L'action est forcÃ© Ã  `install`
====
======

[[default_step]]
== Step par dÃ©faut

Si aucune dÃ©claration d'Ã©tape n'existe, une par dÃ©faut sera crÃ©Ã©e Ã  partir de valeur de l'entÃªte.

[tabs]
======
pyproject.toml::
+
====
[,toml]
----
include::partial$sample_config/pyproject_minimal.toml[]
----
<1> Configuration d'entÃªte
<2> Le nom du module Ã  installer et tester
====

runbot.toml::
+
====
[,toml]
----
include::partial$sample_config/custom_minimal.toml[]
----
<1> Le nom du module Ã  installer et tester
====

result.toml::
+
====
[,toml]
----
[tool.runbot]
[tool.runbot.step.default] # <1>
modules = ["module_to_test"] # <2>
action = "tests"
log-filters = []
----
<1> Reprends les valeurs de la section `tool.runbot`
<2> Le nom du module Ã  installer et tester
====
======


== Ordre d'Ã©xÃ©cution

Elles sont exÃ©cutÃ©es dans l'ordre de dÃ©claration dans le fichier `toml`
[tabs]
======
pyproject.toml::
+
====
[,toml]
----
[tool.runbot]
modules = ["sale"]

[tool.runbot.step.step2]
name = "Step number 2"

[tool.runbot.step.step1]
name = "Step number 1"
----
====

runbot.toml::
+
====
[,toml]
----
modules = ["sale"]
[step.step2]
name = "Step number 2"
[step.step1]
name = "Step number 1"
----
====

output::
+
====
[,shell]
----
$ odoo-runbot diag
...blabla
                                         Steps
â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Step    â”ƒ Module â”ƒ Run tests â”ƒ Activate Coverage â”ƒ Tags to test â”ƒ Logger filter â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ step2   â”‚ sale   â”‚ TESTS     â”‚ âœ”                 â”‚              â”‚               â”‚ <1>
â”‚ step1   â”‚ sale   â”‚ TESTS     â”‚ âœ”                 â”‚              â”‚               â”‚ <2>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
----
<1> C'est bien la `step` "step2" qui sera exÃ©cutÃ©e en premiÃ¨re
<2> Puis la `step` "step1"
====
======

== Calcul de la couverture de test
Vous pouvez paramÃ©ter coverage via un fichier `.coveragerc` Ã  la racine du projet, soit en utilisant le fichier `pyproject.toml` dans la section `[tool.coverage]`. Se rÃ©fÃ©rer Ã  la https://coverage.readthedocs.io/en/7.13.1/[doc].
