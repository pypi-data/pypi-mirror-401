"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[1664],{1664:function(e,n,t){t.d(n,{p:function(){return D},V:function(){return A}});var i=t(68248),o=t(46709),r=t(27757),d=t(82716),s=t(79081),a=t(98332),l=t(7655),c=t(40724),m=t(884),u=t(27151),p=t(35583),g=t(93422),h=t(73716),f=t(75329),v=t(73408);var x={name:"1wjtvq0",styles:"flex-grow:1;min-width:0"};const w=({title:e,titleWidth:n=200,children:t,hideDivider:o=!1,className:d})=>{const{theme:s}=(0,r.u)();return(0,v.FD)("div",{className:d,css:(0,i.AH)({display:"flex",gap:32,paddingTop:s.spacing.lg,paddingBottom:s.spacing.lg,borderBottom:o?"none":`1px solid ${s.colors.borderDecorative}`,"@media (max-width: 1023px)":{flexDirection:"column",gap:s.spacing.md}},""),children:[(0,v.Y)("div",{css:(0,i.AH)({flexShrink:0,width:n,"@media (max-width: 1023px)":{width:"100%"}},""),children:(0,v.Y)("span",{css:(0,i.AH)({fontWeight:s.typography.typographyBoldFontWeight,fontSize:s.typography.fontSizeLg},""),children:e})}),(0,v.Y)("div",{css:x,children:t})]})};var S=t(6459),y=t(6420);var M={name:"9e0cr4",styles:"flex-grow:1;max-width:900px;min-width:0;@media (max-width: 1023px){max-width:100%;}"},Y={name:"1w2agvp",styles:"flex-shrink:0;width:360px;position:sticky;top:0;align-self:flex-start;@media (max-width: 1023px){width:100%;position:static;}"};const A=({mode:e,isSubmitting:n,error:t,errorMessage:x,resetErrors:y,selectedModel:A,isFormComplete:b,hasChanges:_=!0,onSubmit:I,onCancel:D,onNameBlur:N,componentIdPrefix:T=`mlflow.gateway.${e}-endpoint`,embedded:k=!1})=>{const{theme:H}=(0,r.u)(),$=(0,l.A)(),B=(0,m.xW)(),V=B.watch("provider"),E=B.watch("modelName"),P=B.watch("secretMode"),L=B.watch("existingSecretId"),q=B.watch("newSecret"),{existingSecrets:z,isLoadingSecrets:W,authModes:j,defaultAuthMode:G,isLoadingProviderConfig:Q}=(0,h.t)({provider:V}),U=(0,o.useMemo)(()=>({mode:P,existingSecretId:L,newSecret:q}),[P,L,q]),R=(0,o.useCallback)(e=>{e.mode!==P&&B.setValue("secretMode",e.mode),e.existingSecretId!==L&&B.setValue("existingSecretId",e.existingSecretId),e.newSecret!==q&&B.setValue("newSecret",e.newSecret)},[B,P,L,q]),O="edit"===e?!b||!_:!b,Z=b?"edit"!==e||_?void 0:$.formatMessage({id:"eANdPU",defaultMessage:"No changes to save"}):$.formatMessage({id:"2vjNq9",defaultMessage:"Please complete all required fields"});return(0,v.FD)(v.FK,{children:[t&&(0,v.Y)("div",{css:(0,i.AH)({padding:k?0:`0 ${H.spacing.md}px`},""),children:(0,v.Y)(d.Alert,{componentId:`${T}.error`,closable:!1,message:x,type:"error",css:(0,i.AH)({marginBottom:H.spacing.md},"")})}),(0,v.FD)("div",{css:(0,i.AH)({flex:1,display:"flex",gap:H.spacing.md,padding:k?0:`0 ${H.spacing.md}px`,overflow:"auto","@media (max-width: 1023px)":{flexDirection:"column"}},""),children:[(0,v.FD)("div",{css:M,children:[(0,v.Y)(w,{titleWidth:200,title:$.formatMessage({id:"GbEHyg",defaultMessage:"Name"}),css:k?{paddingTop:0}:void 0,children:(0,v.Y)(m.xI,{control:B.control,name:"name",rules:{required:"Name is required"},render:({field:e,fieldState:n})=>(0,v.FD)("div",{children:[(0,v.Y)(a.f,{id:`${T}.name`,componentId:`${T}.name`,...e,onChange:n=>{e.onChange(n),B.clearErrors("name"),y()},onBlur:()=>{e.onBlur(),N()},placeholder:$.formatMessage({id:"AanBxl",defaultMessage:"my-endpoint"}),validationState:n.error?"error":void 0}),n.error&&(0,v.Y)(d.FormUI.Message,{type:"error",message:n.error.message})]})})}),(0,v.Y)(w,{titleWidth:200,title:$.formatMessage({id:"olpQcl",defaultMessage:"Model"}),hideDivider:!0,children:(0,v.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:H.spacing.md},""),children:[(0,v.Y)(m.xI,{control:B.control,name:"provider",rules:{required:"Provider is required"},render:({field:e,fieldState:n})=>{var t;return(0,v.Y)(u.U,{value:e.value,onChange:n=>{e.onChange(n),B.setValue("modelName",""),B.setValue("existingSecretId",""),B.setValue("secretMode","new"),B.setValue("newSecret",{name:"",authMode:"",secretFields:{},configFields:{}})},error:null===(t=n.error)||void 0===t?void 0:t.message,componentIdPrefix:`${T}.provider`})}}),(0,v.Y)(m.xI,{control:B.control,name:"modelName",rules:{required:"Model is required"},render:({field:e,fieldState:n})=>{var t;return(0,v.Y)(p.o,{provider:V,value:e.value,onChange:e.onChange,error:null===(t=n.error)||void 0===t?void 0:t.message,componentIdPrefix:`${T}.model`})}}),V&&(0,v.FD)("div",{css:(0,i.AH)({marginTop:H.spacing.sm},""),children:[(0,v.Y)(r.T.Text,{bold:!0,css:(0,i.AH)({display:"block",marginBottom:H.spacing.sm},""),children:(0,v.Y)(c.A,{id:"PRwILA",defaultMessage:"Connections"})}),(0,v.Y)(g.$,{value:U,onChange:R,provider:V,existingSecrets:z,isLoadingSecrets:W,authModes:j,defaultAuthMode:G,isLoadingProviderConfig:Q,componentIdPrefix:`${T}.api-key`})]})]})})]}),(0,v.Y)("div",{css:Y,children:(0,v.Y)(S.v,{title:$.formatMessage({id:"mi7FdJ",defaultMessage:"Summary"}),children:(0,v.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:H.spacing.md},""),children:[(0,v.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:H.spacing.xs},""),children:[(0,v.Y)(r.T.Text,{bold:!0,color:"secondary",children:(0,v.Y)(c.A,{id:"a3G5A7",defaultMessage:"Provider"})}),V?(0,v.Y)(r.T.Text,{children:(0,f.aU)(V)}):(0,v.Y)(r.T.Text,{color:"secondary",children:(0,v.Y)(c.A,{id:"QnZkGt",defaultMessage:"Not configured"})})]}),(0,v.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:H.spacing.xs},""),children:[(0,v.Y)(r.T.Text,{bold:!0,color:"secondary",children:(0,v.Y)(c.A,{id:"7pkOrA",defaultMessage:"Model"})}),E?(0,v.Y)(F,{model:A,modelName:E}):(0,v.Y)(r.T.Text,{color:"secondary",children:(0,v.Y)(c.A,{id:"QnZkGt",defaultMessage:"Not configured"})})]}),(0,v.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:H.spacing.xs},""),children:[(0,v.Y)(r.T.Text,{bold:!0,color:"secondary",children:(0,v.Y)(c.A,{id:"gqFQc3",defaultMessage:"API Key"})}),(0,v.Y)(C,{secretMode:P,newSecretName:null===q||void 0===q?void 0:q.name,existingSecretId:L,existingSecrets:z})]})]})})})]}),(0,v.FD)("div",{css:(0,i.AH)({display:"flex",justifyContent:"flex-end",gap:H.spacing.sm,padding:k?`${H.spacing.md}px 0 0 0`:H.spacing.md,borderTop:`1px solid ${H.colors.border}`,flexShrink:0},""),children:[(0,v.Y)(r.B,{componentId:`${T}.cancel`,onClick:D,children:(0,v.Y)(c.A,{id:"qz9XeG",defaultMessage:"Cancel"})}),(0,v.Y)(s.T,{componentId:`${T}.submit-tooltip`,content:Z,children:(0,v.Y)(r.B,{componentId:`${T}.submit`,type:"primary",onClick:B.handleSubmit(I),loading:n,disabled:O,children:"create"===e?(0,v.Y)(c.A,{id:"c4METn",defaultMessage:"Create"}):(0,v.Y)(c.A,{id:"NVDxng",defaultMessage:"Save changes"})})})]})]})},F=({model:e,modelName:n})=>{const{theme:t}=(0,r.u)(),o=(0,l.A)(),d=[];null!==e&&void 0!==e&&e.supports_function_calling&&d.push("Tools"),null!==e&&void 0!==e&&e.supports_reasoning&&d.push("Reasoning");const s=(0,y._y)(null===e||void 0===e?void 0:e.max_input_tokens),a=(0,y.BD)(null===e||void 0===e?void 0:e.input_cost_per_token),c=(0,y.BD)(null===e||void 0===e?void 0:e.output_cost_per_token);return(0,v.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,minWidth:0,maxWidth:"100%"},""),children:[(0,v.Y)(r.T.Text,{bold:!0,css:(0,i.AH)({fontSize:t.typography.fontSizeSm,wordBreak:"break-all",overflowWrap:"anywhere"},""),children:n}),d.length>0&&(0,v.Y)(r.T.Text,{color:"secondary",css:(0,i.AH)({fontSize:t.typography.fontSizeSm,marginLeft:t.spacing.sm},""),children:d.join(", ")}),e&&(s||a||c)&&(0,v.FD)("div",{css:(0,i.AH)({display:"flex",flexDirection:"column",gap:2,marginLeft:t.spacing.sm,fontSize:t.typography.fontSizeSm,color:t.colors.textSecondary},""),children:[s&&(0,v.Y)("span",{children:o.formatMessage({id:"HFavpn",defaultMessage:"Max input: {tokens}"},{tokens:s})}),(a||c)&&(0,v.Y)("span",{children:o.formatMessage({id:"WFEeyZ",defaultMessage:"Cost: {input} in / {output} out"},{input:null!==a&&void 0!==a?a:"-",output:null!==c&&void 0!==c?c:"-"})})]})]})},C=({secretMode:e,newSecretName:n,existingSecretId:t,existingSecrets:i})=>{var o;const d="new"===e?n:null===i||void 0===i||null===(o=i.find(e=>e.secret_id===t))||void 0===o?void 0:o.secret_name;return d?(0,v.Y)(r.T.Text,{children:d}):(0,v.Y)(r.T.Text,{color:"secondary",children:(0,v.Y)(c.A,{id:"QnZkGt",defaultMessage:"Not configured"})})};var b=t(71952),_=t(85344);var I={name:"7lphdr",styles:"width:100% !important"};const D=({open:e,onClose:n,onSuccess:t})=>{const i=(0,l.A)(),{form:o,isLoading:r,error:d,resetErrors:a,selectedModel:c,isFormComplete:u,handleSubmit:p,handleCancel:g,handleNameBlur:h}=(0,b.F)({onSuccess:e=>{o.reset(),null===t||void 0===t||t(e),n()},onCancel:()=>{o.reset(),a(),n()}});return(0,v.Y)(s.d,{componentId:"mlflow.gateway.create-endpoint-modal",title:i.formatMessage({id:"S50iFK",defaultMessage:"Create endpoint"}),visible:e,onCancel:g,footer:null,size:"wide",css:I,children:(0,v.Y)(m.Op,{...o,children:(0,v.Y)(A,{mode:"create",isSubmitting:r,error:d,errorMessage:(0,_.m)(d),resetErrors:a,selectedModel:c,isFormComplete:u,onSubmit:p,onCancel:g,onNameBlur:h,componentIdPrefix:"mlflow.gateway.create-endpoint-modal",embedded:!0})})})}},27151:function(e,n,t){t.d(n,{U:function(){return i.U}});var i=t(63420)},71952:function(e,n,t){t.d(n,{F:function(){return g}});var i=t(884),o=t(46709),r=t(39595),d=t(61060),s=t(25117);const a=()=>{const e=(0,r.jE)();return(0,d.n)({mutationFn:e=>s.t.createEndpoint(e),onSuccess:()=>{e.invalidateQueries(["gateway_endpoints"])}})};var l=t(44341),c=t(1422),m=t(8264),u=t(30431),p=t(87032);function g({onSuccess:e,onCancel:n}={}){const t=(0,i.mN)({defaultValues:{name:"",provider:"",modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}}}}),{mutateAsync:r,error:d,isLoading:s,reset:g}=a(),{mutateAsync:h,error:f,isLoading:v,reset:x}=(0,l.w)(),{mutateAsync:w,error:S,isLoading:y,reset:M}=(0,c.H)(),Y=(0,o.useCallback)(()=>{g(),x(),M()},[g,x,M]),A=s||v||y,F=d||f||S,C=t.watch("provider"),b=t.watch("modelName"),_=t.watch("secretMode"),I=t.watch("existingSecretId"),D=t.watch("newSecret.name"),N=t.watch("newSecret.secretFields"),T=(0,o.useRef)(C);(0,o.useEffect)(()=>{const e=T.current;T.current=C,e&&C&&e!==C&&(t.setValue("modelName",""),t.setValue("secretMode","new"),t.setValue("existingSecretId",""),t.setValue("newSecret",{name:"",authMode:"",secretFields:{},configFields:{}}),Y())},[C,t,Y]);const{data:k}=(0,m.o)({provider:C||void 0}),H=null===k||void 0===k?void 0:k.find(e=>e.model===b),{data:$}=(0,u.c)(),B=Object.values(N||{}).some(e=>!!e);return{form:t,isLoading:A,error:F,resetErrors:Y,existingEndpoints:$,selectedModel:H,isFormComplete:!!C&&!!b&&("existing"===_?!!I:!!D&&B),handleSubmit:async n=>{try{let t=n.existingSecretId;if("new"===n.secretMode){const e={...n.newSecret.configFields};n.newSecret.authMode&&(e.auth_mode=n.newSecret.authMode);t=(await h({secret_name:n.newSecret.name,secret_value:n.newSecret.secretFields,provider:n.provider,auth_config:Object.keys(e).length>0?e:void 0})).secret.secret_id}const i=(await w({name:`${n.name||"endpoint"}-${n.modelName}`,secret_id:t,provider:n.provider,model_name:n.modelName})).model_definition.model_definition_id,o=await r({name:n.name||void 0,model_configs:[{model_definition_id:i,linkage_type:"PRIMARY",weight:1}]});null===e||void 0===e||e(o.endpoint)}catch{}},handleCancel:()=>{null===n||void 0===n||n()},handleNameBlur:()=>{const e=t.getValues("name");if(e){if(!(0,p.j8)(e))return void t.setError("name",{type:"manual",message:"Name can only contain letters, numbers, underscores, hyphens, and dots. Spaces and special characters are not allowed."});null!==$&&void 0!==$&&$.some(n=>n.name===e)&&t.setError("name",{type:"manual",message:"An endpoint with this name already exists"})}}}}}}]);