"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[8316],{18316:function(e,n,o){o.r(n),o.d(n,{default:function(){return re}});var i=o(91105),t=o(55570),d=o(91113),r=o(884),a=o(39595),l=o(46709),s=o(30431),c=o(49708),m=o(25117);var p=o(61060);var g=o(1422);var u=o(44341),f=o(85344),h=o(87032),v=o(29447);function y(e){const n=(0,i.Zp)(),{data:o,isLoading:t,error:d}=((0,a.jE)(),(e=>(0,c.I)(["gateway_endpoint",e],{queryFn:()=>m.t.getEndpoint(e),retry:!1,enabled:Boolean(e)}))(e)),f=null===o||void 0===o?void 0:o.endpoint,y=(0,r.mN)({defaultValues:{name:"",trafficSplitModels:[],fallbackModels:[]}});(0,l.useEffect)(()=>{if(f&&f.model_mappings){var e,n,o;const i=null!==(e=f.model_mappings.filter(e=>"PRIMARY"===e.linkage_type))&&void 0!==e?e:[],t=null!==(n=f.model_mappings.filter(e=>"FALLBACK"===e.linkage_type))&&void 0!==n?n:[],d=i.reduce((e,n)=>{var o;return e+(null!==(o=n.weight)&&void 0!==o?o:1)},0);y.reset({name:null!==(o=f.name)&&void 0!==o?o:"",trafficSplitModels:i.map(e=>{var n,o,t,r,a,l,s,c,m,p;return{modelDefinitionId:null===(n=e.model_definition)||void 0===n?void 0:n.model_definition_id,modelDefinitionName:null!==(o=null===(t=e.model_definition)||void 0===t?void 0:t.name)&&void 0!==o?o:"",provider:null!==(r=null===(a=e.model_definition)||void 0===a?void 0:a.provider)&&void 0!==r?r:"",modelName:null!==(l=null===(s=e.model_definition)||void 0===s?void 0:s.model_name)&&void 0!==l?l:"",secretMode:"existing",existingSecretId:null!==(c=null===(m=e.model_definition)||void 0===m?void 0:m.secret_id)&&void 0!==c?c:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}},weight:d>0?(null!==(p=e.weight)&&void 0!==p?p:1)/d*100:100/i.length}}),fallbackModels:t.sort((e,n)=>{var o,i;return(null!==(o=e.fallback_order)&&void 0!==o?o:0)-(null!==(i=n.fallback_order)&&void 0!==i?i:0)}).map((e,n)=>{var o,i,t,d,r,a,l,s,c;return{modelDefinitionId:null===(o=e.model_definition)||void 0===o?void 0:o.model_definition_id,modelDefinitionName:null!==(i=null===(t=e.model_definition)||void 0===t?void 0:t.name)&&void 0!==i?i:"",provider:null!==(d=null===(r=e.model_definition)||void 0===r?void 0:r.provider)&&void 0!==d?d:"",modelName:null!==(a=null===(l=e.model_definition)||void 0===l?void 0:l.model_name)&&void 0!==a?a:"",secretMode:"existing",existingSecretId:null!==(s=null===(c=e.model_definition)||void 0===c?void 0:c.secret_id)&&void 0!==s?s:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}},fallbackOrder:n+1}})})}},[f,y]);const{mutateAsync:x,error:w,isLoading:b,reset:A}=(()=>{const e=(0,a.jE)();return(0,p.n)({mutationFn:e=>m.t.updateEndpoint({endpoint_id:e.endpointId,name:e.name,model_configs:e.model_configs,routing_strategy:e.routing_strategy,fallback_config:e.fallback_config}),onSuccess:()=>{e.invalidateQueries(["gateway_endpoints"]),e.invalidateQueries(["gateway_endpoint"])}})})(),{mutateAsync:M}=(0,u.w)(),{mutateAsync:S}=(0,g.H)(),{mutateAsync:Y}=(()=>{const e=(0,a.jE)();return(0,p.n)({mutationFn:e=>m.t.updateModelDefinition({model_definition_id:e.modelDefinitionId,secret_id:e.secretId,provider:e.provider,model_name:e.modelName}),onSuccess:()=>{e.invalidateQueries(["gateway_endpoints"]),e.invalidateQueries(["gateway_endpoint"]),e.invalidateQueries(["gateway_model_definitions"])}})})(),[I,_]=(0,l.useState)(),C=(0,l.useCallback)(()=>{A(),_(null)},[A]),k=b,D=I||w,T=(0,l.useCallback)(async e=>{if(f)try{const o=async e=>{if("existing"===e.secretMode)return e.existingSecretId;return(await M({secret_name:e.newSecret.name,secret_value:e.newSecret.secretFields,provider:e.provider,auth_config:e.newSecret.configFields})).secret.secret_id},i=async n=>{if(n.modelDefinitionId){var i;const e=null===(i=f.model_mappings)||void 0===i?void 0:i.find(e=>{var o;return(null===(o=e.model_definition)||void 0===o?void 0:o.model_definition_id)===n.modelDefinitionId});if(null!==e&&void 0!==e&&e.model_definition){if(n.provider!==e.model_definition.provider||n.modelName!==e.model_definition.model_name||"existing"===n.secretMode&&n.existingSecretId!==e.model_definition.secret_id||"new"===n.secretMode){const e=await o(n);await Y({modelDefinitionId:n.modelDefinitionId,secretId:e,provider:n.provider,modelName:n.modelName})}}return n.modelDefinitionId}const t=await o(n);if(!n.provider||!n.modelName)throw new Error("Provider and model name are required to create a model definition");const d=Date.now();let r=`${e.name||f.name}-${n.provider}-${n.modelName}-${d}`.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");r||(r=`model-definition-${d}`);return(await S({name:r,secret_id:t,provider:n.provider,model_name:n.modelName})).model_definition.model_definition_id},t=await Promise.all(e.trafficSplitModels.map(e=>i(e))),d=await Promise.all(e.fallbackModels.map(e=>i(e))),r=e.trafficSplitModels.reduce((e,n)=>e+n.weight,0),a=e.trafficSplitModels.length||1,l=[...e.trafficSplitModels.map((e,n)=>({model_definition_id:t[n],linkage_type:"PRIMARY",weight:r>0?e.weight/100:1/a})),...e.fallbackModels.map((e,n)=>({model_definition_id:d[n],linkage_type:"FALLBACK",fallback_order:e.fallbackOrder}))],s=e.trafficSplitModels.length>1?"REQUEST_BASED_TRAFFIC_SPLIT":void 0,c=e.fallbackModels.length>0?{strategy:"SEQUENTIAL",max_attempts:e.fallbackModels.length+1}:void 0;await x({endpointId:f.endpoint_id,name:e.name||void 0,model_configs:l,routing_strategy:s,fallback_config:c}),n(v.Ay.getEndpointDetailsRoute(f.endpoint_id))}catch{}},[f,x,n,M,S,Y]),F=(0,l.useCallback)(()=>{n(v.Ay.gatewayPageRoute)},[n]),$=y.watch("trafficSplitModels"),H=y.watch("fallbackModels"),P=(0,l.useMemo)(()=>{if(0===$.length)return!1;const e=$.reduce((e,n)=>e+n.weight,0);if(Math.abs(e-100)>.01)return!1;const n=e=>{if(!e.provider||!e.modelName)return!1;if("existing"===e.secretMode)return Boolean(e.existingSecretId);{if(!e.newSecret)return!1;const n=Boolean(e.newSecret.name&&e.newSecret.authMode),o=!!e.newSecret.secretFields&&Object.values(e.newSecret.secretFields).some(e=>e);return n&&o}},o=$.every(n),i=H.every(n);return o&&i},[$,H]),N=y.watch("name"),B=(0,l.useMemo)(()=>{var e,n,o,i,t;if(!f)return!1;const d=null!==(e=f.name)&&void 0!==e?e:"";if(N!==d)return!0;const r=null!==(n=null===(o=f.model_mappings)||void 0===o?void 0:o.filter(e=>"PRIMARY"===e.linkage_type))&&void 0!==n?n:[],a=null!==(i=null===(t=f.model_mappings)||void 0===t?void 0:t.filter(e=>"FALLBACK"===e.linkage_type))&&void 0!==i?i:[];if($.length!==r.length)return!0;if(H.length!==a.length)return!0;const l=r.reduce((e,n)=>{var o;return e+(null!==(o=n.weight)&&void 0!==o?o:1)},0),s=$.some((e,n)=>{var o;const i=r[n];if(!i||!i.model_definition)return!0;const t=l>0?(null!==(o=i.weight)&&void 0!==o?o:1)/l*100:100/r.length;if(e.modelDefinitionId&&e.modelDefinitionId!==i.model_definition.model_definition_id)return!0;if(e.modelDefinitionId&&e.modelDefinitionId===i.model_definition.model_definition_id){if(e.provider!==i.model_definition.provider||e.modelName!==i.model_definition.model_name||"existing"===e.secretMode&&e.existingSecretId!==i.model_definition.secret_id||"new"===e.secretMode)return!0}return e.provider!==i.model_definition.provider||e.modelName!==i.model_definition.model_name||"existing"!==e.secretMode||e.existingSecretId!==i.model_definition.secret_id||Math.abs(e.weight-t)>.01}),c=H.some(e=>{if(!e.modelDefinitionId)return!0;const n=a.find(n=>{var o;return(null===(o=n.model_definition)||void 0===o?void 0:o.model_definition_id)===e.modelDefinitionId});if(!n)return!0;if(n.model_definition){if(e.provider!==n.model_definition.provider||e.modelName!==n.model_definition.model_name||"existing"===e.secretMode&&e.existingSecretId!==n.model_definition.secret_id||"new"===e.secretMode)return!0}return n.fallback_order!==e.fallbackOrder});return s||c},[f,N,$,H]),{data:L}=(0,s.c)(),R=(0,l.useCallback)(()=>{const n=y.getValues("name");if(n){if(!(0,h.j8)(n))return void y.setError("name",{type:"manual",message:"Name can only contain letters, numbers, underscores, hyphens, and dots. Spaces and special characters are not allowed."});const o=null===L||void 0===L?void 0:L.filter(n=>n.endpoint_id!==e);null!==o&&void 0!==o&&o.some(e=>e.name===n)&&y.setError("name",{type:"manual",message:"An endpoint with this name already exists"})}},[y,L,e]);return{form:y,isLoadingEndpoint:t,isSubmitting:k,loadError:d,mutationError:D,resetErrors:C,endpoint:f,isFormComplete:P,hasChanges:B,handleSubmit:T,handleCancel:F,handleNameBlur:R}}var x=o(68248),w=o(27757),b=o(82716),A=o(79081),M=o(7655),S=o(40724),Y=o(6459),I=o(98332),_=o(63420),C=o(35583),k=o(93422),D=o(73716),T=o(75329),F=o(73408);var $={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},H={name:"1hhxok4",styles:"margin:0;font-weight:bold"},P={name:"1u1zie3",styles:"width:120px"},N={name:"1d3w5wq",styles:"width:100%"};const B=({model:e,index:n,onModelChange:o,onWeightChange:i,onRemove:t,componentIdPrefix:d})=>{const{theme:r}=(0,w.u)(),a=(0,M.A)(),[s,c]=(0,l.useState)(!e.provider&&!e.modelName),[m,p]=(0,l.useState)(null),g=null!==m&&void 0!==m?m:0===e.weight?"":String(e.weight),{existingSecrets:u,isLoadingSecrets:f,authModes:h,defaultAuthMode:v,isLoadingProviderConfig:y}=(0,D.t)({provider:e.provider}),Y={mode:e.secretMode,existingSecretId:e.existingSecretId,newSecret:e.newSecret},B=e.provider&&e.modelName;return(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:r.spacing.md,padding:r.spacing.md,border:`2px solid ${r.colors.border}`,borderRadius:r.borders.borderRadiusMd,backgroundColor:r.colors.backgroundPrimary},""),children:[(0,F.FD)("div",{css:$,children:[(0,F.FD)("div",{css:(0,x.AH)({display:"flex",alignItems:"center",gap:r.spacing.sm,flex:1},""),children:[(0,F.Y)(w.B,{componentId:`${d}.expand.${n}`,icon:s?(0,F.Y)(b.ChevronDownIcon,{}):(0,F.Y)(w.o,{}),onClick:()=>c(!s),size:"small"}),(0,F.Y)(b.FormUI.Label,{css:H,children:(0,F.Y)(S.A,{id:"JNmxAa",defaultMessage:"Model {number}",values:{number:n+1}})}),!s&&B&&(0,F.FD)(w.T.Text,{css:(0,x.AH)({fontFamily:"monospace",color:r.colors.textSecondary},""),children:[(0,T.aU)(e.provider)," / ",e.modelName,(0,F.FD)("span",{css:(0,x.AH)({marginLeft:r.spacing.sm,color:r.colors.actionTertiaryTextDefault},""),children:["(",e.weight,"%)"]})]})]}),(0,F.Y)(A.T,{componentId:`${d}.remove-tooltip.${n}`,content:a.formatMessage({id:"eWm+AG",defaultMessage:"Remove model"}),children:(0,F.Y)(w.B,{componentId:`${d}.remove.${n}`,icon:(0,F.Y)(b.TrashIcon,{}),onClick:()=>t(n)})})]}),s&&(0,F.FD)(F.FK,{children:[(0,F.Y)(_.U,{value:e.provider,onChange:e=>{o(n,{provider:e,modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}}})},componentIdPrefix:`${d}.provider.${n}`}),(0,F.Y)(C.o,{provider:e.provider,value:e.modelName,onChange:e=>o(n,{modelName:e}),componentIdPrefix:`${d}.model.${n}`}),(0,F.Y)(k.$,{value:Y,onChange:e=>{o(n,{secretMode:e.mode,existingSecretId:e.existingSecretId,newSecret:e.newSecret})},provider:e.provider,existingSecrets:u,isLoadingSecrets:f,authModes:h,defaultAuthMode:v,isLoadingProviderConfig:y,componentIdPrefix:`${d}.api-key.${n}`}),(0,F.FD)("div",{css:P,children:[(0,F.Y)(b.FormUI.Label,{htmlFor:`${d}.weight.${n}`,children:(0,F.Y)(S.A,{id:"pOqgMC",defaultMessage:"Weight"})}),(0,F.FD)("div",{css:(0,x.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs},""),children:[(0,F.Y)(I.f,{componentId:`${d}.weight.${n}`,type:"number",min:0,max:100,value:g,onChange:e=>{p(e.target.value);const o=parseInt(e.target.value,10);i(n,Number.isNaN(o)?0:o)},css:N}),(0,F.Y)("span",{css:(0,x.AH)({color:r.colors.textSecondary},""),children:"%"})]})]})]})]})};var L={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"};const R=({value:e,onChange:n,componentIdPrefix:o="mlflow.gateway.traffic-split"})=>{const{theme:i}=(0,w.u)(),t=(0,l.useCallback)(()=>{n([...e,{modelDefinitionName:"",provider:"",modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}},weight:0}])},[e,n]),d=(0,l.useCallback)(o=>{n(e.filter((e,n)=>n!==o))},[e,n]),r=(0,l.useCallback)((o,i)=>{const t=[...e];t[o]={...t[o],...i},n(t)},[e,n]),a=(0,l.useCallback)((o,i)=>{const t=[...e];t[o]={...t[o],weight:i},n(t)},[e,n]),s=e.reduce((e,n)=>e+n.weight,0),c=100===s;return(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:i.spacing.md},""),children:[e.map((e,n)=>(0,F.Y)(B,{model:e,index:n,onModelChange:r,onWeightChange:a,onRemove:d,componentIdPrefix:o},n)),(0,F.FD)("div",{css:L,children:[(0,F.Y)(w.B,{componentId:`${o}.add`,icon:(0,F.Y)(b.PlusIcon,{}),onClick:t,children:(0,F.Y)(S.A,{id:"MsSpWB",defaultMessage:"Add model for traffic split"})}),e.length>0&&(0,F.FD)("div",{css:(0,x.AH)({display:"flex",alignItems:"center",gap:i.spacing.xs,color:c?i.colors.textSecondary:i.colors.textValidationDanger,fontSize:i.typography.fontSizeSm},""),children:[(0,F.Y)(S.A,{id:"6fV0+T",defaultMessage:"Total: {total}%",values:{total:s}}),!c&&(0,F.Y)(S.A,{id:"ftZaLl",defaultMessage:"(must equal 100%)"})]})]})]})};var E=o(17066),z=o(24014),O=o(72943),j=o(59126);const U="FALLBACK_MODEL";var q={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},X={name:"uaizzl",styles:"cursor:grab;display:flex;align-items:center;&:active{cursor:grabbing;}"},G={name:"1hhxok4",styles:"margin:0;font-weight:bold"};const W=({model:e,index:n,onModelChange:o,onRemove:i,onMove:t,componentIdPrefix:d})=>{const{theme:r}=(0,w.u)(),a=(0,M.A)(),[s,c]=(0,l.useState)(!e.provider&&!e.modelName),m=(0,l.useRef)(null),[{isDragging:p},g,u]=(0,O.i)({type:U,item:{type:U,index:n},collect:e=>({isDragging:e.isDragging()})}),[{isOver:f},h]=(0,j.H)({accept:U,hover:e=>{if(!m.current)return;const o=e.index,i=n;o!==i&&(t(o,i),e.index=i)},collect:e=>({isOver:e.isOver()})});u(h(m));const{existingSecrets:v,isLoadingSecrets:y,authModes:Y,defaultAuthMode:I,isLoadingProviderConfig:$}=(0,D.t)({provider:e.provider}),H={mode:e.secretMode,existingSecretId:e.existingSecretId,newSecret:e.newSecret},P=e.provider&&e.modelName;return(0,F.FD)("div",{ref:m,css:(0,x.AH)({display:"flex",flexDirection:"column",gap:r.spacing.md,padding:r.spacing.md,border:`2px solid ${r.colors.border}`,borderRadius:r.borders.borderRadiusMd,backgroundColor:r.colors.backgroundPrimary,opacity:p?.5:1,borderColor:f?r.colors.actionPrimaryBackgroundDefault:r.colors.border},""),children:[(0,F.FD)("div",{css:q,children:[(0,F.FD)("div",{css:(0,x.AH)({display:"flex",alignItems:"center",gap:r.spacing.sm,flex:1},""),children:[(0,F.Y)("div",{ref:g,css:X,children:(0,F.Y)(b.DragIcon,{css:(0,x.AH)({color:r.colors.textSecondary},"")})}),(0,F.Y)(w.B,{componentId:`${d}.expand.${n}`,icon:s?(0,F.Y)(b.ChevronDownIcon,{}):(0,F.Y)(w.o,{}),onClick:()=>c(!s),size:"small"}),(0,F.Y)(b.FormUI.Label,{css:G,children:(0,F.Y)(S.A,{id:"hDExYR",defaultMessage:"Fallback Model {order}",values:{order:n+1}})}),!s&&P&&(0,F.FD)(w.T.Text,{css:(0,x.AH)({fontFamily:"monospace",color:r.colors.textSecondary},""),children:[(0,T.aU)(e.provider)," / ",e.modelName]})]}),(0,F.Y)(A.T,{componentId:`${d}.remove-tooltip.${n}`,content:a.formatMessage({id:"XZlIAj",defaultMessage:"Remove fallback model"}),children:(0,F.Y)(w.B,{componentId:`${d}.remove.${n}`,icon:(0,F.Y)(b.TrashIcon,{}),onClick:()=>i(n)})})]}),s&&(0,F.FD)(F.FK,{children:[(0,F.Y)(_.U,{value:e.provider,onChange:e=>{o(n,{provider:e,modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}}})},componentIdPrefix:`${d}.provider.${n}`}),(0,F.Y)(C.o,{provider:e.provider,value:e.modelName,onChange:e=>o(n,{modelName:e}),componentIdPrefix:`${d}.model.${n}`}),(0,F.Y)(k.$,{value:H,onChange:e=>{o(n,{secretMode:e.mode,existingSecretId:e.existingSecretId,newSecret:e.newSecret})},provider:e.provider,existingSecrets:v,isLoadingSecrets:y,authModes:Y,defaultAuthMode:I,isLoadingProviderConfig:$,componentIdPrefix:`${d}.api-key.${n}`})]})]})},Q=({value:e,onChange:n,componentIdPrefix:o="mlflow.gateway.fallback"})=>{const{theme:i}=(0,w.u)(),t=(0,l.useCallback)(()=>{const o=e.length>0?Math.max(...e.map(e=>e.fallbackOrder))+1:1;n([...e,{modelDefinitionName:"",provider:"",modelName:"",secretMode:"new",existingSecretId:"",newSecret:{name:"",authMode:"",secretFields:{},configFields:{}},fallbackOrder:o}])},[e,n]),d=(0,l.useCallback)(o=>{const i=e.filter((e,n)=>n!==o).map((e,n)=>({...e,fallbackOrder:n+1}));n(i)},[e,n]),r=(0,l.useCallback)((o,i)=>{const t=[...e];t[o]={...t[o],...i},n(t)},[e,n]),a=(0,l.useCallback)((o,i)=>{const t=[...e],[d]=t.splice(o,1);t.splice(i,0,d);const r=t.map((e,n)=>({...e,fallbackOrder:n+1}));n(r)},[e,n]);return(0,F.Y)(E.Q,{backend:z.t2,children:(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:i.spacing.md},""),children:[e.map((e,n)=>(0,F.Y)(W,{model:e,index:n,onModelChange:r,onRemove:d,onMove:a,componentIdPrefix:o},n)),(0,F.Y)(w.B,{componentId:`${o}.add`,icon:(0,F.Y)(b.PlusIcon,{}),onClick:t,children:(0,F.Y)(S.A,{id:"NlwpVQ",defaultMessage:"Add fallback"})})]})})};var K=o(91701),V=o(19112);var Z={name:"bjn8wh",styles:"position:relative"},J={name:"1i9vogi",styles:"margin-top:0"};const ee=({open:e,onClose:n,endpointName:o,baseUrl:i})=>{const{theme:t}=(0,w.u)(),[d,r]=(0,l.useState)("unified"),[a,s]=(0,l.useState)("openai"),[c,m]=(0,l.useState)("curl"),[p,g]=(0,l.useState)("curl"),u=(e=>e||("undefined"!==typeof window?window.location.origin:"http://localhost:5000"))(i),f=`curl -X POST ${u}/gateway/${o}/mlflow/invocations \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "messages": [\n    {"role": "user", "content": "Hello, how are you?"}\n  ]\n}'`,h=`import requests\n\nresponse = requests.post(\n    "${u}/gateway/${o}/mlflow/invocations",\n    json={\n        "messages": [\n            {"role": "user", "content": "Hello, how are you?"}\n        ]\n    }\n)\nprint(response.json())`,v=`curl -X POST ${u}/gateway/mlflow/v1/chat/completions \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "model": "${o}",\n  "messages": [\n    {"role": "user", "content": "How are you?"}\n  ]\n}'`,y=`from openai import OpenAI\n\nclient = OpenAI(\n    base_url="${u}/gateway/mlflow/v1",\n    api_key="",  # API key not needed, configured server-side\n)\n\nmessages = [{"role": "user", "content": "How are you?"}]\n\nresponse = client.chat.completions.create(\n    model="${o}",  # Endpoint name as model\n    messages=messages,\n)\nprint(response.choices[0].message)`,M=`curl -X POST ${u}/gateway/openai/v1/responses \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "model": "${o}",\n  "input": "How are you?"\n}'`,Y=`from openai import OpenAI\n\nclient = OpenAI(\n    base_url="${u}/gateway/openai/v1",\n    api_key="dummy",  # API key not needed, configured server-side\n)\n\nresponse = client.responses.create(\n    model="${o}",\n    input="How are you?",\n)\nprint(response.output_text)`,I=`curl -X POST ${u}/gateway/anthropic/v1/messages \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "model": "${o}",\n  "max_tokens": 1024,\n  "messages": [\n    {"role": "user", "content": "How are you?"}\n  ]\n}'`,_=`import anthropic\n\nclient = anthropic.Anthropic(\n    base_url="${u}/gateway/anthropic",\n    api_key="dummy",  # API key not needed, configured server-side\n)\n\nresponse = client.messages.create(\n    model="${o}",\n    max_tokens=1024,\n    messages=[{"role": "user", "content": "How are you?"}],\n)\nprint(response.content[0].text)`,C=`curl -X POST ${u}/gateway/gemini/v1beta/models/${o}:generateContent \\\n  -H "Content-Type: application/json" \\\n  -d '{\n  "contents": [{\n    "parts": [{"text": "How are you?"}]\n  }]\n}'`,k=`from google import genai\n\n# Configure with custom endpoint\nclient = genai.Client(\n    api_key='dummy',\n    http_options={\n        'base_url': "${u}/gateway/gemini",\n    }\n)\nresponse = client.models.generate_content(\n    model="${o}",\n    contents={'text': 'How are you?'},\n)\nclient.close()\nprint(response.candidates[0].content.parts[0].text)`,D=(e,n,o="text")=>(0,F.FD)("div",{css:(0,x.AH)({marginBottom:t.spacing.md},""),children:[(0,F.FD)("div",{css:(0,x.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:t.spacing.xs},""),children:[(0,F.Y)(w.T.Text,{bold:!0,children:e}),(0,F.Y)(K.i,{componentId:`mlflow.gateway.usage-modal.copy-${e.toLowerCase().replace(/\s+/g,"-")}`,copyText:n,icon:(0,F.Y)(b.CopyIcon,{}),showLabel:!1})]}),(0,F.Y)("div",{css:Z,children:(0,F.Y)(V.z7,{language:o,theme:t.isDarkMode?"duotoneDark":"light",style:{fontSize:t.typography.fontSizeSm,padding:`${t.spacing.sm}px ${t.spacing.md}px`},children:n})})]});return(0,F.Y)(A.d,{componentId:"mlflow.gateway.endpoint-usage-modal",visible:e,onCancel:n,title:(0,F.Y)(S.A,{id:"/Sa51w",defaultMessage:"Query endpoint"}),footer:null,size:"wide",children:(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:t.spacing.md,maxHeight:"70vh",overflowY:"auto"},""),children:[(0,F.Y)(w.T.Text,{color:"secondary",children:(0,F.Y)(S.A,{id:"+HgSTK",defaultMessage:"Use these code examples to call your endpoint. Choose between unified APIs for seamless model switching or passthrough APIs for provider-specific features."})}),(0,F.FD)("div",{css:(0,x.AH)({display:"flex",gap:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:[(0,F.Y)("div",{css:(0,x.AH)({padding:`${t.spacing.sm}px ${t.spacing.md}px`,cursor:"pointer",borderBottom:"unified"===d?`2px solid ${t.colors.actionPrimaryBackgroundDefault}`:"2px solid transparent",color:"unified"===d?t.colors.actionPrimaryBackgroundDefault:t.colors.textSecondary,fontWeight:"unified"===d?"bold":"normal"},""),onClick:()=>r("unified"),children:(0,F.Y)(S.A,{id:"vwD2zW",defaultMessage:"Unified APIs"})}),(0,F.Y)("div",{css:(0,x.AH)({padding:`${t.spacing.sm}px ${t.spacing.md}px`,cursor:"pointer",borderBottom:"passthrough"===d?`2px solid ${t.colors.actionPrimaryBackgroundDefault}`:"2px solid transparent",color:"passthrough"===d?t.colors.actionPrimaryBackgroundDefault:t.colors.textSecondary,fontWeight:"passthrough"===d?"bold":"normal"},""),onClick:()=>r("passthrough"),children:(0,F.Y)(S.A,{id:"dQawRm",defaultMessage:"Passthrough APIs"})})]}),"unified"===d&&(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:t.spacing.lg},""),children:[(0,F.FD)(b.SegmentedControlGroup,{name:"unified-language-selector",componentId:"mlflow.gateway.usage-modal.unified-language-selector",value:p,onChange:({target:{value:e}})=>g(e),children:[(0,F.Y)(b.SegmentedControlButton,{value:"curl",children:"cURL"}),(0,F.Y)(b.SegmentedControlButton,{value:"python",children:"Python"})]}),(0,F.FD)("div",{children:[(0,F.Y)(w.T.Title,{level:4,css:J,children:(0,F.Y)(S.A,{id:"Y7AIKR",defaultMessage:"MLflow Invocations API"})}),(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(S.A,{id:"tv0qk9",defaultMessage:"Native MLflow API for model invocations. Supports seamless model switching and advanced routing."})}),"curl"===p&&D("cURL",f,"text"),"python"===p&&D("Python",h,"python")]}),(0,F.FD)("div",{children:[(0,F.Y)(w.T.Title,{level:4,children:(0,F.Y)(S.A,{id:"dsPsxG",defaultMessage:"OpenAI-Compatible Chat Completions API"})}),(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(S.A,{id:"hjAgZ8",defaultMessage:"Unified OpenAI compatible API for model invocations. Set the endpoint name as the model parameter."})}),"curl"===p&&D("cURL",v,"text"),"python"===p&&D("Python",y,"python")]})]}),"passthrough"===d&&(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:t.spacing.lg},""),children:[(0,F.FD)("div",{children:[(0,F.Y)(w.T.Text,{bold:!0,css:(0,x.AH)({display:"block",marginBottom:t.spacing.sm},""),children:(0,F.Y)(S.A,{id:"+li9YN",defaultMessage:"Provider"})}),(0,F.FD)(b.SegmentedControlGroup,{name:"provider-selector",componentId:"mlflow.gateway.usage-modal.provider-selector",value:a,onChange:({target:{value:e}})=>s(e),children:[(0,F.Y)(b.SegmentedControlButton,{value:"openai",children:"OpenAI"}),(0,F.Y)(b.SegmentedControlButton,{value:"anthropic",children:"Anthropic"}),(0,F.Y)(b.SegmentedControlButton,{value:"gemini",children:"Google Gemini"})]})]}),(0,F.FD)("div",{children:["openai"===a&&(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(S.A,{id:"cniMRT",defaultMessage:"Direct access to OpenAI's Responses API for multi-turn conversations with vision and audio capabilities."})}),"anthropic"===a&&(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(S.A,{id:"Xn0LxG",defaultMessage:"Direct access to Anthropic's Messages API with Claude-specific features."})}),"gemini"===a&&(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({display:"block",marginBottom:t.spacing.md},""),children:(0,F.Y)(S.A,{id:"7MWbDM",defaultMessage:"Direct access to Google's Gemini API. Note: endpoint name is part of the URL path."})}),(0,F.FD)(b.SegmentedControlGroup,{name:"language-selector",componentId:"mlflow.gateway.usage-modal.language-selector",value:c,onChange:({target:{value:e}})=>m(e),css:(0,x.AH)({marginBottom:t.spacing.md},""),children:[(0,F.Y)(b.SegmentedControlButton,{value:"curl",children:"cURL"}),(0,F.Y)(b.SegmentedControlButton,{value:"python",children:"Python"})]}),"openai"===a&&"curl"===c&&D("cURL",M,"text"),"openai"===a&&"python"===c&&D("Python",Y,"python"),"anthropic"===a&&"curl"===c&&D("cURL",I,"text"),"anthropic"===a&&"python"===c&&D("Python",_,"python"),"gemini"===a&&"curl"===c&&D("cURL",C,"text"),"gemini"===a&&"python"===c&&D("Python",k,"python")]})]})]})})};var ne={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},oe={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},ie={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},te={name:"1e1crzz",styles:"width:280px;flex-shrink:0;position:sticky;top:0;align-self:flex-start"};const de=({form:e,isLoadingEndpoint:n,isSubmitting:o,loadError:t,mutationError:d,errorMessage:a,resetErrors:s,endpointName:c,isFormComplete:m,hasChanges:p,onSubmit:g,onCancel:u,onNameBlur:f})=>{const{theme:h}=(0,w.u)(),y=(0,M.A)(),[_,C]=(0,l.useState)(!1),k=e.watch("trafficSplitModels"),D=e.watch("fallbackModels"),T=k.reduce((e,n)=>e+n.weight,0),$=Math.abs(T-100)<.01;return n?(0,F.Y)("div",{css:ne,children:(0,F.FD)("div",{css:(0,x.AH)({display:"flex",alignItems:"center",gap:h.spacing.sm,padding:h.spacing.md},""),children:[(0,F.Y)(w.S,{size:"small"}),(0,F.Y)(S.A,{id:"RyNXc+",defaultMessage:"Loading endpoint..."})]})}):t?(0,F.Y)("div",{css:oe,children:(0,F.Y)("div",{css:(0,x.AH)({padding:h.spacing.md},""),children:(0,F.Y)(b.Alert,{componentId:"mlflow.gateway.edit-endpoint.error",type:"error",message:null!==(H=t.message)&&void 0!==H?H:"Endpoint not found"})})}):(0,F.FD)("div",{css:ie,children:[(0,F.FD)("div",{css:(0,x.AH)({padding:h.spacing.md},""),children:[(0,F.FD)(b.Breadcrumb,{includeTrailingCaret:!0,children:[(0,F.Y)(b.Breadcrumb.Item,{children:(0,F.Y)(i.N_,{to:v.Ay.gatewayPageRoute,children:(0,F.Y)(S.A,{id:"uABFy0",defaultMessage:"AI Gateway"})})}),(0,F.Y)(b.Breadcrumb.Item,{children:(0,F.Y)(i.N_,{to:v.Ay.gatewayPageRoute,children:(0,F.Y)(S.A,{id:"eYZ/ZL",defaultMessage:"Endpoints"})})})]}),(0,F.FD)("div",{css:(0,x.AH)({marginTop:h.spacing.sm,display:"flex",justifyContent:"space-between",alignItems:"center"},""),children:[(0,F.Y)(w.T.Title,{level:2,children:c}),(0,F.Y)(w.B,{componentId:"mlflow.gateway.edit-endpoint.use-button",onClick:()=>C(!0),children:(0,F.Y)(S.A,{id:"yLAJ6r",defaultMessage:"Use"})})]})]}),d&&(0,F.Y)("div",{css:(0,x.AH)({padding:`0 ${h.spacing.md}px`},""),children:(0,F.Y)(b.Alert,{componentId:"mlflow.gateway.edit-endpoint.mutation-error",closable:!1,message:a,type:"error",css:(0,x.AH)({marginBottom:h.spacing.md},"")})}),(0,F.FD)("div",{css:(0,x.AH)({flex:1,display:"flex",gap:h.spacing.md,padding:`${h.spacing.md}px`,overflow:"auto",backgroundColor:h.colors.backgroundPrimary},""),children:[(0,F.FD)("div",{css:(0,x.AH)({flex:1,display:"flex",flexDirection:"column",gap:h.spacing.lg},""),children:[(0,F.FD)("div",{css:(0,x.AH)({padding:h.spacing.md,border:`1px solid ${h.colors.border}`,borderRadius:h.borders.borderRadiusMd,backgroundColor:h.colors.backgroundSecondary},""),children:[(0,F.Y)(w.T.Title,{level:3,children:(0,F.Y)(S.A,{id:"Wt644B",defaultMessage:"Endpoint Name"})}),(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({display:"block",marginTop:h.spacing.xs},""),children:(0,F.Y)(S.A,{id:"o9x0Pq",defaultMessage:"The name is used in the endpoint URL. Only letters, numbers, underscores, hyphens, and dots are allowed."})}),(0,F.Y)("div",{css:(0,x.AH)({marginTop:h.spacing.md},""),children:(0,F.Y)(r.xI,{control:e.control,name:"name",render:({field:n,fieldState:o})=>(0,F.FD)("div",{children:[(0,F.Y)(I.f,{id:"mlflow.gateway.edit-endpoint.name",componentId:"mlflow.gateway.edit-endpoint.name",...n,onChange:o=>{n.onChange(o),e.clearErrors("name"),s()},onBlur:()=>{n.onBlur(),f()},placeholder:y.formatMessage({id:"AanBxl",defaultMessage:"my-endpoint"}),validationState:o.error?"error":void 0}),o.error&&(0,F.Y)(b.FormUI.Message,{type:"error",message:o.error.message})]})})})]}),(0,F.FD)("div",{css:(0,x.AH)({padding:h.spacing.md,border:`1px solid ${h.colors.border}`,borderRadius:h.borders.borderRadiusMd,backgroundColor:h.colors.backgroundSecondary},""),children:[(0,F.Y)(w.T.Title,{level:3,children:(0,F.Y)(S.A,{id:"t8zXLd",defaultMessage:"Priority 1 (Traffic Split)"})}),(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({display:"block",marginTop:h.spacing.xs},""),children:(0,F.Y)(S.A,{id:"Lh4Pv4",defaultMessage:"Models in this priority will be tested first, with traffic split load balancing"})}),(0,F.Y)("div",{css:(0,x.AH)({marginTop:h.spacing.lg},""),children:(0,F.Y)(r.xI,{control:e.control,name:"trafficSplitModels",render:({field:e})=>(0,F.Y)(R,{value:e.value,onChange:e.onChange,componentIdPrefix:"mlflow.gateway.edit-endpoint.traffic-split"})})})]}),(0,F.FD)("div",{css:(0,x.AH)({padding:h.spacing.md,border:`1px solid ${h.colors.border}`,borderRadius:h.borders.borderRadiusMd,backgroundColor:h.colors.backgroundSecondary},""),children:[(0,F.Y)(w.T.Title,{level:3,children:(0,F.Y)(S.A,{id:"RMdf6R",defaultMessage:"Priority 2 (Fallback)"})}),(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({display:"block",marginTop:h.spacing.xs},""),children:(0,F.Y)(S.A,{id:"nF/4Eh",defaultMessage:"Models in this priority will be tested second, after models in Priority 1 have failed. Models will be attempted in order from top to bottom."})}),(0,F.Y)("div",{css:(0,x.AH)({marginTop:h.spacing.lg},""),children:(0,F.Y)(r.xI,{control:e.control,name:"fallbackModels",render:({field:e})=>(0,F.Y)(Q,{value:e.value,onChange:e.onChange,componentIdPrefix:"mlflow.gateway.edit-endpoint.fallback"})})})]}),(0,F.FD)("div",{css:(0,x.AH)({display:"flex",gap:h.spacing.md},""),children:[(0,F.FD)("div",{css:(0,x.AH)({flex:1,padding:h.spacing.md,border:`2px dashed ${h.colors.actionDefaultBorderDefault}`,borderRadius:h.borders.borderRadiusMd,backgroundColor:h.colors.backgroundPrimary,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},""),children:[(0,F.Y)(w.T.Text,{bold:!0,children:(0,F.Y)(S.A,{id:"p8KS2c",defaultMessage:"Usage Tracking"})}),(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({fontSize:h.typography.fontSizeSm},""),children:(0,F.Y)(S.A,{id:"jLHxac",defaultMessage:"Coming Soon"})})]}),(0,F.FD)("div",{css:(0,x.AH)({flex:1,padding:h.spacing.md,border:`2px dashed ${h.colors.actionDefaultBorderDefault}`,borderRadius:h.borders.borderRadiusMd,backgroundColor:h.colors.backgroundPrimary,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},""),children:[(0,F.Y)(w.T.Text,{bold:!0,children:(0,F.Y)(S.A,{id:"oxHklW",defaultMessage:"Rate Limiting"})}),(0,F.Y)(w.T.Text,{color:"secondary",css:(0,x.AH)({fontSize:h.typography.fontSizeSm},""),children:(0,F.Y)(S.A,{id:"jLHxac",defaultMessage:"Coming Soon"})})]})]})]}),(0,F.Y)("div",{css:te,children:(0,F.Y)(Y.v,{title:y.formatMessage({id:"mi7FdJ",defaultMessage:"Summary"}),children:(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:h.spacing.md},""),children:[k.length>0&&(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:h.spacing.xs},""),children:[(0,F.Y)(w.T.Text,{bold:!0,color:"secondary",children:(0,F.Y)(S.A,{id:"mz/gog",defaultMessage:"Traffic Split"})}),k.map((e,n)=>(0,F.Y)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:h.spacing.xs,fontSize:h.typography.fontSizeSm},""),children:(0,F.FD)(w.T.Text,{css:(0,x.AH)({fontSize:h.typography.fontSizeSm},""),children:[e.provider&&e.modelName?`${e.provider}/${e.modelName}`:`Model ${n+1}`," ","- ",e.weight,"%"]})},n))]}),D.length>0&&(0,F.FD)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:h.spacing.xs},""),children:[(0,F.Y)(w.T.Text,{bold:!0,color:"secondary",children:(0,F.Y)(S.A,{id:"b6hjrM",defaultMessage:"Fallback Models"})}),D.map((e,n)=>(0,F.Y)("div",{css:(0,x.AH)({display:"flex",flexDirection:"column",gap:h.spacing.xs,fontSize:h.typography.fontSizeSm},""),children:(0,F.FD)(w.T.Text,{css:(0,x.AH)({fontSize:h.typography.fontSizeSm},""),children:[n+1,"."," ",e.provider&&e.modelName?`${e.provider}/${e.modelName}`:`Model ${n+1}`]})},n))]})]})})})]}),(0,F.FD)("div",{css:(0,x.AH)({display:"flex",justifyContent:"flex-end",gap:h.spacing.sm,padding:h.spacing.md,borderTop:`1px solid ${h.colors.border}`,flexShrink:0},""),children:[(0,F.Y)(w.B,{componentId:"mlflow.gateway.edit-endpoint.cancel",onClick:u,children:(0,F.Y)(S.A,{id:"qz9XeG",defaultMessage:"Cancel"})}),(0,F.Y)(A.T,{componentId:"mlflow.gateway.edit-endpoint.save-tooltip",content:!m&&k.length>0&&!$?y.formatMessage({id:"3YddwH",defaultMessage:"Traffic split percentages must total 100%"}):m?p?void 0:y.formatMessage({id:"eANdPU",defaultMessage:"No changes to save"}):y.formatMessage({id:"Lw+dTL",defaultMessage:"Please configure at least one model in traffic split"}),children:(0,F.Y)(w.B,{componentId:"mlflow.gateway.edit-endpoint.save",type:"primary",onClick:e.handleSubmit(g),loading:o,disabled:!m||!p,children:(0,F.Y)(S.A,{id:"NVDxng",defaultMessage:"Save changes"})})})]}),(0,F.Y)(ee,{open:_,onClose:()=>C(!1),endpointName:c||""})]});var H};var re=(0,t.X)(d.A.mlflowServices.EXPERIMENTS,()=>{const{endpointId:e}=(0,i.g)(),{form:n,isLoadingEndpoint:o,isSubmitting:t,loadError:d,mutationError:a,resetErrors:l,endpoint:s,isFormComplete:c,hasChanges:m,handleSubmit:p,handleCancel:g,handleNameBlur:u}=y(null!==e&&void 0!==e?e:"");return(0,F.Y)(r.Op,{...n,children:(0,F.Y)(de,{form:n,isLoadingEndpoint:o,isSubmitting:t,loadError:d,mutationError:a,errorMessage:(0,f.m)(a),resetErrors:l,endpointName:null===s||void 0===s?void 0:s.name,isFormComplete:c,hasChanges:m,onSubmit:p,onCancel:g,onNameBlur:u})})})},91701:function(e,n,o){o.d(n,{i:function(){return s}});var i=o(46709),t=o(40724),d=o(27757),r=o(79081),a=o(73408);var l={name:"1739oy8",styles:"z-index:1"};const s=({copyText:e,showLabel:n=!0,componentId:o,...s})=>{const[c,m]=(0,i.useState)(!1);return(0,a.Y)(r.T,{content:(0,a.Y)(t.A,{id:"X+boXI",defaultMessage:"Copied"}),open:c,componentId:"mlflow.shared.copy_button.tooltip",children:(0,a.Y)(d.B,{componentId:null!==o&&void 0!==o?o:"mlflow.shared.copy_button",type:"primary",onClick:()=>{navigator.clipboard.writeText(e),m(!0),setTimeout(()=>{m(!1)},3e3)},onMouseLeave:()=>{m(!1)},css:l,children:n?(0,a.Y)(t.A,{id:"1Iq+NW",defaultMessage:"Copy"}):void 0,...s})})}}}]);