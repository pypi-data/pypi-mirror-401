"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[9011],{14429:function(e,t,n){n.d(t,{KT:function(){return c},Pz:function(){return u},UY:function(){return T},VA:function(){return m},oy:function(){return d}});var a=n(46709),i=n(91105),r=n(79444);const o="startTimeLabel",s="startTime",l="endTime",d="LAST_7_DAYS",c=(0,a.createContext)(null),m=()=>{const e=(0,r.U)(),t=(0,a.useContext)(c),[n,m]=(0,i.ok)();let u,g,f;var p;t?(u=t.params.startTimeLabel||d,g=t.params.startTime,f=t.params.endTime):(u=n.get(o)||d,g=n.get(s)||void 0,f=null!==(p=n.get(l))&&void 0!==p?p:void 0);if("CUSTOM"!==u){const t=T(e.dateNow,{startTimeLabel:u});g=t.startTime,f=t.endTime}const v=(0,a.useMemo)(()=>({startTimeLabel:u,startTime:g,endTime:f}),[u,g,f]),h=(0,a.useCallback)((e,n=!1)=>{t?t.setParams(null!==e&&void 0!==e?e:{startTimeLabel:void 0,startTime:void 0,endTime:void 0},n):m(t=>(void 0===(null===e||void 0===e?void 0:e.startTime)?t.delete(s):"CUSTOM"===e.startTimeLabel&&t.set(s,e.startTime),void 0===(null===e||void 0===e?void 0:e.endTime)?t.delete(l):"CUSTOM"===e.startTimeLabel&&t.set(l,e.endTime),void 0===(null===e||void 0===e?void 0:e.startTimeLabel)?t.delete(o):t.set(o,e.startTimeLabel),t),{replace:n})},[t,m]);return[v,h,Boolean(n.has(o)||(null===t||void 0===t?void 0:t.disableAutomaticInitialization))]},u=e=>{const[t]=m(),[n]=(0,a.useState)(()=>null!==e&&void 0!==e?e:new Date);return(0,a.useMemo)(()=>{const{startTime:e,endTime:a}=T(n,t);return{startTime:e?new Date(e).getTime().toString():void 0,endTime:a?new Date(a).getTime().toString():void 0}},[n,t])};function T(e,t){return t.startTimeLabel&&"CUSTOM"!==t.startTimeLabel?function(e,t){switch(t){case"LAST_HOUR":return{startTime:new Date(new Date(e).setUTCHours((new Date).getUTCHours()-1)).toISOString(),endTime:e.toISOString()};case"LAST_24_HOURS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-1)).toISOString(),endTime:e.toISOString()};case"LAST_7_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-7)).toISOString(),endTime:e.toISOString()};case"LAST_30_DAYS":return{startTime:new Date(new Date(e).setUTCDate((new Date).getUTCDate()-30)).toISOString(),endTime:e.toISOString()};case"LAST_YEAR":return{startTime:new Date(new Date(e).setUTCFullYear((new Date).getUTCFullYear()-1)).toISOString(),endTime:e.toISOString()};case"ALL":return{startTime:void 0,endTime:e.toISOString()};default:throw new Error(`Unexpected start time label: ${t}`)}}(e,t.startTimeLabel):{startTime:t.startTime,endTime:t.endTime}}},27462:function(e,t,n){n.d(t,{F:function(){return r}});var a=n(46709),i=n(40720);const r=({traceSearchLocations:e,reviewAppId:t,labelingSessionId:n,traceIdToItemIdMap:r})=>{const o=(0,i.C)();return(0,a.useMemo)(()=>({deleteTraces:async(e,t)=>o.mutateAsync({experimentId:e,traceRequestIds:t})}),[o])}},28140:function(e,t,n){n.r(t),n.d(t,{default:function(){return I}});var a=n(43979),i=n(59930),r=n.n(i),o=n(91105),s=n(46709),l=n(4168),d=n(79444),c=n(14429),m=n(54741),u=n(48785),T=n(89949),g=n(82716),f=n(27757),p=n(40724),v=n(73408);var h={name:"1vfb318",styles:"flex:1;display:flex;align-items:center;justify-content:center"};const S=({error:e})=>{var t;return(0,v.Y)(g.PageWrapper,{css:h,children:(0,v.Y)(g.Empty,{"data-testid":"fallback",title:(0,v.Y)(p.A,{id:"QXLV8h",defaultMessage:"Error"}),description:null!==(t=null===e||void 0===e?void 0:e.message)&&void 0!==t?t:(0,v.Y)(p.A,{id:"D99bil",defaultMessage:"An error occurred while rendering chat sessions."}),image:(0,v.Y)(f.k,{})})})},b=({children:e})=>(0,v.Y)(T.tH,{fallback:(0,v.Y)(S,{}),children:e});var w=n(27462);var L={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const D=()=>{const{experimentId:e}=(0,o.g)(),[t,n]=(0,s.useState)("");r()(e,"Experiment ID must be defined");const i=(0,d.U)(),{loading:T}=(0,m.L)({experimentId:e}),g=(0,c.Pz)(i.dateNow),f=(0,s.useMemo)(()=>[(0,l.$U)(e)],[e]),p=(0,s.useMemo)(()=>(0,u._)({sessionId:null}),[]),{data:h,isLoading:S,isFetching:b}=(0,l.Zn)({locations:f,timeRange:g,filters:p,searchQuery:t,disabled:!1}),D=(0,w.F)({traceSearchLocations:f}),I=(0,s.useMemo)(()=>({deleteTracesAction:D}),[D]);return(0,v.FD)("div",{css:L,children:[(0,v.Y)(a.J,{viewState:"sessions"}),(0,v.Y)(l.sp,{experimentId:e,traces:null!==h&&void 0!==h?h:[],isLoading:S,searchQuery:t,setSearchQuery:n,traceActions:I})]})};var I=()=>(0,v.Y)(b,{children:(0,v.Y)(d.k,{children:(0,v.Y)(D,{})})})},40720:function(e,t,n){n.d(t,{C:function(){return s}});var a=n(39595),i=n(61060),r=n(12803),o=n(4168);const s=()=>{const e=(0,a.jE)();return(0,i.n)({mutationFn:async({experimentId:e,traceRequestIds:t})=>{const n=[];for(let i=0;i<t.length;i+=100)n.push(t.slice(i,i+100));const a=n.map(t=>r.x.deleteTracesV3(e,t));return{traces_deleted:(await Promise.all(a)).reduce((e,t)=>e+t.traces_deleted,0)}},onSuccess:()=>(0,o.BL)({queryClient:e})})}},43979:function(e,t,n){n.d(t,{J:function(){return c}});var a=n(68248),i=n(82716),r=n(27757),o=n(12998),s=n(84411),l=n(42747),d=n(73408);const c=({viewState:e,sessionId:t,className:n})=>{const{theme:c}=(0,r.u)();return(0,d.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",width:"100%",borderBottom:`1px solid ${c.colors.grey100}`,paddingBottom:`${c.spacing.sm}px`},""),className:n,children:[!("single-chat-session"===e)&&(0,d.Y)(s.$,{}),"single-chat-session"===e&&(0,d.FD)("div",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:c.spacing.sm},""),children:[(0,d.Y)(i.Tag,{color:"default",componentId:"mlflow.chat-sessions.session-header-label",css:(0,a.AH)({padding:c.spacing.xs+2,margin:0},""),children:(0,d.FD)("span",{css:(0,a.AH)({display:"flex",alignItems:"center",gap:c.spacing.sm},""),children:[(0,d.Y)(i.SpeechBubbleIcon,{}),(0,d.Y)(r.T.Text,{ellipsis:!0,bold:!0,children:(0,d.Y)(l.sA,{id:"EAf6xM",defaultMessage:"Session"})})]})}),(0,d.Y)(r.T.Title,{level:3,withoutMargins:!0,children:t}),t&&(0,d.Y)(o.ad,{copyText:t,componentId:"mlflow.chat-sessions.copy-session-id",buttonProps:{icon:void 0}})]})]})}},48785:function(e,t,n){n.d(t,{_:function(){return r}});var a=n(4168),i=n(54313);const r=({sessionId:e})=>{const t=a.tl.CONTAINS;return[{column:`${a.rc}:${i.n2}`,operator:e?a.tl.EQUALS:t,value:null!==e&&void 0!==e?e:""}]}},54741:function(e,t,n){n.d(t,{L:function(){return r}});var a=n(81641);const i=a.J1`
  query MlflowGetExperimentQuery($input: MlflowGetExperimentInput!) @component(name: "MLflow.ExperimentRunTracking") {
    mlflowGetExperiment(input: $input) {
      apiError {
        code
        message
      }
      experiment {
        artifactLocation
        creationTime
        experimentId
        lastUpdateTime
        lifecycleStage
        name
        tags {
          key
          value
        }
      }
    }
  }
`,r=({experimentId:e,options:t={}})=>{var n;const{data:r,loading:o,error:s,refetch:l}=(0,a.IT)(i,{variables:{input:{experimentId:e}},skip:!e,...t});return{loading:o,data:null===r||void 0===r||null===(n=r.mlflowGetExperiment)||void 0===n?void 0:n.experiment,refetch:l,apolloError:s,apiError:(()=>{var e;return null===r||void 0===r||null===(e=r.mlflowGetExperiment)||void 0===e?void 0:e.apiError})()}}},76256:function(e,t,n){n.d(t,{L:function(){return i},S:function(){return r}});var a=n(43617);function i(e,t){return(0,a.N4)(t)}const r=a.N4},79444:function(e,t,n){n.d(t,{U:function(){return d},k:function(){return l}});var a=n(76118),i=n(46709),r=n(73408);const o=()=>({dateNow:new Date,lastRefreshTime:Date.now(),refresh:()=>{}}),s=(0,i.createContext)(o()),l=({config:e,children:t})=>{const n=o(),l=(0,a.merge)({},n,e),[d,c]=i.useState(l.lastRefreshTime),m=(0,i.useMemo)(()=>new Date(d),[d]),u=(0,i.useCallback)(()=>{c(Date.now())},[]);return(0,r.Y)(s.Provider,{value:{...l,dateNow:m,lastRefreshTime:d,refresh:u},children:t})},d=()=>{const e=(0,i.useContext)(s);return e||o()}},84411:function(e,t,n){n.d(t,{$:function(){return h}});var a=n(68248),i=n(46709),r=n(82716),o=n(27757),s=n(79081),l=n(4168),d=n(42747),c=n(92338),m=n(14429),u=n(76118),T=n(16453),g=n(79444),f=n(39595),p=n(92388),v=n(73408);const h=i.memo(function({excludeOptions:e,refreshButtonComponentId:t="mlflow.experiment-evaluation-monitoring.refresh-date-button"}){const n=(0,d.tz)(),{theme:h}=(0,o.u)(),S=(0,f.jE)(),b=(0,p.C)({queryKey:[l.TH]}),[w,L]=(0,m.VA)(),D=(0,i.useMemo)(()=>{const t=(0,c.p)(n);return null!==e&&void 0!==e&&e.length?t.filter(t=>!e.includes(t.key)):t},[n,e]),I=n.formatMessage({id:"BJvcsS",defaultMessage:"Time Range"}),y=(0,g.U)();return(0,v.FD)("div",{css:(0,a.AH)({display:"flex",gap:h.spacing.sm,alignItems:"center"},""),children:[(0,v.FD)(r.DialogCombobox,{componentId:"mlflow.experiment-evaluation-monitoring.date-selector",label:I,value:w.startTimeLabel?[w.startTimeLabel]:[m.oy],children:[(0,v.Y)(r.DialogComboboxTrigger,{renderDisplayedValue:e=>{var t;return null===(t=D.find(t=>t.key===e))||void 0===t?void 0:t.label},allowClear:!(0,u.isNil)(w.startTimeLabel)&&w.startTimeLabel!==m.oy,onClear:()=>{L({startTimeLabel:m.oy})},"data-testid":"time-range-select-dropdown"}),(0,v.Y)(r.DialogComboboxContent,{children:(0,v.Y)(r.DialogComboboxOptionList,{children:D.map(e=>(0,v.Y)(r.DialogComboboxOptionListSelectItem,{checked:w.startTimeLabel===e.key||e.key===m.oy&&(0,u.isNil)(w.startTimeLabel),title:e.label,"data-testid":`time-range-select-${e}`,value:e.key,onChange:()=>{L({...w,startTimeLabel:e.key})},children:e.label},e.key))})})]}),"CUSTOM"===w.startTimeLabel&&(0,v.Y)(v.FK,{children:(0,v.Y)(T.cv,{id:"date-picker-range",includeTime:!0,selected:{from:new Date(w.startTime),to:w.endTime?new Date(w.endTime):y.dateNow},onChange:e=>{const t=e.target.value;L({...w,startTime:null!==t&&void 0!==t&&t.from?t.from.toISOString():void 0,endTime:null!==t&&void 0!==t&&t.to?t.to.toISOString():void 0})},startDatePickerProps:{componentId:"experiment-evaluation-monitoring-start-date-picker",datePickerProps:{disabled:{after:y.dateNow}},value:w.startTime?new Date(w.startTime):void 0},endDatePickerProps:{componentId:"experiment-evaluation-monitoring-end-date-picker",datePickerProps:{disabled:{after:y.dateNow}},value:w.endTime?new Date(w.endTime):void 0}})}),(0,v.Y)(s.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:n.formatMessage({id:"Arvaod",defaultMessage:"Showing data up to {date}."},{date:y.dateNow.toLocaleString(navigator.language,{timeZoneName:"short"})}),children:(0,v.Y)(o.B,{type:"link",componentId:t,disabled:Boolean(b),onClick:()=>{y.refresh(),(0,l.BL)({queryClient:S})},children:(0,v.Y)(r.RefreshIcon,{})})})]})})},92338:function(e,t,n){function a(e){return[{key:"LAST_HOUR",label:e.formatMessage({id:"bjoGjg",defaultMessage:"Last hour"})},{key:"LAST_24_HOURS",label:e.formatMessage({id:"JChRnq",defaultMessage:"Last 24 hours"})},{key:"LAST_7_DAYS",label:e.formatMessage({id:"eQsXm7",defaultMessage:"Last 7 days"})},{key:"LAST_30_DAYS",label:e.formatMessage({id:"p1H1KR",defaultMessage:"Last 30 days"})},{key:"LAST_YEAR",label:e.formatMessage({id:"EI7moF",defaultMessage:"Last year"})},{key:"ALL",label:e.formatMessage({id:"HeNa8H",defaultMessage:"All"})},{key:"CUSTOM",label:e.formatMessage({id:"TpmJlu",defaultMessage:"Custom"})}]}n.d(t,{p:function(){return a}})}}]);