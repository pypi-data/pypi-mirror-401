"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[7913],{110:function(e,t,n){n.d(t,{N_:function(){return a},Oz:function(){return l},g:function(){return o},zy:function(){return i}});var r=n(27637),s=n(58024);const o=s.g,i=s.zy,a=r.N_,l=e=>e},777:function(e,t,n){n.d(t,{S:function(){return g}});var r=n(68248),s=n(76118),o=n(82716),i=n(27757),a=n(79081),l=n(73408);var u={name:"1gyqtrv",styles:"width:min-content;max-width:100%"},c={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const d=({objectKey:e,value:t})=>{const{theme:n}=(0,i.u)(),d=(0,s.isString)(t)?t:JSON.stringify(t);return(0,l.Y)(a.T,{content:d,componentId:"shared.model-trace-explorer.expectation-value-preview-tooltip",children:(0,l.Y)(o.Tag,{color:"indigo",componentId:"shared.model-trace-explorer.expectation-array-item-tag",css:u,children:(0,l.FD)(i.T.Text,{css:c,children:[e&&(0,l.FD)(i.T.Text,{bold:!0,css:(0,r.AH)({marginRight:n.spacing.xs},""),children:[e,":"]}),d]})})})},g=({parsedValue:e,singleLine:t=!1})=>{const{theme:n}=(0,i.u)();return(0,s.isNil)(e)?null:Array.isArray(e)?t?(0,l.Y)(d,{value:e}):(0,l.Y)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:e.map((e,t)=>(0,l.Y)(d,{value:e},t))}):(0,s.isObject)(e)?t?(0,l.Y)(d,{value:e}):(0,l.Y)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:Object.entries(e).map(([e,t])=>(0,l.Y)(d,{objectKey:e,value:t},e))}):(0,l.Y)(d,{value:e})}},3448:function(e,t,n){n.d(t,{_:function(){return y}});var r=n(68248),s=n(76118),o=n(46709),i=n(27757),a=n(26059),l=n(3241),u=n(53915),c=n(33045),d=n(72125),g=n(8531),p=n(81390),m=n(73408);var f={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},h={name:"82a6rk",styles:"flex:1"};const y=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:y})=>{const{theme:v}=(0,i.u)(),S=(0,o.useRef)(null),[x,b]=(0,o.useState)(500),{selectedNode:_,setSelectedNode:A,activeTab:I,setActiveTab:N,isInComparisonView:k,updatePaneSizeRatios:O,getPaneSizeRatios:w,topLevelNodes:T}=(0,u.nJ)(),{expandedKeys:Y,setExpandedKeys:j}=(0,p.B$)({rootNodes:T,initialExpandDepth:p.vf}),C=(0,o.useCallback)(e=>{O({detailsPane:e})},[O]),{matchData:D,searchFilter:M,setSearchFilter:E,spanFilterState:Z,setSpanFilterState:F,filteredTreeNodes:R,handleNextSearchMatch:P,handlePreviousSearchMatch:H}=(0,c.u)({treeNodes:T,selectedNode:_,setSelectedNode:A,setActiveTab:N,setExpandedKeys:j,modelTraceInfo:e});(0,o.useLayoutEffect)(()=>{const e=(0,s.values)((0,p.dM)(R,p.vf)).map(e=>e.key);j(new Set(e))},[R,j]);const z=(0,o.useMemo)(()=>{const e=Math.max(...R.map(p.EA))*p.De+7*v.spacing.lg;return Math.max(275,e)},[R,v.spacing.lg]),{traceStartTime:V,traceEndTime:$}=(0,o.useMemo)(()=>{if(!T||0===T.length)return{traceStartTime:0,traceEndTime:0};return{traceStartTime:Math.min(...T.map(e=>e.start)),traceEndTime:Math.max(...T.map(e=>e.end))}},[T]);return(0,m.FD)("div",{css:f,className:t,children:[(0,m.Y)("div",{css:(0,r.AH)({padding:v.spacing.xs,borderBottom:`1px solid ${v.colors.border}`},""),children:(0,m.Y)(l.A,{searchFilter:M,setSearchFilter:E,matchData:D,handleNextSearchMatch:P,handlePreviousSearchMatch:H})}),(0,m.Y)(a.A,{ref:S,initialRatio:w().detailsPane,paneWidth:x,setPaneWidth:b,onRatioChange:C,leftChild:(0,m.Y)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:z},""),children:(0,m.Y)(g.a,{rootNodes:R,selectedNode:_,traceStartTime:V,traceEndTime:$,setSelectedNode:e=>{A(e),(0,s.isString)(null===e||void 0===e?void 0:e.key)&&(null===y||void 0===y||y(null===e||void 0===e?void 0:e.key))},css:h,expandedKeys:Y,setExpandedKeys:j,spanFilterState:Z,setSpanFilterState:F})}),leftMinWidth:z,rightChild:(0,m.Y)(d.aW,{activeSpan:_,searchFilter:M,activeMatch:D.match,activeTab:I,setActiveTab:N}),rightMinWidth:d.gr})]})}},4564:function(e,t,n){n.d(t,{V:function(){return a}});var r=n(68248),s=n(27757),o=n(79081),i=n(73408);const a=({source:e})=>{const{theme:t}=(0,s.u)();return(0,i.Y)(o.T,{componentId:"shared.model-trace-explorer.assessment-source-name",content:e.source_id,children:(0,i.Y)("span",{css:(0,r.AH)({flexShrink:1,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",marginLeft:t.spacing.sm,minWidth:t.spacing.md},""),children:(0,i.Y)(s.T.Text,{children:(0,i.Y)("span",{css:(0,r.AH)({color:t.colors.blue500},""),children:e.source_id})})})})}},9773:function(e,t,n){n.d(t,{oi:function(){return oe},KF:function(){return u},pL:function(){return c},nW:function(){return f},u6:function(){return h},Yv:function(){return x},f1:function(){return b},iU:function(){return J},Pn:function(){return L},DE:function(){return O},Sy:function(){return w},HD:function(){return Z},oI:function(){return R},Hy:function(){return $},W3:function(){return V},xW:function(){return T.xW},m$:function(){return T.m$},a8:function(){return T.a8},bS:function(){return T.bS},AG:function(){return T.AG},n_:function(){return T.n_},pN:function(){return le},Ii:function(){return me},TY:function(){return fe},fJ:function(){return X},QA:function(){return ee},o0:function(){return Ae},LO:function(){return Ie},Nw:function(){return ke}});var r=n(76118),s=n(86125);const o=e=>{if((0,r.isNil)(e))return!1;if((0,r.has)(e,"type")){if("text"===e.type&&(0,r.has)(e,"text")&&(0,r.isString)(e.text))return!0;if("image"===e.type&&(0,r.has)(e,"source")&&(0,r.has)(e.source,"type")){if("base64"===e.source.type&&(0,r.has)(e.source,"media_type")&&(0,r.isString)(e.source.media_type)&&["image/jpeg","image/png","image/gif","image/webp"].includes(e.source.media_type)&&(0,r.has)(e.source,"data")&&(0,r.isString)(e.source.data))return!0;if("url"===e.source.type&&(0,r.has)(e.source,"url")&&(0,r.isString)(e.source.url))return!0}if("tool_use"===e.type&&(0,r.has)(e,"id")&&(0,r.has)(e,"name")&&(0,r.has)(e,"input"))return(0,r.isString)(e.id)&&(0,r.isString)(e.name)&&(0,r.isObject)(e.input);if("tool_result"===e.type&&(0,r.has)(e,"tool_use_id")&&(0,r.has)(e,"content"))return(0,r.isString)(e.tool_use_id)&&(0,r.isString)(e.content);if("thinking"===e.type&&(0,r.has)(e,"thinking")&&(0,r.isString)(e.thinking))return!0}return!1},i=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.has)(e,"role")&&(0,r.isString)(e.role)&&["user","assistant"].includes(e.role),n="content"in e&&((0,r.isString)(e.content)||(0,r.isArray)(e.content)&&e.content.every(o));return t&&n},a=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":switch(e.source.type){case"base64":return{type:"image_url",image_url:{url:`data:${e.source.media_type};base64,${e.source.data}`}};case"url":return{type:"image_url",image_url:{url:e.source.url}}}}throw new Error(`Unsupported content block type: ${e.type}`)},l=e=>{const t=[];if("string"===typeof e.content){const n=(0,s.ZI)({type:"message",content:e.content,role:e.role});n&&t.push(n)}else{const{messages:n,textParts:r,toolCalls:o,thinking:i}=(e=>{const t=[],n=[],r=[],s=[];for(const o of e)"text"===o.type||"image"===o.type?n.push(a(o)):"tool_use"===o.type?r.push({id:o.id,function:{name:o.name,arguments:JSON.stringify(o.input)}}):"tool_result"===o.type?t.push({role:"tool",tool_call_id:o.tool_use_id,content:o.content}):"thinking"===o.type&&s.push(o.thinking);return{messages:t,textParts:n,toolCalls:r,thinking:s.length>0?s.join("\n\n"):null}})(e.content);if(t.push(...n),r.length>0||o.length>0){const n=(0,s.ZI)({type:"message",content:r.length>0?r:void 0,role:e.role,...o.length>0&&{tool_calls:o}});n&&(i?t.push({...n,reasoning:i}):t.push(n))}}return t},u=e=>{if(!(0,r.isObject)(e))return null;if("messages"in e&&(0,r.isArray)(e.messages)&&e.messages.every(i)){const t=[];for(const n of e.messages)t.push(...l(n));return t}return null},c=e=>(0,r.isObject)(e)&&(0,r.has)(e,"type")&&"message"===e.type&&i(e)?l(e):null,d=e=>(0,r.isObject)(e)&&(0,r.isString)((0,r.get)(e,"id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments")),g=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.get)(e,"type");if(t){if("SystemMessage"===t)return(0,r.isString)((0,r.get)(e,"content"));if("UserMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source");if("AssistantMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source");if("FunctionMessage"===t)return(0,r.has)(e,"content")&&(0,r.has)(e,"source")}return!(!(0,r.has)(e,"source")||!["system","user","assistant","function"].includes((0,r.get)(e,"source")))&&(0,r.has)(e,"content")},p=e=>(0,r.isString)(e)?(0,s.ZI)({type:"message",content:e,role:"assistant"}):(0,r.isArray)(e)&&e.every(d)?{role:"assistant",tool_calls:e.map(e=>(0,s.CL)({id:e.id,function:{name:e.name,arguments:e.arguments}}))}:null,m=e=>{if("SystemMessage"===e.type)return(0,s.ZI)({type:"message",content:e.content,role:"system"});if("UserMessage"===e.type){if((0,r.isString)(e.content))return(0,s.ZI)({type:"message",content:e.content,role:"user"});if((0,r.isArray)(e.content)){const t=e.content.filter(e=>(0,r.isString)(e)||(0,r.isObject)(e)&&"text"===e.type).map(e=>(0,r.isString)(e)?{type:"text",text:e}:e);if(t.length>0)return(0,s.ZI)({type:"message",content:t,role:"user"})}}if("AssistantMessage"===e.type)return p(e.content);if("FunctionMessage"===e.type)return(0,s.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"});if("system"===e.source)return(0,s.ZI)({type:"message",content:e.content,role:"system"});if("user"===e.source){if((0,r.isString)(e.content))return(0,s.ZI)({type:"message",content:e.content,role:"user"});if((0,r.isArray)(e.content)){const t=e.content.filter(e=>(0,r.isString)(e)).map(e=>({type:"text",text:e}));if(t.length>0)return(0,s.ZI)({type:"message",content:t,role:"user"})}}return"assistant"===e.source?p(e.content):"function"===e.source?(0,s.ZI)({type:"message",content:JSON.stringify(e.content),role:"user"}):null},f=e=>{if((0,r.isNil)(e))return null;if((0,r.isArray)(e)&&e.length>0&&e.every(g))return(0,r.compact)(e.map(m));if((0,r.isObject)(e)&&"messages"in e){const t=e.messages;if((0,r.isArray)(t)&&t.length>0&&t.every(g))return(0,r.compact)(t.map(m))}return null},h=e=>{if((0,r.isNil)(e))return null;if((0,r.isArray)(e)&&e.length>0&&e.every(g))return(0,r.compact)(e.map(m));if((0,r.isObject)(e)&&"content"in e){const t=(0,s.ZI)({role:"assistant",content:e.content,type:"message"});return t?[t]:null}return null},y=e=>{if(e.text)return{type:"text",text:e.text};if(e.json)return{type:"text",text:JSON.stringify(e.json)};if(e.image){const t=e.image.source.bytes,n=e.image.format;let r;if("string"===typeof t)r=t;else{r=Buffer.from(t).toString("base64")}return{type:"image_url",image_url:{url:`data:${`image/${n}`};base64,${r}`}}}return null},v=e=>{let t=e.role;const n=[],r=[];let o;for(const l of e.content)if(l.toolUse){const e=l.toolUse,t="string"===typeof e.input?e.input:JSON.stringify(e.input);r.push((0,s.CL)({id:e.toolUseId,function:{name:e.name,arguments:t}}))}else if(l.toolResult){o=l.toolResult.toolUseId,t="tool";for(const e of l.toolResult.content){const t=y(e);t&&n.push(t)}}else{const e=y(l);e&&n.push(e)}let i="";n.length>0&&(i=n.map(e=>"text"===e.type?e.text:"image_url"===e.type?`[Image: ${e.image_url.url}]`:"").filter(e=>e.length>0).join(" "));const a={role:t,content:i};return r.length>0&&(a.tool_calls=r),o&&(a.tool_call_id=o),a},S=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.has)(e,"role")&&(0,r.isString)(e.role)&&["user","assistant","system"].includes(e.role),n=(0,r.has)(e,"content")&&(0,r.isArray)(e.content);return t&&n},x=e=>{if((0,r.isNil)(e))return null;if((0,r.isObject)(e)&&"messages"in e){const t=e.messages;if((0,r.isArray)(t)&&t.length>0&&t.every(S))return(0,r.compact)(t.map(v))}return null},b=e=>{if((0,r.isNil)(e))return null;if((0,r.isObject)(e)&&"output"in e){const t=e.output;if((0,r.isObject)(t)&&"message"in t){const e=t.message;if(S(e))return[v(e)]}}return null},_=e=>(0,r.isObject)(e)&&"text"in e&&(0,r.isString)(e.text),A=e=>!0===e.thought,I=e=>(0,r.isObject)(e)&&"role"in e&&(0,r.isString)(e.role)&&["user","model"].includes(e.role)&&(0,r.has)(e,"parts")&&Array.isArray(e.parts)&&e.parts.every(_),N=e=>(0,r.isObject)(e)&&"content"in e&&I(e.content),k=e=>{const t=[],n=[];for(const r of e)A(r)?n.push(r.text):t.push({type:"text",text:r.text});return{textParts:t,thinking:n.length>0?n.join("\n\n"):null}},O=e=>{if(!(0,r.isObject)(e))return null;if("contents"in e){if((0,r.isString)(e.contents)){const t=(0,s.ZI)({type:"message",content:e.contents,role:"user"});return t&&[t]}if((0,r.isArray)(e.contents)&&e.contents.every(I))return(0,r.compact)(e.contents.map(e=>{const t="model"===e.role?"assistant":e.role,{textParts:n,thinking:r}=k(e.parts),o=(0,s.ZI)({type:"message",content:n.length>0?n:void 0,role:t});return o&&r?{...o,reasoning:r}:o}))}return null},w=e=>(0,r.isObject)(e)&&"candidates"in e&&(0,r.isArray)(e.candidates)&&e.candidates.every(N)?(0,r.compact)(e.candidates.flatMap(e=>e.content).map(e=>{const t="model"===e.role?"assistant":e.role,{textParts:n,thinking:r}=k(e.parts),o=(0,s.ZI)({type:"message",content:n.length>0?n:void 0,role:t});return o&&r?{...o,reasoning:r}:o})):null;var T=n(69660);const Y=e=>{if(e)return"string"===typeof e?e:Array.isArray(e)?e.filter(e=>"text"===e.type&&e.text).map(e=>e.text).join("\n\n"):void 0},j=e=>{var t;let n,o,i;switch(e.type){case"user":case"human":n="user";break;case"assistant":case"ai":n="assistant";break;case"system":n="system";break;case"tool":n="tool";break;case"function":n="function";break;default:return null}if((0,r.isString)(e.content))o=e.content;else if(Array.isArray(e.content)){const t=[],n=[];for(const s of e.content){var a;if((0,r.isString)(s))n.push(s);else if("thinking"===s.type&&s.thinking){const e=Y(s.thinking);e&&t.push(e)}else"text"===s.type&&s.text?n.push(s.text):"image_url"===s.type&&null!==(a=s.image_url)&&void 0!==a&&a.url&&n.push(`![](${s.image_url.url})`)}t.length>0&&(i=t.join("\n\n")),o=n.filter(Boolean).join("\n\n")}else o=void 0;const l={content:o,role:n,...i&&{reasoning:i}},u=e.tool_calls,c=null===(t=e.additional_kwargs)||void 0===t?void 0:t.tool_calls;return!(0,r.isNil)(u)&&Array.isArray(u)&&u.length>0&&u.every(M)?l.tool_calls=(0,r.compact)(u.map(C)):!(0,r.isNil)(c)&&Array.isArray(c)&&c.length>0&&c.every(s.h8)&&(l.tool_calls=c.map(s.CL)),(0,r.isNil)(e.tool_call_id)||(l.tool_call_id=e.tool_call_id),l},C=e=>({id:e.id,function:{arguments:JSON.stringify(e.args,null,2),name:e.name}}),D=e=>!!e&&(!!((0,r.isNil)(e.content)||(0,r.isString)(e.content)||Array.isArray(e.content))&&["human","user","assistant","ai","system","tool","function"].includes(e.type)),M=e=>e&&(0,r.isString)(e.name)&&(0,r.has)(e,"args")&&(0,r.isString)(e.id),E=e=>e&&D(e.message),Z=e=>{if(Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&e[0].length>0&&e[0].every(D)){const t=e[0].map(j);return t.some(e=>null===e)?null:t}if(Array.isArray(null===e||void 0===e?void 0:e.messages)&&e.messages.length>0&&e.messages.every(D)){const t=e.messages.map(j);return t.some(e=>null===e)?null:t}if(Array.isArray(e)&&e.length>0&&e.every(D)){const t=e.map(j);return t.some(e=>null===e)?null:t}return null},F=e=>{const t=e.map(e=>j(e.message));return t.some(e=>null===e)?null:t},R=e=>(e=>!(!Array.isArray(e)||e.length<1)&&!(!Array.isArray(e[0])||e[0].length<1)&&e[0].every(E))(e)?F(e[0]):Array.isArray(null===e||void 0===e?void 0:e.generations)&&e.generations.length>0&&e.generations[0].every(E)?F(e.generations[0]):null,P=e=>{const t=(0,r.get)(e,"text");return"text"===(0,r.get)(e,"block_type")&&(0,r.isString)(t)},H=e=>{const t=(0,r.get)(e,"blocks"),n=(0,r.get)(e,"role");return(0,r.isString)(n)&&["assistant","system","user"].includes(n)&&(0,r.isArray)(t)&&t.every(P)},z=e=>(0,s.ZI)({role:e.role,content:e.blocks.map(e=>({type:"text",text:e.text}))}),V=e=>{if(!(e=>H((0,r.get)(e,"message")))(e))return null;const t=z(e.message);return t&&[t]},$=e=>(e=>{const t=(0,r.get)(e,"messages");return(0,r.isArray)(t)&&t.every(H)})(e)?(0,r.compact)(e.messages.map(z)):null,J=e=>{if((0,r.has)(e,"messages")&&(0,r.isArray)(e.messages)){return e.messages.map(e=>(0,s.ZI)({type:"message",content:(0,r.isString)(e.content)?W(e.content):e.content,role:e.role})).filter(Boolean)}return null},L=e=>{if((0,r.isArray)(e)&&e.length>0&&e.every(r.isString)){const t=W(e.join("\n")),n=(0,s.ZI)({type:"message",content:t,role:"assistant"});return n&&[n]}return null},W=e=>e.replace(/\r\n/g,"\n").replace(/(^|[^\n])\n(?!\n)/g,(e,t)=>`${t}  \n`),B=e=>{if(!(0,r.isObject)(e)||!(0,r.has)(e,"type"))return!1;const t=e;return!("text"!==t.type||!(0,r.has)(e,"text")||!(0,r.isString)(t.text))||("image"===t.type&&(0,r.has)(e,"image")?(0,r.isString)(t.image):!!U(e)||!("tool-result"!==t.type||!(0,r.has)(e,"output")))},U=e=>!!(0,r.isObject)(e)&&((0,r.has)(e,"toolCallId")&&(0,r.has)(e,"toolName")&&(0,r.has)(e,"input")),K=e=>{if(!(0,r.isObject)(e))return!1;const t=e;if(!((0,r.has)(e,"role")&&(0,r.isString)(t.role)&&["user","assistant","system","tool","function"].includes(t.role)))return!1;return(0,r.has)(e,"content")&&((0,r.isString)(t.content)||(0,r.isArray)(t.content)&&t.content.every(B))},G=e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image}};case"tool-call":return{type:"text",text:""};case"tool-result":return{type:"text",text:JSON.stringify(e.output)}}},q=e=>{if("string"===typeof e.content)return(0,s.ZI)({type:"message",content:e.content,role:e.role,...e.name&&{name:e.name}});{var t;const n=e.content.map(G),r=e.content.filter(e=>"tool-call"===e.type).map(Q),o=null===(t=e.content.find(e=>"tool-result"===e.type))||void 0===t?void 0:t.toolCallId;return(0,s.ZI)({content:n,role:e.role,...e.name&&{name:e.name},...o&&{tool_call_id:o},...r&&r.length>0&&{tool_calls:r}})}},Q=e=>({id:e.toolCallId,function:{name:e.toolName,arguments:JSON.stringify(e.input)}}),X=e=>{if(!(0,r.isObject)(e))return null;const t=e;return(0,r.has)(e,"messages")&&(0,r.isArray)(t.messages)&&t.messages.every(K)?(0,r.compact)(t.messages.map(q)):null},ee=e=>{if(!(0,r.isObject)(e))return null;const t=e;return(0,r.has)(e,"text")&&(0,r.isString)(t.text)?(0,r.compact)([(0,s.ZI)({type:"message",content:t.text,role:"assistant"})]):(0,r.has)(e,"toolCalls")&&(0,r.isArray)(t.toolCalls)&&t.toolCalls.every(U)?(0,r.compact)([(0,s.ZI)({type:"message",content:"",role:"assistant",tool_calls:(0,r.compact)(t.toolCalls.map(Q))})]):null},te=e=>(0,r.isObject)(e)&&"text"===(0,r.get)(e,"type")&&(0,r.isString)((0,r.get)(e,"content")),ne=e=>{if(!(0,r.isObject)(e)||"tool_call"!==(0,r.get)(e,"type"))return!1;if(!(0,r.isString)((0,r.get)(e,"name")))return!1;const t=(0,r.get)(e,"id");return(0,r.isNil)(t)||(0,r.isString)(t)},re=e=>{if(!(0,r.isObject)(e)||"tool_call_response"!==(0,r.get)(e,"type"))return!1;const t=(0,r.get)(e,"id");return!(!(0,r.isNil)(t)&&!(0,r.isString)(t))&&(0,r.has)(e,"response")},se=e=>te(e)||ne(e)||re(e),oe=e=>{if(!(0,r.isObject)(e))return!1;const t=(0,r.get)(e,"role");return!(!(0,r.isString)(t)||!["system","user","assistant","tool"].includes(t))&&(!(!(0,r.has)(e,"parts")||!(0,r.isArray)(e.parts)||0===e.parts.length)&&e.parts.every(se))},ie=e=>{var t,n;const s=(0,r.get)(e,"arguments");let o="";try{o=JSON.stringify(null!==s&&void 0!==s?s:{})}catch{o=String(s)}return{id:String(null!==(t=null!==(n=(0,r.get)(e,"id"))&&void 0!==n?n:(0,r.get)(e,"name"))&&void 0!==t?t:""),function:{name:String((0,r.get)(e,"name")),arguments:o}}},ae=e=>{var t;const n=String(null!==(t=(0,r.get)(e,"id"))&&void 0!==t?t:""),s=(0,r.get)(e,"response");return{role:"tool",tool_call_id:n,content:(0,r.isString)(s)?s:(()=>{try{return JSON.stringify(s)}catch{return String(s)}})()}},le=e=>{if(!oe(e))return null;const t=e.role,n=[],r=[];let o=null;for(const s of e.parts)te(s)?n.push({type:"text",text:s.content}):ne(s)?r.push(ie(s)):re(s)&&(o=ae(s));return o&&0===n.length&&0===r.length?o:(0,s.ZI)({type:"message",role:t,...e.name&&{name:e.name},...n.length>0&&{content:n},...r.length>0&&{tool_calls:r}})},ue=e=>(0,r.isObject)(e)&&(0,r.has)(e,"kind")&&"request"===e.kind&&(0,r.has)(e,"parts")&&(0,r.isArray)(e.parts),ce=e=>(0,r.isObject)(e)&&(0,r.has)(e,"kind")&&"response"===e.kind&&(0,r.has)(e,"parts")&&(0,r.isArray)(e.parts),de=e=>{return{id:e.tool_call_id,function:{name:e.tool_name,arguments:(t=e.args,(0,r.isNil)(t)?"{}":(0,r.isString)(t)?t:JSON.stringify(t,null,2))}};var t},ge=e=>{const t=[];for(const n of e.parts)switch(n.part_kind){case"system-prompt":{const e=(0,s.ZI)({role:"system",content:n.content});e&&t.push(e);break}case"user-prompt":{const e=(0,s.ZI)({role:"user",content:n.content});e&&t.push(e);break}case"tool-return":case"builtin-tool-return":{const e=(0,r.isString)(n.content)?n.content:JSON.stringify(n.content,null,2),o=(0,s.ZI)({role:"tool",content:e,tool_call_id:n.tool_call_id});o&&t.push(o);break}}return t},pe=e=>{const t=[],n=[],r=[],o=[];for(const s of e.parts)switch(s.part_kind){case"text":n.push(s.content);break;case"thinking":r.push(s.content);break;case"tool-call":case"builtin-tool-call":o.push(de(s));break;case"file":n.push("[file]")}const i=n.length>0?n.join("\n\n"):void 0,a=r.length>0?r.join("\n\n"):void 0,l=(0,s.ZI)({role:"assistant",content:i,...o.length>0&&{tool_calls:o}});return l&&t.push(a?{...l,reasoning:a}:l),t},me=e=>{if(!e)return null;if((0,r.isObject)(e)&&(0,r.has)(e,"message_history")){const t=e.message_history;if((0,r.isArray)(t)&&t.length>0){const e=[];for(const n of t)ue(n)?e.push(...ge(n)):ce(n)&&e.push(...pe(n));return e.length>0?e:null}}if((0,r.isArray)(e)&&e.length>0){const t=[];for(const n of e)ue(n)?t.push(...ge(n)):ce(n)&&t.push(...pe(n));return t.length>0?t:null}return ue(e)?ge(e):null},fe=e=>{if(!e)return null;if((0,r.isObject)(e)&&(0,r.has)(e,"_new_messages_serialized")){const t=e._new_messages_serialized;if((0,r.isArray)(t)&&t.length>0){const e=[];for(const n of t)ue(n)?e.push(...ge(n)):ce(n)&&e.push(...pe(n));return e.length>0?e:null}}if((0,r.isArray)(e)&&e.length>0){const t=[];for(const n of e)ue(n)?t.push(...ge(n)):ce(n)&&t.push(...pe(n));return t.length>0?t:null}return ce(e)?pe(e):null},he=e=>{if(!(0,r.isObject)(e))return!1;const t=e;return"text"===t.type&&(0,r.isString)(t.text)},ye=e=>{if(!(0,r.isObject)(e))return!1;const t=e;return"tool-call"===t.type&&(0,r.isString)(t.toolCallId)&&(0,r.isString)(t.toolName)},ve=e=>{if(!(0,r.isObject)(e))return!1;const t=e;return"tool-result"===t.type&&(0,r.isString)(t.toolCallId)&&(0,r.isString)(t.toolName)},Se=e=>he(e)||ye(e)||ve(e),xe=e=>{if(!(0,r.isObject)(e))return!1;const t=e;return!!((0,r.has)(e,"role")&&(0,r.isString)(t.role)&&["system","user","assistant","tool"].includes(t.role))&&(!!(0,r.isString)(t.content)||!!(0,r.isArray)(t.content)&&t.content.every(Se))},be=e=>{const t=[];for(const n of e)he(n)&&t.push(n.text);return t.join("\n\n")},_e=e=>{if((0,r.isString)(e.content))return(0,s.ZI)({role:e.role,content:e.content});const t=e.content;if("tool"===e.role){const e=(e=>{for(const t of e)if(ve(t)){const e=t.output;return"json"===(null===e||void 0===e?void 0:e.type)&&null!==e&&void 0!==e&&e.value?JSON.stringify(e.value,null,2):JSON.stringify(e,null,2)}})(t),n=(e=>{for(const t of e)if(ve(t))return t.toolCallId})(t);return(0,s.ZI)({role:"tool",content:e,...n&&{tool_call_id:n}})}if("assistant"===e.role){const e=be(t),n=(e=>{const t=[];for(const n of e)ye(n)&&t.push({id:n.toolCallId,function:{name:n.toolName,arguments:JSON.stringify(n.input,null,2)}});return t})(t);return(0,s.ZI)({role:"assistant",content:e||void 0,...n.length>0&&{tool_calls:n}})}const n=be(t);return(0,s.ZI)({role:e.role,content:n})},Ae=e=>{let t=null;if((0,r.isString)(e))try{const n=JSON.parse(e);(0,r.isArray)(n)&&(t=n)}catch{return null}else(0,r.isArray)(e)&&(t=e);return t&&0!==t.length&&t.every(xe)?(0,r.compact)(t.map(_e)):null},Ie=e=>{if((0,r.isString)(e)&&e.trim().length>0){const t=(0,s.ZI)({role:"assistant",content:e});return t?[t]:null}return null},Ne=e=>{var t;if(Array.isArray(e.attributes)){var n;const t=e.attributes.find(e=>"tool.call.id"===e.key);return null!==(n=null===t||void 0===t?void 0:t.value.string_value)&&void 0!==n?n:""}return null===(t=e.attributes)||void 0===t?void 0:t["tool.call.id"]},ke=(e,t,n)=>{const o=[],i=Ae(e);if(!i||0===i.length)return null;o.push(...i);const a=n.filter(e=>{var t;if(Array.isArray(e.attributes)){const t=e.attributes.find(e=>"span.type"===e.key);return"tool"===(null===t||void 0===t?void 0:t.value.string_value)}return"tool"===(null===(t=e.attributes)||void 0===t?void 0:t["span.type"])});if(a.length>0){const e=a.map(e=>{const t=Ne(e),n=(e=>{var t;if(Array.isArray(e.attributes)){var n;const t=e.attributes.find(e=>"tool.name"===e.key);return null!==(n=null===t||void 0===t?void 0:t.value.string_value)&&void 0!==n?n:""}return null===(t=e.attributes)||void 0===t?void 0:t["tool.name"]})(e),s=e.inputs;return{id:t,function:{name:n,arguments:(0,r.isObject)(s)?JSON.stringify(s,null,2):String(null!==s&&void 0!==s?s:"")}}}),t=(0,s.ZI)({role:"assistant",content:void 0,tool_calls:e});t&&o.push(t);for(const n of a){const e=Ne(n),t=n.outputs,i=(0,r.isObject)(t)?JSON.stringify(t,null,2):String(null!==t&&void 0!==t?t:""),a=(0,s.ZI)({role:"tool",content:i,tool_call_id:e});a&&o.push(a)}}if((0,r.isString)(t)&&t.trim().length>0){const e=(0,s.ZI)({role:"assistant",content:t});e&&o.push(e)}return o.length>0?o:null}},15929:function(e,t,n){n.d(t,{F:function(){return u}});var r=n(68248),s=n(82716),o=n(27757),i=n(73408);var a={name:"15currb",styles:"display:flex;height:100%"},l={name:"82a6rk",styles:"flex:1"};const u=({label:e})=>{const{theme:t}=(0,o.u)();return(0,i.FD)("div",{css:a,children:[(0,i.FD)("div",{css:l,children:[(0,i.Y)("div",{css:(0,r.AH)({padding:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,i.Y)(s.TitleSkeleton,{label:e})}),(0,i.FD)("div",{css:(0,r.AH)({borderRadius:t.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,i.Y)("div",{css:(0,r.AH)({flex:1,padding:t.spacing.sm,borderRight:`1px solid ${t.colors.border}`},""),children:(0,i.Y)(s.TableSkeleton,{lines:5})}),(0,i.Y)("div",{css:(0,r.AH)({flex:2,padding:t.spacing.sm},""),children:(0,i.Y)(s.TableSkeleton,{lines:5})})]})]}),(0,i.Y)("div",{css:(0,r.AH)({padding:t.spacing.md,overflowY:"auto",flex:1},""),children:(0,i.Y)(s.TableSkeleton,{lines:12})})]})}},27094:function(e,t,n){n.d(t,{k:function(){return i}});var r=n(66916),s=n(73408);var o={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:a})=>(0,s.FD)("div",{children:[(0,s.Y)(r.I,{"data-testid":"assessment-value-string-input",componentId:"shared.model-trace-explorer.assessment-value-string-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value),i(null)},disabled:a,allowClear:!0}),t&&(0,s.Y)("div",{css:o,children:t})]})},27925:function(e,t,n){n.d(t,{w:function(){return s}});var r=n(46709);function s({ref:e,debounceTimeMs:t}){const n=(0,r.useRef)({width:-1,height:-1}),s=(0,r.useRef)(),[o,i]=(0,r.useState)(null),a=(0,r.useCallback)(e=>{if(0===e.length)return;const r=e[0].contentRect;if(-1===n.current.width)return n.current={width:r.width,height:r.height},void i(n.current);if(r.width!==n.current.width||r.height!==n.current.height){if(n.current.width=r.width,n.current.height=r.height,!t)return void i({...n.current});clearTimeout(s.current),s.current=setTimeout(()=>{i({...n.current})},t)}},[t]),l=(0,r.useRef)();return l.current||(l.current=new ResizeObserver(a)),(0,r.useEffect)(()=>{const t="function"===typeof e?e():e.current;if(t){const e=l.current;return e.observe(t),()=>e.unobserve(t)}}),o}},33120:function(e,t,n){n.d(t,{ff:function(){return o},we:function(){return i}});var r=n(36476);const s=fetch;const o=async(e,t="GET",n,o)=>{const i={method:t,signal:o,headers:{...n?{"Content-Type":"application/json"}:{},...l(document.cookie)}};n&&(i.body=function(e){if(void 0!==e)return"string"===typeof e||e instanceof FormData||e instanceof Blob?e:JSON.stringify(e)}(n));const a=await s(e,i);if(!a.ok){const e=(0,r.a$)(a);if(e){try{const t=(await a.json()).message;e.message=null!==t&&void 0!==t?t:e.message}catch{}throw e}}return a.json()},i=e=>e;const a=e=>{const t="mlflow-request-header-",n=function(e=document.cookie){return e.split(";").reduce((e,t)=>{const[n,r]=t.trim().split("=");return e[n]=decodeURIComponent(r||""),e},{})}(e);return n&&0!==Object.keys(n).length?Object.keys(n).filter(e=>e.startsWith(t)).reduce((e,t)=>({...e,[t.substring(22)]:n[t]}),{}):{}},l=e=>({...a(e)})},33145:function(e,t,n){n.d(t,{R:function(){return o},e:function(){return s}});var r=n(82716);const s=e=>"feedback"in e&&e.feedback?e.feedback.value:"expectation"in e?e.expectation&&"value"in e.expectation?e.expectation.value:e.expectation.serialized_value.value:void 0,o=e=>{switch(e.source_type){case"HUMAN":return r.UserIcon;case"LLM_JUDGE":return r.SparkleIcon;default:return r.CodeIcon}}},44666:function(e,t,n){n.d(t,{w:function(){return r}});const r=()=>"User"},45218:function(e,t,n){n.d(t,{F:function(){return f},n:function(){return h}});var r=n(68248),s=n(46709),o=n(82716),i=n(27757),a=n(42747),l=n(22558),u=n(47784),c=n(83219),d=n(86125),g=n(53915),p=n(85060),m=n(73408);const f=400,h=({rootNode:e,intermediateNodes:t,hideRenderModeSelector:n=!1})=>{const{theme:h}=(0,i.u)(),[y,v]=(0,s.useState)("default"),{readOnly:S}=(0,g.nJ)(),x=e.inputs,b=e.outputs,_=e.chatMessageFormat,A=(0,d.bn)(e),I=t.length>0,N=A.length>0,k=(0,d.g_)(x).filter(({value:e})=>"null"!==e),O=(0,d.g_)(b).filter(({value:e})=>"null"!==e);return(0,m.FD)("div",{css:(0,r.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:h.spacing.md,paddingTop:h.spacing.sm,overflow:"auto",minWidth:f},""),children:[!n&&(0,m.Y)("div",{css:(0,r.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:h.spacing.sm},""),children:(0,m.FD)("div",{css:(0,r.AH)({display:"flex",gap:h.spacing.sm},""),children:[(0,m.FD)(o.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:y,size:"small",onChange:e=>v(e.target.value),children:[(0,m.Y)(o.SegmentedControlButton,{value:"default",children:(0,m.Y)(a.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,m.Y)(o.SegmentedControlButton,{value:"json",children:(0,m.Y)(a.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),!S&&(0,m.Y)(p.N,{})]})}),N&&(0,m.Y)(c.c,{node:e}),(0,m.Y)(u.l,{title:(0,m.Y)(a.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,r.AH)({marginBottom:I?0:h.spacing.md},""),sectionKey:"summary-inputs",data:k,renderMode:y,chatMessageFormat:_}),I&&t.map(e=>(0,m.Y)(l.$,{node:e,renderMode:y},e.key)),(0,m.Y)(u.l,{title:(0,m.Y)(a.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",data:O,renderMode:y,chatMessageFormat:null!==_&&void 0!==_?_:"openai"})]})}},51847:function(e,t,n){n.d(t,{P:function(){return u}});var r=n(68248),s=n(82716),o=n(27757),i=n(66916),a=n(94664),l=n(73408);const u=({type:e=a.Dy.CONNECT,isInTooltip:t=!1,hasException:n=!1,isRootSpan:u=!1})=>{const{theme:c}=(0,o.u)();let d;u?d="ai":n&&(d="danger");const g={[a.Dy.MODELS]:(0,l.Y)(s.ModelsIcon,{color:d}),[a.Dy.DOCUMENT]:(0,l.Y)(s.FileDocumentIcon,{color:d}),[a.Dy.CONNECT]:(0,l.Y)(s.ConnectIcon,{color:d}),[a.Dy.CODE]:(0,l.Y)(s.CodeIcon,{color:d}),[a.Dy.FUNCTION]:(0,l.Y)(s.FunctionIcon,{color:d}),[a.Dy.NUMBERS]:(0,l.Y)(s.NumbersIcon,{color:d}),[a.Dy.SEARCH]:(0,l.Y)(i.S,{color:d}),[a.Dy.SORT]:(0,l.Y)(s.SortUnsortedIcon,{color:d}),[a.Dy.UNKNOWN]:(0,l.Y)(s.QuestionMarkIcon,{color:d}),[a.Dy.WRENCH]:(0,l.Y)(s.WrenchIcon,{color:d}),[a.Dy.AGENT]:(0,l.Y)(s.UserSparkleIcon,{color:d}),[a.Dy.CHAIN]:(0,l.Y)(s.ChainIcon,{color:d}),[a.Dy.USER]:(0,l.Y)(s.UserIcon,{color:d}),[a.Dy.SYSTEM]:(0,l.Y)(s.GearIcon,{color:d}),[a.Dy.SAVE]:(0,l.Y)(s.SaveIcon,{color:d})};let p=c.colors.actionDefaultIconDefault,m=c.colors.actionPrimaryIcon,f=c.colors.backgroundSecondary;switch(e){case a.Dy.SEARCH:p=c.colors.textValidationSuccess,m=c.colors.green500,f=c.isDarkMode?c.colors.green800:c.colors.green100;break;case a.Dy.MODELS:p=c.isDarkMode?c.colors.blue500:c.colors.turquoise,m=c.isDarkMode?c.colors.turquoise:c.colors.blue500,f=c.isDarkMode?c.colors.blue800:c.colors.blue100;break;case a.Dy.WRENCH:p=c.isDarkMode?c.colors.red500:c.colors.red700,m=c.isDarkMode?c.colors.red700:c.colors.red500,f=c.isDarkMode?c.colors.red800:c.colors.red100}return(0,l.FD)("div",{css:(0,r.AH)({position:"relative",width:c.general.iconSize,height:c.general.iconSize,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:c.borders.borderRadiusSm,background:t?c.colors.tooltipBackgroundTooltip:f,color:t?m:p,svg:{width:c.general.iconFontSize,height:c.general.iconFontSize},flexShrink:0},""),children:[n&&(0,l.Y)("div",{css:(0,r.AH)({position:"absolute",top:-c.spacing.xs,right:-c.spacing.xs,height:c.spacing.sm,width:c.spacing.sm,borderRadius:c.borders.borderRadiusSm,backgroundColor:c.colors.actionDangerPrimaryBackgroundDefault,zIndex:5},"")}),g[e]]})}},52033:function(e,t,n){n.d(t,{B:function(){return i}});var r=n(82716),s=n(73408);var o={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:a})=>(0,s.FD)("div",{children:[(0,s.FD)(r.SegmentedControlGroup,{"data-testid":"assessment-value-boolean-input",componentId:"shared.model-trace-explorer.assessment-value-boolean-input",name:"shared.model-trace-explorer.assessment-value-boolean-input",value:e,disabled:a,onChange:e=>{n(e.target.value),i(null)},children:[(0,s.Y)(r.SegmentedControlButton,{value:!0,children:"True"}),(0,s.Y)(r.SegmentedControlButton,{value:!1,children:"False"})]}),t&&(0,s.Y)("div",{css:o,children:t})]})},52489:function(e,t,n){n.d(t,{e:function(){return s}});var r=n(110);const s=(e,t)=>(0,r.Oz)(`/experiments/${e}/chat-sessions/${t}`)},53915:function(e,t,n){n.d(t,{DK:function(){return d},nJ:function(){return c}});var r=n(76118),s=n(46709),o=n(86125),i=n(81390),a=n(73408);const l=()=>({summarySidebar:.75,detailsSidebar:.7,detailsPane:window.innerWidth<=768?.33:.25}),u=(0,s.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},isTraceInitialLoading:!1,assessmentsPaneEnabled:!0,isInComparisonView:!1,updatePaneSizeRatios:()=>{},getPaneSizeRatios:()=>l(),readOnly:!1,topLevelNodes:[]}),c=()=>(0,s.useContext)(u),d=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:n,assessmentsPaneEnabled:c,initialAssessmentsPaneCollapsed:d,isTraceInitialLoading:g=!1,isInComparisonView:p=!1,children:m,readOnly:f=!1})=>{var h,y,v;const S=(0,s.useMemo)(()=>(0,o.uM)(e),[e]),x=1===S.length?S[0]:null,b=(0,s.useMemo)(()=>x?(0,i.dM)([x]):{},[x]),_=(0,o.f7)(x,n),A=null!==(h=null!==_&&void 0!==_?_:x)&&void 0!==h?h:void 0,I=(null!==(y=null===A||void 0===A||null===(v=A.assessments)||void 0===v?void 0:v.length)&&void 0!==y?y:0)>0,N=!(0,r.isNil)(null===x||void 0===x?void 0:x.inputs)||!(0,r.isNil)(null===x||void 0===x?void 0:x.outputs),k=(0,s.useRef)(l()),O=(0,s.useCallback)(()=>k.current,[]),w=(0,s.useCallback)(e=>{k.current={...k.current,...e}},[]),[T,Y]=(0,s.useState)(()=>x?null!==t&&void 0!==t?t:N?"summary":"detail":"detail"),[j,C]=(0,s.useState)(A),D=(0,o.pQ)(j),[M,E]=(0,s.useState)(D),[Z,F]=(0,s.useState)(!1),[R,P]=(0,s.useState)(!d&&I||"force-open"===d);(0,s.useEffect)(()=>{const e=(0,o.pQ)(j);E(e)},[j]),(0,s.useEffect)(()=>{x||"summary"!==T||Y("detail")},[x,T]);const H=(0,s.useMemo)(()=>({rootNode:x,nodeMap:b,activeView:T,setActiveView:Y,activeTab:M,setActiveTab:E,selectedNode:j,setSelectedNode:C,showTimelineTreeGantt:Z,setShowTimelineTreeGantt:F,assessmentsPaneExpanded:!f&&R,setAssessmentsPaneExpanded:P,assessmentsPaneEnabled:c,isTraceInitialLoading:g,isInComparisonView:p,updatePaneSizeRatios:w,getPaneSizeRatios:O,readOnly:f,topLevelNodes:S}),[T,b,M,x,j,Z,F,R,P,c,g,p,w,O,f,S]);return(0,a.Y)(u.Provider,{value:H,children:m})}},59542:function(e,t,n){n.d(t,{B:function(){return r}});const r=({queryClient:e})=>{e.invalidateQueries({queryKey:["searchMlflowTraces"]})}},65854:function(e,t,n){n.d(t,{w:function(){return r}});const r=300},69291:function(e,t,n){n.d(t,{p:function(){return i}});var r=n(110),s=n(55113);const o=e=>(0,s.tW)((0,r.Oz)("/experiments/:experimentId"),{experimentId:e}),i=e=>`${o(e)}/traces`},69660:function(e,t,n){n.d(t,{AG:function(){return c},a8:function(){return o},bS:function(){return i},m$:function(){return S},n_:function(){return m},x1:function(){return x},xW:function(){return v}});var r=n(76118),s=n(86125);const o=e=>{var t,n,o;if(!e)return null;const i=null!==(t=null!==(n=e.messages)&&void 0!==n?n:e.input)&&void 0!==t?t:null===(o=e.request)||void 0===o?void 0:o.input;return Array.isArray(i)&&0!==i.length&&i.every(s.I$)?(0,r.compact)(i.map(s.ZI)):null},i=e=>(0,s.x0)(e)?e.map(e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(s.CL)}}):(0,s.in)(e)?e.choices.map(e=>{var t;return{...e.message,tool_calls:null===(t=e.message.tool_calls)||void 0===t?void 0:t.map(s.CL)}}):null,a=e=>!!((0,r.has)(e,"role")&&(0,r.has)(e,"content")&&["user","assistant","system","developer"].includes(e.role))&&((0,r.isString)(e.content)||(0,r.isArray)(e.content)&&e.content.every(e=>(0,r.has)(e,"type")&&["input_text","input_image","input_file"].includes(e.type))),l=e=>{if(!(0,r.isObject)(e))return!1;if("message"===(0,r.get)(e,"type"))return(0,s.I$)(e);if("function_call"===(0,r.get)(e,"type"))return(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments"));if("function_call_output"===(0,r.get)(e,"type"))return(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"output"));if("image_generation_call"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"output_format");return(0,r.isString)((0,r.get)(e,"result"))&&(0,r.isString)(t)&&["png","jpeg","webp"].includes(t)}if("reasoning"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"summary");return(0,r.has)(e,"id")&&((0,r.isArray)(t)||null===t)}return!1},u=e=>{if((0,r.isString)(e.content)){const t=(0,s.ZI)({type:"message",content:e.content,role:e.role});return t&&[t]}return e.content.map(t=>((e,t)=>{const n=(0,r.get)(e,"text");if("input_text"===(0,r.get)(e,"type")&&(0,r.isString)(n))return(0,s.ZI)({type:"message",content:[{type:"text",text:n}],role:t});const o=(0,r.get)(e,"image_url");return"input_image"===(0,r.get)(e,"type")&&(0,r.isString)(o)?(0,s.ZI)({type:"message",content:[{type:"image_url",image_url:{url:o}}],role:t}):null})(t,e.role)).filter(e=>null!==e)},c=e=>{var t,n;const o=null!==(t=null!==(n=(0,r.get)(e,"input"))&&void 0!==n?n:(0,r.get)(e,"request.input"))&&void 0!==t?t:e;if((0,r.isString)(o)){const e=(0,s.ZI)({type:"message",content:o,role:"user"});return e&&[e]}return(0,r.isArray)(o)&&o.every(a)?(0,r.compact)(o.flatMap(u)):null},d=e=>e.summary&&e.summary.map(e=>e.text).join("\n\n")||null,g=e=>{const t=[];let n=null;for(const r of e)"reasoning"===r.type?n=d(r):(t.push(p(r,n)),n=null);return(0,r.compact)(t)},p=(e,t)=>{if("message"===e.type){const n=(0,s.ZI)(e);return n&&t?{...n,reasoning:t}:n}return"function_call"===e.type?{role:"assistant",tool_calls:[(0,s.CL)({id:e.call_id,function:{arguments:e.arguments,name:e.name}})],...t&&{reasoning:t}}:"function_call_output"===e.type?{role:"tool",tool_call_id:e.call_id,content:e.output}:"image_generation_call"===e.type?(0,s.ZI)({type:"message",content:[{type:"image_url",image_url:{url:`data:image/${e.output_format};base64,${e.result}`}}],role:"tool"}):(e.type,null)},m=e=>{var t;if((0,r.isNil)(e))return null;const n=null!==(t=(0,r.get)(e,"output"))&&void 0!==t?t:e;if((0,r.isArray)(n)&&n.length>0&&n.every(l)){const e=g(n);return e.length>0?e:null}if((0,r.isArray)(n)&&n.length>0&&n.every(e=>"response.output_item.done"===e.type&&l(e.item))){const e=n.map(e=>e.item),t=g(e);return t.length>0?t:null}return null},f=e=>!!(0,r.isObject)(e)&&(!!((0,r.has)(e,"role")&&(0,r.has)(e,"content")&&["user","assistant","system","tool"].includes(e.role))||("function_call"===(0,r.get)(e,"type")?(0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"name"))&&(0,r.isString)((0,r.get)(e,"arguments")):"function_call_output"===(0,r.get)(e,"type")&&((0,r.isString)((0,r.get)(e,"call_id"))&&(0,r.isString)((0,r.get)(e,"output"))))),h=e=>!!(0,r.isObject)(e)&&("response.output_item.done"===(0,r.get)(e,"type")&&l((0,r.get)(e,"item"))),y=e=>{if((0,r.has)(e,"role")&&(0,r.has)(e,"content")){if((0,r.isArray)(e.content)){const t=e.content.filter(e=>"output_text"===e.type&&(0,r.isString)(e.text)).map(e=>e.text).join(" ");if(t)return(0,s.ZI)({...e,content:t})}return(0,s.ZI)(e)}if("function_call"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"call_id"),n=(0,r.get)(e,"arguments"),o=(0,r.get)(e,"name");if((0,r.isString)(t)&&(0,r.isString)(n)&&(0,r.isString)(o))return{role:"assistant",tool_calls:[(0,s.CL)({id:t,function:{arguments:n,name:o}})]}}if("function_call_output"===(0,r.get)(e,"type")){const t=(0,r.get)(e,"call_id"),n=(0,r.get)(e,"output");if((0,r.isString)(t)&&(0,r.isString)(n))return{role:"tool",tool_call_id:t,content:n}}return null},v=e=>(0,r.isNil)(e)?null:(0,r.isArray)(e)&&e.length>0&&e.every(f)?(0,r.compact)(e.map(y)):null,S=e=>(0,r.isNil)(e)?null:(0,r.isArray)(e)&&e.length>0&&e.every(f)?(0,r.compact)(e.map(y)):null,x=e=>(0,r.isNil)(e)?null:(0,r.isArray)(e)&&e.length>0&&e.every(e=>(e=>!!(0,r.isObject)(e)&&"response.output_text.delta"===(0,r.get)(e,"type")&&(0,r.isString)((0,r.get)(e,"delta")))(e)||h(e))&&e.some(e=>h(e))?(0,r.compact)(e.filter(h).map(e=>p(e.item))):null},72143:function(e,t,n){n.d(t,{f:function(){return i}});var r=n(82716),s=n(66916),o=n(73408);const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:a})=>(0,o.FD)("div",{children:[(0,o.Y)(s.I.TextArea,{"data-testid":"assessment-value-json-input",componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(e),autoSize:{minRows:1,maxRows:5},onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value),i(null)},validationState:t?"error":void 0,disabled:a}),t&&(0,o.Y)(r.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:t,type:"error"})]})},73880:function(e,t,n){n.d(t,{t:function(){return u}});var r=n(68248),s=n(82716),o=n(27757),i=n(79081),a=n(73408);const l=e=>e?{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"},u=({itemKey:e,itemValue:t,charLimit:n=18,maxWidth:u=150,className:c})=>{const{shouldTruncateKey:d,shouldTruncateValue:g}=function(e,t,n){const r=e.length+t.length,s=e.length>t.length,o=s?t.length:e.length;return r<=n?{shouldTruncateKey:!1,shouldTruncateValue:!1}:o>n/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:s,shouldTruncateValue:!s}}(e,t,n);return(0,a.Y)(i.T,{componentId:"shared.model-trace-explorer.key-value-tag.hover-tooltip",content:`${e}: ${t}`,children:(0,a.Y)(s.Tag,{componentId:"shared.model-trace-explorer.key-value-tag",className:c,children:(0,a.FD)("span",{css:(0,r.AH)({maxWidth:u,display:"inline-flex"},""),children:[(0,a.Y)(o.T.Text,{bold:!0,css:l(d),size:"sm",children:e}),":\xa0",(0,a.Y)(o.T.Text,{css:l(g),size:"sm",children:t})]})})})}},76127:function(e,t,n){n.d(t,{X:function(){return i}});var r=n(68248),s=n(27757),o=n(73408);function i({count:e}){const{theme:t}=(0,s.u)();return(0,o.Y)("div",{css:(0,r.AH)({display:"flex",alignItems:"center",justifyContent:"center",borderRadius:t.typography.fontSizeBase,height:t.typography.fontSizeBase,backgroundColor:t.colors.actionDangerPrimaryBackgroundDefault,padding:t.spacing.xs,marginLeft:t.spacing.xs,boxSizing:"border-box"},""),children:(0,o.Y)("span",{css:(0,r.AH)({color:t.colors.actionPrimaryTextDefault,fontSize:11},""),children:e})})}},89634:function(e,t,n){n.d(t,{O:function(){return i}});var r=n(66916),s=n(73408);var o={name:"t152af",styles:"margin-top:8px;color:red"};const i=({value:e,valueError:t,setValue:n,setValueError:i,isSubmitting:a})=>(0,s.FD)("div",{children:[(0,s.Y)(r.I,{"data-testid":"assessment-value-number-input",componentId:"shared.model-trace-explorer.assessment-value-number-input",value:String(e),onKeyDown:e=>e.stopPropagation(),onChange:e=>{n(e.target.value?Number(e.target.value):""),i(null)},type:"number",disabled:a,allowClear:!0}),t&&(0,s.Y)("div",{css:o,children:t})]})}}]);