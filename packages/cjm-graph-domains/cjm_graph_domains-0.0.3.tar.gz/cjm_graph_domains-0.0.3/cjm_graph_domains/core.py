"""Base Pydantic models and conversion logic for domain-specific graph schemas"""

# AUTOGENERATED! DO NOT EDIT! File to edit: ../nbs/core.ipynb.

# %% auto 0
__all__ = ['DomainNode']

# %% ../nbs/core.ipynb 3
from uuid import uuid4
from typing import List, Dict, Any, Optional
from pydantic import BaseModel, Field

from cjm_graph_plugin_system.core import GraphNode, SourceRef

# %% ../nbs/core.ipynb 5
class DomainNode(BaseModel):
    """Base Pydantic model for domain-specific graph nodes."""
    
    id: str = Field(default_factory=lambda: str(uuid4()))  # Unique node identifier (UUID)
    
    # Fields excluded from properties dict (they map to GraphNode structural fields)
    _exclude_from_props: set = {'id'}

    def get_label(self) -> str:  # Node label for the graph (defaults to class name)
        """Return the node label."""
        return self.__class__.__name__

    def to_graph_node(
        self,
        sources: List[SourceRef] = []  # External data references for provenance
    ) -> GraphNode:  # Generic GraphNode for storage in graph plugins
        """Convert this domain model to a generic GraphNode."""
        # Dump Pydantic model to dict, excluding structural fields
        props = self.model_dump(exclude=self._exclude_from_props, exclude_none=True)
        
        # Normalize 'name' field for consistent display in queries
        if 'name' not in props:
            if 'title' in props:
                props['name'] = props['title']
            elif 'label' in props:
                props['name'] = props['label']
            elif 'text' in props:
                props['name'] = props['text'][:50]

        return GraphNode(
            id=self.id,
            label=self.get_label(),
            properties=props,
            sources=sources
        )
