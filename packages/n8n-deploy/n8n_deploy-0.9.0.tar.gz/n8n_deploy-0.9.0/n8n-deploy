#!/bin/bash
# n8n-deploy wrapper script
# Automatically sets up virtual environment and runs the CLI

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
cd "$SCRIPT_DIR"

# Create virtual environment if it doesn't exist or uses conda
if [ ! -d ".venv" ] || [[ "$(cd .venv && source bin/activate && which python)" == *"conda"* ]]; then
    echo "Setting up virtual environment..." >&2
    if command -v uv &> /dev/null; then
        uv venv --python /usr/bin/python3 .venv >/dev/null 2>&1
        source .venv/bin/activate
        uv pip install -e . >/dev/null 2>&1
    else
        /usr/bin/python3 -m venv .venv >/dev/null 2>&1
        source .venv/bin/activate
        pip install -e . >/dev/null 2>&1
    fi
else
    source .venv/bin/activate
fi

# Run the CLI with all arguments
python -m api.cli "$@"
