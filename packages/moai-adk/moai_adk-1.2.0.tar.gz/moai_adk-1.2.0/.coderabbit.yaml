# yaml-language-server: $schema=https://coderabbit.ai/integrations/schema.v2.json
# CodeRabbit Configuration - MoAI-ADK
# Docs: https://docs.coderabbit.ai/reference/configuration

# General Settings
language: en-US
tone_instructions: "Be constructive and specific. Focus on actionable improvements."
early_access: true

# Review Configuration
reviews:
  profile: chill
  auto_review:
    enabled: true
    drafts: true
    base_branches:
      - main
      - develop
      - "release/**"
  high_level_summary: true
  high_level_summary_instructions: |
    Summarize the PR in 2-3 sentences focusing on:
    1. Main purpose and scope of changes
    2. Key files or components affected
    3. Potential impact on existing functionality
  poem: false
  review_status: true
  collapse_walkthrough: false
  changed_files_summary: true
  sequence_diagrams: true

  # Path filters (include/exclude patterns)
  path_filters:
    - "!**/*.lock"
    - "!**/package-lock.json"
    - "!**/uv.lock"
    - "!**/__pycache__/**"
    - "!**/*.pyc"
    - "!**/dist/**"
    - "!**/build/**"
    - "!**/.git/**"
    - "!.moai/tmp/**"
    - "!.moai/cache/**"
    - "!.moai/logs/**"
    - "!.moai/reports/**"
    - "!assets/images/**"
    - "!**/*.png"
    - "!**/*.jpg"
    - "!**/*.gif"
    - "!**/*.ico"

  # Path-based review instructions
  path_instructions:
    - path: "src/moai_adk/**/*.py"
      instructions: |
        Review Python code for:
        - Type hints on all function parameters and returns
        - Comprehensive docstrings (Google style)
        - PEP-8 compliance
        - Error handling with specific exceptions
        - No hardcoded values (use config)
    - path: "tests/**/*.py"
      instructions: |
        Review test code for:
        - Descriptive test names (test_<function>_<scenario>_<expected>)
        - Proper use of fixtures and mocks
        - Edge case coverage
        - Assert messages for debugging
    - path: ".claude/agents/**/*.md"
      instructions: |
        Review agent definitions for:
        - Clear description and purpose
        - Proper tool restrictions (disallowedTools if needed)
        - Consistent formatting (no tables, no emojis in instructions)
        - Language-aware response instructions
        - Single responsibility principle
    - path: ".claude/commands/**/*.md"
      instructions: |
        Review slash command definitions for:
        - Clear command purpose and description
        - Valid YAML frontmatter (description, argument-hint if needed)
        - Proper argument handling patterns
        - No hardcoded paths (use $ARGUMENTS)
        - Consistent naming convention (kebab-case)
        - Language-aware user responses
    - path: ".claude/skills/**/*.md"
      instructions: |
        Review skill definitions for:
        - Valid YAML frontmatter (name, version, description, triggers)
        - Clear trigger patterns
        - Proper module structure
        - Version compatibility
        - Progressive disclosure pattern
    - path: ".moai/specs/**/*.md"
      instructions: |
        Review SPEC documents for:
        - All 7 required YAML fields (id, version, status, created, updated, author, priority)
        - EARS format requirements (WHEN/IF/THEN)
        - At least 2-3 test scenarios (Given-When-Then)
        - Clear acceptance criteria
        - Traceability links
    - path: "CLAUDE.md"
      instructions: |
        Review CLAUDE.md for:
        - Clear Alfred execution directives
        - Proper agent delegation patterns
        - Documentation standards compliance (no code examples, no tables, no emojis)
        - Language-aware response rules
        - Consistent formatting (list format, narrative style)
        - Version and last updated date
    - path: ".claude/hooks/**/*.py"
      instructions: |
        Review hook scripts for:
        - Proper error handling with try/except
        - JSON input/output format compliance
        - Performance (should complete quickly)
        - No blocking operations
        - Clear logging for debugging

  # Tool configuration
  tools:
    ruff:
      enabled: true
    gitleaks:
      enabled: true
    yamllint:
      enabled: true
    shellcheck:
      enabled: true
    markdownlint:
      enabled: true
    checkov:
      enabled: false
    actionlint:
      enabled: true

# Knowledge Base
knowledge_base:
  opt_out: false
  web_search:
    enabled: true
  code_guidelines:
    enabled: true
    filePatterns:
      - "CLAUDE.md"
      - ".claude/**/*.md"
      - ".moai/docs/**/*.md"
  learnings:
    scope: local
  issues:
    scope: local

# Chat Settings
chat:
  auto_reply: true
