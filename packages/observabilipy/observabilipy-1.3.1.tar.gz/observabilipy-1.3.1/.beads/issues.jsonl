{"id":"observabilipy-sh1","title":"Add public registry merge API","description":"Add public methods to MappingRegistry so consumers don't need to access private _mappings attribute.\n\n## Problem\nConsumers (like sunsoric_backend) need to merge multiple registries, but currently must access private _mappings:\n```python\nfor event_name, mapper in other_reg._mappings.items():\n    registry.register(event_name, mapper)\n```\n\n## Solution\nAdd public methods to MappingRegistry:\n\n1. `merge(other: MappingRegistry) -\u003e None` - Copy all mappings from another registry\n2. `__len__() -\u003e int` - Return count of registered mappings\n\n## Acceptance Criteria\n- [ ] `merge()` copies all mappings from source registry\n- [ ] `merge()` raises ValueError on duplicate event names\n- [ ] `len(registry)` returns mapping count\n- [ ] Tests for both methods\n- [ ] Release new version\n\n## Related\n- sunsoric_backend issue: sunsoric_backend-3jx (blocked on this)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-11T21:37:57.758778+01:00","created_by":"philipphematty","updated_at":"2026-01-11T21:50:34.78962+01:00","closed_at":"2026-01-11T21:50:34.78962+01:00","close_reason":"Implemented merge() and __len__() methods"}
{"id":"observabilipy-t9t","title":"EventObservability.record() race condition under pytest-xdist","description":"## Problem\n\n`EventObservability.record()` has a race condition when called from sync code running inside an async context (like pytest-xdist workers). The method schedules writes as fire-and-forget tasks, returning before the write completes.\n\n## Root Cause\n\nIn `adapters/events.py`, the `_write_outputs()` method:\n\n```python\ndef _write_outputs(self, outputs):\n    try:\n        loop = asyncio.get_running_loop()\n    except RuntimeError:\n        # No running event loop - use asyncio.run() (sync context)\n        asyncio.run(self._write_outputs_async(outputs))\n    else:\n        # Inside a running event loop - schedule as a task\n        loop.create_task(self._write_outputs_async(outputs))  # \u003c-- FIRE AND FORGET!\n```\n\nWhen an event loop is detected, writes are scheduled as background tasks that complete *after* `record()` returns. This causes tests to check storage before writes complete.\n\n## Impact\n\n- **sunsoric_backend**: 10+ tests marked with `@pytest.mark.no_parallel` as workaround\n- Tests that verify event emission fail randomly under parallel execution\n- Manual `SyncEventObservability` wrapper created in test conftest.py\n\n## Proposed Solution\n\nAdd a `sync: bool = False` parameter to EventObservability:\n\n```python\nclass EventObservability:\n    def __init__(self, registry, log_storage, metrics_storage, *, sync: bool = False):\n        self._sync = sync\n        # ...\n\n    def _write_outputs(self, outputs):\n        if self._sync:\n            # Write directly to storage, bypassing async machinery\n            for output in outputs:\n                if isinstance(output, LogEntry):\n                    self._log_storage._entries.append(output)\n                elif isinstance(output, MetricSample):\n                    self._metrics_storage._samples.append(output)\n            return\n\n        # Existing async logic...\n```\n\nAlternative: Always use sync writes for InMemoryStorage implementations (detect by checking storage type).\n\n## Acceptance Criteria\n\n- [ ] `EventObservability(sync=True)` writes synchronously to storage\n- [ ] Tests can verify event emission immediately after `record()` returns\n- [ ] Existing async behavior preserved when `sync=False` (default)\n- [ ] Document when to use sync mode (testing, WSGI contexts)\n\n## Related\n\n- sunsoric_backend workaround: `SyncEventObservability` class in `tests/unit/conftest.py`\n- sunsoric_backend tests marked `@pytest.mark.no_parallel` as mitigation","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-15T00:13:31.417237+01:00","created_by":"philipphematty","updated_at":"2026-01-15T10:03:57.062175+01:00","closed_at":"2026-01-15T10:03:57.062175+01:00","close_reason":"Added sync=True parameter to EventObservability that bypasses async fire-and-forget task scheduling, allowing tests to verify storage state immediately after record() returns."}
{"id":"observabilipy-xiu","title":"Event-Based Observability","description":"Epic for implementing event-based observability layer that decouples domain events from metrics/logs","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-09T11:37:02.408781+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:53:49.192964+01:00","closed_at":"2026-01-09T12:53:49.192964+01:00","close_reason":"Event-Based Observability epic complete. Implemented MappingRegistry, EventObservability adapter, event descriptor models, and BDD step definitions for all event features.","dependencies":[{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.1","type":"blocks","created_at":"2026-01-09T11:37:35.01438+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.2","type":"blocks","created_at":"2026-01-09T11:37:35.057368+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.3","type":"blocks","created_at":"2026-01-09T11:37:35.093981+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.4","type":"blocks","created_at":"2026-01-09T11:37:35.130936+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.5","type":"blocks","created_at":"2026-01-09T11:37:35.168533+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.6","type":"blocks","created_at":"2026-01-09T11:37:35.2044+01:00","created_by":"daemon"}]}
{"id":"observabilipy-xiu.1","title":"Add pytest-bdd dev dependency","description":"Add pytest-bdd to dev dependencies in pyproject.toml for BDD testing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:05.422351+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:10:13.978316+01:00","closed_at":"2026-01-09T12:10:13.978316+01:00","close_reason":"Closed"}
{"id":"observabilipy-xiu.2","title":"Create MappingRegistry (register, lookup, validate)","description":"Create MappingRegistry class that registers event-to-metric/log descriptors, validates descriptor fields/labels exist on event class, and provides lookup functionality","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:08.617809+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:10:13.980439+01:00","closed_at":"2026-01-09T12:10:13.980439+01:00","close_reason":"Closed"}
{"id":"observabilipy-xiu.3","title":"Implement descriptor validation logic","description":"Implement validation that checks descriptor fields/labels exist on event class","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:12.113476+01:00","created_by":"philipphematty","updated_at":"2026-01-09T11:57:47.967296+01:00","closed_at":"2026-01-09T11:57:47.967296+01:00","close_reason":"Merged into MappingRegistry and EventObservability adapter","dependencies":[{"issue_id":"observabilipy-xiu.3","depends_on_id":"observabilipy-xiu.2","type":"blocks","created_at":"2026-01-09T11:37:38.563336+01:00","created_by":"daemon"}]}
{"id":"observabilipy-xiu.4","title":"Implement event-to-observability recording logic","description":"Implement logic to convert events to metrics/logs based on descriptors","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:15.016979+01:00","created_by":"philipphematty","updated_at":"2026-01-09T11:57:50.763259+01:00","closed_at":"2026-01-09T11:57:50.763259+01:00","close_reason":"Merged into MappingRegistry and EventObservability adapter","dependencies":[{"issue_id":"observabilipy-xiu.4","depends_on_id":"observabilipy-xiu.2","type":"blocks","created_at":"2026-01-09T11:37:38.694641+01:00","created_by":"daemon"}]}
{"id":"observabilipy-xiu.5","title":"Create EventObservability adapter (sync/async, uses registry)","description":"Create EventObservability adapter that handles sync/async contexts using event loop detection pattern, uses MappingRegistry to record events as metrics/logs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:17.421447+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:31:41.825147+01:00","closed_at":"2026-01-09T12:31:41.825147+01:00","close_reason":"Implemented MappingRegistry and EventObservability adapter with sync/async support. All tests passing.","dependencies":[{"issue_id":"observabilipy-xiu.5","depends_on_id":"observabilipy-xiu.2","type":"blocks","created_at":"2026-01-09T11:00:10.025094Z","created_by":"auto-update"}]}
{"id":"observabilipy-xiu.6","title":"BDD step definitions for all event features","description":"Create step definitions for event_descriptors.feature, event_recording.feature, and event_validation.feature","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:20.332965+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:42:37.283092+01:00","closed_at":"2026-01-09T12:42:37.283092+01:00","close_reason":"Implemented BDD step definitions for all event features (event_mappings.feature, event_recording.feature, event_validation.feature). All 10 scenarios pass.","dependencies":[{"issue_id":"observabilipy-xiu.6","depends_on_id":"observabilipy-xiu.1","type":"blocks","created_at":"2026-01-09T11:37:45.549034+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu.6","depends_on_id":"observabilipy-xiu.5","type":"blocks","created_at":"2026-01-09T11:37:45.598959+01:00","created_by":"daemon"}]}
