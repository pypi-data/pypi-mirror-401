{"id":"observabilipy-1xi","title":"Refactor: Extract Generic[T] base for in-memory storage","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T10:42:17.331594+01:00","created_by":"philipphematty","updated_at":"2026-01-15T14:17:47.143452+01:00","closed_at":"2026-01-15T14:17:47.143452+01:00","close_reason":"Work migrated to observabilipy-2ph.13 (hierarchical structure)"}
{"id":"observabilipy-23v","title":"Add write_sync() to InMemoryMetricsStorage/InMemoryLogStorage","description":"## Problem\n\n`InMemoryMetricsStorage` and `InMemoryLogStorage` only have async `write()` method.\nAdapters that use these storage classes (like `ObservabilipyObservability` in sunsoric_backend)\ncheck for `write_sync()` to enable synchronous writes, but fall back to async fire-and-forget\nwhen it's missing.\n\nThis causes the same race condition as EventObservability had - tests check storage before\nwrites complete under pytest-xdist.\n\n## Related\n\n- Fixed for EventObservability in 1.3.1 via `sync=True` parameter\n- `ObservabilipyObservability` adapter uses `hasattr(storage, 'write_sync')` check\n\n## Proposed Solution\n\nAdd `write_sync()` method to in-memory storage classes:\n\n```python\nclass InMemoryMetricsStorage:\n    def write_sync(self, sample: MetricSample) -\u003e None:\n        \"\"\"Synchronous write for testing contexts.\"\"\"\n        self._samples.append(sample)\n\n    def write_sync_batch(self, samples: list[MetricSample]) -\u003e None:\n        \"\"\"Synchronous batch write for testing contexts.\"\"\"\n        self._samples.extend(samples)\n```\n\nSame for `InMemoryLogStorage`.\n\n## Acceptance Criteria\n\n- [ ] `InMemoryMetricsStorage.write_sync()` writes directly to `_samples`\n- [ ] `InMemoryMetricsStorage.write_sync_batch()` writes multiple samples\n- [ ] `InMemoryLogStorage.write_sync()` writes directly to `_entries`\n- [ ] Tests can use `ObservabilipyObservability` adapter without race conditions","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-15T10:17:41.402023+01:00","created_by":"philipphematty","updated_at":"2026-01-15T10:25:28.046858+01:00","closed_at":"2026-01-15T10:25:28.046858+01:00","close_reason":"Added write_sync() and write_sync_batch() to InMemoryLogStorage and InMemoryMetricsStorage"}
{"id":"observabilipy-2ph","title":"Architecture Review Cleanup (Jan 2026)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-15T11:39:02.358262+01:00","created_by":"philipphematty","updated_at":"2026-01-15T21:30:01.628993+01:00","closed_at":"2026-01-15T21:30:01.628993+01:00","close_reason":"All 20 architecture cleanup tasks completed","dependencies":[{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.1","type":"blocks","created_at":"2026-01-15T11:39:26.990527+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.2","type":"blocks","created_at":"2026-01-15T11:39:27.026725+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.3","type":"blocks","created_at":"2026-01-15T11:39:27.061063+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.4","type":"blocks","created_at":"2026-01-15T11:39:27.095882+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.5","type":"blocks","created_at":"2026-01-15T11:39:27.133366+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.6","type":"blocks","created_at":"2026-01-15T11:39:27.168775+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.7","type":"blocks","created_at":"2026-01-15T11:39:27.205458+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.8","type":"blocks","created_at":"2026-01-15T13:04:33.339354+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.9","type":"blocks","created_at":"2026-01-15T13:04:33.373958+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.10","type":"blocks","created_at":"2026-01-15T13:04:33.405843+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.11","type":"blocks","created_at":"2026-01-15T14:37:27.346303+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.12","type":"blocks","created_at":"2026-01-15T14:37:27.380274+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.13","type":"blocks","created_at":"2026-01-15T14:37:27.419979+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.14","type":"blocks","created_at":"2026-01-15T14:37:27.454921+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.15","type":"blocks","created_at":"2026-01-15T20:51:56.588429+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.16","type":"blocks","created_at":"2026-01-15T20:51:56.662141+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.17","type":"blocks","created_at":"2026-01-15T20:51:56.739511+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.18","type":"blocks","created_at":"2026-01-15T20:51:56.812297+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.19","type":"blocks","created_at":"2026-01-15T20:51:56.879145+01:00","created_by":"daemon"},{"issue_id":"observabilipy-2ph","depends_on_id":"observabilipy-2ph.20","type":"blocks","created_at":"2026-01-15T20:51:56.951683+01:00","created_by":"daemon"}]}
{"id":"observabilipy-2ph.1","title":"Delete duplicate dashboard_metrics.py","description":"Delete examples/dashboard_metrics.py which duplicates dashboard_metrics_collector.py. Update any imports.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T11:39:04.910964+01:00","created_by":"philipphematty","updated_at":"2026-01-15T11:47:48.732049+01:00","closed_at":"2026-01-15T11:47:48.732049+01:00","close_reason":"Closed"}
{"id":"observabilipy-2ph.10","title":"Extract async/sync connection context managers to SQLiteStorageBase","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T13:04:08.020697+01:00","created_by":"philipphematty","updated_at":"2026-01-15T14:14:19.818995+01:00","closed_at":"2026-01-15T14:14:19.818995+01:00","close_reason":"Extracted async_connection() and sync_connection() context managers to SQLiteStorageBase, replacing 13 repetitive try/finally blocks across SQLiteLogStorage and SQLiteMetricsStorage"}
{"id":"observabilipy-2ph.11","title":"Add clear()/clear_sync() to in-memory storage classes","description":"Tests in test_examples.py directly access internal _entries.clear() and _samples.clear() instead of using public methods. Add public methods to both InMemoryLogStorage and InMemoryMetricsStorage.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T14:17:25.097627+01:00","created_by":"philipphematty","updated_at":"2026-01-15T20:50:42.812583+01:00","closed_at":"2026-01-15T20:50:42.812583+01:00","close_reason":"Already implemented - verified with passing tests"}
{"id":"observabilipy-2ph.12","title":"Add write_sync()/clear_sync() to port interfaces","description":"Add write_sync(), clear(), and clear_sync() methods to LogStoragePort and MetricsStoragePort interfaces and implement in all adapters.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T14:17:25.364606+01:00","created_by":"philipphematty","updated_at":"2026-01-15T20:50:42.823001+01:00","closed_at":"2026-01-15T20:50:42.823001+01:00","close_reason":"Already implemented - verified with passing tests"}
{"id":"observabilipy-2ph.13","title":"Extract Generic[T] base for in-memory storage","description":"Extract Generic[T] base class InMemoryStorage for in-memory storage adapters to reduce duplication and improve type safety.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T14:17:25.642579+01:00","created_by":"philipphematty","updated_at":"2026-01-15T20:50:42.82797+01:00","closed_at":"2026-01-15T20:50:42.82797+01:00","close_reason":"Already implemented - verified with passing tests"}
{"id":"observabilipy-2ph.14","title":"Fix EventObservability.record() race condition with sync parameter","description":"Add sync: bool = False parameter to EventObservability to avoid race conditions when called from sync code in async contexts. This fixes pytest-xdist parallel execution issues.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T14:17:32.633601+01:00","created_by":"philipphematty","updated_at":"2026-01-15T20:50:42.831461+01:00","closed_at":"2026-01-15T20:50:42.831461+01:00","close_reason":"Already implemented - verified with passing tests"}
{"id":"observabilipy-2ph.15","title":"Implement factory pattern for SQLite storage adapters","description":"sqlite_logs.py and sqlite_metrics.py share ~100 lines of duplicated patterns (write/read/clear logic). Create a parameterized factory to generate domain-specific SQLite storage classes, reducing duplication while keeping schema/query differences explicit. Estimated effort: 2-3 hours.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T14:44:46.184466+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:06:26.869101+01:00","closed_at":"2026-01-15T15:06:26.869101+01:00","close_reason":"Implemented SQLiteStorageOperations mixin in sqlite_base.py to consolidate common async/sync patterns. Both sqlite_logs.py and sqlite_metrics.py now inherit from the mixin."}
{"id":"observabilipy-2ph.16","title":"Extract log-level filtering to domain service","description":"Level filtering logic is scattered across storage adapters (read() with level param, count_by_level(), delete_by_level_before()). Extract to LogStorageWithLevelFilter domain service wrapper to keep adapters thin and move domain logic to domain layer.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T14:44:49.403768+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:06:28.207947+01:00","closed_at":"2026-01-15T15:06:28.207947+01:00","close_reason":"Created LogStorageWithLevelFilter service in core/services.py with 16 unit tests. Provides level-based filtering as domain service wrapper."}
{"id":"observabilipy-2ph.17","title":"Add async-to-sync wrapper utility for storage adapters","description":"Every storage adapter duplicates async/sync method pairs (~80 lines). Create async_to_sync_wrapper utility to auto-generate sync methods. Note: Must handle AsyncIterable vs list return type divergence carefully.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T14:44:52.066249+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:06:29.188332+01:00","closed_at":"2026-01-15T15:06:29.188332+01:00","close_reason":"Created async_sync.py utility module with run_sync() and collect_async_iterable() helpers. Added 7 unit tests."}
{"id":"observabilipy-2ph.18","title":"Extract temp path fixtures to tests/conftest.py","description":"Temp path fixtures (log_db_path, metrics_db_path) are duplicated across 4 test files: e2e/conftest.py, test_sqlite_log_storage.py, test_sqlite_metrics_storage.py, test_sqlite_storage_sync.py. Extract to central tests/conftest.py.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-15T14:44:55.389199+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:06:30.142614+01:00","closed_at":"2026-01-15T15:06:30.142614+01:00","close_reason":"Extracted log_db_path and metrics_db_path fixtures to tests/conftest.py. Removed duplicates from 4 test files."}
{"id":"observabilipy-2ph.19","title":"Extract memory storage fixtures to tests/integration/conftest.py","description":"memory_log_storage and memory_metrics_storage fixtures are duplicated in test_sqlite_log_storage.py and test_sqlite_metrics_storage.py. Extract to tests/integration/conftest.py.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-15T14:44:58.501997+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:06:31.078915+01:00","closed_at":"2026-01-15T15:06:31.078915+01:00","close_reason":"Created tests/integration/conftest.py with memory_log_storage and memory_metrics_storage fixtures. Removed duplicates from test files."}
{"id":"observabilipy-2ph.2","title":"Delete unused dashboard_app.py","description":"Delete examples/dashboard_app.py - unused factory function that duplicates dashboard_example.py","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-15T11:39:06.933998+01:00","created_by":"philipphematty","updated_at":"2026-01-15T11:47:48.738667+01:00","closed_at":"2026-01-15T11:47:48.738667+01:00","close_reason":"Closed"}
{"id":"observabilipy-2ph.20","title":"Extract shared example code to examples/shared.py","description":"Identical demo endpoint code (27 lines) in sqlite_example.py and embedded_runtime_example.py. Extract demo_root_endpoint() to examples/shared.py for consistency.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-15T14:45:01.389602+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:06:32.1893+01:00","closed_at":"2026-01-15T15:06:32.1893+01:00","close_reason":"Created examples/demo_helpers.py with shared demo endpoint logic. Updated both example files to use the shared code."}
{"id":"observabilipy-2ph.3","title":"Fix await on non-coroutine in dashboard_example.py","description":"Line 91-93 uses await on StructuredLogger.info() which returns LogEntry, not a coroutine. Remove the await or change to actually write to storage.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-15T11:39:09.601996+01:00","created_by":"philipphematty","updated_at":"2026-01-15T11:51:42.655482+01:00","closed_at":"2026-01-15T11:51:42.655482+01:00","close_reason":"Fixed await on non-coroutine: split logger.info() call into entry creation + await log_storage.write(entry)"}
{"id":"observabilipy-2ph.4","title":"Split test_sqlite_storage.py by storage type","description":"Split 709-line god file into test_sqlite_log_storage.py and test_sqlite_metrics_storage.py","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T11:39:12.082678+01:00","created_by":"philipphematty","updated_at":"2026-01-15T12:49:05.662594+01:00","closed_at":"2026-01-15T12:49:05.662594+01:00","close_reason":"Closed"}
{"id":"observabilipy-2ph.5","title":"Split test_in_memory_storage.py by storage type","description":"Split 593-line god file into test_in_memory_log_storage.py and test_in_memory_metrics_storage.py","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T11:39:14.358649+01:00","created_by":"philipphematty","updated_at":"2026-01-15T14:35:30.218702+01:00","closed_at":"2026-01-15T14:35:30.218702+01:00","close_reason":"Split 698-line test_in_memory_storage.py into 3 focused files: test_in_memory_storage_base.py (9 tests), test_in_memory_log_storage.py (28 tests), test_in_memory_metrics_storage.py (18 tests). All 55 tests preserved, 662 total suite tests pass."}
{"id":"observabilipy-2ph.6","title":"Split test_ring_buffer_storage.py by storage type","description":"Split 649-line god file into test_ring_buffer_log_storage.py and test_ring_buffer_metrics_storage.py","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T11:39:16.529703+01:00","created_by":"philipphematty","updated_at":"2026-01-15T21:02:47.803631+01:00","closed_at":"2026-01-15T21:02:47.803631+01:00","close_reason":"Split 649-line god file into test_ring_buffer_log_storage.py and test_ring_buffer_metrics_storage.py"}
{"id":"observabilipy-2ph.7","title":"Extract SQLite storage base class","description":"Extract common initialization patterns from sqlite_logs.py and sqlite_metrics.py into SQLiteStorageBase class to reduce ~100 lines of duplication","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-15T11:39:19.0586+01:00","created_by":"philipphematty","updated_at":"2026-01-15T12:59:15.189924+01:00","closed_at":"2026-01-15T12:59:15.189924+01:00","close_reason":"Extracted SQLiteStorageBase class with connection lifecycle management (async + sync). Reduced ~50 lines of duplication."}
{"id":"observabilipy-2ph.8","title":"Add error handling for JSON deserialization in SQLite adapters","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-15T13:04:03.61352+01:00","created_by":"philipphematty","updated_at":"2026-01-15T13:27:58.153829+01:00","closed_at":"2026-01-15T13:27:58.153829+01:00","close_reason":"Added JSON deserialization error handling in SQLite adapters (4 locations). Corrupted JSON now falls back to empty dict instead of crashing. Added 4 tests."}
{"id":"observabilipy-2ph.9","title":"Remove sqlite.py re-export wrapper","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T13:04:05.882553+01:00","created_by":"philipphematty","updated_at":"2026-01-15T13:48:03.897234+01:00","closed_at":"2026-01-15T13:48:03.897234+01:00","close_reason":"Removed sqlite.py re-export wrapper. Updated storage/__init__.py to import directly from sqlite_logs.py and sqlite_metrics.py. Updated 8 consumer files to use public API."}
{"id":"observabilipy-2yl","title":"Fix: Add write_sync()/clear_sync() to port interfaces","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T10:42:17.436413+01:00","created_by":"philipphematty","updated_at":"2026-01-15T14:17:45.460256+01:00","closed_at":"2026-01-15T14:17:45.460256+01:00","close_reason":"Work migrated to observabilipy-2ph.12 (hierarchical structure)"}
{"id":"observabilipy-dcj","title":"Test Organization Improvements","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-15T15:15:49.080245+01:00","created_by":"philipphematty","updated_at":"2026-01-15T20:40:16.580045+01:00","closed_at":"2026-01-15T20:40:16.580045+01:00","close_reason":"Closed","dependencies":[{"issue_id":"observabilipy-dcj","depends_on_id":"observabilipy-dcj.1","type":"blocks","created_at":"2026-01-15T20:52:01.536484+01:00","created_by":"daemon"},{"issue_id":"observabilipy-dcj","depends_on_id":"observabilipy-dcj.2","type":"blocks","created_at":"2026-01-15T20:52:01.604361+01:00","created_by":"daemon"},{"issue_id":"observabilipy-dcj","depends_on_id":"observabilipy-dcj.3","type":"blocks","created_at":"2026-01-15T20:52:01.678143+01:00","created_by":"daemon"},{"issue_id":"observabilipy-dcj","depends_on_id":"observabilipy-dcj.4","type":"blocks","created_at":"2026-01-15T20:52:01.747675+01:00","created_by":"daemon"}]}
{"id":"observabilipy-dcj.1","title":"Split test_sqlite_log_storage.py by responsibility","description":"Split 487-line file into 3 focused files:\n- test_sqlite_log_storage_basic.py (core CRUD operations)\n- test_sqlite_log_storage_persistence.py (cross-instance persistence)\n- test_sqlite_log_storage_resilience.py (corrupted JSON handling)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T15:15:52.337259+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:23:29.747757+01:00","closed_at":"2026-01-15T15:23:29.747757+01:00","close_reason":"Test files split by responsibility"}
{"id":"observabilipy-dcj.2","title":"Split test_sqlite_metrics_storage.py by responsibility","description":"Split 362-line file into 3 focused files:\n- test_sqlite_metrics_storage_basic.py (core CRUD operations)\n- test_sqlite_metrics_storage_persistence.py (cross-instance persistence)\n- test_sqlite_metrics_storage_resilience.py (corrupted JSON handling)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T15:15:54.450123+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:23:29.75252+01:00","closed_at":"2026-01-15T15:23:29.75252+01:00","close_reason":"Test files split by responsibility"}
{"id":"observabilipy-dcj.3","title":"Reorganize test_sqlite_storage_sync.py by storage type","description":"Split 160-line file with mixed log/metrics sync tests into:\n- test_sqlite_log_storage_sync.py (log sync methods)\n- test_sqlite_metrics_storage_sync.py (metrics sync methods)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T15:15:56.927572+01:00","created_by":"philipphematty","updated_at":"2026-01-15T15:23:29.75628+01:00","closed_at":"2026-01-15T15:23:29.75628+01:00","close_reason":"Test files split by responsibility"}
{"id":"observabilipy-dcj.4","title":"Split e2e/conftest.py by concern","description":"Split 107-line conftest with mixed concerns into focused modules:\n- storage_fixtures.py (storage setup)\n- app_fixtures.py (FastAPI app, HTTP client)\n- policy_fixtures.py (retention policies)\nKeep conftest.py as thin aggregator.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-15T15:16:00.302705+01:00","created_by":"philipphematty","updated_at":"2026-01-15T20:40:16.574938+01:00","closed_at":"2026-01-15T20:40:16.574938+01:00","close_reason":"Closed"}
{"id":"observabilipy-pgz","title":"Refactor: Split test_in_memory_storage.py by storage type","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T10:42:17.384362+01:00","created_by":"philipphematty","updated_at":"2026-01-15T14:17:24.828765+01:00","closed_at":"2026-01-15T14:17:24.828765+01:00","close_reason":"Duplicate of observabilipy-2ph.5 (already part of Architecture Review epic)"}
{"id":"observabilipy-r51","title":"Add clear()/clear_sync() to in-memory storage classes","description":"## Problem\n\nTests in test_examples.py directly access internal _entries.clear() and _samples.clear() (lines 34, 147-148, 209-210, 246-247) instead of using public methods.\n\nAlso tests use len(storage._entries) instead of awaiting a count method (lines 215-216).\n\n## Solution\n\nAdd public methods to both InMemoryLogStorage and InMemoryMetricsStorage:\n\n- clear() - async method to clear all entries/samples\n- clear_sync() - sync method (for sync adapter variant)\n\n## Updates Required\n\n1. Update adapters/storage/in_memory.py:\n   - Add clear() async method to InMemoryLogStorage\n   - Add clear() async method to InMemoryMetricsStorage\n   - Add clear_sync() to sync variants if they exist\n\n2. Update tests/test_examples.py:\n   - Replace storage._entries.clear() with await storage.clear()\n   - Replace storage._samples.clear() with await storage.clear()\n   - Replace len(storage._entries) with await storage.count() or add a count() method if needed\n\n## Testing\n\nRun tests to verify no regressions:\nuv run pytest tests/test_examples.py -v","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T10:30:33.9433+01:00","created_by":"philipphematty","updated_at":"2026-01-15T14:17:36.716247+01:00","closed_at":"2026-01-15T14:17:36.716247+01:00","close_reason":"Work migrated to observabilipy-2ph.11 (hierarchical structure)"}
{"id":"observabilipy-sh1","title":"Add public registry merge API","description":"Add public methods to MappingRegistry so consumers don't need to access private _mappings attribute.\n\n## Problem\nConsumers (like sunsoric_backend) need to merge multiple registries, but currently must access private _mappings:\n```python\nfor event_name, mapper in other_reg._mappings.items():\n    registry.register(event_name, mapper)\n```\n\n## Solution\nAdd public methods to MappingRegistry:\n\n1. `merge(other: MappingRegistry) -\u003e None` - Copy all mappings from another registry\n2. `__len__() -\u003e int` - Return count of registered mappings\n\n## Acceptance Criteria\n- [ ] `merge()` copies all mappings from source registry\n- [ ] `merge()` raises ValueError on duplicate event names\n- [ ] `len(registry)` returns mapping count\n- [ ] Tests for both methods\n- [ ] Release new version\n\n## Related\n- sunsoric_backend issue: sunsoric_backend-3jx (blocked on this)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-11T21:37:57.758778+01:00","created_by":"philipphematty","updated_at":"2026-01-11T21:50:34.78962+01:00","closed_at":"2026-01-11T21:50:34.78962+01:00","close_reason":"Implemented merge() and __len__() methods"}
{"id":"observabilipy-t9t","title":"EventObservability.record() race condition under pytest-xdist","description":"## Problem\n\n`EventObservability.record()` has a race condition when called from sync code running inside an async context (like pytest-xdist workers). The method schedules writes as fire-and-forget tasks, returning before the write completes.\n\n## Root Cause\n\nIn `adapters/events.py`, the `_write_outputs()` method:\n\n```python\ndef _write_outputs(self, outputs):\n    try:\n        loop = asyncio.get_running_loop()\n    except RuntimeError:\n        # No running event loop - use asyncio.run() (sync context)\n        asyncio.run(self._write_outputs_async(outputs))\n    else:\n        # Inside a running event loop - schedule as a task\n        loop.create_task(self._write_outputs_async(outputs))  # \u003c-- FIRE AND FORGET!\n```\n\nWhen an event loop is detected, writes are scheduled as background tasks that complete *after* `record()` returns. This causes tests to check storage before writes complete.\n\n## Impact\n\n- **sunsoric_backend**: 10+ tests marked with `@pytest.mark.no_parallel` as workaround\n- Tests that verify event emission fail randomly under parallel execution\n- Manual `SyncEventObservability` wrapper created in test conftest.py\n\n## Proposed Solution\n\nAdd a `sync: bool = False` parameter to EventObservability:\n\n```python\nclass EventObservability:\n    def __init__(self, registry, log_storage, metrics_storage, *, sync: bool = False):\n        self._sync = sync\n        # ...\n\n    def _write_outputs(self, outputs):\n        if self._sync:\n            # Write directly to storage, bypassing async machinery\n            for output in outputs:\n                if isinstance(output, LogEntry):\n                    self._log_storage._entries.append(output)\n                elif isinstance(output, MetricSample):\n                    self._metrics_storage._samples.append(output)\n            return\n\n        # Existing async logic...\n```\n\nAlternative: Always use sync writes for InMemoryStorage implementations (detect by checking storage type).\n\n## Acceptance Criteria\n\n- [ ] `EventObservability(sync=True)` writes synchronously to storage\n- [ ] Tests can verify event emission immediately after `record()` returns\n- [ ] Existing async behavior preserved when `sync=False` (default)\n- [ ] Document when to use sync mode (testing, WSGI contexts)\n\n## Related\n\n- sunsoric_backend workaround: `SyncEventObservability` class in `tests/unit/conftest.py`\n- sunsoric_backend tests marked `@pytest.mark.no_parallel` as mitigation","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-15T00:13:31.417237+01:00","created_by":"philipphematty","updated_at":"2026-01-15T14:17:44.112127+01:00","closed_at":"2026-01-15T14:17:44.112127+01:00","close_reason":"Work migrated to observabilipy-2ph.14 (hierarchical structure)"}
{"id":"observabilipy-xiu","title":"Event-Based Observability","description":"Epic for implementing event-based observability layer that decouples domain events from metrics/logs","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-09T11:37:02.408781+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:53:49.192964+01:00","closed_at":"2026-01-09T12:53:49.192964+01:00","close_reason":"Event-Based Observability epic complete. Implemented MappingRegistry, EventObservability adapter, event descriptor models, and BDD step definitions for all event features.","dependencies":[{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.1","type":"blocks","created_at":"2026-01-09T11:37:35.01438+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.2","type":"blocks","created_at":"2026-01-09T11:37:35.057368+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.3","type":"blocks","created_at":"2026-01-09T11:37:35.093981+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.4","type":"blocks","created_at":"2026-01-09T11:37:35.130936+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.5","type":"blocks","created_at":"2026-01-09T11:37:35.168533+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu","depends_on_id":"observabilipy-xiu.6","type":"blocks","created_at":"2026-01-09T11:37:35.2044+01:00","created_by":"daemon"}]}
{"id":"observabilipy-xiu.1","title":"Add pytest-bdd dev dependency","description":"Add pytest-bdd to dev dependencies in pyproject.toml for BDD testing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:05.422351+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:10:13.978316+01:00","closed_at":"2026-01-09T12:10:13.978316+01:00","close_reason":"Closed"}
{"id":"observabilipy-xiu.2","title":"Create MappingRegistry (register, lookup, validate)","description":"Create MappingRegistry class that registers event-to-metric/log descriptors, validates descriptor fields/labels exist on event class, and provides lookup functionality","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:08.617809+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:10:13.980439+01:00","closed_at":"2026-01-09T12:10:13.980439+01:00","close_reason":"Closed"}
{"id":"observabilipy-xiu.3","title":"Implement descriptor validation logic","description":"Implement validation that checks descriptor fields/labels exist on event class","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:12.113476+01:00","created_by":"philipphematty","updated_at":"2026-01-09T11:57:47.967296+01:00","closed_at":"2026-01-09T11:57:47.967296+01:00","close_reason":"Merged into MappingRegistry and EventObservability adapter","dependencies":[{"issue_id":"observabilipy-xiu.3","depends_on_id":"observabilipy-xiu.2","type":"blocks","created_at":"2026-01-09T11:37:38.563336+01:00","created_by":"daemon"}]}
{"id":"observabilipy-xiu.4","title":"Implement event-to-observability recording logic","description":"Implement logic to convert events to metrics/logs based on descriptors","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:15.016979+01:00","created_by":"philipphematty","updated_at":"2026-01-09T11:57:50.763259+01:00","closed_at":"2026-01-09T11:57:50.763259+01:00","close_reason":"Merged into MappingRegistry and EventObservability adapter","dependencies":[{"issue_id":"observabilipy-xiu.4","depends_on_id":"observabilipy-xiu.2","type":"blocks","created_at":"2026-01-09T11:37:38.694641+01:00","created_by":"daemon"}]}
{"id":"observabilipy-xiu.5","title":"Create EventObservability adapter (sync/async, uses registry)","description":"Create EventObservability adapter that handles sync/async contexts using event loop detection pattern, uses MappingRegistry to record events as metrics/logs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:17.421447+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:31:41.825147+01:00","closed_at":"2026-01-09T12:31:41.825147+01:00","close_reason":"Implemented MappingRegistry and EventObservability adapter with sync/async support. All tests passing.","dependencies":[{"issue_id":"observabilipy-xiu.5","depends_on_id":"observabilipy-xiu.2","type":"blocks","created_at":"2026-01-09T11:00:10.025094Z","created_by":"auto-update"}]}
{"id":"observabilipy-xiu.6","title":"BDD step definitions for all event features","description":"Create step definitions for event_descriptors.feature, event_recording.feature, and event_validation.feature","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T11:37:20.332965+01:00","created_by":"philipphematty","updated_at":"2026-01-09T12:42:37.283092+01:00","closed_at":"2026-01-09T12:42:37.283092+01:00","close_reason":"Implemented BDD step definitions for all event features (event_mappings.feature, event_recording.feature, event_validation.feature). All 10 scenarios pass.","dependencies":[{"issue_id":"observabilipy-xiu.6","depends_on_id":"observabilipy-xiu.1","type":"blocks","created_at":"2026-01-09T11:37:45.549034+01:00","created_by":"daemon"},{"issue_id":"observabilipy-xiu.6","depends_on_id":"observabilipy-xiu.5","type":"blocks","created_at":"2026-01-09T11:37:45.598959+01:00","created_by":"daemon"}]}
