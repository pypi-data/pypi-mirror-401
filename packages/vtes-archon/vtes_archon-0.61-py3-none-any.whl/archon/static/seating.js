!function(e,t,r,n,s,o,i,l){var a="u">typeof globalThis?globalThis:"u">typeof self?self:"u">typeof window?window:"u">typeof global?global:{},f="function"==typeof a[n]&&a[n],u=f.i||{},h=f.cache||{},p="u">typeof module&&"function"==typeof module.require&&module.require.bind(module);function g(t,r){if(!h[t]){if(!e[t]){if(s[t])return s[t];var o="function"==typeof a[n]&&a[n];if(!r&&o)return o(t,!0);if(f)return f(t,!0);if(p&&"string"==typeof t)return p(t);var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}u.resolve=function(r){var n=e[t][1][r];return null!=n?n:r},u.cache={};var l=h[t]=new g.Module(t);e[t][0].call(l.exports,u,l,l.exports,a)}return h[t].exports;function u(e){var t=u.resolve(e);if(!1===t)return{};if(Array.isArray(t)){var r={__esModule:!0};return t.forEach(function(e){var t=e[0],n=e[1],s=e[2]||e[0],o=g(n);"*"===t?Object.keys(o).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:function(){return o[e]}})}):"*"===s?Object.defineProperty(r,t,{enumerable:!0,value:o}):Object.defineProperty(r,t,{enumerable:!0,get:function(){return"default"===s?o.__esModule?o.default:o:o[s]}})}),r}return g(t)}}g.isParcelRequire=!0,g.Module=function(e){this.id=e,this.bundle=g,this.require=p,this.exports={}},g.modules=e,g.cache=h,g.parent=f,g.distDir=void 0,g.publicUrl=void 0,g.devServer=void 0,g.i=u,g.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(g,"root",{get:function(){return a[n]}}),a[n]=g;for(var _=0;_<t.length;_++)g(t[_]);if(r){var d=g(r);"object"==typeof exports&&"u">typeof module?module.exports=d:"function"==typeof define&&define.amd&&define(function(){return d})}}({"5liWw":[function(e,t,r,n){var s,o,i=e("@parcel/transformer-js/src/esmodule-helpers.js");i.defineInteropFlag(r),i.export(r,"RULE",()=>l),i.export(r,"shuffle_array",()=>g),i.export(r,"initial_seating",()=>R),i.export(r,"compute_issues",()=>v);var l=((s={})[s.R1_PREDATOR_PREY=0]="R1_PREDATOR_PREY",s[s.R2_OPPONENT_ALWAYS=1]="R2_OPPONENT_ALWAYS",s[s.R3_AVAILABLE_VPS=2]="R3_AVAILABLE_VPS",s[s.R4_OPPONENT_TWICE=3]="R4_OPPONENT_TWICE",s[s.R5_FIFTH_SEAT=4]="R5_FIFTH_SEAT",s[s.R6_SAME_POSITION=5]="R6_SAME_POSITION",s[s.R7_SAME_SEAT=6]="R7_SAME_SEAT",s[s.R8_STARTING_TRANSFERS=7]="R8_STARTING_TRANSFERS",s[s.R9_SAME_POSITION_GROUP=8]="R9_SAME_POSITION_GROUP",s),a=((o=a||{})[o.OPPONENT=0]="OPPONENT",o[o.PREY=1]="PREY",o[o.PREDATOR=2]="PREDATOR",o[o.GRAND_PREY=3]="GRAND_PREY",o[o.GRAND_PREDATOR=4]="GRAND_PREDATOR",o[o.CROSS_TABLE=5]="CROSS_TABLE",o[o.NEIGHBOUR=6]="NEIGHBOUR",o[o.NON_NEIGHBOUR=7]="NON_NEIGHBOUR",o[o.ROUNDS_PLAYED=0]="ROUNDS_PLAYED",o[o.VPS=1]="VPS",o[o.TRS=2]="TRS",o[o.SEAT_1=3]="SEAT_1",o[o.SEAT_2=4]="SEAT_2",o[o.SEAT_3=5]="SEAT_3",o[o.SEAT_4=6]="SEAT_4",o[o.SEAT_5=7]="SEAT_5",o);let f=new Map([[4,[[],[1,1,0,0,0,0,1,0],[1,0,0,0,0,1,0,1],[1,0,1,0,0,0,1,0]]],[5,[[],[1,1,0,0,0,0,1,0],[1,0,0,1,0,0,0,1],[1,0,0,0,1,0,0,1],[1,0,1,0,0,0,1,0]]]]),u=new Map([[4,[[1,4,1,1,0,0,0,0],[1,4,2,0,1,0,0,0],[1,4,3,0,0,1,0,0],[1,4,4,0,0,0,1,0]]],[5,[[1,5,1,1,0,0,0,0],[1,5,2,0,1,0,0,0],[1,5,3,0,0,1,0,0],[1,5,4,0,0,0,1,0],[1,5,4,0,0,0,0,1]]]]);function h(e,t){return e.map((e,r)=>e.map((e,n)=>e.map((e,s)=>e+t[r][n][s])))}class p{mapping=new Map;reverse=new Map;constructor(e){var t=0;for(const r of e)this.mapping.has(r)||(this.reverse.set(t,r),this.mapping.set(r,t++))}measure(e,t){let r=Array.from({length:this.mapping.size},e=>Array.from({length:this.mapping.size},e=>Array(8).fill(0)));for(let[s,o]of e.entries())if((!t||t.includes(s))&&u.has(o.length))for(let[e,t]of o.entries()){let s=this.mapping.get(t);r[s][s]=u.get(o.length)[e].slice();for(var n=1;n<o.length;n++){let t=this.mapping.get(o[(e+n)%o.length]);t>s||(r[s][t]=f.get(o.length)[n].slice())}}return r}measure_rounds(e){var t=void 0;for(let r of e){let e=this.measure(r);t=t?h(t,e):e}return t}issues(e){let t=Array.from({length:9},e=>[]);var r=0,n=0,s=0,o=0;for(let[t,i]of e.entries()){let e=i[t],l=e[0];l>0&&(r+=e[1]/l,n+=e[2]/l,s++,o=o<l?l:o)}for(let[i,l]of(r/=s,n/=s,e.entries()))for(let[e,a]of l.entries()){if(e>i)break;if(e===i){let e=a[0];Math.abs(r-a[1]/e)>1/e&&t[2].push([this.reverse.get(i)]),Math.abs(n-a[2]/e)>2/e&&t[7].push([this.reverse.get(i)]),a[3]>1&&t[6].push([this.reverse.get(i)]),a[4]>1&&t[6].push([this.reverse.get(i)]),a[5]>1&&t[6].push([this.reverse.get(i)]),a[6]>1&&t[6].push([this.reverse.get(i)]),a[7]>1&&(t[6].push([this.reverse.get(i)]),t[4].push([this.reverse.get(i)]))}else for(let[r,n]of a.entries())n>1&&(0==r?(s>20&&t[3].push([this.reverse.get(i),this.reverse.get(e)]),n>=o&&o>2&&t[1].push([this.reverse.get(i),this.reverse.get(e)])):r<=2?(t[0].push([this.reverse.get(i),this.reverse.get(e)]),t[5].push([this.reverse.get(i),this.reverse.get(e)])):r<=5?t[5].push([this.reverse.get(i),this.reverse.get(e)]):s>20&&t[8].push([this.reverse.get(i),this.reverse.get(e)]))}return t}fast_score(e){let t=Array(9).fill(0);var r=0,n=0,s=0,o=0;for(let[t,i]of e.entries()){let e=i[t],l=e[0];l>0&&(r+=e[1]/l,n+=e[2]/l,s++,o=o<l?l:o)}for(let[i,l]of(r/=s,n/=s,e.entries()))for(let[e,s]of l.entries()){if(e>i)break;if(e===i){let e=s[0];Math.abs(r-s[1]/e)>1/e&&t[2]++,Math.abs(n-s[2]/e)>2/e&&t[7]++,s[3]>1&&t[6]++,s[4]>1&&t[6]++,s[5]>1&&t[6]++,s[6]>1&&t[6]++,s[7]>1&&(t[6]++,t[4]++)}else for(let[e,r]of s.entries())r>1&&(0==e?(t[3]++,r>=o&&t[1]++):e<=2?(t[0]++,t[5]++):e<=5?t[5]++:t[8]++)}return t}}function g(e){for(let t=e.length-1;t>=0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}}function _(e){let t=e.length-4*(5-(e.length%5||5));var r=0;let n=[];for(;r<e.length;){let s=r<t?5:4,o=e.slice(r,r+s);if(o.length<4)throw Error("Invalid players count");n.push(o),r+=s}return n}function d(e,t){let r=e.length<t.length?e.length:t.length;for(var n=0;n<r;n++){let r=e[n].length,s=t[n].length;if(r<s)return -1;if(r>s)return 1}return 0}class c{seat_index=new Map;player_index=new Map;seating;constructor(e){this.seating=e.map(e=>e.slice());var t=0;for(const[r,n]of e.entries())for(const[e,s]of n.entries())this.player_index.set(s,t),this.seat_index.set(t,[r,e]),t++}random_swap(e){let t=this.player_index.get(e);for(var r=t;r==t;)r=Math.floor(Math.random()*this.seat_index.size);this.swap(t,r)}shuffle(){for(var e=this.seat_index.size-1;e>=0;e--){let t=e,r=Math.floor(Math.random()*(e+1));this.swap(t,r)}}swap(e,t){let[r,n]=[this.seat_index.get(e),this.seat_index.get(t)],[s,o]=[this.seating[r[0]][r[1]],this.seating[n[0]][n[1]]];this.seating[r[0]][r[1]]=o,this.seating[n[0]][n[1]]=s,this.player_index.set(s,t),this.player_index.set(o,e)}}function R(e,t){if(t=t.slice(),e.length<=0)return g(t),_(t);let r=new Set(t),n=new Set(t);for(let t of e)for(let e of t)for(let t of e)n.add(t);let s=new p(n),o=s.measure_rounds(e);if(t.length<1)return _(t);let i=[,,,,];for(var l=0;l<i.length;l++){g(t);let e=new c(_(t));i[l]=[e,s.issues(h(o,s.measure(e.seating)))]}let a=Math.floor(t.length/2);for(var f=0;f<3e3;f++){var u=1+Math.round((a-1)*(1-Math.log(f+1)/Math.log(3e3)));u<2&&Math.random()>.5&&(u+=1);for(var R=0;R<i.length;R++){var v=new c(i[R][0].seating);let e=new Set;for(let t of i[R][1]){for(let n of t){let t=n.filter(e=>r.has(e));if(!(t.length<1)&&(t.length<2?e.add(t[0]):e.add(t[Math.floor(Math.random()*t.length)]),e.size>=u))break}if(e.size>=u)break}let t=Array.from(r).filter(t=>!e.has(t));for(;e.size<u&&t.length>0;)e.add(t.splice(Math.floor(Math.random()*t.length),1)[0]);for(let t of e)v.random_swap(t);let n=s.issues(h(o,s.measure(v.seating)));if(0>d(n,i[R][1])&&(i[R]=[v,n]),!i[R][1].some(e=>e.length>0))return console.log(`optimal found after ${f} iterations`),i[R][0].seating}}i.sort((e,t)=>d(e[1],t[1]));let E=i[0];return console.log("best seating found",E[1].map(e=>e.length).join(", ")),E[0].seating}function v(e){let t=new Set;for(let r of e)for(let e of r)for(let r of e)t.add(r);let r=new p(t),n=r.measure_rounds(e);return r.issues(n)}},{"@parcel/transformer-js/src/esmodule-helpers.js":"k3151"}],k3151:[function(e,t,r,n){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}]},["5liWw"],"5liWw","parcelRequire94c2",{});
//# sourceMappingURL=seating.js.map
