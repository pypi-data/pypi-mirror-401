import{J as ie,a7 as oe,K as re,r as o,f as de,o as ce,a8 as ue,N as h,Q as y,R as t,c as a,b as i,W as n,X as $,a9 as me,Y as r,aa as pe,n as K,S as fe,z as ve}from"./index-DMKqdLaf.js";import{A as O,I,i as u,l as m,n as P,p as U,o as Q,q as W,_ as ye}from"./_plugin-vue_export-helper-DIV_95uD.js";import{S as ge}from"./SchemaForm-Dd2o4P-y.js";import{L as X,V as he}from"./VSelect-0SukG3gG.js";import{V as G,a as z}from"./LoadingSpinner.vue_vue_type_style_index_0_scoped_0c8a0411_lang-D_MGrIbP.js";import{V as Ve}from"./VDataTable-cALBmuad.js";import{V as Y,a as we}from"./VContainer-Dp3Q7MEs.js";import{V as Z}from"./VDialog-BRH2VoLb.js";import{V as H}from"./VSpacer-DC1r4rXe.js";import{V as L,f as Ie}from"./VMenu-CRN2gxfd.js";import{V as _e}from"./VForm-CkYUn06t.js";import{d as ee}from"./VTextField-Bjfd5Be9.js";import{V as be}from"./VAlert-lJiK8Tm2.js";import"./forwardRefs-DYN4dGLY.js";const $e={class:"d-flex align-center justify-space-between flex-wrap ga-4"},Ce={class:"text-h5 text-sm-h4 font-weight-bold mb-1"},Ae={class:"text-body-2 text-medium-emphasis mb-0"},ke={class:"d-flex ga-2"},xe={class:"d-none d-sm-inline ml-2"},Se={class:"d-none d-sm-inline ml-2"},ze={class:"d-flex align-center"},De={class:"font-weight-medium"},Te={class:"text-caption"},Ne={class:"d-flex flex-nowrap"},Be={class:"text-center py-8"},qe={class:"text-h6 text-medium-emphasis"},Fe={class:"text-body-2 text-medium-emphasis mb-4"},Pe={class:"d-flex align-center mb-4"},Ue={class:"text-subtitle-1 font-weight-bold"},Ge={key:3,class:"text-center text-medium-emphasis py-4"},He=ie({__name:"instances",setup(Le){const D=oe("showSnackbar",()=>{}),{t:C}=re(),A=e=>{switch(e){case"getter":return"success";case"pusher":return"info";case"processer":return"warning";default:return"primary"}},T=e=>{switch(e){case"getter":return"mdi-download-outline";case"pusher":return"mdi-upload-outline";case"processer":return"mdi-cog-outline";default:return"mdi-puzzle-outline"}},j=e=>{if(e)return k.value.find(l=>l.name===e)?.type},k=o([]),N=o([]),ae=de(()=>[{title:C("instances.tableHeaderAdapter"),key:"adapter_name",width:"200px"},{title:C("instances.tableHeaderIdentifier"),key:"identifier"},{title:C("instances.tableHeaderId"),key:"id",width:"300px"},{title:C("common.actions"),key:"actions",align:"end",sortable:!1,width:"120px"}]),x=o(!1),B=o(!0),V=o(!1),q=o(!1),w=o(!1),_=o(!1),c=o(!1),p=o({}),d=o(""),S=o(null),F=o(!1),f=o(null),g=o({});ce(async()=>{await E(),await b()}),ue(async()=>{await b()});const E=async()=>{try{const e=await O.listAdaptersApiV1AdaptersGet();k.value=e||[]}catch(e){throw console.error(e),e}},b=async()=>{x.value=!0,N.value=[];try{k.value.length===0&&await E();const e=await I.listInstancesApiV1InstancesGet({});N.value=e.items||[]}catch(e){console.error(e),D("Failed to load instances","error")}finally{x.value=!1,B.value=!1}},M=async e=>{if(!e){f.value=null;return}V.value=!0;try{const l=await O.getAdapterInstanceConfigSchemaApiV1AdaptersAdapterNameInstanceConfigSchemaGet({adapterName:e});f.value=l,c.value||(g.value={})}catch(l){console.error(l),f.value=null}finally{V.value=!1}},R=()=>{c.value=!1,p.value={identifier:""},d.value="",f.value=null,g.value={},w.value=!0},te=async e=>{const l=e.adapter_name;if(!(!l||!e.id)){c.value=!0,p.value={...e},d.value=l,w.value=!0,await M(l);try{const s=await I.getInstanceConfigApiV1InstancesInstanceIdConfigGet({instanceId:e.id});g.value=s||{}}catch(s){console.error(s)}}},J=()=>{w.value=!1},se=async()=>{if(!(!d.value||!p.value.identifier)){q.value=!0;try{if(c.value&&p.value.id)await I.setInstanceConfigApiV1InstancesInstanceIdConfigPut({instanceId:p.value.id,requestBody:g.value});else{const e=await I.createInstanceApiV1InstancesPost({requestBody:{adapter_name:d.value,identifier:p.value.identifier}});await I.setInstanceConfigApiV1InstancesInstanceIdConfigPut({instanceId:e.id,requestBody:g.value})}w.value=!1,await b()}catch(e){console.error(e),D("Failed to save instance","error")}finally{q.value=!1}}},le=e=>{S.value=e,_.value=!0},ne=async()=>{if(S.value?.id){F.value=!0;try{await I.deleteInstanceApiV1InstancesInstanceIdDelete({instanceId:S.value.id}),_.value=!1,S.value=null,await b()}catch(e){console.error(e),D("Failed to delete instance","error")}finally{F.value=!1}}};return(e,l)=>(y(),h(we,{fluid:""},{default:t(()=>[a(G,{class:"mb-6"},{default:t(()=>[a(z,{cols:"12"},{default:t(()=>[i("div",$e,[i("div",null,[i("h1",Ce,n(e.$t("instances.title")),1),i("p",Ae,n(e.$t("instances.description")),1)]),i("div",ke,[a(u,{color:"primary",variant:"tonal",icon:e.$vuetify.display.xs,onClick:b,loading:x.value},{default:t(()=>[a(m,{icon:"mdi-refresh"}),i("span",xe,n(e.$t("common.refresh")),1)]),_:1},8,["icon","loading"]),a(u,{color:"primary",icon:e.$vuetify.display.xs,onClick:R},{default:t(()=>[a(m,{icon:"mdi-plus"}),i("span",Se,n(e.$t("instances.createInstance")),1)]),_:1},8,["icon"])])])]),_:1})]),_:1}),a(G,null,{default:t(()=>[a(z,{cols:"12"},{default:t(()=>[a(P,{class:"card-outlined"},{default:t(()=>[B.value?(y(),h(U,{key:0,class:"pa-0"},{default:t(()=>[a(X,{text:e.$t("messages.loadingMessages")},null,8,["text"])]),_:1})):$("",!0),me(a(Ve,{items:N.value,headers:ae.value,loading:x.value,"items-per-page-text":e.$t("common.itemsPerPage"),"items-per-page-options":[10,25,50,100],class:"elevation-0"},{"item.adapter_name":t(({item:s})=>[a(Y,{color:A(j(s.adapter_name)),variant:"tonal",size:"small",label:""},{default:t(()=>[a(m,{icon:T(j(s.adapter_name)),size:"small",start:""},null,8,["icon"]),r(" "+n(s.adapter_name),1)]),_:2},1032,["color"])]),"item.identifier":t(({item:s})=>[i("div",ze,[a(m,{icon:"mdi-identifier",size:"small",class:"mr-2 text-medium-emphasis"}),i("span",De,n(s.identifier),1)])]),"item.id":t(({item:s})=>[i("code",Te,n(s.id),1)]),"item.actions":t(({item:s})=>[i("div",Ne,[a(u,{icon:"mdi-cog-outline",variant:"text",size:"small",color:"primary",onClick:v=>te(s)},null,8,["onClick"]),a(u,{icon:"mdi-delete-outline",variant:"text",size:"small",color:"error",onClick:v=>le(s)},null,8,["onClick"])])]),"no-data":t(()=>[i("div",Be,[a(m,{icon:"mdi-server-off",size:"64",color:"medium-emphasis",class:"mb-4"}),i("div",qe,n(e.$t("instances.noInstances")),1),i("div",Fe,n(e.$t("instances.noInstancesText")),1),a(u,{color:"primary","prepend-icon":"mdi-plus",onClick:R},{default:t(()=>[r(n(e.$t("instances.createInstance")),1)]),_:1})])]),_:1},8,["items","headers","loading","items-per-page-text"]),[[pe,!B.value]])]),_:1})]),_:1})]),_:1}),a(Z,{modelValue:w.value,"onUpdate:modelValue":l[4]||(l[4]=s=>w.value=s),"max-width":"800px",scrollable:"",persistent:"",fullscreen:e.$vuetify.display.smAndDown},{default:t(()=>[a(P,{rounded:e.$vuetify.display.smAndDown?"0":"xl",class:"d-flex flex-column",style:K(e.$vuetify.display.smAndDown?"height: 100%":"")},{default:t(()=>[a(Q,{class:"d-flex align-center pa-3 pa-sm-4"},{default:t(()=>[a(m,{icon:c.value?"mdi-pencil":"mdi-plus-circle",class:"mr-2"},null,8,["icon"]),r(" "+n(c.value?e.$t("instances.editInstance"):e.$t("instances.createInstance"))+" ",1),a(H),a(u,{icon:"mdi-close",variant:"text",size:"small",onClick:J})]),_:1}),a(L),a(U,{style:K(e.$vuetify.display.smAndDown?"flex: 1; overflow-y: auto;":"max-height: 60vh;"),class:"pa-3 pa-sm-4"},{default:t(()=>[a(_e,{ref:"form"},{default:t(()=>[a(G,null,{default:t(()=>[a(z,{cols:"12",md:"6"},{default:t(()=>[c.value?(y(),h(ee,{key:1,modelValue:d.value,"onUpdate:modelValue":l[1]||(l[1]=s=>d.value=s),label:e.$t("instances.adapterType"),"prepend-inner-icon":"mdi-puzzle-outline",readonly:"",disabled:""},null,8,["modelValue","label"])):(y(),h(he,{key:0,modelValue:d.value,"onUpdate:modelValue":[l[0]||(l[0]=s=>d.value=s),M],items:k.value,"item-title":"name","item-value":"name",label:e.$t("instances.adapterType"),"prepend-inner-icon":"mdi-puzzle-outline",rules:[s=>!!s||e.$t("crons.required")]},{item:t(({props:s,item:v})=>[a(Ie,ve(s,{subtitle:v.raw.summary||v.raw.description||""}),{prepend:t(()=>[a(m,{icon:T(v.raw.type),color:A(v.raw.type),class:"mr-2"},null,8,["icon","color"])]),append:t(()=>[a(Y,{size:"x-small",color:A(v.raw.type),variant:"tonal"},{default:t(()=>[r(n(v.raw.type),1)]),_:2},1032,["color"])]),_:2},1040,["subtitle"])]),selection:t(({item:s})=>[a(m,{icon:T(s.raw.type),color:A(s.raw.type),size:"small",class:"mr-2"},null,8,["icon","color"]),r(" "+n(s.raw.name),1)]),_:1},8,["modelValue","items","label","rules"]))]),_:1}),a(z,{cols:"12",md:"6"},{default:t(()=>[a(ee,{modelValue:p.value.identifier,"onUpdate:modelValue":l[2]||(l[2]=s=>p.value.identifier=s),label:e.$t("instances.instanceName"),"prepend-inner-icon":"mdi-identifier",rules:[s=>!!s||e.$t("crons.required")],readonly:c.value,disabled:c.value,"persistent-hint":""},null,8,["modelValue","label","rules","readonly","disabled"])]),_:1})]),_:1}),a(L,{class:"my-6"}),i("div",Pe,[a(m,{icon:"mdi-cog",class:"mr-2"}),i("span",Ue,n(e.$t("system.configuration")),1)]),V.value?(y(),h(X,{key:0,text:e.$t("system.loadingSystemStatus"),size:"40",class:"my-4"},null,8,["text"])):$("",!0),f.value&&!V.value?(y(),h(ge,{key:1,modelValue:g.value,"onUpdate:modelValue":l[3]||(l[3]=s=>g.value=s),schema:f.value,"root-schema":f.value},null,8,["modelValue","schema","root-schema"])):$("",!0),!f.value&&!V.value&&d.value?(y(),h(be,{key:2,type:"info",variant:"tonal",density:"compact"},{default:t(()=>[r(n(e.$t("adapters.noConfigurationSchema")),1)]),_:1})):$("",!0),!d.value&&!V.value?(y(),fe("div",Ge,n(e.$t("instances.selectAdapterToViewOptions")),1)):$("",!0)]),_:1},512)]),_:1},8,["style"]),a(L),a(W,{class:"pa-2 pa-sm-4"},{default:t(()=>[a(H),a(u,{variant:"text",onClick:J},{default:t(()=>[r(n(e.$t("common.cancel")),1)]),_:1}),a(u,{color:"primary",onClick:se,loading:q.value,disabled:!d.value||!p.value.identifier},{default:t(()=>[r(n(c.value?e.$t("common.save"):e.$t("instances.createInstance")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["rounded","style"])]),_:1},8,["modelValue","fullscreen"]),a(Z,{modelValue:_.value,"onUpdate:modelValue":l[6]||(l[6]=s=>_.value=s),"max-width":"400px",persistent:""},{default:t(()=>[a(P,{rounded:"xl"},{default:t(()=>[a(Q,{class:"d-flex align-center pa-4"},{default:t(()=>[a(m,{icon:"mdi-alert-circle",color:"error",class:"mr-2"}),r(" "+n(e.$t("instances.deleteInstance")),1)]),_:1}),a(U,null,{default:t(()=>[r(n(e.$t("instances.confirmDelete")),1)]),_:1}),a(W,{class:"pa-4"},{default:t(()=>[a(H),a(u,{variant:"text",onClick:l[5]||(l[5]=s=>_.value=!1)},{default:t(()=>[r(n(e.$t("common.cancel")),1)]),_:1}),a(u,{color:"error",variant:"tonal",onClick:ne,loading:F.value},{default:t(()=>[r(n(e.$t("common.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ta=ye(He,[["__scopeId","data-v-0abaa39a"]]);export{ta as default};
