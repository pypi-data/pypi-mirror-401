"""Initial migration

Revision ID: bfbf041984e0
Revises:
Create Date: 2025-11-13 17:59:26.591067

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
import sqlmodel


# revision identifiers, used by Alembic.
revision: str = "bfbf041984e0"
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "adapterinstance",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("adapter_name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("identifier", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "adapter_name", "identifier", name="uix_adapter_identifier"
        ),
    )
    op.create_table(
        "config",
        sa.Column("key", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("value", sa.JSON(), nullable=True),
        sa.PrimaryKeyConstraint("key"),
    )
    op.create_table(
        "file",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("path", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("mime", sqlmodel.sql.sqltypes.AutoString(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "message",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column(
            "message_identifier", sqlmodel.sql.sqltypes.AutoString(), nullable=False
        ),
        sa.Column("getter_name", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("ts", sa.Float(), nullable=False),
        sa.Column("content", sa.JSON(), nullable=True),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "message_identifier", "getter_name", name="uix_message_identifier_getter"
        ),
    )
    op.create_table(
        "pipextraindexurl",
        sa.Column("url", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.PrimaryKeyConstraint("url"),
        sa.UniqueConstraint("url", name="uix_pip_extra_index_url"),
    )
    op.create_table(
        "adapterinstancepair",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("getter_instance_id", sa.Uuid(), nullable=False),
        sa.Column("pusher_instance_id", sa.Uuid(), nullable=False),
        sa.ForeignKeyConstraint(
            ["getter_instance_id"],
            ["adapterinstance.id"],
        ),
        sa.ForeignKeyConstraint(
            ["pusher_instance_id"],
            ["adapterinstance.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "getter_instance_id", "pusher_instance_id", name="uix_getter_pusher_pair"
        ),
    )
    op.create_table(
        "getterinstancecron",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("instance_id", sa.Uuid(), nullable=False),
        sa.Column("cron", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.ForeignKeyConstraint(
            ["instance_id"],
            ["adapterinstance.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("instance_id", "cron", name="uix_instance_cron"),
    )
    op.create_table(
        "pushtask",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("pusher_instance_id", sa.Uuid(), nullable=False),
        sa.Column("message_id", sa.Uuid(), nullable=False),
        sa.Column("status", sqlmodel.sql.sqltypes.AutoString(), nullable=False),
        sa.Column("retry_count", sa.Integer(), nullable=False),
        sa.Column("created_at", sa.DateTime(), nullable=False),
        sa.ForeignKeyConstraint(
            ["message_id"],
            ["message.id"],
        ),
        sa.ForeignKeyConstraint(
            ["pusher_instance_id"],
            ["adapterinstance.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint(
            "pusher_instance_id", "message_id", name="uix_pusher_message"
        ),
    )
    op.create_table(
        "warningrecipient",
        sa.Column("id", sa.Uuid(), nullable=False),
        sa.Column("adapter_instance_id", sa.Uuid(), nullable=False),
        sa.Column("created_at", sa.DateTime(), nullable=False),
        sa.ForeignKeyConstraint(
            ["adapter_instance_id"],
            ["adapterinstance.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
        sa.UniqueConstraint("adapter_instance_id", name="uix_warning_recipient"),
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table("warningrecipient")
    op.drop_table("pushtask")
    op.drop_table("getterinstancecron")
    op.drop_table("adapterinstancepair")
    op.drop_table("pipextraindexurl")
    op.drop_table("message")
    op.drop_table("file")
    op.drop_table("config")
    op.drop_table("adapterinstance")
    # ### end Alembic commands ###
