import{J as C,K as I,O as M,M as N,r as m,o as R,N as V,Q as b,R as n,c as o,b as r,W as c,ac as q,X as z,V as a,aK as B,Y as y,$ as A}from"./index-DMKqdLaf.js";import{u as F}from"./auth-BYzPLr2t.js";import{V as K}from"./VMain-DAtyNVQn.js";import{n as L,l as h,i as k,_ as W}from"./_plugin-vue_export-helper-DIV_95uD.js";import{V as j}from"./VForm-CkYUn06t.js";import{d as D}from"./VTextField-Bjfd5Be9.js";import{V as J}from"./VAlert-lJiK8Tm2.js";import{V as _}from"./VSpacer-DC1r4rXe.js";import"./forwardRefs-DYN4dGLY.js";const O={class:"text-center mb-6"},P={class:"text-h5 font-weight-medium"},Q={class:"d-flex align-center my-4"},U={class:"text-caption text-medium-emphasis mx-4"},x=C({__name:"login",setup(X){const{t:T}=I(),p=M(),f=N(),g=F(),l=m(""),u=m(!1),i=m(null),d=m(!1);R(async()=>{g.initializeFromStorage();const e=f.query.token;if(typeof e=="string"&&e){await v(e);const{token:t,...s}=f.query;p.replace({path:f.path,query:s})}});const v=async e=>{if(u.value)return;const t=(e??l.value).trim();if(t){u.value=!0,i.value=null;try{await g.loginWithToken(t),await p.isReady(),await p.replace("/")}catch{g.logout(),i.value=T("login.invalidToken")}finally{u.value=!1}}},S=()=>v(),$=()=>{const e="/api/v1/oauth/login";window.location.href=e};return(e,t)=>(b(),V(A,null,{default:n(()=>[o(K,{class:"d-flex align-center justify-center bg-white"},{default:n(()=>[o(L,{"max-width":"480",width:"100%",class:"pa-4 pa-sm-6 mx-2 login-card",rounded:"xl"},{default:n(()=>[r("div",O,[o(h,{icon:"mdi-account-circle",size:"64",class:"mb-1 icon-light-blue"}),r("h1",P,c(e.$t("login.title")),1),t[3]||(t[3]=r("p",{class:"text-body-2 text-medium-emphasis mt-1"},null,-1))]),o(j,{onSubmit:q(S,["prevent"])},{default:n(()=>[o(D,{modelValue:a(l),"onUpdate:modelValue":t[0]||(t[0]=s=>B(l)?l.value=s:null),label:e.$t("login.accessToken"),variant:"outlined",type:a(d)?"text":"password","append-inner-icon":a(d)?"mdi-eye-off":"mdi-eye","onClick:appendInner":t[1]||(t[1]=s=>d.value=!a(d)),autocomplete:"off","hide-details":"auto",class:"mb-4"},null,8,["modelValue","label","type","append-inner-icon"]),a(i)?(b(),V(J,{key:0,type:"error",variant:"tonal",density:"compact",closable:"",class:"mb-4","onClick:close":t[2]||(t[2]=s=>i.value=null)},{default:n(()=>[y(c(a(i)),1)]),_:1})):z("",!0),o(k,{block:"",color:"primary",size:"large",type:"submit",loading:a(u),disabled:!a(l),class:"mb-4"},{default:n(()=>[o(h,{icon:"mdi-key",class:"mr-2"}),y(" "+c(e.$t("login.signInToken")),1)]),_:1},8,["loading","disabled"]),r("div",Q,[o(_),r("span",U,c(e.$t("login.or")),1),o(_)]),o(k,{block:"",variant:"tonal",size:"large",onClick:$},{default:n(()=>[o(h,{icon:"mdi-shield-account",class:"mr-2"}),y(" "+c(e.$t("login.signInSso")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),w={};typeof w=="function"&&w(x);const ne=W(x,[["__scopeId","data-v-187772cf"]]);export{ne as default};
