[tool.poetry]
name = "tnh-scholar"
version = "0.3.0"
description = "TNH Scholar is an AI-driven project designed to explore, query, and translate the teachings of Thich Nhat Hanh and Plum Village community."
authors = ["Aaron K. Solomon <aaron.kyle.solomon@gmail.com>"]
license = "GPL-3.0-only"
readme = "README.md"
keywords = ["nlp", "dharma", "processing", "text", "translation", "ai"]
classifiers = [
    "Development Status :: 3 - Alpha",
    "Intended Audience :: Science/Research",
    "Programming Language :: Python :: 3.12",
]
packages = [{ include = "tnh_scholar", from = "src" }]
include = ["src/tnh_scholar/runtime_assets/**"]

[tool.poetry.urls]
Homepage = "https://aaronksolomon.github.io/tnh-scholar/"
"Bug Tracker" = "https://github.com/aaronksolomon/tnh-scholar/issues"
Documentation = "https://aaronksolomon.github.io/tnh-scholar/"

[tool.poetry.dependencies]
python = ">=3.12,<3.13"
beautifulsoup4 = { version = "4.12.3", optional = true }
click = "8.1.8"
colorlog = "6.9.0"
assemblyai = "0.34.0"
ebooklib = { version = "0.18", optional = true }
fitz = { version = "0.0.1.dev2", optional = true }
flask = "3.1.0"
gitpython = "3.1.44"
google-cloud = { version = "0.34.0", optional = true }
google-cloud-vision = { version = "3.9.0", optional = true }
jinja2 = "3.1.5"
langchain-community = { version = "0.3.13", optional = true }
langdetect = "1.0.9"
lxml = "5.3.0"
nltk = "3.9.1"
numpy = "2.0.2"
openai = "2.5.0"
openai-whisper = "20240930"
packaging = "24.2"
pdf2image = { version = "1.17.0", optional = true }
pillow = { version = "11.1.0", optional = true }
pycountry = "24.6.1"
pydantic = "2.10.4"
pydantic-settings = "2.6.1"
pysrt = "1.1.2"
pydub = "0.25.1"
platformdirs = "4.3.6"
pyngrok = "7.2.3"
python-dotenv = "1.0.1"
python-json-logger = "2.0.7"
pyyaml = "6.0.2"
regex = "2024.11.6"
requests = "2.32.3"
spacy = { version = "3.8.3", optional = true }
streamlit = { version = "1.41.1", optional = true }
supabase = { version = "2.11.0", optional = true }
tenacity = "9.0.0"
tiktoken = "0.8.0"
torch = "2.5.1"
tqdm = "4.67.1"
transformers = "4.48"
unidecode = "1.3.8"
typer = "0.12.5"
yt-dlp = ">=2025.1.15"

[tool.poetry.extras]
gui = ["streamlit", "langchain-community", "supabase"]
query = ["beautifulsoup4", "spacy", "ebooklib"]
ocr = ["fitz", "pillow", "google-cloud", "google-cloud-vision", "pdf2image"]

[tool.poetry.group.dev]

[tool.poetry.group.dev.dependencies]
black = "24.10.0"
ipykernel = "6.29.5"
mkdocs-gen-files = "0.5.0"
mkdocs-literate-nav = "0.6.1"
mkdocstrings-python = "^2.0.1"
mkdocs-material = "9.5.50"
mypy = "1.14.1"
pipreqs = "0.5.0"
pytest = "8.3.4"
pytest-cov = "6.0.0"
pylint = "3.2.2"
radon = "6.0.1"
ruff = "0.9.2"
types-PyYAML = "6.0.12.20241230"
types-requests = "2.32.0.20241016"
pre-commit = "^4.5.0"
codespell = "2.3.0"
md-dead-link-check = "^1.2.0"

[tool.poetry.group.local]
optional = true

[tool.poetry.group.local.dependencies]
sourcery = "^1.41.1"

[tool.poetry.scripts]
audio-transcribe = "tnh_scholar.cli_tools.audio_transcribe.audio_transcribe:main"
tnh-fab = "tnh_scholar.cli_tools.tnh_fab.tnh_fab:main"
tnh-gen = "tnh_scholar.cli_tools.tnh_gen.tnh_gen:main"
ytt-fetch = "tnh_scholar.cli_tools.ytt_fetch.ytt_fetch:main"
nfmt = "tnh_scholar.cli_tools.nfmt.nfmt:main"
token-count = "tnh_scholar.cli_tools.token_count.token_count:main"
tnh-setup = "tnh_scholar.cli_tools.tnh_setup.tnh_setup:main"
tnh-tree = "tnh_scholar.cli_tools.tnh_tree:main"
sent-split = "tnh_scholar.cli_tools.sent_split.sent_split:main"
json-srt = "tnh_scholar.cli_tools.json_to_srt.json_to_srt:main"
srt-translate = "tnh_scholar.cli_tools.srt_translate.srt_translate:main"

[tool.black]
line-length = 110
target-version = ["py312"]
include = "\\.pyi?$"

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
addopts = "-ra -q"
pythonpath = ["src"]

[tool.mypy]
python_version = "3.12"
strict = false
mypy_path = "typings"
disallow_untyped_defs = false
check_untyped_defs = false
ignore_missing_imports = true
strict_optional = false
warn_return_any = true
warn_unused_configs = true
plugins = ["pydantic.mypy"]

[[tool.mypy.overrides]]
module = ["tests.*"]
disallow_untyped_defs = false

[tool.coverage.run]
source = ["tnh_scholar"]
omit = ["tests/*", "**/__init__.py"]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
    "pass",
]

[tool.ruff]
line-length = 110
target-version = "py312"
lint.select = ["E", "F", "I", "C90"]
lint.mccabe.max-complexity = 9
exclude = [
    "*.ipynb",
    "notebooks/**",
    ".venv",
    "__pycache__",
]

[tool.pylint."MAIN"]
max-line-length = 110
max-args = 6
max-locals = 15
max-branches = 7
max-statements = 20
max-returns = 6
max-nested-blocks = 3
max-bool-expr = 5
max-parents = 7
max-attributes = 10
max-public-methods = 20
disable = ["missing-docstring", "invalid-name", "too-few-public-methods"]
good-names = ["i", "j", "k", "ex", "Run", "_"]

[tool.radon]

[tool.md_dead_link_check]
# External link checking configuration
timeout = 10
check_web_links = true
validate_ssl = true
catch_response_codes = [404, 410, 500, 502, 503]

# Exclude internal/relative links (MkDocs validates these)
exclude_links = [
    "./*",           # Relative links
    "../*",          # Parent relative links
    "/*",            # Absolute internal paths
    "#*",            # Anchor-only links
    "mailto:*",      # Email links
]

# Exclude files/directories
exclude_files = [
    "*/archive/*",
    "*/tmp/*",
]

[build-system]
requires = ["poetry-core>=1.9.0"]
build-backend = "poetry.core.masonry.api"
