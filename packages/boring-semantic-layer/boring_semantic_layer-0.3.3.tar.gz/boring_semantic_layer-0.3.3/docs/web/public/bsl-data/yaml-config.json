{
  "markdown": "# YAML Configuration\n\nDefine your semantic models using YAML for better organization and maintainability.\n\n## Why YAML?\n\nYAML configuration provides several advantages:\n- **Better organization**: Keep your model definitions separate from your code\n- **Version control**: Track changes to your data model structure\n- **Collaboration**: Non-developers can review and understand the model\n- **Reusability**: Share model definitions across different projects\n\n## Expression Syntax\n\nHere's a complete example with dimensions, measures, and joins:\n\n<yamlcontent path=\"yaml_example.yaml\"></yamlcontent>\n\n<note type=\"warning\">\nIn YAML configuration, **only unbound syntax (`_`) is accepted** for expressions. Lambda expressions are not supported in YAML files.\n</note>\n\n## Loading YAML Models\n\n### Option 1: Using Profiles (Recommended)\n\n```yaml\n# File-level profile\nprofile: my_db\n\nflights:\n  table: flights_tbl\n  dimensions:\n    origin: _.origin\n```\n\n```python\nfrom boring_semantic_layer import from_yaml\n\nmodels = from_yaml(\"flights_model.yml\")\n```\n\nSee [Profile documentation](/building/profile) for setup details.\n\n### Option 2: Passing Tables Manually\n\nCreate your ibis tables:\n\n```yaml_setup\nimport ibis\n\nflights_tbl = ibis.memtable({\n    \"origin\": [\"JFK\", \"LAX\", \"SFO\"],\n    \"dest\": [\"LAX\", \"SFO\", \"JFK\"],\n    \"carrier\": [\"AA\", \"UA\", \"DL\"],\n    \"year\": [2023, 2023, 2024],\n    \"distance\": [2475, 337, 382]\n})\n\ncarriers_tbl = ibis.memtable({\n    \"code\": [\"AA\", \"UA\", \"DL\"],\n    \"name\": [\"American Airlines\", \"United Airlines\", \"Delta Air Lines\"]\n})\n```\n\nAnd pass them to the loaded YAML file defining your Semantic Tables:\n\n```load_yaml_example\nfrom boring_semantic_layer import from_yaml\n\n# Load models from YAML file with explicit tables\nmodels = from_yaml(\n    \"yaml_example.yaml\",\n    tables={\n        \"flights_tbl\": flights_tbl,\n        \"carriers_tbl\": carriers_tbl\n    }\n)\n\nflights_sm = models[\"flights\"]\ncarriers_sm = models[\"carriers\"]\n\n# Inspect the loaded models\nflights_sm.dimensions, flights_sm.measures\n```\n\n<regularoutput code-block=\"load_yaml_example\"></regularoutput> \n\n### Option 3: Loading from a Dictionary (`from_config`)\n\nIf you're loading configuration through your own mechanism (e.g., Kedro catalog, external config management), you can use `from_config()` to construct semantic models directly from a Python dictionary:\n\n```python\nfrom boring_semantic_layer import from_config\n\nconfig = {\n    \"flights\": {\n        \"table\": \"flights_tbl\",\n        \"dimensions\": {\n            \"origin\": \"_.origin\",\n            \"destination\": \"_.dest\",\n        },\n        \"measures\": {\n            \"flight_count\": \"_.count()\",\n            \"avg_distance\": \"_.distance.mean()\",\n        },\n    }\n}\n\nmodels = from_config(config, tables={\"flights_tbl\": flights_tbl})\nflights_sm = models[\"flights\"]\n```\n\nThis is useful for integrations where you don't want to write config to a file just to load it. The `from_config()` function accepts the same `profile` and `profile_path` parameters as `from_yaml()`:\n\n```python\n# With a profile\nmodels = from_config(config, profile=\"my_db\")\n\n# With profile in config\nconfig = {\n    \"profile\": \"my_db\",\n    \"flights\": {\n        \"table\": \"flights_tbl\",\n        ...\n    }\n}\nmodels = from_config(config)\n```\n\n## Querying YAML Models\n\nYAML-defined models work exactly like Python-defined models. You can use the same `group_by()` and `aggregate()` methods to query your data.\n\n```query_yaml_model\n# Query the YAML-defined model\nresult = (\n    flights_sm\n    .group_by(\"origin\")\n    .aggregate(\"flight_count\", \"avg_distance\")\n)\n```\n\n<bslquery code-block=\"query_yaml_model\"></bslquery>\n\n## Filters\n\nYou can apply a filter to all queries on a model by adding a `filter` field:\n\n```yaml\nflights:\n  table: flights_tbl\n  filter: _.year > 2020  # Applied to all queries\n  dimensions:\n    origin: _.origin\n  measures:\n    flight_count: _.count()\n```\n\nThe filter expression uses the same `_` syntax as dimensions and measures. It's applied automatically when you query the model.\n\n## Next Steps\n\n- See [Building Semantic Tables](/building/semantic-tables) for Python-based definitions\n- Learn [Query Methods](/querying/methods) for querying YAML-defined models\n- Explore [Composing Models](/building/compose) for joining YAML models\n",
  "queries": {
    "load_yaml_example": {
      "code": "from boring_semantic_layer import from_yaml\n\n# Load models from YAML file with explicit tables\nmodels = from_yaml(\n    \"yaml_example.yaml\",\n    tables={\n        \"flights_tbl\": flights_tbl,\n        \"carriers_tbl\": carriers_tbl\n    }\n)\n\nflights_sm = models[\"flights\"]\ncarriers_sm = models[\"carriers\"]\n\n# Inspect the loaded models\nflights_sm.dimensions, flights_sm.measures",
      "sql": "SELECT\n  *\nFROM \"ibis_pandas_memtable_w2egbdit6bfbpn32v723vkcnke\"",
      "plan": "\u001b[1;34mSemanticTable\u001b[0m: \u001b[1;34mcarriers\u001b[0m\n  \u001b[36mcode [dim]\u001b[0m\n  \u001b[36mname [dim]\u001b[0m\n  \u001b[35mcarrier_count [measure]\u001b[0m",
      "table": {
        "columns": [
          "code",
          "name"
        ],
        "data": [
          [
            "AA",
            "American Airlines"
          ],
          [
            "UA",
            "United Airlines"
          ],
          [
            "DL",
            "Delta Air Lines"
          ]
        ]
      }
    },
    "query_yaml_model": {
      "code": "# Query the YAML-defined model\nresult = (\n    flights_sm\n    .group_by(\"origin\")\n    .aggregate(\"flight_count\", \"avg_distance\")\n)",
      "sql": "SELECT\n  *\nFROM (\n  SELECT\n    \"t1\".\"origin\",\n    COUNT(*) AS \"flight_count\",\n    AVG(\"t1\".\"distance\") AS \"avg_distance\"\n  FROM (\n    SELECT\n      *\n    FROM \"ibis_pandas_memtable_xftauifgljft3da6d3mk3kmo5y\" AS \"t0\"\n    WHERE\n      \"t0\".\"year\" > 2020\n  ) AS \"t1\"\n  GROUP BY\n    1\n) AS \"t2\"",
      "plan": "r0 := \u001b[1;34mSemanticTable\u001b[0m: \u001b[1;34mflights\u001b[0m\n  \u001b[36morigin [dim]\u001b[0m\n  \u001b[36mdestination [dim]\u001b[0m\n  \u001b[36myear [dim]\u001b[0m\n  \u001b[36mcarrier [dim]\u001b[0m\n  \u001b[35mflight_count [measure]\u001b[0m\n  \u001b[35mtotal_distance [measure]\u001b[0m\n  \u001b[35mavg_distance [measure]\u001b[0m\n\nr1 := \u001b[1;32mFilter\u001b[0m[\u001b[93mr0\u001b[0m]\n  predicate:\n    \u03bb <lambda>\n\nr2 := \u001b[1;32mGroupBy\u001b[0m[\u001b[93mr1\u001b[0m]\n  keys:\n    \u001b[36morigin\u001b[0m\n\n\u001b[1;32mAggregate\u001b[0m[\u001b[93mr2\u001b[0m]\n  groups:\n    \u001b[36morigin\u001b[0m\n  metrics:\n    \u001b[35mflight_count\u001b[0m\n    \u001b[35mavg_distance\u001b[0m",
      "table": {
        "columns": [
          "origin",
          "flight_count",
          "avg_distance"
        ],
        "data": [
          [
            "LAX",
            1,
            337.0
          ],
          [
            "SFO",
            1,
            382.0
          ],
          [
            "JFK",
            1,
            2475.0
          ]
        ]
      },
      "chart": {
        "type": "vega",
        "spec": {
          "config": {
            "view": {
              "continuousWidth": 300,
              "continuousHeight": 300
            }
          },
          "data": {
            "name": "data-5e957fb8d888b60ccb5be04ecb943b47"
          },
          "mark": {
            "type": "bar"
          },
          "encoding": {
            "color": {
              "field": "measure",
              "type": "nominal"
            },
            "tooltip": [
              {
                "field": "origin",
                "type": "nominal"
              },
              {
                "field": "measure",
                "type": "nominal"
              },
              {
                "field": "value",
                "type": "quantitative"
              }
            ],
            "x": {
              "field": "origin",
              "sort": null,
              "type": "ordinal"
            },
            "xOffset": {
              "field": "measure"
            },
            "y": {
              "field": "value",
              "type": "quantitative"
            }
          },
          "height": 400,
          "transform": [
            {
              "fold": [
                "flight_count",
                "avg_distance"
              ],
              "as": [
                "measure",
                "value"
              ]
            }
          ],
          "width": 700,
          "$schema": "https://vega.github.io/schema/vega-lite/v5.20.1.json",
          "datasets": {
            "data-5e957fb8d888b60ccb5be04ecb943b47": [
              {
                "origin": "JFK",
                "flight_count": 1,
                "avg_distance": 2475.0
              },
              {
                "origin": "SFO",
                "flight_count": 1,
                "avg_distance": 382.0
              },
              {
                "origin": "LAX",
                "flight_count": 1,
                "avg_distance": 337.0
              }
            ]
          }
        }
      }
    }
  },
  "files": {
    "yaml_example.yaml": "flights:\n  table: flights_tbl\n  filter: _.year > 2020  # Optional: filter applied to all queries\n  dimensions:\n    origin:\n      expr: _.origin\n      description: \"Flight origin airport code\"\n    destination:\n      expr: _.dest\n      description: \"Flight destination airport code\"\n    year:\n      expr: _.year\n      description: \"Flight year\"\n    carrier:\n      expr: _.carrier\n      description: \"Carrier code\"\n  measures:\n    flight_count:\n      expr: _.count()\n      description: \"Total number of flights\"\n    total_distance:\n      expr: _.distance.sum()\n      description: \"Total distance traveled\"\n    avg_distance:\n      expr: _.distance.mean()\n      description: \"Average flight distance\"\n\ncarriers:\n  table: carriers_tbl\n  dimensions:\n    code:\n      expr: _.code\n      description: \"Carrier code\"\n    name:\n      expr: _.name\n      description: \"Carrier name\"\n  measures:\n    carrier_count:\n      expr: _.count()\n      description: \"Number of carriers\"\n"
  }
}
