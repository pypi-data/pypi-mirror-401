# Generated by the protocol buffer compiler.  DO NOT EDIT!
# sources: envoy/extensions/filters/http/stateful_session/v3/stateful_session.proto
# plugin: python-betterproto2
# This file has been @generated

__all__ = (
    "StatefulSession",
    "StatefulSessionPerRoute",
)

import typing

import betterproto2
import pydantic
from pydantic import model_validator
from pydantic.dataclasses import dataclass

from .......message_pool import default_message_pool

_COMPILER_VERSION = "0.9.0"
betterproto2.check_compiler_version(_COMPILER_VERSION)


@dataclass(eq=False, repr=False, config={"extra": "forbid"})
class StatefulSession(betterproto2.Message):
    """
    [#protodoc-title: Stateful session filter]
    Stateful session :ref:`configuration overview <config_http_filters_stateful_session>`.
    [#extension: envoy.filters.http.stateful_session]
    """

    session_state: "_____config__core__v3__.TypedExtensionConfig | None" = (
        betterproto2.field(1, betterproto2.TYPE_MESSAGE, optional=True)
    )
    """
    Specifies the implementation of session state. This session state is used to store and retrieve the address of the
    upstream host assigned to the session.

    [#extension-category: envoy.http.stateful_session]
    """

    strict: "bool" = betterproto2.field(2, betterproto2.TYPE_BOOL)
    """
    Determines whether the HTTP request must be strictly routed to the requested destination. When set to ``true``,
    if the requested destination is unavailable, Envoy will return a 503 status code. The default value is ``false``,
    which allows Envoy to fall back to its load balancing mechanism. In this case, if the requested destination is not
    found, the request will be routed according to the load balancing algorithm.
    """

    stat_prefix: "typing.Annotated[str, pydantic.AfterValidator(betterproto2.validators.validate_string)]" = betterproto2.field(
        3, betterproto2.TYPE_STRING
    )
    """
    Optional stat prefix. If specified, the filter will emit statistics in the
    ``http.<stat_prefix>.stateful_session.<stat_prefix>.`` namespace. If not specified, no statistics will be emitted.

    .. note::

      Per-route configuration overrides do not support statistics and will not emit stats even if this field is set
      in the per-route config.
    """


default_message_pool.register_message(
    "envoy.extensions.filters.http.stateful_session.v3",
    "StatefulSession",
    StatefulSession,
)


@dataclass(eq=False, repr=False, config={"extra": "forbid"})
class StatefulSessionPerRoute(betterproto2.Message):
    """


    Oneofs:
        - override:
    """

    disabled: "bool | None" = betterproto2.field(
        1, betterproto2.TYPE_BOOL, optional=True, group="override"
    )
    """
    Disable the stateful session filter for this particular vhost or route. If disabled is
    specified in multiple per-filter-configs, the most specific one will be used.
    """

    stateful_session: "StatefulSession | None" = betterproto2.field(
        2, betterproto2.TYPE_MESSAGE, optional=True, group="override"
    )
    """
    Per-route stateful session configuration that can be served by RDS or static route table.
    """

    @model_validator(mode="after")
    def check_oneof(cls, values):
        return cls._validate_field_groups(values)


default_message_pool.register_message(
    "envoy.extensions.filters.http.stateful_session.v3",
    "StatefulSessionPerRoute",
    StatefulSessionPerRoute,
)


from ......config.core import v3 as _____config__core__v3__
