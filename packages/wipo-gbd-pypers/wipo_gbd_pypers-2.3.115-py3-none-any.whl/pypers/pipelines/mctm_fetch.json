{
    "name" : "mctm_fetch",
    "label": "Fetch Monaco collection",

    "dag": {
        "nodes": {
            "fetch"    : "fetch.download.SFTP_PK",
            "group"    : "fetch.common.GroupByMask",
            "join"     : "fetch.common.Join",
            "extract"  : "fetch.extract.mc.Trademarks",
            "organize" : "fetch.common.Organize",
            "clean"    : "fetch.common.Cleanup"
        },
        "edges": [
           {
                "from"     : "fetch",
                "to"       : "group",
                "bindings" : { "group.input_files" : "fetch.output_files" }
            },
            {
                "from"     : "group",
                "to"       : "join",
                "bindings" : { "join.archives" : "group.output_files" }
            },
            {
                "from"     : "join",
                "to"       : "extract",
                "bindings" : { "extract.archives" : "join.archives" }
            },
            {
                "from"     : "extract",
                "to"       : "organize",
                "bindings" : { "organize.manifest" : "extract.manifest"}
            },
            {
                "from"     : "fetch",
                "to"       : "clean",
                "bindings" : { "clean.processed_list" : "fetch.output_files" }
            },
            {
                "from": "organize",
                "to": "clean",
                "bindings": {
                    "clean.manifest_list": "organize.manifest"
                }
            }
        ]
    },
    "config": {
        "steps": {
            "fetch": {
                "file_regex": "\\d{4}-\\d{2}-\\d{2}-MC-.*\\.zip"
            },
             "group": {
                "mask_output" : "\\1\\2\\3-\\4",
                "mask_input"  : "(\\d{4})-(\\d{2})-(\\d{2})-.*INDX-(\\d{4}).*"
            },
            "join": {
                "mask_input"  : "(\\d{4})-(\\d{2})-(\\d{2})-.*-INDX-(\\d{4}).*",
                "mask_output" : "\\1-\\2-\\3.DIFF"
            }
	    }
    }
}

