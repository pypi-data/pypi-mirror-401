"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[480],{4550:(e,t,a)=>{a.r(t),a.d(t,{default:()=>V});var r=a(1624);let s=a.p+"static/svg/xiaojing.082e17d9.svg";var n=a(9418),l=a(4257),o=a(197),i=a(3104),c=a(4359);function u(e,t,a,r,s,n,l){try{var o=e[n](l),i=o.value}catch(e){a(e);return}o.done?t(i):Promise.resolve(i).then(r,s)}function d(e){return function(){var t=this,a=arguments;return new Promise(function(r,s){var n=e.apply(t,a);function l(e){u(n,r,s,l,o,"next",e)}function o(e){u(n,r,s,l,o,"throw",e)}l(void 0)})}}let m={class:"share-container",role:"main","aria-label":"AI 分享内容"},v={class:"ai-share-container"},h={class:"ai-share-header"},p={class:"ai-share-header-left"},f={class:"ai-share-header-title"},g={key:0,class:"ai-share-header-right"},y={class:"share-content"},k={key:0,class:"error-state",role:"alert","aria-live":"polite"},E={key:1,class:"share-data"},N=(0,r.defineComponent)({__name:"share",setup(e){var t;let a={404:{message:"分享内容不存在",userMessage:"分享内容不存在，请检查链接是否正确",canRetry:!1},403:{message:"无权访问此分享内容",userMessage:"您没有权限访问此分享内容",canRetry:!0},401:{message:"未授权访问",userMessage:"请先登录后再访问",canRetry:!0},500:{message:"服务器内部错误",userMessage:"服务器暂时无法处理请求，请稍后重试",canRetry:!0}},u={message:"网络请求失败",userMessage:"网络请求失败，请稍后重试",canRetry:!0},N=(0,r.ref)(""),V=(0,r.ref)(""),T=(0,r.ref)(window.BK_API_PREFIX||""),A=(0,r.ref)(!1),B=(0,r.ref)([]),_=(0,r.ref)(null),w=(0,r.ref)(""),x=(0,n.lq)(),C=(0,r.computed)(()=>B.value.length>0),b=(0,r.computed)(()=>null!==_.value),I=(0,r.computed)(()=>_.value||""),M=(0,r.computed)(()=>{var e,t;return!!w.value&&!!b.value&&(null!==(t=null===(e=a[R(_.value)])||void 0===e?void 0:e.canRetry)&&void 0!==t?t:u.canRetry)}),R=e=>{if(!e)return 0;let t=e.match(/HTTP (\d+)/);return t?parseInt(t[1]):0},$=(e,t)=>{let r=a[e]||u;_.value=`${r.message}: ${e} ${t}`,(0,l.A)({theme:"error",message:r.userMessage,delay:3e3})},P=(t=d(function*(e){if(!(null==e?void 0:e.trim())){$(0,"分享码为空");return}A.value=!0,_.value=null,w.value=e.trim();try{var t;let a=new AbortController,r=setTimeout(()=>a.abort(),3e4),s=yield fetch(`${T.value}/share/${e.trim()}`,{method:"GET",credentials:"include",signal:a.signal});if(clearTimeout(r),!s.ok)throw Error(`HTTP ${s.status}: ${s.statusText}`);let n=yield s.json();if(!(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.session_contents))throw Error("Invalid response data structure");B.value=n.data.session_contents,N.value=n.data.session_name||"AI 对话分享",V.value=n.data.agent_name||""}catch(e){if(console.error("获取分享数据失败:",e),e instanceof Error){if("AbortError"===e.name)_.value="请求超时，请稍后重试",(0,l.A)({theme:"error",message:"请求超时，请稍后重试",delay:3e3});else{let t=e.message.match(/HTTP (\d+)/);t?$(parseInt(t[1]),e.message):(_.value=u.message,(0,l.A)({theme:"error",message:u.userMessage,delay:3e3}))}}else _.value=u.message,(0,l.A)({theme:"error",message:u.userMessage,delay:3e3})}finally{A.value=!1}}),function(e){return t.apply(this,arguments)}),D=()=>{w.value&&P(w.value)};return(0,r.onBeforeMount)(d(function*(){let e=x.params.shareCode;(null==e?void 0:e.trim())?yield P(e.trim()):$(0,"分享码不存在")})),(e,t)=>{let a=(0,r.resolveDirective)("bkloading");return(0,r.openBlock)(),(0,r.createElementBlock)("div",m,[(0,r.createElementVNode)("div",v,[(0,r.createElementVNode)("div",h,[(0,r.createElementVNode)("div",p,[t[0]||(t[0]=(0,r.createElementVNode)("img",{src:s,alt:"AI助手logo"},null,-1)),t[1]||(t[1]=(0,r.createTextVNode)()),(0,r.createElementVNode)("h1",f,(0,r.toDisplayString)(N.value),1)]),t[2]||(t[2]=(0,r.createTextVNode)()),V.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",g,(0,r.toDisplayString)(`分享于 "${V.value}"`),1)):(0,r.createCommentVNode)("",!0)]),t[4]||(t[4]=(0,r.createTextVNode)()),(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",y,[b.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",k,[(0,r.createVNode)((0,r.unref)(o.Ay),{class:"exception-wrap-item exception-part",description:I.value,scene:"part",type:"empty"},{default:(0,r.withCtx)(()=>[M.value?((0,r.openBlock)(),(0,r.createBlock)((0,r.unref)(i.Ay),{key:0,theme:"primary",onClick:D,class:"retry-button"},{default:(0,r.withCtx)(()=>t[3]||(t[3]=[(0,r.createTextVNode)(" 重新加载 ")])),_:1,__:[3]})):(0,r.createCommentVNode)("",!0)]),_:1},8,["description"])])):C.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",E,[(0,r.createVNode)((0,r.unref)(c.Mf),{standalone:"","session-contents":B.value,"has-session-contents":!0,"content-margin-bottom":0,"is-select-mode":!1,readonly:!0},null,8,["session-contents"])])):(0,r.createCommentVNode)("",!0)])),[[a,{loading:A.value,theme:"primary",mode:"spin"}]])]),t[5]||(t[5]=(0,r.createTextVNode)()),t[6]||(t[6]=(0,r.createElementVNode)("div",{class:"share-tip"},"内容由 AI 大模型生成，请仔细甄别",-1))])}}}),V=(0,a(4028).A)(N,[["__scopeId","data-v-7e62ba7c"]])}}]);