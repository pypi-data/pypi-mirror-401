"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[875],{3079:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var o=n(1624),i=n(2512),l=n(3104),a=n(1249),r=n(9733),u=n(4359),s=n(8568),d=n(9418),c=n(4485);function v(e,t,n,o,i,l,a){try{var r=e[l](a),u=r.value}catch(e){n(e);return}r.done?t(u):Promise.resolve(u).then(o,i)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var l=e.apply(t,n);function a(e){v(l,o,i,a,r,"next",e)}function r(e){v(l,o,i,a,r,"throw",e)}a(void 0)})}}let p={class:"chat-wrapper"},h={class:"chat-container"},w={key:0,class:"session-list-sidebar"},y={class:"top-controls"},m={class:"input-icon suffix-icon"},k=["onClick"],g={class:"conversation-title"},N={class:"conversation-subtitle"},C=(0,o.defineComponent)({__name:"page-demo",setup(e){var t,n,v,C,S;let V=(0,d.lq)(),E=(0,d.rd)(),x=(0,o.ref)(null),D=(0,o.ref)([]),T=(0,o.ref)(null),B=(0,o.ref)(""),_=(0,o.ref)(null),b=(0,o.ref)(!1),A=(0,o.ref)(null),L=(0,o.ref)(window.BK_API_PREFIX),P=(t=f(function*(){let e=yield(0,c.i)(L.value);return _.value=e,e}),function(){return t.apply(this,arguments)}),z=e=>{console.error("SDK错误:",e),s.A.push("/403")},W=(0,o.ref)(800),q=(0,o.computed)(()=>"undefined"==typeof window?800:K.value?window.innerWidth-280:window.innerWidth),I=(0,o.ref)("加载中..."),F=(0,o.ref)(!0),$=(0,o.reactive)({loading:F,title:I}),H=(0,o.computed)(()=>B.value?D.value.filter(e=>e.sessionName.toLowerCase().includes(B.value.toLowerCase())):D.value),K=(0,o.computed)(()=>{var e,t,n;return!!_.value&&(null===(n=null===(t=_.value)||void 0===t?void 0:null===(e=t.conversation_settings)||void 0===e?void 0:e.enable_chat_session)||void 0===n||n)}),M=e=>{if(!e)return"";let t=new Date(e),n=new Date,o=new Date(n);return(o.setDate(o.getDate()-1),t.toDateString()===n.toDateString())?"今天":t.toDateString()===o.toDateString()?"昨天":t.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})},j=(n=f(function*(e){if(x.value&&"function"==typeof x.value.switchToSession)try{yield x.value.switchToSession(e);let t=D.value;T.value=t.find(t=>t.sessionCode===e)||null}catch(e){console.error("切换会话失败:",e)}}),function(e){return n.apply(this,arguments)}),R=(v=f(function*(){if(x.value&&"function"==typeof x.value.addNewSession)try{let e=yield x.value.addNewSession();x.value.getSessionList&&(D.value=yield x.value.getSessionList()),e&&e.sessionCode&&(T.value=e)}catch(e){console.error("创建新会话失败:",e)}}),function(){return v.apply(this,arguments)}),U=(C=f(function*(){var e;if(x.value&&void 0!==(null===(e=x.value.sessionList)||void 0===e?void 0:e.value))D.value=x.value.sessionList.value,T.value=D.value[0]||null;else if(x.value&&"function"==typeof x.value.getSessionList)try{D.value=yield x.value.getSessionList(),T.value=D.value[0]||null}catch(e){console.error("获取会话列表失败:",e)}}),function(){return C.apply(this,arguments)});(0,o.watch)(()=>{var e,t;return null===(t=x.value)||void 0===t?void 0:null===(e=t.sessionList)||void 0===e?void 0:e.value},e=>{e&&(D.value=e,!T.value&&e.length>0&&(T.value=e[0]))},{deep:!0});let X=()=>{"undefined"!=typeof window&&(W.value=K.value?window.innerWidth-280:window.innerWidth,setTimeout(()=>{if(x.value&&"function"==typeof x.value.updatePositionAndSize){let e=K.value?window.innerWidth-280:window.innerWidth,t=window.innerWidth-e;x.value.updatePositionAndSize(t,52,e,window.innerHeight-52)}},100))},G=(S=f(function*(){if(A.value){var e,t;let n=A.value;A.value=null,yield null===(e=x.value)||void 0===e?void 0:e.handleShow(void 0,{isTemporary:!0}),yield(0,o.nextTick)(),null===(t=x.value)||void 0===t||t.handleSendMessage(n),E.replace({query:{}})}F.value=!1}),function(){return S.apply(this,arguments)});return(0,o.onMounted)(f(function*(){"undefined"!=typeof window&&window.addEventListener("resize",X);let e=V.query.question;e&&(A.value=e),yield P(),b.value=!0,setTimeout(f(function*(){var e;yield null===(e=x.value)||void 0===e?void 0:e.handleShow(),U(),setTimeout(()=>{"undefined"!=typeof window&&window.dispatchEvent(new Event("resize"))},100)}),200)})),(e,t)=>{let n=(0,o.resolveComponent)("bk-exception"),s=(0,o.resolveDirective)("bkloading");return(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("div",p,[(0,o.createElementVNode)("div",h,[K.value?((0,o.openBlock)(),(0,o.createElementBlock)("div",w,[(0,o.createElementVNode)("div",y,[(0,o.createVNode)((0,o.unref)(i.A),{type:"text",class:"search-input",placeholder:"搜索会话名称",modelValue:B.value,"onUpdate:modelValue":t[0]||(t[0]=e=>B.value=e),clearable:""},{suffix:(0,o.withCtx)(()=>[(0,o.createElementVNode)("span",m,[(0,o.createVNode)((0,o.unref)(a.A))])]),_:1},8,["modelValue"])]),t[4]||(t[4]=(0,o.createTextVNode)()),(0,o.createVNode)((0,o.unref)(l.Ay),{class:"new-chat-button",onClick:R},{default:(0,o.withCtx)(()=>[(0,o.createVNode)((0,o.unref)(r.A),{class:"f22"}),t[1]||(t[1]=(0,o.createTextVNode)()),t[2]||(t[2]=(0,o.createElementVNode)("span",null,"添加会话",-1))]),_:1,__:[1,2]}),t[5]||(t[5]=(0,o.createTextVNode)()),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["conversation-list",{"is-empty":0===H.value.length&&B.value}])},[H.value.length>0?((0,o.openBlock)(!0),(0,o.createElementBlock)(o.Fragment,{key:0},(0,o.renderList)(H.value,e=>{var n;return(0,o.openBlock)(),(0,o.createElementBlock)("div",{key:e.sessionCode,class:(0,o.normalizeClass)(["conversation-item",{active:(null===(n=T.value)||void 0===n?void 0:n.sessionCode)===e.sessionCode}]),onClick:t=>j(e.sessionCode)},[(0,o.createElementVNode)("div",g,(0,o.toDisplayString)(e.sessionName),1),t[3]||(t[3]=(0,o.createTextVNode)()),(0,o.createElementVNode)("div",N,(0,o.toDisplayString)(M(e.createdAt)),1)],10,k)}),128)):((0,o.openBlock)(),(0,o.createBlock)(n,{key:1,style:{"margin-top":"100px"},description:B.value?"搜索为空":"暂无对话",scene:"part",type:B.value?"search-empty":"empty"},null,8,["description","type"]))],2)])):(0,o.createCommentVNode)("",!0),t[6]||(t[6]=(0,o.createTextVNode)()),(0,o.createElementVNode)("div",{class:(0,o.normalizeClass)(["main-chat-area",{"full-width":!K.value}])},[b.value?((0,o.openBlock)(),(0,o.createBlock)((0,o.unref)(u.Ay),{key:0,ref_key:"aiBlueking",ref:x,"ext-cls":"page-demo-ai-blueking","hide-header":"",draggable:!1,"hide-nimbus":!1,url:L.value,"default-top":52,"sdk-error":z,"default-width":q.value,onInitSessionFinished:G},null,8,["url","default-width"])):(0,o.createCommentVNode)("",!0)],2)])])),[[s,$]])}}}),S=(0,n(4028).A)(C,[["__scopeId","data-v-48b58dd4"]])},4485:(e,t,n)=>{n.d(t,{i:()=>l});var o=n(8568);function i(e,t,n,o,i,l,a){try{var r=e[l](a),u=r.value}catch(e){n(e);return}r.done?t(u):Promise.resolve(u).then(o,i)}let l=function(){var e,t=(e=function*(e){try{let t=yield fetch(`${e}/agent/info/`,{credentials:"include"});if(!t.ok&&403===t.status)throw o.A.push("/403"),Error(`HTTP Error: ${t.status} ${t.statusText}`);return(yield t.json()).data}catch(e){return console.error("获取Agent信息失败:",e),null}},function(){var t=this,n=arguments;return new Promise(function(o,l){var a=e.apply(t,n);function r(e){i(a,o,l,r,u,"next",e)}function u(e){i(a,o,l,r,u,"throw",e)}r(void 0)})});return function(e){return t.apply(this,arguments)}}()}}]);