# RNAFlow Delivery Tool

**åŸºäº Rust åŠ é€Ÿçš„é«˜æ€§èƒ½ç”Ÿç‰©ä¿¡æ¯æ•°æ®äº¤ä»˜ç³»ç»Ÿã€‚**

ä¸“é—¨ç”¨äºå°†å¤æ‚çš„åˆ†ææµç¨‹ï¼ˆå¦‚ Snakemakeï¼‰äº§ç”Ÿçš„é›¶æ•£ç»“æœï¼Œæ ¹æ®é…ç½®è‡ªåŠ¨æ•´ç†ã€è¿‡æ»¤å¹¶äº¤ä»˜åˆ°ç»“æ„åŒ–çš„ç›®æ ‡ç›®å½•ï¼ˆæœ¬åœ°æˆ–äº‘ç«¯å¯¹è±¡å­˜å‚¨ï¼‰ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

*   **Rust æ ¸å¿ƒé©±åŠ¨**: é‡‡ç”¨ Rust ç¼–å†™åç«¯ (`data_deliver_rs`)ï¼Œæ”¯æŒå¤šçº¿ç¨‹å¹¶å‘ä¼ è¾“ä¸ MD5 è®¡ç®—ï¼Œæ€§èƒ½è¿œè¶…çº¯ Python å®ç°ã€‚
*   **ç»“æ„åŒ–é‡ç»„**: æ”¯æŒé€šè¿‡ `pattern` åŒ¹é…æ–‡ä»¶ï¼Œå¹¶åˆ©ç”¨ `dest` å°†å…¶é‡å®šå‘æˆ–é‡å‘½åã€‚
*   **å¤šçº§æ ¡éªŒ**: 
    *   **å…¨å±€æ ¡éªŒ**: æ ¹ç›®å½•ç”Ÿæˆ `delivery_manifest.md5` åŒ…å«æ‰€æœ‰æ–‡ä»¶ã€‚
    *   **ç›®å½•æ ¡éªŒ**: æ¯ä¸ªäº¤ä»˜å­ç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿæˆ `MD5.txt`ï¼Œä»…åŒ…å«è¯¥ç›®å½•å†…çš„æ–‡ä»¶ã€‚
*   **æ™ºèƒ½æŠ¥å‘Š**: ç”Ÿæˆ `delivery_manifest.json`ï¼Œå®Œç¾å¯¹æ¥ Quarto æŠ¥å‘Šç³»ç»Ÿã€‚

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

```bash
# 1. ç¼–è¯‘ Rust åç«¯
cd src/src/data-deliver/RNAFlow_Deliver_Tool
cargo build --release

# 2. å®‰è£…æ‰©å±•
cp target/release/libdata_deliver_rs.so python/RNAFlow_Deliver/data_deliver_rs.so

# 3. è®¾ç½®ç¯å¢ƒå˜é‡
export PYTHONPATH=$PYTHONPATH:$(pwd)/python
```

## âš™ï¸ äº¤ä»˜æ¨¡å¼ (`delivery_mode`)

åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ `delivery_mode` æŒ‡å®šæ–‡ä»¶çš„å¤„ç†æ–¹å¼ï¼š

| æ¨¡å¼ | è¯´æ˜ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
| :--- | :--- | :--- | :--- |
| `copy` | **ç‰©ç†å¤åˆ¶**ã€‚æ–‡ä»¶ä¼šè¢«å®Œæ•´æ‹·è´åˆ°ç›®æ ‡ä½ç½®ã€‚ | äº¤ä»˜ç»“æœå®Œå…¨ç‹¬ç«‹ï¼Œç§»åŠ¨æˆ–åˆ é™¤æºç ä¸å½±å“äº¤ä»˜æ•°æ®ã€‚ | è€—è´¹ç£ç›˜ç©ºé—´ï¼Œå¤§æ–‡ä»¶ä¼ è¾“è¾ƒæ…¢ã€‚ |
| `symlink` | **è½¯é“¾æ¥ (Symbolic Link)**ã€‚ç›®æ ‡ä½ç½®ä»…åˆ›å»ºä¸€ä¸ªæŒ‡å‘æºç çš„å¿«æ·æ–¹å¼ã€‚ | æé€Ÿï¼Œä¸å ç”¨é¢å¤–ç£ç›˜ç©ºé—´ã€‚ | å¦‚æœæºç è¢«ç§»åŠ¨æˆ–åˆ é™¤ï¼Œé“¾æ¥ä¼šå¤±æ•ˆã€‚ |
| `hardlink` | **ç¡¬é“¾æ¥ (Hard Link)**ã€‚ç›®æ ‡ä½ç½®åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶è¡¨é¡¹æŒ‡å‘ç›¸åŒçš„ç‰©ç†æ•°æ®ã€‚ | æé€Ÿï¼Œä¸å ç©ºé—´ï¼Œåˆ é™¤æºç åäº¤ä»˜æ•°æ®ä¾ç„¶æœ‰æ•ˆã€‚ | ä¸èƒ½è·¨åˆ†åŒºï¼ˆè·¨ç£ç›˜ï¼‰ï¼Œä¸æ”¯æŒæ–‡ä»¶å¤¹ï¼ˆå·¥å…·ä¼šè‡ªåŠ¨å¯¹æ–‡ä»¶å¤¹å†…å®¹è¿›è¡Œç¡¬é“¾ï¼‰ã€‚ |

## ğŸ“– é…ç½®æ–‡ä»¶æŒ‡å— (`full_delivery_config.yaml`)

```yaml
data_delivery:
  delivery_mode: copy        # è®¾ç½®äº¤ä»˜æ¨¡å¼ (copy, symlink, hardlink)
  output_dir: ./full_delivery
  threads: 8
  
  include_patterns:
    # æ¨¡å¼ 1: æ”¾å…¥ç›®å½• (dest ä»¥ / ç»“å°¾)
    - pattern: "02.mapping/*.bam"
      dest: "02_Mapping/BAM/"
    
    # æ¨¡å¼ 2: é‡å‘½åæ–‡ä»¶ (dest ä¸ä»¥ / ç»“å°¾)
    - pattern: "01.qc/.../multiqc_fastq_screen.txt"
      dest: "Summary/fastq_screen_result.txt"
```

## ğŸ“‚ äº¤ä»˜ç»“æœç¤ºä¾‹

```text
delivery_output/
â”œâ”€â”€ 01_QC/
â”‚   â”œâ”€â”€ Reports/
â”‚   â”‚   â”œâ”€â”€ sample1_report.html
â”‚   â”‚   â””â”€â”€ MD5.txt              <-- æœ¬ç›®å½•æ–‡ä»¶æ ¡éªŒå’Œ
â”œâ”€â”€ delivery_manifest.json       <-- è‡ªåŠ¨åŒ–æŠ¥å‘Šæ˜ å°„è¡¨
â”œâ”€â”€ delivery_manifest.md5        <-- å…¨å±€æ ¡éªŒæ–‡ä»¶
â””â”€â”€ ...
```

## â˜ï¸ äº‘ç«¯äº¤ä»˜ (S3/TOS)

ä½¿ç”¨ `--cloud` å‚æ•°å¼€å¯äº‘ç«¯æ¨¡å¼ï¼ˆæ­¤æ¨¡å¼ä¸‹ `delivery_mode` å°†å¤±æ•ˆï¼Œå§‹ç»ˆä¸ºä¸Šä¼ æ¨¡å¼ï¼‰ã€‚
