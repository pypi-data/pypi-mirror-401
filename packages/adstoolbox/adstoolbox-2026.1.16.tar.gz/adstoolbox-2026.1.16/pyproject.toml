[tool.poetry]
name = "adstoolbox"
version = "2026.01.16"
description = "Generic functions"
authors = [
    "Olivier Siguré <olivier.sigure@alchimiedatasolutions.com>",
    "Matthieu Vannin <matthieu.vannin@alchimiedatasolutions.com>",
    "Antoine Ducoulombier <antoine.ducoulombier@alchimiedatasolutions.com>",
    "Pierre Baux <pierre.baux@alchimiedatasolutions.com>"
]
license = "MIT"
readme = "README.md"
packages = [
    { include = "adsToolBox" }
]

[tool.poetry.dependencies]
python = "^3.9"
adlfs = "2024.1.0"
azure-core = "1.36.0"
chardet = "^5.2.0"
django_sendgrid_webhook = "0.3.0"
fsspec = "2025.10.0"
GitPython = "3.1.45"
google-api-python-client = "2.149.0"
google-auth-oauthlib = "1.2.1"
jsonschema = "4.25.1"
mysql_connector_repackaged = "0.3.1"
polars = "1.34.0"
protobuf = "6.33.0"
psycopg2-binary = "2.9.9"
PyGithub = "2.8.1"
pymssql = "2.3.2"
pymysql = "1.1.2"
pytest = "8.3.3"
pytz = "2025.2"
python-dotenv = "1.1.1"
Requests = "2.32.5"
sendgrid = "6.10.0"
smbprotocol = "1.11.0"
SQLAlchemy = "2.0.44"
testcontainers = "4.13.3"
tzdata = "2025.2"

[build-system]
requires = ["poetry-core"]
build-backend = "poetry.core.masonry.api"

[tool.ruff]
target-version = "py39"
src = ["adsToolBox", "tests"]
exclude = [
    ".git",
    "__pycache__",
    "build",
    "dist",
    "venv",
]
line-length = 100

# ------------------------
# Linting rules
# ------------------------
[tool.ruff.lint]
select = ["ALL"]
ignore = [
    "E501",  # ignore la limite de longueur de ligne
    "D203",  # conflit incorrect-blank-line-before-class
    "D212",  # conflit multi-line-summary-first-line
    "TRY400", # autorise l'usage de logger.error à la place de logger.exception
    "G004" # autorise les f-string dans les messages du logger
]

[tool.ruff.lint.per-file-ignores]
"adsToolBox/__init__.py" = ["N999"] # problème mineur
"adsToolBox/db_mssql.py" = ["S608"] # injections inévitables
"adsToolBox/db_mysql.py" = ["S608"] # injections inévitables
"adsToolBox/db_pgsql.py" = ["S608"] # injections inévitables
"adsToolBox/data_factory.py" = ["S608", "BLE001"] # Exception génériques car on ne connaît pas la techno utilisée
"tests/test_data_factory.py" = ["S608"] # injections inévitables
"adsToolBox/logger.py" = ["S608"] # injections inévitables
"tests/test_db_mssql.py" = ["S608"] # injections inévitables
"tests/test_db_mysql.py" = ["S608"] # injections inévitables
"tests/test_db_pgsql.py" = ["S608"] # injections inévitables
"integration_tests/test_file_handler.py" = ["D401", "BLE001"]

# ------------------------
# Formatage (style de code)
# ------------------------
[tool.ruff.format]
quote-style = "double"
indent-style = "space"
line-ending = "lf"
skip-magic-trailing-comma = false

[tool.ruff.lint.pylint]
max-args = 8 # par défaut à 5, mais trop contraignant