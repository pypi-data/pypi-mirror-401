var ce=Object.defineProperty;var v=(t,e)=>ce(t,"name",{value:e,configurable:!0});import{c as U,_ as pe,f as le,t as B,P as fe,a as me,k as ve,cU as ge}from"./index-Bc79VbnU.js";import{E as u,a2 as L,dk as Q,dl as V,j as T,d as g,k as E,z as F,e as M,m as oe,a8 as h,p as ye,c as $,s as C,q as j,u as R,ea as J,r as P,F as Y,y as _,i as be,h as we,l as he,A as Se,M as ke,fb as Me,w as $e,Z as xe}from"./vendor-other-Dsj-QuOx.js";import{i as Ue,p as ae}from"./vendor-primevue-Cif--Rbw.js";import"./vendor-xterm-CWYFmgbN.js";import{f as se,P as ne}from"./widgetPropFilter-CygYoMQt.js";import{W as ie}from"./index-BBvP0bLh.js";import{_ as re}from"./WidgetLayoutField.vue_vue_type_script_setup_true_lang-CYDaxuge.js";import{b as Ce,a as Ve,d as Oe}from"./LazyImage.vue_vue_type_script_setup_true_lang-CX9YtPlM.js";import{_ as ze}from"./WidgetWithControl.vue_vue_type_script_setup_true_lang-B5RYQ41H.js";const Ae={name:"SelectPlus",extends:Ue,emits:["hide"],methods:{onOverlayLeave(){this.unbindOutsideClickListener(),this.unbindScrollListener(),this.unbindResizeListener(),this.$emit("hide"),this.overlay=null}}};function de(t={}){return u(()=>({appendTo:"self",...t}))}v(de,"useTransformCompatOverlayProps");const Ie={class:"absolute top-5 right-8 h-4 w-7 -translate-y-4/5 flex"},ee=L({__name:"WidgetSelectDefault",props:Q({widget:{}},{modelValue:{default(t){return t.widget.options?.values?.[0]||""}},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,n=V(t,"modelValue"),b=de(),i=u(()=>{const a=e.widget.options;return a?.values&&Array.isArray(a.values)?a.values:[]}),y=u(()=>!!n.value&&!i.value.includes(n.value)),c=u(()=>({...se(e.widget.options,ne),...b.value,...y.value?{placeholder:`${n.value}`}:{}}));return(a,p)=>(g(),T(re,{widget:a.widget},{default:E(()=>[F(Ae,oe({modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=f=>n.value=f),invalid:y.value,filter:i.value.length>4,"auto-filter-focus":"",options:i.value},c.value,{class:h(U)(h(ie),"w-full text-xs"),"aria-label":a.widget.name,size:"small",pt:{option:"text-xs",dropdown:"w-8",label:h(U)("truncate min-w-[4ch]",a.$slots.default&&"mr-5"),overlay:"w-fit min-w-full"},"data-capture-wheel":"true"}),null,16,["modelValue","invalid","filter","options","class","aria-label","pt"]),M("div",Ie,[ye(a.$slots,"default")])]),_:3},8,["widget"]))}}),De={class:"min-w-0 flex-1 px-1 py-2 text-left truncate"},Te={key:0},Le={key:1},Fe=["multiple","disabled","accept"],Pe=L({__name:"FormDropdownInput",props:{isOpen:{type:Boolean,default:!1},placeholder:{default:"Select..."},items:{},selected:{},maxSelectable:{},uploadable:{type:Boolean},disabled:{type:Boolean},accept:{}},emits:["select-click","file-change"],setup(t,{emit:e}){const n=t,b=e,i=u(()=>n.items.filter(c=>n.selected.has(c.id))),y=u(()=>U("border-0 bg-component-node-widget-background outline-none text-text-secondary",n.disabled?"cursor-not-allowed":"hover:bg-component-node-widget-background-hovered cursor-pointer",i.value.length>0&&"text-text-primary"));return(c,a)=>(g(),$("div",{class:C(h(U)(h(ie),"flex text-base leading-none",{"opacity-50 cursor-not-allowed !outline-zinc-300/10":c.disabled}))},[M("button",{class:C(h(U)(y.value,"flex justify-between items-center flex-1 min-w-0 h-8",{"rounded-l-lg":c.uploadable,"rounded-lg":!c.uploadable})),onClick:a[0]||(a[0]=p=>b("select-click",p))},[M("span",De,[i.value.length?(g(),$("span",Le,R(i.value.map(p=>p.label??p.name).join(", ")),1)):(g(),$("span",Te,R(c.placeholder),1))]),M("i",{class:C(["icon-[lucide--chevron-down]",h(U)("mr-2 size-4 transition-transform duration-200 flex-shrink-0 text-component-node-foreground-secondary",c.isOpen&&"rotate-180")])},null,2)],2),c.uploadable?(g(),$("label",{key:0,class:C(h(U)(y.value,"relative","size-8 flex justify-center items-center border-l rounded-r-lg border-zinc-300/10"))},[a[2]||(a[2]=M("i",{class:"icon-[lucide--folder-search] size-4"},null,-1)),M("input",{type:"file",class:"absolute inset-0 -z-1 opacity-0",multiple:c.maxSelectable>1,disabled:c.disabled,accept:c.accept,onChange:a[1]||(a[1]=p=>b("file-change",p))},null,40,Fe)],2)):j("",!0)],2))}}),Qe={class:"text-secondary flex gap-2 px-4"},je={key:0,class:"absolute top-[-2px] left-[-2px] size-2 rounded-full bg-component-node-widget-background-highlighted"},Be=["onClick"],Re={key:0,class:"icon-[lucide--check] size-4"},Z="bg-transparent border-0 outline-0 ring-0 text-left",te="size-6 flex justify-center items-center rounded-sm cursor-pointer transition-all duration-150 hover:scale-108 hover:text-base-foreground active:scale-95",Ke=L({__name:"FormDropdownMenuActions",props:Q({searcher:{type:Function},sortOptions:{}},{layoutMode:{},layoutModeModifiers:{},searchQuery:{},searchQueryModifiers:{},sortSelected:{},sortSelectedModifiers:{}}),emits:["update:layoutMode","update:searchQuery","update:sortSelected"],setup(t){const e=V(t,"layoutMode"),n=V(t,"searchQuery"),b=V(t,"sortSelected"),i=U("h-8 bg-zinc-500/20 rounded-lg outline outline-1 outline-offset-[-1px] outline-node-component-border transition-all duration-150"),y=J("sortPopoverRef"),c=J("sortTriggerRef"),a=P(!1);function p(s){!y.value||!c.value||(a.value=!a.value,y.value.toggle(s,c.value))}v(p,"toggleSortPopover");function f(){a.value=!1,y.value?.hide()}v(f,"closeSortPopover");function l(s){b.value=s.id,f()}return v(l,"handleSortSelected"),(s,d)=>(g(),$("div",Qe,[F(Ce,{modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=S=>n.value=S),searcher:s.searcher,class:C(h(U)(h(i),"hover:outline-component-node-widget-background-highlighted/80","focus-within:outline-component-node-widget-background-highlighted/80 focus-within:ring-0"))},null,8,["modelValue","searcher","class"]),M("button",{ref_key:"sortTriggerRef",ref:c,class:C(h(U)(Z,h(i),"relative w-8 flex justify-center items-center cursor-pointer","hover:outline-component-node-widget-background-highlighted","active:!scale-95")),onClick:p},[b.value!=="default"?(g(),$("div",je)):j("",!0),d[4]||(d[4]=M("i",{class:"icon-[lucide--arrow-up-down] size-4"},null,-1))],2),F(h(ae),{ref_key:"sortPopoverRef",ref:y,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:d[1]||(d[1]=S=>a.value=!1)},{default:E(()=>[M("div",{class:C(h(U)("flex flex-col gap-2 p-2 min-w-32","bg-component-node-background","rounded-lg outline outline-offset-[-1px] outline-component-node-border"))},[(g(!0),$(Y,null,_(s.sortOptions,S=>(g(),$("button",{key:S.name,class:C(h(U)(Z,"flex justify-between items-center h-6 cursor-pointer","hover:!text-blue-500")),onClick:v(z=>l(S),"onClick")},[M("span",null,R(S.name),1),b.value===S.id?(g(),$("i",Re)):j("",!0)],10,Be))),128))],2)]),_:1},512),M("div",{class:C(h(U)(h(i),"flex justify-center items-center p-1 gap-1 hover:outline-component-node-widget-background-highlighted"))},[M("button",{class:C(h(U)(Z,te,e.value==="list"?"bg-neutral-500/50 text-base-foreground":"")),onClick:d[2]||(d[2]=S=>e.value="list")},d[5]||(d[5]=[M("i",{class:"icon-[lucide--list] size-4"},null,-1)]),2),M("button",{class:C(h(U)(Z,te,e.value==="grid"?"bg-neutral-500/50 text-base-foreground":"")),onClick:d[3]||(d[3]=S=>e.value="grid")},d[6]||(d[6]=[M("i",{class:"icon-[lucide--layout-grid] size-4"},null,-1)]),2)],2)]))}}),We={class:"text-secondary mb-4 flex gap-1 px-4 justify-start"},Ee=["disabled","onClick"],He=L({__name:"FormDropdownMenuFilter",props:Q({filterOptions:{}},{filterSelected:{},filterSelectedModifiers:{}}),emits:["update:filterSelected"],setup(t){const e=V(t,"filterSelected"),{isUploadButtonEnabled:n,showUploadDialog:b}=Ve(),i=u(()=>t.filterOptions.length===1);return(y,c)=>(g(),$("div",We,[(g(!0),$(Y,null,_(y.filterOptions,a=>(g(),$("button",{key:a.id,type:"button",disabled:i.value,class:C(h(U)("px-4 py-2 rounded-md inline-flex justify-center items-center select-none appearance-none border-0 text-base-foreground",!i.value&&"transition-all duration-150 hover:text-base-foreground hover:bg-interface-menu-component-surface-hovered cursor-pointer active:scale-95",!i.value&&e.value===a.id?"!bg-interface-menu-component-surface-selected text-base-foreground":"bg-transparent")),onClick:v(p=>e.value=a.id,"onClick")},R(a.name),11,Ee))),128)),h(n)&&i.value?(g(),T(pe,{key:0,class:"ml-auto",size:"md",variant:"textonly",onClick:h(b)},{default:E(()=>[c[0]||(c[0]=M("i",{class:"icon-[lucide--folder-input]"},null,-1)),M("span",null,R(y.$t("g.import")),1)]),_:1},8,["onClick"])):j("",!0)]))}}),ue=Symbol("assetKind"),Ne={key:0,class:"absolute top-1 left-1 size-4 rounded-full border-1 border-base-foreground bg-primary-background"},qe=["src"],Ze={key:3,class:"size-full bg-gradient-to-tr from-blue-400 via-teal-500 to-green-400"},Xe={class:"text-secondary block text-xs"},Ge=L({__name:"FormDropdownMenuItem",props:{index:{},selected:{type:Boolean},mediaSrc:{},name:{},label:{},metadata:{},layout:{}},emits:["click","mediaLoad"],setup(t,{emit:e}){const n=t,b=e,i=P(null),y=be(ue),c=u(()=>y?.value==="video");function a(){b("click",n.index)}v(a,"handleClick");function p(l){if(b("mediaLoad",l),!l.target||!(l.target instanceof HTMLImageElement))return;const s=l.target;s.naturalWidth&&s.naturalHeight&&(i.value=`${s.naturalWidth} x ${s.naturalHeight}`)}v(p,"handleImageLoad");function f(l){if(b("mediaLoad",l),!l.target||!(l.target instanceof HTMLVideoElement))return;const s=l.target;s.videoWidth&&s.videoHeight&&(i.value=`${s.videoWidth} x ${s.videoHeight}`)}return v(f,"handleVideoLoad"),(l,s)=>{const d=we("tooltip");return g(),$("div",{class:C(h(U)("flex gap-1 select-none group/item cursor-pointer bg-component-node-widget-background","transition-all duration-150",{"flex-col text-center":l.layout==="grid","flex-row text-left max-h-16 rounded-lg hover:scale-102 active:scale-98":l.layout==="list","flex-row text-left hover:bg-component-node-widget-background-hovered rounded-lg":l.layout==="list-small","ring-2 ring-component-node-widget-background-highlighted":l.layout==="list"&&l.selected})),onClick:a},[l.layout!=="list-small"?(g(),$("div",{key:0,class:C(h(U)("relative","w-full aspect-square overflow-hidden outline-1 outline-offset-[-1px] outline-interface-stroke","transition-all duration-150",{"min-w-16 max-w-16 rounded-l-lg":l.layout==="list","rounded-sm group-hover/item:scale-108 group-active/item:scale-95":l.layout==="grid","ring-2 ring-component-node-widget-background-highlighted":l.layout==="grid"&&l.selected}))},[l.selected?(g(),$("div",Ne,s[0]||(s[0]=[M("i",{class:"icon-[lucide--check] size-3 translate-y-[-0.5px] text-base-foreground bold"},null,-1)]))):j("",!0),l.mediaSrc&&c.value?(g(),$("video",{key:1,src:l.mediaSrc,class:"size-full object-cover",preload:"metadata",muted:"",onLoadeddata:f},null,40,qe)):l.mediaSrc?(g(),T(Oe,{key:2,src:l.mediaSrc,alt:l.name,"image-class":"size-full object-cover",onLoad:p},null,8,["src","alt"])):(g(),$("div",Ze))],2)):j("",!0),M("div",{class:C(h(U)("flex gap-1",{"flex-col":l.layout==="grid","flex-col px-4 py-1 w-full justify-center min-w-0":l.layout==="list","flex-row p-2 items-center justify-between w-full":l.layout==="list-small"}))},[he((g(),$("span",{class:C(h(U)("block text-xs line-clamp-2 break-words overflow-hidden","transition-colors duration-150",!!l.selected&&"text-base-foreground"))},[Se(R(l.label??l.name),1)],2)),[[d,l.layout==="grid"?l.label??l.name:void 0]]),M("span",Xe,R(l.metadata||i.value),1)],2)],2)}}}),Je={class:"flex max-h-[640px] w-103 flex-col rounded-lg bg-component-node-background pt-4 outline outline-offset-[-1px] outline-node-component-border"},Ye={class:"relative flex h-full mt-2 overflow-y-scroll"},_e={key:0,class:"h-50 col-span-full flex items-center justify-center"},et=["title","aria-label"],tt=L({__name:"FormDropdownMenu",props:Q({items:{},isSelected:{type:Function},filterOptions:{},sortOptions:{},searcher:{type:Function}},{filterSelected:{},filterSelectedModifiers:{},layoutMode:{},layoutModeModifiers:{},sortSelected:{},sortSelectedModifiers:{},searchQuery:{},searchQueryModifiers:{}}),emits:Q(["item-click"],["update:filterSelected","update:layoutMode","update:sortSelected","update:searchQuery"]),setup(t,{emit:e}){const n=e,b=V(t,"filterSelected"),i=V(t,"layoutMode"),y=V(t,"sortSelected"),c=V(t,"searchQuery");return(a,p)=>(g(),$("div",Je,[a.filterOptions.length>0?(g(),T(He,{key:0,"filter-selected":b.value,"onUpdate:filterSelected":p[0]||(p[0]=f=>b.value=f),"filter-options":a.filterOptions},null,8,["filter-selected","filter-options"])):j("",!0),F(Ke,{"layout-mode":i.value,"onUpdate:layoutMode":p[1]||(p[1]=f=>i.value=f),"sort-selected":y.value,"onUpdate:sortSelected":p[2]||(p[2]=f=>y.value=f),"search-query":c.value,"onUpdate:searchQuery":p[3]||(p[3]=f=>c.value=f),"sort-options":a.sortOptions,searcher:a.searcher},null,8,["layout-mode","sort-selected","search-query","sort-options","searcher"]),M("div",Ye,[M("div",{class:C(h(U)("h-full max-h-full grid gap-x-2 gap-y-4 overflow-y-auto px-4 pt-4 pb-4 w-full",{"grid-cols-4":i.value==="grid","grid-cols-1 gap-y-2":i.value==="list","grid-cols-1 gap-y-1":i.value==="list-small"}))},[p[4]||(p[4]=M("div",{class:"pointer-events-none absolute inset-x-3 top-0 z-10 h-5"},null,-1)),a.items.length===0?(g(),$("div",_e,[M("i",{title:a.$t("g.noItems"),"aria-label":a.$t("g.noItems"),class:"icon-[lucide--circle-off] size-30 text-zinc-500/20"},null,8,et)])):j("",!0),(g(!0),$(Y,null,_(a.items,(f,l)=>(g(),T(Ge,{key:f.id,index:l,selected:a.isSelected(f,l),"media-src":f.mediaSrc,name:f.name,label:f.label,metadata:f.metadata,layout:i.value,onClick:v(s=>n("item-click",f,l),"onClick")},null,8,["index","selected","media-src","name","label","metadata","layout","onClick"]))),128))],2)])]))}});async function lt(t,e){if(t.trim()==="")return e;const n=t.trim().toLowerCase().split(" ");return e.filter(b=>{const i=b.name.toLowerCase();return n.every(y=>i.includes(y))})}v(lt,"defaultSearcher");function ot(){return[{name:"Default",id:"default",sorter:v(({items:t})=>t.slice(),"sorter")},{name:"A-Z",id:"a-z",sorter:v(({items:t})=>t.slice().sort((e,n)=>e.name.localeCompare(n.name)),"sorter")}]}v(ot,"getDefaultSortOptions");const at=L({__name:"FormDropdown",props:Q({items:{},placeholder:{default:B("widgets.uploadSelect.placeholder")},multiple:{type:[Boolean,Number],default:!1},uploadable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},accept:{},filterOptions:{default:v(()=>[],"default")},sortOptions:{default:v(()=>ot(),"default")},isSelected:{type:Function,default:v((t,e,n)=>t.has(e.id),"default")},searcher:{type:Function,default:lt}},{selected:{default:new Set},selectedModifiers:{},filterSelected:{default:""},filterSelectedModifiers:{},sortSelected:{default:"default"},sortSelectedModifiers:{},layoutMode:{default:"grid"},layoutModeModifiers:{},files:{default:[]},filesModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:selected","update:filterSelected","update:sortSelected","update:layoutMode","update:files","update:searchQuery"],setup(t){const e=t,n=V(t,"selected"),b=V(t,"filterSelected"),i=V(t,"sortSelected"),y=V(t,"layoutMode"),c=V(t,"files"),a=V(t,"searchQuery"),p=le(),f=P(),l=J("triggerRef"),s=P(!1),d=u(()=>e.multiple===!0?1/0:typeof e.multiple=="number"?e.multiple:1),S=P([]),z=u(()=>e.sortOptions.find(w=>w.id==="default")?.sorter||(({items:w})=>w.slice())),W=u(()=>i.value==="default"?z.value:e.sortOptions.find(w=>w.id===i.value)?.sorter||z.value),A=u(()=>W.value({items:S.value})||[]);function I(k,w){return e.isSelected?.(n.value,k,w)??!1}v(I,"internalIsSelected");const H=v(k=>{e.disabled||f.value&&l.value&&(f.value.toggle(k,l.value),s.value=!s.value)},"toggleDropdown"),N=v(()=>{f.value&&(f.value.hide(),s.value=!1)},"closeDropdown");function q(k){if(e.disabled)return;const w=k.target;w.files&&(c.value=Array.from(w.files)),w.value=""}v(q,"handleFileChange");function X(k,w){if(e.disabled)return;const x=n.value;if(I(k,w))x.delete(k.id);else if(x.size<d.value)x.add(k.id);else if(d.value===1)x.clear(),x.add(k.id);else{p.addAlert("Maximum selection limit reached");return}n.value=new Set(x),d.value===1&&N()}v(X,"handleSelection");async function G(k,w){let x=!1,r;w(()=>{x=!0,r?.()}),await e.searcher(k,e.items,o=>r=o).then(o=>{x||(S.value=o)})}return v(G,"customSearcher"),(k,w)=>(g(),$("div",{ref_key:"triggerRef",ref:l},[F(Pe,{files:c.value,"is-open":s.value,placeholder:k.placeholder,items:k.items,"max-selectable":d.value,selected:n.value,uploadable:k.uploadable,disabled:k.disabled,accept:k.accept,onSelectClick:H,onFileChange:q},null,8,["files","is-open","placeholder","items","max-selectable","selected","uploadable","disabled","accept"]),F(h(ae),{ref_key:"popoverRef",ref:f,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"]}},onHide:w[4]||(w[4]=x=>s.value=!1)},{default:E(()=>[F(tt,{"filter-selected":b.value,"onUpdate:filterSelected":w[0]||(w[0]=x=>b.value=x),"layout-mode":y.value,"onUpdate:layoutMode":w[1]||(w[1]=x=>y.value=x),"sort-selected":i.value,"onUpdate:sortSelected":w[2]||(w[2]=x=>i.value=x),"search-query":a.value,"onUpdate:searchQuery":w[3]||(w[3]=x=>a.value=x),"filter-options":k.filterOptions,"sort-options":k.sortOptions,disabled:k.disabled,searcher:G,items:A.value,"is-selected":I,"max-selectable":d.value,onClose:N,onItemClick:X},null,8,["filter-selected","layout-mode","sort-selected","search-query","filter-options","sort-options","disabled","items","max-selectable"])]),_:1},512)],512))}});function st(t){return{category:u(()=>{}),assets:u(()=>[]),dropdownItems:u(()=>[]),isLoading:u(()=>!1),error:u(()=>null)}}v(st,"useAssetWidgetData");const nt=L({__name:"WidgetSelectDropdown",props:Q({widget:{},nodeType:{},assetKind:{},allowUpload:{type:Boolean},uploadFolder:{},isAssetMode:{type:Boolean},defaultLayoutMode:{}},{modelValue:{default(t){return t.widget.options?.values?.[0]||""}},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t;ke(ue,u(()=>e.assetKind));const n=V(t,"modelValue"),b=le(),i=fe(),y=de(),c=u(()=>({...se(e.widget.options,ne),...y.value})),p=v(()=>{const r=e.widget.options?.nodeType??e.nodeType;return e.isAssetMode&&r?st(xe(r)):null},"getAssetData")(),f=P("all"),l=u(()=>{if(e.isAssetMode){const r=p?.category.value??"All";return[{id:"all",name:Me(r)}]}return[{id:"all",name:"All"},{id:"inputs",name:"Inputs"},{id:"outputs",name:"Outputs"}]}),s=P(new Set);function d(r){const o=e.widget.options?.getOptionLabel;if(!o)return r;try{return o(r)}catch(m){return console.error("Failed to map value:",m),r}}v(d,"getDisplayLabel");const S=u(()=>{const r=e.widget.options?.values||[];return Array.isArray(r)?r.map((o,m)=>({id:`input-${m}`,mediaSrc:x(o,"input"),name:o,label:d(o),metadata:""})):[]}),z=u(()=>{if(!["image","video"].includes(e.assetKind??""))return[];const r=new Set;return i.historyTasks.forEach(o=>{o.flatOutputs.forEach(m=>{const O=e.assetKind==="image"&&m.mediaType==="images"||e.assetKind==="video"&&m.mediaType==="video";if(m.type==="output"&&O){const K=`${m.subfolder?`${m.subfolder}/${m.filename}`:m.filename} [output]`;r.add(K)}})}),Array.from(r).map(o=>({id:`output-${o}`,mediaSrc:x(o.replace(" [output]",""),"output"),name:o,label:d(o),metadata:""}))}),W=u(()=>e.isAssetMode&&p?p.dropdownItems.value:[...S.value,...z.value]),A=u(()=>{if(e.isAssetMode)return W.value;switch(f.value){case"inputs":return S.value;case"outputs":return z.value;case"all":default:return[...S.value,...z.value]}}),I=u(()=>{const r=e.widget.options;if(r?.placeholder)return r.placeholder;switch(e.assetKind){case"image":return B("widgets.uploadSelect.placeholderImage");case"video":return B("widgets.uploadSelect.placeholderVideo");case"audio":return B("widgets.uploadSelect.placeholderAudio");case"model":return B("widgets.uploadSelect.placeholderModel");case"unknown":return B("widgets.uploadSelect.placeholderUnknown")}return B("widgets.uploadSelect.placeholder")}),H=u(()=>e.isAssetMode?!1:e.allowUpload===!0),N=u(()=>{switch(e.assetKind){case"image":return"image/*";case"video":return"video/*";case"audio":return"audio/*";default:return}}),q=P(e.defaultLayoutMode??"grid");$e([n,A],([r,o])=>{if(r===void 0){s.value.clear();return}const m=A.value.find(O=>O.name===r);m&&(s.value.clear(),s.value.add(m.id))},{immediate:!0});function X(r){let o;if(r.size>0&&(o=r.values().next().value),o==null){n.value=void 0;return}const m=A.value.find(O=>O.id===o)?.name;if(!m){n.value=void 0;return}n.value=m}v(X,"updateSelectedItems");const G=v(async(r,o=!1,m={})=>{const O=new FormData;O.append("image",r),o&&O.append("subfolder","pasted"),m.type&&O.append("type",m.type);const D=await me.fetchApi("/upload/image",{method:"POST",body:O});if(D.status!==200)return b.addAlert(D.status+" - "+D.statusText),null;const K=await D.json();return(m.type==="input"||!m.type&&!o)&&await ve().updateInputs(),K.subfolder?`${K.subfolder}/${K.name}`:K.name},"uploadFile"),k=v(async r=>{const o=e.uploadFolder??"input",m=r.map(D=>G(D,!1,{type:o}));return(await Promise.all(m)).filter(D=>D!==null)},"uploadFiles");async function w(r){if(!(!r||r.length===0))try{const o=await k(r);if(o.length===0){b.addAlert("File upload failed");return}e.widget.options?.values&&o.forEach(m=>{const O=e.widget.options.values;O.includes(m)||O.push(m)}),n.value=o[0],e.widget.callback&&e.widget.callback(o[0])}catch(o){console.error("Upload error:",o),b.addAlert(`Upload failed: ${o}`)}}v(w,"handleFilesUpdate");function x(r,o="input"){return["image","video"].includes(e.assetKind??"")?`/api/view?filename=${encodeURIComponent(r)}&type=${o}`:""}return v(x,"getMediaUrl"),(r,o)=>(g(),T(re,{widget:r.widget},{default:E(()=>[F(at,oe({selected:s.value,"onUpdate:selected":o[0]||(o[0]=m=>s.value=m),"filter-selected":f.value,"onUpdate:filterSelected":o[1]||(o[1]=m=>f.value=m),"layout-mode":q.value,"onUpdate:layoutMode":o[2]||(o[2]=m=>q.value=m),items:A.value,placeholder:I.value,multiple:!1,uploadable:H.value,accept:N.value,"filter-options":l.value},c.value,{class:"w-full","onUpdate:selected":X,"onUpdate:files":w}),null,16,["selected","filter-selected","layout-mode","items","placeholder","uploadable","accept","filter-options"])]),_:1},8,["widget"]))}}),bt=L({__name:"WidgetSelect",props:Q({widget:{},nodeType:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,n=V(t,"modelValue"),b=u(()=>{if(e.widget.spec&&ge(e.widget.spec))return e.widget.spec}),i=u(()=>{const s=b.value;if(!s)return{kind:"unknown",allowUpload:!1,folder:void 0};const{image_upload:d,animated_image_upload:S,video_upload:z,image_folder:W,audio_upload:A}=s;let I="unknown";return z?I="video":d||S?I="image":A&&(I="audio"),{kind:I,allowUpload:d===!0||S===!0||z===!0||A===!0,folder:W}}),y=u(()=>!1),c=u(()=>i.value.kind),a=u(()=>y.value||c.value!=="unknown"),p=u(()=>i.value.allowUpload),f=u(()=>i.value.folder??"input"),l=u(()=>y.value?"list":"grid");return(s,d)=>a.value?(g(),T(nt,{key:0,modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=S=>n.value=S),widget:s.widget,"node-type":s.widget.nodeType??s.nodeType,"asset-kind":c.value,"allow-upload":p.value,"upload-folder":f.value,"is-asset-mode":y.value,"default-layout-mode":l.value},null,8,["modelValue","widget","node-type","asset-kind","allow-upload","upload-folder","is-asset-mode","default-layout-mode"])):s.widget.controlWidget?(g(),T(ze,{key:1,modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=S=>n.value=S),component:ee,widget:s.widget},null,8,["modelValue","widget"])):(g(),T(ee,{key:2,modelValue:n.value,"onUpdate:modelValue":d[2]||(d[2]=S=>n.value=S),widget:s.widget},null,8,["modelValue","widget"]))}});export{bt as _};
//# sourceMappingURL=WidgetSelect.vue_vue_type_script_setup_true_lang-Ua67RWUI.js.map
