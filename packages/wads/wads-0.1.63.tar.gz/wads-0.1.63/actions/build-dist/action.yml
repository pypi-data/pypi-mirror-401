name: "Build Distribution"
description: "Build Python distribution packages using modern PEP 517 build tools"

inputs:
  build-backend:
    description: "Build backend to use (defaults to auto-detect from pyproject.toml)"
    required: false
  output-dir:
    description: "Output directory for built distributions"
    required: false
    default: "dist"
  sdist:
    description: "Build source distribution"
    required: false
    default: "true"
  wheel:
    description: "Build wheel distribution"
    required: false
    default: "true"
  ssh-private-key:
    description: "SSH private key for installing private dependencies"
    required: false

runs:
  using: 'composite'
  steps:
    - name: Configure SSH
      if: ${{ inputs.ssh-private-key }}
      uses: webfactory/ssh-agent@v0.7.0
      with:
        ssh-private-key: ${{ inputs.ssh-private-key }}

    - name: Build Distributions
      shell: bash
      run: |
        set -e
        
        build_args="--output-dir=${{ inputs.output-dir }}"
        
        if [ "${{ inputs.sdist }}" = "false" ]; then
          build_args="$build_args --no-sdist"
        fi
        
        if [ "${{ inputs.wheel }}" = "false" ]; then
          build_args="$build_args --no-wheel"
        fi
        
        python3 -m wads.scripts.build_dist $build_args
