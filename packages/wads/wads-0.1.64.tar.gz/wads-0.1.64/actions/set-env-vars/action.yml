name: 'Set Environment Variables from Secrets'
description: 'Conditionally set environment variables from GitHub Secrets with validation'
branding:
  icon: 'key'
  color: 'green'

inputs:
  pyproject-path:
    description: 'Path to pyproject.toml file or directory containing it'
    required: false
    default: '.'

runs:
  using: 'composite'
  steps:
    - name: Set up Python for env var setup
      uses: actions/setup-python@v6
      with:
        python-version: '3.11'

    - name: Install wads (for CI config utilities)
      shell: bash
      run: |
        python -m pip install --quiet 'wads>=0.1.48'

    - name: Set Environment Variables
      shell: bash
      env:
        # Pass all secrets as JSON (GitHub Actions automatic behavior)
        SECRETS_CONTEXT: ${{ toJson(secrets) }}
      run: |
        python3 -m wads.scripts.set_env_vars "${{ inputs.pyproject-path }}"

    - name: Validate Environment
      shell: bash
      run: |
        echo "âœ… Environment variables configured successfully"

