name: 'Read CI Config from pyproject.toml'
description: 'Extract CI configuration from pyproject.toml and export as outputs and env vars'
branding:
  icon: 'settings'
  color: 'blue'

inputs:
  pyproject-path:
    description: 'Path to pyproject.toml file or directory containing it'
    required: false
    default: '.'

outputs:
  project-name:
    description: 'Project name'
    value: ${{ steps.config.outputs.project-name }}
  python-versions:
    description: 'Python versions as JSON array'
    value: ${{ steps.config.outputs.python-versions }}
  pytest-args:
    description: 'Pytest arguments as space-separated string'
    value: ${{ steps.config.outputs.pytest-args }}
  coverage-enabled:
    description: 'Whether coverage is enabled (true/false)'
    value: ${{ steps.config.outputs.coverage-enabled }}
  exclude-paths:
    description: 'Paths to exclude from tests'
    value: ${{ steps.config.outputs.exclude-paths }}
  test-on-windows:
    description: 'Whether to test on Windows (true/false)'
    value: ${{ steps.config.outputs.test-on-windows }}
  build-sdist:
    description: 'Whether to build source distribution (true/false)'
    value: ${{ steps.config.outputs.build-sdist }}
  build-wheel:
    description: 'Whether to build wheel (true/false)'
    value: ${{ steps.config.outputs.build-wheel }}
  metrics-enabled:
    description: 'Whether code metrics tracking is enabled (true/false)'
    value: ${{ steps.config.outputs.metrics-enabled }}
  metrics-config-path:
    description: 'Path to umpyre config file'
    value: ${{ steps.config.outputs.metrics-config-path }}
  metrics-storage-branch:
    description: 'Git branch to store metrics data'
    value: ${{ steps.config.outputs.metrics-storage-branch }}
  metrics-python-version:
    description: 'Python version for metrics collection'
    value: ${{ steps.config.outputs.metrics-python-version }}
  metrics-force-run:
    description: 'Run metrics even if workflow failed (true/false)'
    value: ${{ steps.config.outputs.metrics-force-run }}

runs:
  using: 'composite'
  steps:
    - name: Set up Python for config reading
      uses: actions/setup-python@v6
      with:
        python-version: '3.11'

    - name: Install wads (for CI config utilities)
      shell: bash
      run: |
        python -m pip install --quiet 'wads>=0.1.48'

    - name: Read CI Configuration
      id: config
      shell: bash
      run: |
        python3 -m wads.scripts.read_ci_config "${{ inputs.pyproject-path }}"
